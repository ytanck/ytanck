<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>9个你不知道的 CSS 伪元素</title>
    <url>/test/post/CSS%E4%BC%AA%E5%85%83%E7%B4%A0/</url>
    <content><![CDATA[<h2 id="9个你不知道的-CSS-伪元素"><a href="#9个你不知道的-CSS-伪元素" class="headerlink" title="9个你不知道的 CSS 伪元素"></a>9个你不知道的 CSS 伪元素</h2><p>CSS 伪元素是一项强大的功能，它允许您为所选元素的特定部分设置样式，而无需额外的 JavaScript 代码。<br>虽然许多开发人员都熟悉常用的伪元素，如 ::before 和 ::after，但还有一些其他元素经常被忽视或未得到充分利用。 </p>
<h3 id="1-selection-伪元素"><a href="#1-selection-伪元素" class="headerlink" title="1. ::selection 伪元素"></a>1. ::selection 伪元素</h3><p>::selection 伪元素以用户选择的文本部分为目标。它提供了一种将样式应用于所选文本并自定义其外观的方法。 </p>
<p>例子：</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-pseudo">::selection</span> &#123;</span><br><span class="line">  <span class="attribute">background-color</span>: yellow;</span><br><span class="line">  <span class="attribute">color</span>: red;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在上面的代码中，当用户在页面上选择文本时，它将以黄色背景和红色文本颜色突出显示。</p>
<h3 id="2-first-letter伪元素"><a href="#2-first-letter伪元素" class="headerlink" title="2.::first-letter伪元素"></a>2.::first-letter伪元素</h3><p>::first-letter 伪元素允许您设置块级元素的第一个字母的样式。当您想将特殊格式应用于段落或标题的初始字符时，它会派上用场。 </p>
<p>例子：</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">p</span><span class="selector-pseudo">::first-letter</span> &#123;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">2em</span>;</span><br><span class="line">  <span class="attribute">color</span>: red;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在上面的代码片段中，每个段落的第一个字母将以更大的字体显示并显示为红色。</p>
<h3 id="3-first-line-伪元素"><a href="#3-first-line-伪元素" class="headerlink" title="3. ::first-line 伪元素"></a>3. ::first-line 伪元素</h3><p>类似于 ::first-letter，::first-line 伪元素以文本或块级元素的第一行为目标。您可以使用此伪元素将特定样式应用于段落或标题的起始行。 </p>
<p>例子：</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">p</span><span class="selector-pseudo">::first-line</span> &#123;</span><br><span class="line">  <span class="attribute">font-weight</span>: bold;</span><br><span class="line">  <span class="attribute">text-decoration</span>: underline;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在上面的代码中，每个段落的第一行将以粗体显示并带有下划线。</p>
<h3 id="4-marker-伪元素"><a href="#4-marker-伪元素" class="headerlink" title="4. ::marker 伪元素"></a>4. ::marker 伪元素</h3><p>::marker 伪元素以列表项的标记为目标，例如无序列表中的项目符号点或有序列表中的数字。使用此伪元素，您可以自定义标记的外观。 </p>
<p>例子：</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">li</span><span class="selector-pseudo">::marker</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: blue;</span><br><span class="line">  <span class="attribute">font-weight</span>: bold;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="5-placeholder-伪元素"><a href="#5-placeholder-伪元素" class="headerlink" title="5. ::placeholder 伪元素"></a>5. ::placeholder 伪元素</h3><p>::placeholder 伪元素允许您在输入字段和文本区域中设置占位符文本的样式。通过将自定义样式应用到占位符，您可以增强用户体验并使其与您的整体设计保持一致。 </p>
<p>例子：</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">input</span><span class="selector-pseudo">::placeholder</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#999</span>;</span><br><span class="line">  <span class="attribute">font-style</span>: italic;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在上面的代码中，输入字段中的占位符文本将以浅灰色和斜体字体样式显示。</p>
<h3 id="6-cue-伪元素"><a href="#6-cue-伪元素" class="headerlink" title="6. ::cue 伪元素"></a>6. ::cue 伪元素</h3><p>::cue 伪元素以 <audio> 或 <video> 元素的提示文本为目标。提示文本通常用于多媒体内容中的字幕或副标题。使用此伪元素，您可以将样式专门应用于提示文本。 </p>
<p>例子：</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">video</span><span class="selector-pseudo">::cue</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: white;</span><br><span class="line">  <span class="attribute">background-color</span>: black;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在上面的代码中，视频元素中的提示文本将具有白色文本颜色和黑色背景。</p>
<h3 id="7-grammar-error-和-spelling-error-伪元素"><a href="#7-grammar-error-和-spelling-error-伪元素" class="headerlink" title="7. ::grammar-error 和::spelling-error 伪元素"></a>7. ::grammar-error 和::spelling-error 伪元素</h3><p>::grammar-error 和 ::spelling-error 伪元素允许您分别对标记为语法或拼写错误的文本部分设置样式。当内容中存在错误时，这些伪元素可用于向用户提供视觉提示。 </p>
<p>例子：</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="selector-tag">p</span><span class="selector-pseudo">::grammar-error</span> &#123;</span><br><span class="line">  <span class="attribute">text-decoration</span>: line-through;</span><br><span class="line">  <span class="attribute">color</span>: red;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">p</span><span class="selector-pseudo">::spelling-error</span> &#123;</span><br><span class="line">  <span class="attribute">text-decoration</span>: underline;</span><br><span class="line">  <span class="attribute">color</span>: blue;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在上面的代码中，段落中的语法错误将以划线文本修饰和红色显示，而拼写错误将以下划线和蓝色显示。</p>
<h3 id="8-backdrop-伪元素"><a href="#8-backdrop-伪元素" class="headerlink" title="8. ::backdrop 伪元素"></a>8. ::backdrop 伪元素</h3><p>::backdrop 伪元素与全屏 API 结合使用，以在全屏模式下自定义元素背后的背景。它允许您将默认的黑色背景更改为自定义颜色或样式。 </p>
<p>例子：</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">video</span><span class="selector-pseudo">::backdrop</span> &#123;</span><br><span class="line">  <span class="attribute">background-color</span>: gray;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在上面的代码中，当一个视频元素处于全屏模式时，它后面的背景将有一个灰色的背景色。</p>
<h3 id="9-target-text-伪元素"><a href="#9-target-text-伪元素" class="headerlink" title="9. ::target-text 伪元素"></a>9. ::target-text 伪元素</h3><p>::target-text CSS 伪元素代表滚动到的文本（如果浏览器支持文本片段）。它允许作者选择如何突出显示该部分文本。 </p>
<p>例子：</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line">::target-text &#123;</span><br><span class="line">  <span class="attribute">background-color</span>: rebeccapurple;</span><br><span class="line">  <span class="attribute">color</span>: white;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这是 MDN 提供的在线示例。请注意，此 API 目前处于试验阶段。</p>
<p><strong>结论</strong></p>
<p>CSS 伪元素为元素的特定部分设置样式和增强网页的视觉吸引力提供了广泛的可能性。您无需使用过多的 JavaScript 代码即可实现令人印象深刻的样式效果。</p>
]]></content>
      <categories>
        <category>前端</category>
      </categories>
      <tags>
        <tag>CSS</tag>
      </tags>
  </entry>
  <entry>
    <title>20道大厂面试题</title>
    <url>/test/post/20%E9%81%93%E5%A4%A7%E5%8E%82%E9%9D%A2%E8%AF%95%E9%A2%98/</url>
    <content><![CDATA[<h2 id="1-new的实现原理是什么？"><a href="#1-new的实现原理是什么？" class="headerlink" title="1. new的实现原理是什么？"></a>1. new的实现原理是什么？</h2><p>new 的实现原理:</p>
<ul>
<li>创建一个空对象，构造函数中的this指向这个空对象</li>
<li>这个新对象被执行 [[原型]] 连接</li>
<li>执行构造函数方法，属性和方法被添加到this引用的对象中</li>
<li>如果构造函数中没有返回其它对象，那么返回this，即创建的这个的新对象，否则，返回构造函数中返回的对象。<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">_new</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> target = &#123;&#125;; <span class="comment">//创建的新对象</span></span><br><span class="line">    <span class="comment">//第一个参数是构造函数</span></span><br><span class="line">    <span class="keyword">let</span> [constructor, ...args] = [...<span class="variable language_">arguments</span>];</span><br><span class="line">    <span class="comment">//执行[[原型]]连接;target 是 constructor 的实例</span></span><br><span class="line">    target.<span class="property">__proto__</span> = constructor.<span class="property"><span class="keyword">prototype</span></span>;</span><br><span class="line">    <span class="comment">//执行构造函数，将属性或方法添加到创建的空对象上</span></span><br><span class="line">    <span class="keyword">let</span> result = constructor.<span class="title function_">apply</span>(target, args);</span><br><span class="line">    <span class="keyword">if</span> (result &amp;&amp; (<span class="keyword">typeof</span> (result) == <span class="string">&quot;object&quot;</span> || <span class="keyword">typeof</span> (result) == <span class="string">&quot;function&quot;</span>)) &#123;</span><br><span class="line">        <span class="comment">//如果构造函数执行的结构返回的是一个对象，那么返回这个对象</span></span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//如果构造函数返回的不是一个对象，返回创建的新对象</span></span><br><span class="line">    <span class="keyword">return</span> target;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="2-如何正确判断this的指向？"><a href="#2-如何正确判断this的指向？" class="headerlink" title="2. 如何正确判断this的指向？"></a>2. 如何正确判断this的指向？</h2><p>如果用一句话说明 this 的指向，那么即是: 谁调用它，this 就指向谁。</p>
<p>但是仅通过这句话，我们很多时候并不能准确判断 this 的指向。因此我们需要借助一些规则去帮助自己：</p>
<p>this 的指向可以按照以下顺序判断:</p>
<p><strong>全局环境中的 this</strong></p>
<p>浏览器环境：无论是否在严格模式下，在全局执行环境中（在任何函数体外部）this 都指向全局对象 window;</p>
<p>node 环境：无论是否在严格模式下，在全局执行环境中（在任何函数体外部），this 都是空对象 {};</p>
<p><strong>是否是 new 绑定</strong></p>
<p>如果是 new 绑定，并且构造函数中没有返回 function 或者是 object，那么 this 指向这个新对象。如下:</p>
<blockquote>
<p>构造函数返回值不是 function 或 object。new Super() 返回的是 this 对象。</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Super</span>(<span class="params">age</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">age</span> = age;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> instance = <span class="keyword">new</span> <span class="title class_">Super</span>(<span class="string">&#x27;26&#x27;</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(instance.<span class="property">age</span>); <span class="comment">//26</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>构造函数返回值是 function 或 object，new Super()是返回的是Super种返回的对象。</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Super</span>(<span class="params">age</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">age</span> = age;</span><br><span class="line">    <span class="keyword">let</span> obj = &#123;<span class="attr">a</span>: <span class="string">&#x27;2&#x27;</span>&#125;;</span><br><span class="line">    <span class="keyword">return</span> obj;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> instance = <span class="keyword">new</span> <span class="title class_">Super</span>(<span class="string">&#x27;hello&#x27;</span>); </span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(instance);<span class="comment">//&#123; a: &#x27;2&#x27; &#125;</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(instance.<span class="property">age</span>); <span class="comment">//undefined</span></span><br></pre></td></tr></table></figure>

<p><strong>函数是否通过 call,apply 调用，或者使用了 bind 绑定，如果是，那么this绑定的就是指定的对象【归结为显式绑定】。</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">info</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">age</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> person = &#123;</span><br><span class="line">    <span class="attr">age</span>: <span class="number">20</span>,</span><br><span class="line">    info</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> age = <span class="number">28</span>;</span><br><span class="line"><span class="keyword">var</span> info = person.<span class="property">info</span>;</span><br><span class="line">info.<span class="title function_">call</span>(person);   <span class="comment">//20</span></span><br><span class="line">info.<span class="title function_">apply</span>(person);  <span class="comment">//20</span></span><br><span class="line">info.<span class="title function_">bind</span>(person)(); <span class="comment">//20</span></span><br></pre></td></tr></table></figure>
<p>这里同样需要注意一种特殊情况，如果 call,apply 或者 bind 传入的第一个参数值是 undefined 或者 null，严格模式下 this 的值为传入的值 null &#x2F;undefined。非严格模式下，实际应用的默认绑定规则，this 指向全局对象(node环境为global，浏览器环境为window)</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">info</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="comment">//node环境中:非严格模式 global，严格模式为null</span></span><br><span class="line">    <span class="comment">//浏览器环境中:非严格模式 window，严格模式为null</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">age</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> person = &#123;</span><br><span class="line">    <span class="attr">age</span>: <span class="number">20</span>,</span><br><span class="line">    info</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> age = <span class="number">28</span>;</span><br><span class="line"><span class="keyword">var</span> info = person.<span class="property">info</span>;</span><br><span class="line"><span class="comment">//严格模式抛出错误；</span></span><br><span class="line"><span class="comment">//非严格模式，node下输出undefined（因为全局的age不会挂在 global 上）</span></span><br><span class="line"><span class="comment">//非严格模式。浏览器环境下输出 28（因为全局的age会挂在 window 上）</span></span><br><span class="line">info.<span class="title function_">call</span>(<span class="literal">null</span>);</span><br></pre></td></tr></table></figure>
<p><strong>隐式绑定，函数的调用是在某个对象上触发的，即调用位置上存在上下文对象。典型的隐式调用为: xxx.fn()</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">info</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">age</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> person = &#123;</span><br><span class="line">    <span class="attr">age</span>: <span class="number">20</span>,</span><br><span class="line">    info</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> age = <span class="number">28</span>;</span><br><span class="line">person.<span class="title function_">info</span>(); <span class="comment">//20;执行的是隐式绑定</span></span><br></pre></td></tr></table></figure>
<p><strong>默认绑定，在不能应用其它绑定规则时使用的默认规则，通常是独立函数调用。</strong></p>
<p>非严格模式： node环境，执行全局对象 global，浏览器环境，执行全局对象 window。</p>
<p>严格模式：执行 undefined</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">info</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">age</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> age = <span class="number">28</span>;</span><br><span class="line"><span class="comment">//严格模式；抛错</span></span><br><span class="line"><span class="comment">//非严格模式，node下输出 undefined（因为全局的age不会挂在 global 上）</span></span><br><span class="line"><span class="comment">//非严格模式。浏览器环境下输出 28（因为全局的age会挂在 window 上）</span></span><br><span class="line"><span class="comment">//严格模式抛出，因为 this 此时是 undefined</span></span><br><span class="line"><span class="title function_">info</span>(); </span><br></pre></td></tr></table></figure>
<p><strong>箭头函数的情况：</strong></p>
<p>箭头函数没有自己的this，继承外层上下文绑定的this。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> obj = &#123;</span><br><span class="line">    <span class="attr">age</span>: <span class="number">20</span>,</span><br><span class="line">    <span class="attr">info</span>: <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="function">() =&gt;</span> &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">age</span>); <span class="comment">//this继承的是外层上下文绑定的this</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> person = &#123;<span class="attr">age</span>: <span class="number">28</span>&#125;;</span><br><span class="line"><span class="keyword">let</span> info = obj.<span class="title function_">info</span>();</span><br><span class="line"><span class="title function_">info</span>(); <span class="comment">//20</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> info2 = obj.<span class="property">info</span>.<span class="title function_">call</span>(person);</span><br><span class="line"><span class="title function_">info2</span>(); <span class="comment">//28</span></span><br></pre></td></tr></table></figure>

<h2 id="3-深拷贝和浅拷贝的区别是什么？实现一个深拷贝"><a href="#3-深拷贝和浅拷贝的区别是什么？实现一个深拷贝" class="headerlink" title="3. 深拷贝和浅拷贝的区别是什么？实现一个深拷贝"></a>3. 深拷贝和浅拷贝的区别是什么？实现一个深拷贝</h2><p>深拷贝和浅拷贝是针对复杂数据类型来说的，浅拷贝只拷贝一层，而深拷贝是层层拷贝。</p>
<p><strong>深拷贝</strong></p>
<blockquote>
<p>深拷贝复制变量值，对于非基本类型的变量，则递归至基本类型变量后，再复制。 深拷贝后的对象与原来的对象是完全隔离的，互不影响，对一个对象的修改并不会影响另一个对象。</p>
</blockquote>
<p><strong>浅拷贝</strong></p>
<blockquote>
<p>浅拷贝是会将对象的每个属性进行依次复制，但是当对象的属性值是引用类型时，实质复制的是其引用，当引用指向的值改变时也会跟着变化。</p>
</blockquote>
<p>可以使用 for in、 Object.assign、 扩展运算符 … 、Array.prototype.slice()、Array.prototype.concat() 等，例如:</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> obj = &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;Yvette&#x27;</span>,</span><br><span class="line">    <span class="attr">age</span>: <span class="number">18</span>,</span><br><span class="line">    <span class="attr">hobbies</span>: [<span class="string">&#x27;reading&#x27;</span>, <span class="string">&#x27;photography&#x27;</span>]</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> obj2 = <span class="title class_">Object</span>.<span class="title function_">assign</span>(&#123;&#125;, obj);</span><br><span class="line"><span class="keyword">let</span> obj3 = &#123;...obj&#125;;</span><br><span class="line"></span><br><span class="line">obj.<span class="property">name</span> = <span class="string">&#x27;Jack&#x27;</span>;</span><br><span class="line">obj.<span class="property">hobbies</span>.<span class="title function_">push</span>(<span class="string">&#x27;coding&#x27;</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(obj);<span class="comment">//&#123; name: &#x27;Jack&#x27;, age: 18,hobbies: [ &#x27;reading&#x27;, &#x27;photography&#x27;, &#x27;coding&#x27; ] &#125;</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(obj2);<span class="comment">//&#123; name: &#x27;Yvette&#x27;, age: 18,hobbies: [ &#x27;reading&#x27;, &#x27;photography&#x27;, &#x27;coding&#x27; ] &#125;</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(obj3);<span class="comment">//&#123; name: &#x27;Yvette&#x27;, age: 18,hobbies: [ &#x27;reading&#x27;, &#x27;photography&#x27;, &#x27;coding&#x27; ] &#125;</span></span><br></pre></td></tr></table></figure>
<p>可以看出浅拷贝只最第一层属性进行了拷贝，当第一层的属性值是基本数据类型时，新的对象和原对象互不影响，但是如果第一层的属性值是复杂数据类型，那么新对象和原对象的属性值其指向的是同一块内存地址。</p>
<p><strong>深拷贝实现</strong></p>
<blockquote>
<p>1.深拷贝最简单的实现是: JSON.parse(JSON.stringify(obj))</p>
</blockquote>
<p>JSON.parse(JSON.stringify(obj)) 是最简单的实现方式，但是有一些缺陷：</p>
<ol>
<li>对象的属性值是函数时，无法拷贝。</li>
<li>原型链上的属性无法拷贝</li>
<li>不能正确的处理 Date 类型的数据</li>
<li>不能处理 RegExp</li>
<li>会忽略 symbol</li>
<li>会忽略 undefined</li>
</ol>
<blockquote>
<p>2.实现一个 deepClone 函数</p>
</blockquote>
<ol>
<li>如果是基本数据类型，直接返回</li>
<li>如果是 RegExp 或者 Date 类型，返回对应类型</li>
<li>如果是复杂数据类型，递归。</li>
<li>考虑循环引用的问题</li>
</ol>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">deepClone</span>(<span class="params">obj, hash = <span class="keyword">new</span> <span class="built_in">WeakMap</span>()</span>) &#123; <span class="comment">//递归拷贝</span></span><br><span class="line">    <span class="keyword">if</span> (obj <span class="keyword">instanceof</span> <span class="title class_">RegExp</span>) <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">RegExp</span>(obj);</span><br><span class="line">    <span class="keyword">if</span> (obj <span class="keyword">instanceof</span> <span class="title class_">Date</span>) <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Date</span>(obj);</span><br><span class="line">    <span class="keyword">if</span> (obj === <span class="literal">null</span> || <span class="keyword">typeof</span> obj !== <span class="string">&#x27;object&#x27;</span>) &#123;</span><br><span class="line">        <span class="comment">//如果不是复杂数据类型，直接返回</span></span><br><span class="line">        <span class="keyword">return</span> obj;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (hash.<span class="title function_">has</span>(obj)) &#123;</span><br><span class="line">        <span class="keyword">return</span> hash.<span class="title function_">get</span>(obj);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 如果obj是数组，那么 obj.constructor 是 [Function: Array]</span></span><br><span class="line"><span class="comment">     * 如果obj是对象，那么 obj.constructor 是 [Function: Object]</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">let</span> t = <span class="keyword">new</span> obj.<span class="title function_">constructor</span>(<span class="params"></span>);</span><br><span class="line">    hash.<span class="title function_">set</span>(obj, t);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> key <span class="keyword">in</span> obj) &#123;</span><br><span class="line">        <span class="comment">//递归</span></span><br><span class="line">        <span class="keyword">if</span> (obj.<span class="title function_">hasOwnProperty</span>(key)) &#123;<span class="comment">//是否是自身的属性</span></span><br><span class="line">            t[key] = <span class="title function_">deepClone</span>(obj[key], hash);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> t;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="4-call-apply-的实现原理是什么？"><a href="#4-call-apply-的实现原理是什么？" class="headerlink" title="4. call&#x2F;apply 的实现原理是什么？"></a>4. call&#x2F;apply 的实现原理是什么？</h2><p>call 和 apply 的功能相同，都是改变 this 的执行，并立即执行函数。区别在于传参方式不同。</p>
<ul>
<li><p>func.call(thisArg, arg1, arg2, …)：第一个参数是 this 指向的对象，其它参数依次传入。</p>
</li>
<li><p>func.apply(thisArg, [argsArray])：第一个参数是 this 指向的对象，第二个参数是数组或类数组。</p>
</li>
</ul>
<p>一起思考一下，如何模拟实现 call ？</p>
<p>首先，我们知道，函数都可以调用 call，说明 call 是函数原型上的方法，所有的实例都可以调用。即: Function.prototype.call。</p>
<ul>
<li>在 call 方法中获取调用call()函数</li>
<li>如果第一个参数没有传入，那么默认指向 window &#x2F; global(非严格模式)</li>
<li>传入 call 的第一个参数是 this 指向的对象，根据隐式绑定的规则，我们知道 obj.foo(), foo() 中的 this 指向 obj;因此我们可以这样调用函数 thisArgs.func(…args)</li>
<li>返回执行结果<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="title class_">Function</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">call</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> [thisArg, ...args] = [...<span class="variable language_">arguments</span>];</span><br><span class="line">    <span class="keyword">if</span> (!thisArg) &#123;</span><br><span class="line">        <span class="comment">//context为null或者是undefined</span></span><br><span class="line">        thisArg = <span class="keyword">typeof</span> <span class="variable language_">window</span> === <span class="string">&#x27;undefined&#x27;</span> ? <span class="variable language_">global</span> : <span class="variable language_">window</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//this的指向的是当前函数 func (func.call)</span></span><br><span class="line">    thisArg.<span class="property">func</span> = <span class="variable language_">this</span>;</span><br><span class="line">    <span class="comment">//执行函数</span></span><br><span class="line">    <span class="keyword">let</span> result = thisArg.<span class="title function_">func</span>(...args);</span><br><span class="line">    <span class="keyword">delete</span> thisArg.<span class="property">func</span>; <span class="comment">//thisArg上并没有 func 属性，因此需要移除</span></span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
bind 的实现思路和 call 一致，仅参数处理略有差别。如下：<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="title class_">Function</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">apply</span> = <span class="keyword">function</span>(<span class="params">thisArg, rest</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> result; <span class="comment">//函数返回结果</span></span><br><span class="line">    <span class="keyword">if</span> (!thisArg) &#123;</span><br><span class="line">        <span class="comment">//context为null或者是undefined</span></span><br><span class="line">        thisArg = <span class="keyword">typeof</span> <span class="variable language_">window</span> === <span class="string">&#x27;undefined&#x27;</span> ? <span class="variable language_">global</span> : <span class="variable language_">window</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//this的指向的是当前函数 func (func.call)</span></span><br><span class="line">    thisArg.<span class="property">func</span> = <span class="variable language_">this</span>;</span><br><span class="line">    <span class="keyword">if</span>(!rest) &#123;</span><br><span class="line">        <span class="comment">//第二个参数为 null / undefined </span></span><br><span class="line">        result = thisArg.<span class="title function_">func</span>();</span><br><span class="line">    &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">        result = thisArg.<span class="title function_">func</span>(...rest);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">delete</span> thisArg.<span class="property">func</span>; <span class="comment">//thisArg上并没有 func 属性，因此需要移除</span></span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="5-柯里化函数实现"><a href="#5-柯里化函数实现" class="headerlink" title="5. 柯里化函数实现"></a>5. 柯里化函数实现</h2><p>在开始之前，我们首先需要搞清楚函数柯里化的概念。</p>
<p>函数柯里化是把接受多个参数的函数变换成接受一个单一参数（最初函数的第一个参数）的函数，并且返回接受余下的参数而且返回结果的新函数的技术。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">curry</span> = (<span class="params">fn, ...args</span>) =&gt;</span><br><span class="line">    args.<span class="property">length</span> &lt; fn.<span class="property">length</span></span><br><span class="line">        <span class="comment">//参数长度不足时，重新柯里化该函数，等待接受新参数</span></span><br><span class="line">        ? <span class="function">(<span class="params">...<span class="variable language_">arguments</span></span>) =&gt;</span> <span class="title function_">curry</span>(fn, ...args, ...<span class="variable language_">arguments</span>)</span><br><span class="line">        <span class="comment">//参数长度满足时，执行函数</span></span><br><span class="line">        : <span class="title function_">fn</span>(...args);</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">sumFn</span>(<span class="params">a, b, c</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> a + b + c;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> sum = <span class="title function_">curry</span>(sumFn);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">sum</span>(<span class="number">2</span>)(<span class="number">3</span>)(<span class="number">5</span>));<span class="comment">//10</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">sum</span>(<span class="number">2</span>, <span class="number">3</span>, <span class="number">5</span>));<span class="comment">//10</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">sum</span>(<span class="number">2</span>)(<span class="number">3</span>, <span class="number">5</span>));<span class="comment">//10</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">sum</span>(<span class="number">2</span>, <span class="number">3</span>)(<span class="number">5</span>));<span class="comment">//10</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>函数柯里化的主要作用：</p>
</blockquote>
<ul>
<li>参数复用</li>
<li>提前返回 – 返回接受余下的参数且返回结果的新函数</li>
<li>延迟执行 – 返回新函数，等待执行</li>
</ul>
<h2 id="6-如何让-a-1-a-2-a-3-的值为true？"><a href="#6-如何让-a-1-a-2-a-3-的值为true？" class="headerlink" title="6. 如何让 (a &#x3D;&#x3D; 1 &amp;&amp; a &#x3D;&#x3D; 2 &amp;&amp; a &#x3D;&#x3D; 3) 的值为true？"></a>6. 如何让 (a &#x3D;&#x3D; 1 &amp;&amp; a &#x3D;&#x3D; 2 &amp;&amp; a &#x3D;&#x3D; 3) 的值为true？</h2><blockquote>
<p>利用隐式类型转换</p>
</blockquote>
<p>&#x3D;&#x3D; 操作符在左右数据类型不一致时，会先进行隐式转换。</p>
<p>a &#x3D;&#x3D; 1 &amp;&amp; a &#x3D;&#x3D; 2 &amp;&amp; a &#x3D;&#x3D; 3 的值意味着其不可能是基本数据类型。因为如果 a 是 null 或者是 undefined bool类型，都不可能返回true。</p>
<p>因此可以推测 a 是复杂数据类型，JS 中复杂数据类型只有 object，回忆一下，Object 转换为原始类型会调用什么方法？</p>
<ul>
<li><p>如果部署了 [Symbol.toPrimitive] 接口，那么调用此接口，若返回的不是基本数据类型，抛出错误。</p>
</li>
<li><p>如果没有部署 [Symbol.toPrimitive] 接口，那么根据要转换的类型，先调用 valueOf &#x2F; toString</p>
</li>
</ul>
<p>i. 非Date类型对象，hint 是 default 时，调用顺序为：valueOf &gt;&gt;&gt; toString，即valueOf 返回的不是基本数据类型，才会继续调用 valueOf，如果toString 返回的还不是基本数据类型，那么抛出错误。</p>
<p>ii. 如果 hint 是 string(Date对象的hint默认是string) ，调用顺序为：toString &gt;&gt;&gt; valueOf，即toString 返回的不是基本数据类型，才会继续调用 valueOf，如果valueOf 返回的还不是基本数据类型，那么抛出错误。</p>
<p>iii. 如果 hint 是 number，调用顺序为： valueOf &gt;&gt;&gt; toString</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">//部署 [Symbol.toPrimitive] / valueOf/ toString 皆可</span></span><br><span class="line"><span class="comment">//一次返回1，2，3 即可。</span></span><br><span class="line"><span class="keyword">let</span> a = &#123;</span><br><span class="line">    [<span class="title class_">Symbol</span>.<span class="property">toPrimitive</span>]: (<span class="keyword">function</span>(<span class="params">hint</span>) &#123;</span><br><span class="line">            <span class="keyword">let</span> i = <span class="number">1</span>;</span><br><span class="line">            <span class="comment">//闭包的特性之一：i 不会被回收</span></span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> i++;</span><br><span class="line">            &#125;</span><br><span class="line">    &#125;)()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>利用数据劫持(Proxy&#x2F;Object.definedProperty)</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> i = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">let</span> a = <span class="keyword">new</span> <span class="title class_">Proxy</span>(&#123;&#125;, &#123;</span><br><span class="line">    <span class="attr">i</span>: <span class="number">1</span>,</span><br><span class="line">    <span class="attr">get</span>: <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="function">() =&gt;</span> <span class="variable language_">this</span>.<span class="property">i</span>++;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<blockquote>
<p>数组的 toString 接口默认调用数组的 join 方法，重新 join 方法</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> a = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];</span><br><span class="line">a.<span class="property">join</span> = a.<span class="property">shift</span>;</span><br></pre></td></tr></table></figure>
<h2 id="7-什么是BFC？BFC的布局规则是什么？如何创建BFC？"><a href="#7-什么是BFC？BFC的布局规则是什么？如何创建BFC？" class="headerlink" title="7. 什么是BFC？BFC的布局规则是什么？如何创建BFC？"></a>7. 什么是BFC？BFC的布局规则是什么？如何创建BFC？</h2><p>Box 是 CSS 布局的对象和基本单位，页面是由若干个Box组成的。</p>
<p>元素的类型 和 display 属性，决定了这个 Box 的类型。不同类型的 Box 会参与不同的 Formatting Context。</p>
<blockquote>
<p>Formatting Context</p>
</blockquote>
<p>Formatting Context 是页面的一块渲染区域，并且有一套渲染规则，决定了其子元素将如何定位，以及和其它元素的关系和相互作用。</p>
<p>Formatting Context 有 BFC (Block formatting context)，IFC (Inline formatting context)，FFC (Flex formatting context) 和 GFC (Grid formatting context)。FFC 和 GFC 为 CC3 中新增。</p>
<blockquote>
<p>BFC布局规则</p>
</blockquote>
<ul>
<li>BFC内，盒子依次垂直排列。</li>
<li>BFC内，两个盒子的垂直距离由 margin 属性决定。属于同一个BFC的两个相邻Box的margin会发生重叠【符合合并原则的margin合并后是使用大的margin】</li>
<li>BFC内，每个盒子的左外边缘接触内部盒子的左边缘（对于从右到左的格式，右边缘接触）。即使在存在浮动的情况下也是如此。除非创建新的BFC。</li>
<li>BFC的区域不会与float box重叠。</li>
<li>BFC就是页面上的一个隔离的独立容器，容器里面的子元素不会影响到外面的元素。反之也如此。</li>
<li>计算BFC的高度时，浮动元素也参与计算。</li>
</ul>
<blockquote>
<p>如何创建BFC</p>
</blockquote>
<ul>
<li>根元素</li>
<li>浮动元素（float 属性不为 none）</li>
<li>position 为 absolute 或 fixed</li>
<li>overflow 不为 visible 的块元素</li>
<li>display 为 inline-block, table-cell, table-caption</li>
</ul>
<blockquote>
<p>BFC 的应用</p>
</blockquote>
<ul>
<li>防止 margin 重叠 (同一个BFC内的两个两个相邻Box的 margin 会发生重叠，触发生成两个BFC，即不会重叠)</li>
<li>清除内部浮动 (创建一个新的 BFC，因为根据 BFC 的规则，计算 BFC 的高度时，浮动元素也参与计算)</li>
<li>自适应多栏布局 (BFC的区域不会与float box重叠。因此，可以触发生成一个新的BFC)</li>
</ul>
<h2 id="8-异步加载JS脚本的方式有哪些？"><a href="#8-异步加载JS脚本的方式有哪些？" class="headerlink" title="8. 异步加载JS脚本的方式有哪些？"></a>8. 异步加载JS脚本的方式有哪些？</h2><blockquote>
<p>1.&lt;script&gt; 的 defer 属性，HTML4 中新增</p>
</blockquote>
<blockquote>
<p>2.&lt;script&gt; 的 async 属性，HTML5 中新增</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;script src=<span class="string">&quot;../XXX.js&quot;</span> defer&gt;&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<p>defer 和 async 的区别在于：</p>
<ul>
<li>defer 要等到整个页面在内存中正常渲染结束（DOM 结构完全生成，以及其他脚本执行完成），在window.onload 之前执行；</li>
<li>async 一旦下载完，渲染引擎就会中断渲染，执行这个脚本以后，再继续渲染。</li>
<li>如果有多个 defer 脚本，会按照它们在页面出现的顺序加载</li>
<li>多个 async 脚本不能保证加载顺序</li>
</ul>
<blockquote>
<p>动态创建 script 标签</p>
</blockquote>
<p>动态创建的 script ，设置 src 并不会开始下载，而是要添加到文档中，JS文件才会开始下载。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> script = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;script&#x27;</span>);</span><br><span class="line">script.<span class="property">src</span> = <span class="string">&#x27;XXX.js&#x27;</span>;</span><br><span class="line"><span class="comment">// 添加到html文件中才会开始下载</span></span><br><span class="line"><span class="variable language_">document</span>.<span class="property">body</span>.<span class="title function_">append</span>(script);</span><br></pre></td></tr></table></figure>
<blockquote>
<p>XHR 异步加载JS</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> xhr = <span class="keyword">new</span> <span class="title class_">XMLHttpRequest</span>();</span><br><span class="line">xhr.<span class="title function_">open</span>(<span class="string">&quot;get&quot;</span>, <span class="string">&quot;js/xxx.js&quot;</span>,<span class="literal">true</span>);</span><br><span class="line">xhr.<span class="title function_">send</span>();</span><br><span class="line">xhr.<span class="property">onreadystatechange</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (xhr.<span class="property">readyState</span> == <span class="number">4</span> &amp;&amp; xhr.<span class="property">status</span> == <span class="number">200</span>) &#123;</span><br><span class="line">        <span class="built_in">eval</span>(xhr.<span class="property">responseText</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="9-ES5有几种方式可以实现继承？分别有哪些优缺点？"><a href="#9-ES5有几种方式可以实现继承？分别有哪些优缺点？" class="headerlink" title="9. ES5有几种方式可以实现继承？分别有哪些优缺点？"></a>9. ES5有几种方式可以实现继承？分别有哪些优缺点？</h2><p>ES5 有 6 种方式可以实现继承，分别为：</p>
<p><strong>1. 原型链继承</strong></p>
<p>原型链继承的基本思想是利用原型让一个引用类型继承另一个引用类型的属性和方法。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">SuperType</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">name</span> = <span class="string">&#x27;Yvette&#x27;</span>;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">colors</span> = [<span class="string">&#x27;pink&#x27;</span>, <span class="string">&#x27;blue&#x27;</span>, <span class="string">&#x27;green&#x27;</span>];</span><br><span class="line">&#125;</span><br><span class="line"><span class="title class_">SuperType</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">getName</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">name</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">SubType</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">age</span> = <span class="number">22</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title class_">SubType</span>.<span class="property"><span class="keyword">prototype</span></span> = <span class="keyword">new</span> <span class="title class_">SuperType</span>();</span><br><span class="line"><span class="title class_">SubType</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">getAge</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">age</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title class_">SubType</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">constructor</span> = <span class="title class_">SubType</span>;</span><br><span class="line"><span class="keyword">let</span> instance1 = <span class="keyword">new</span> <span class="title class_">SubType</span>();</span><br><span class="line">instance1.<span class="property">colors</span>.<span class="title function_">push</span>(<span class="string">&#x27;yellow&#x27;</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(instance1.<span class="title function_">getName</span>()); <span class="comment">//&#x27;Yvette&#x27;</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(instance1.<span class="property">colors</span>);<span class="comment">//[ &#x27;pink&#x27;, &#x27;blue&#x27;, &#x27;green&#x27;, &#x27;yellow&#x27; ]</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> instance2 = <span class="keyword">new</span> <span class="title class_">SubType</span>();</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(instance2.<span class="property">colors</span>);<span class="comment">//[ &#x27;pink&#x27;, &#x27;blue&#x27;, &#x27;green&#x27;, &#x27;yellow&#x27; ]</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>缺点：</p>
</blockquote>
<ul>
<li>通过原型来实现继承时，原型会变成另一个类型的实例，原先的实例属性变成了现在的原型属性，该原型的引用类型属性会被所有的实例共享。</li>
<li>在创建子类型的实例时，没有办法在不影响所有对象实例的情况下给超类型的构造函数中传递参数。</li>
</ul>
<p><strong>2. 借用构造函数</strong><br>借用构造函数的技术，其基本思想为:</p>
<p>在子类型的构造函数中调用超类型构造函数。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">SuperType</span>(<span class="params">name</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">name</span> = name;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">colors</span> = [<span class="string">&#x27;pink&#x27;</span>, <span class="string">&#x27;blue&#x27;</span>, <span class="string">&#x27;green&#x27;</span>];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">SubType</span>(<span class="params">name</span>) &#123;</span><br><span class="line">    <span class="title class_">SuperType</span>.<span class="title function_">call</span>(<span class="variable language_">this</span>, name);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> instance1 = <span class="keyword">new</span> <span class="title class_">SubType</span>(<span class="string">&#x27;Yvette&#x27;</span>);</span><br><span class="line">instance1.<span class="property">colors</span>.<span class="title function_">push</span>(<span class="string">&#x27;yellow&#x27;</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(instance1.<span class="property">colors</span>);<span class="comment">//[&#x27;pink&#x27;, &#x27;blue&#x27;, &#x27;green&#x27;, yellow]</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> instance2 = <span class="keyword">new</span> <span class="title class_">SubType</span>(<span class="string">&#x27;Jack&#x27;</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(instance2.<span class="property">colors</span>); <span class="comment">//[&#x27;pink&#x27;, &#x27;blue&#x27;, &#x27;green&#x27;]</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>优点:</p>
</blockquote>
<ul>
<li>可以向超类传递参数</li>
<li>解决了原型中包含引用类型值被所有实例共享的问题</li>
</ul>
<blockquote>
<p>缺点:</p>
</blockquote>
<ul>
<li>方法都在构造函数中定义，函数复用无从谈起，另外超类型原型中定义的方法对于子类型而言都是不可见的。</li>
</ul>
<p><strong>3. 组合继承(原型链 + 借用构造函数)</strong></p>
<p>组合继承指的是将原型链和借用构造函数技术组合到一块，从而发挥二者之长的一种继承模式。基本思路：</p>
<p>使用原型链实现对原型属性和方法的继承，通过借用构造函数来实现对实例属性的继承，既通过在原型上定义方法来实现了函数复用，又保证了每个实例都有自己的属性。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">SuperType</span>(<span class="params">name</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">name</span> = name;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">colors</span> = [<span class="string">&#x27;pink&#x27;</span>, <span class="string">&#x27;blue&#x27;</span>, <span class="string">&#x27;green&#x27;</span>];</span><br><span class="line">&#125;</span><br><span class="line"><span class="title class_">SuperType</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">sayName</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">name</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">SuberType</span>(<span class="params">name, age</span>) &#123;</span><br><span class="line">    <span class="title class_">SuperType</span>.<span class="title function_">call</span>(<span class="variable language_">this</span>, name);</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">age</span> = age;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title class_">SuberType</span>.<span class="property"><span class="keyword">prototype</span></span> = <span class="keyword">new</span> <span class="title class_">SuperType</span>();</span><br><span class="line"><span class="title class_">SuberType</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">constructor</span> = <span class="title class_">SuberType</span>;</span><br><span class="line"><span class="title class_">SuberType</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">sayAge</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">age</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> instance1 = <span class="keyword">new</span> <span class="title class_">SuberType</span>(<span class="string">&#x27;Yvette&#x27;</span>, <span class="number">20</span>);</span><br><span class="line">instance1.<span class="property">colors</span>.<span class="title function_">push</span>(<span class="string">&#x27;yellow&#x27;</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(instance1.<span class="property">colors</span>); <span class="comment">//[ &#x27;pink&#x27;, &#x27;blue&#x27;, &#x27;green&#x27;, &#x27;yellow&#x27; ]</span></span><br><span class="line">instance1.<span class="title function_">sayName</span>(); <span class="comment">//Yvette</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> instance2 = <span class="keyword">new</span> <span class="title class_">SuberType</span>(<span class="string">&#x27;Jack&#x27;</span>, <span class="number">22</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(instance2.<span class="property">colors</span>); <span class="comment">//[ &#x27;pink&#x27;, &#x27;blue&#x27;, &#x27;green&#x27; ]</span></span><br><span class="line">instance2.<span class="title function_">sayName</span>();<span class="comment">//Jack</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>缺点:</p>
</blockquote>
<p>无论什么情况下，都会调用两次超类型构造函数：一次是在创建子类型原型的时候，另一次是在子类型构造函数内部。</p>
<blockquote>
<p>优点:</p>
</blockquote>
<ul>
<li>可以向超类传递参数</li>
<li>每个实例都有自己的属性</li>
<li>实现了函数复用</li>
</ul>
<p><strong>4. 原型式继承</strong></p>
<p>原型继承的基本思想：</p>
<p>借助原型可以基于已有的对象创建新对象，同时还不必因此创建自定义类型。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">object</span>(<span class="params">o</span>) &#123;</span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">F</span>(<span class="params"></span>) &#123; &#125;</span><br><span class="line">    F.<span class="property"><span class="keyword">prototype</span></span> = o;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title function_">F</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在 object() 函数内部，先穿甲一个临时性的构造函数，然后将传入的对象作为这个构造函数的原型，最后返回了这个临时类型的一个新实例，从本质上讲，object() 对传入的对象执行了一次浅拷贝。</p>
<p>ECMAScript5通过新增 Object.create()方法规范了原型式继承。这个方法接收两个参数：一个用作新对象原型的对象和（可选的）一个为新对象定义额外属性的对象(可以覆盖原型对象上的同名属性)，在传入一个参数的情况下，Object.create() 和 object() 方法的行为相同。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> person = &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;Yvette&#x27;</span>,</span><br><span class="line">    <span class="attr">hobbies</span>: [<span class="string">&#x27;reading&#x27;</span>, <span class="string">&#x27;photography&#x27;</span>]</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> person1 = <span class="title class_">Object</span>.<span class="title function_">create</span>(person);</span><br><span class="line">person1.<span class="property">name</span> = <span class="string">&#x27;Jack&#x27;</span>;</span><br><span class="line">person1.<span class="property">hobbies</span>.<span class="title function_">push</span>(<span class="string">&#x27;coding&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> person2 = <span class="title class_">Object</span>.<span class="title function_">create</span>(person);</span><br><span class="line">person2.<span class="property">name</span> = <span class="string">&#x27;Echo&#x27;</span>;</span><br><span class="line">person2.<span class="property">hobbies</span>.<span class="title function_">push</span>(<span class="string">&#x27;running&#x27;</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(person.<span class="property">hobbies</span>);<span class="comment">//[ &#x27;reading&#x27;, &#x27;photography&#x27;, &#x27;coding&#x27;, &#x27;running&#x27; ]</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(person1.<span class="property">hobbies</span>);<span class="comment">//[ &#x27;reading&#x27;, &#x27;photography&#x27;, &#x27;coding&#x27;, &#x27;running&#x27; ]</span></span><br></pre></td></tr></table></figure>
<p>在没有必要创建构造函数，仅让一个对象与另一个对象保持相似的情况下，原型式继承是可以胜任的。</p>
<blockquote>
<p>缺点:</p>
</blockquote>
<p>同原型链实现继承一样，包含引用类型值的属性会被所有实例共享。</p>
<p><strong>5. 寄生式继承</strong></p>
<p>寄生式继承是与原型式继承紧密相关的一种思路。寄生式继承的思路与寄生构造函数和工厂模式类似，即创建一个仅用于封装继承过程的函数，该函数在内部已某种方式来增强对象，最后再像真地是它做了所有工作一样返回对象。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">createAnother</span>(<span class="params">original</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> clone = <span class="title function_">object</span>(original);<span class="comment">//通过调用函数创建一个新对象</span></span><br><span class="line">    clone.<span class="property">sayHi</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;<span class="comment">//以某种方式增强这个对象</span></span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;hi&#x27;</span>);</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">return</span> clone;<span class="comment">//返回这个对象</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> person = &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;Yvette&#x27;</span>,</span><br><span class="line">    <span class="attr">hobbies</span>: [<span class="string">&#x27;reading&#x27;</span>, <span class="string">&#x27;photography&#x27;</span>]</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> person2 = <span class="title function_">createAnother</span>(person);</span><br><span class="line">person2.<span class="title function_">sayHi</span>(); <span class="comment">//hi</span></span><br></pre></td></tr></table></figure>

<p>基于 person 返回了一个新对象 -—— person2，新对象不仅具有 person 的所有属性和方法，而且还有自己的 sayHi() 方法。在考虑对象而不是自定义类型和构造函数的情况下，寄生式继承也是一种有用的模式。</p>
<blockquote>
<p>缺点：</p>
</blockquote>
<ul>
<li>使用寄生式继承来为对象添加函数，会由于不能做到函数复用而效率低下。</li>
<li>同原型链实现继承一样，包含引用类型值的属性会被所有实例共享。</li>
</ul>
<p><strong>6. 寄生组合式继承</strong></p>
<p>所谓寄生组合式继承，即通过借用构造函数来继承属性，通过原型链的混成形式来继承方法，基本思路：</p>
<p>不必为了指定子类型的原型而调用超类型的构造函数，我们需要的仅是超类型原型的一个副本，本质上就是使用寄生式继承来继承超类型的原型，然后再将结果指定给子类型的原型。寄生组合式继承的基本模式如下所示：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">inheritPrototype</span>(<span class="params">subType, superType</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> prototype = <span class="title function_">object</span>(superType.<span class="property"><span class="keyword">prototype</span></span>); <span class="comment">//创建对象</span></span><br><span class="line">    prototype.<span class="property">constructor</span> = subType;<span class="comment">//增强对象</span></span><br><span class="line">    subType.<span class="property"><span class="keyword">prototype</span></span> = prototype;<span class="comment">//指定对象</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>第一步：创建超类型原型的一个副本</li>
<li>第二步：为创建的副本添加 constructor 属性</li>
<li>第三步：将新创建的对象赋值给子类型的原型</li>
</ul>
<p>至此，我们就可以通过调用 inheritPrototype 来替换为子类型原型赋值的语句：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">SuperType</span>(<span class="params">name</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">name</span> = name;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">colors</span> = [<span class="string">&#x27;pink&#x27;</span>, <span class="string">&#x27;blue&#x27;</span>, <span class="string">&#x27;green&#x27;</span>];</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//...code</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">SuberType</span>(<span class="params">name, age</span>) &#123;</span><br><span class="line">    <span class="title class_">SuperType</span>.<span class="title function_">call</span>(<span class="variable language_">this</span>, name);</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">age</span> = age;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title class_">SuberType</span>.<span class="property"><span class="keyword">prototype</span></span> = <span class="keyword">new</span> <span class="title class_">SuperType</span>();</span><br><span class="line"><span class="title function_">inheritPrototype</span>(<span class="title class_">SuberType</span>, <span class="title class_">SuperType</span>);</span><br><span class="line"><span class="comment">//...code</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>优点:</p>
</blockquote>
<p>只调用了一次超类构造函数，效率更高。避免在SuberType.prototype上面创建不必要的、多余的属性，与其同时，原型链还能保持不变。</p>
<p>因此寄生组合继承是引用类型最理性的继承范式。</p>
<h2 id="10-隐藏页面中的某个元素的方法有哪些？"><a href="#10-隐藏页面中的某个元素的方法有哪些？" class="headerlink" title="10. 隐藏页面中的某个元素的方法有哪些？"></a>10. 隐藏页面中的某个元素的方法有哪些？</h2><blockquote>
<p>隐藏类型</p>
</blockquote>
<p>屏幕并不是唯一的输出机制，比如说屏幕上看不见的元素（隐藏的元素），其中一些依然能够被读屏软件阅读出来（因为读屏软件依赖于可访问性树来阐述）。为了消除它们之间的歧义，我们将其归为三大类：</p>
<blockquote>
<p>完全隐藏：</p>
</blockquote>
<ul>
<li>元素从渲染树中消失，不占据空间。</li>
<li>视觉上的隐藏：屏幕中不可见，占据空间。</li>
<li>语义上的隐藏：读屏软件不可读，但正常占据空。<br>完全隐藏</li>
</ul>
<p><strong>1.display 属性</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">display: none;</span><br></pre></td></tr></table></figure>
<p><strong>2.hidden 属性</strong></p>
<p>HTML5 新增属性，相当于 display: none</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;div hidden&gt; &lt;/div&gt;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>视觉上的隐藏</p>
</blockquote>
<p><strong>1.利用 position 和 盒模型 将元素移出可视区范围</strong></p>
<ul>
<li><p>设置 posoition 为 absolute 或 fixed，�通过设置 top、left 等值，将其移出可视区域。</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="attribute">position</span>:absolute;</span><br><span class="line"><span class="attribute">left</span>: -<span class="number">99999px</span>;</span><br></pre></td></tr></table></figure></li>
<li><p>设置 position 为 relative，通过设置 top、left 等值，将其移出可视区域。</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="attribute">position</span>: relative;</span><br><span class="line"><span class="attribute">left</span>: -<span class="number">99999px</span>;</span><br><span class="line"><span class="attribute">height</span>: <span class="number">0</span></span><br></pre></td></tr></table></figure></li>
<li><p>设置 margin 值，将其移出可视区域范围（可视区域占位）。</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="attribute">margin-left</span>: -<span class="number">99999px</span>;</span><br><span class="line"><span class="attribute">height</span>: <span class="number">0</span>;</span><br></pre></td></tr></table></figure>
<p><strong>2. 利用 transfrom</strong></p>
</li>
<li><p>缩放</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="attribute">transform</span>: <span class="built_in">scale</span>(<span class="number">0</span>);</span><br><span class="line"><span class="attribute">height</span>: <span class="number">0</span>;</span><br></pre></td></tr></table></figure></li>
<li><p>移动 translateX, translateY</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="attribute">transform</span>: <span class="built_in">translateX</span>(-<span class="number">99999px</span>);</span><br><span class="line"><span class="attribute">height</span>: <span class="number">0</span></span><br></pre></td></tr></table></figure>
<p><strong>3.设置其大小为0</strong></p>
</li>
<li><p>宽高为0，字体大小为0：</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="attribute">height</span>: <span class="number">0</span>;</span><br><span class="line"><span class="attribute">width</span>: <span class="number">0</span>;</span><br><span class="line"><span class="attribute">font-size</span>: <span class="number">0</span>;</span><br></pre></td></tr></table></figure></li>
<li><p>宽高为0，超出隐藏:</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="attribute">height</span>: <span class="number">0</span>;</span><br><span class="line"><span class="attribute">width</span>: <span class="number">0</span>;</span><br><span class="line"><span class="attribute">overflow</span>: hidden;</span><br></pre></td></tr></table></figure>
</li>
<li><p>设置透明度为0</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="attribute">opacity</span>: <span class="number">0</span>;</span><br></pre></td></tr></table></figure></li>
<li><p>visibility属性</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="attribute">visibility</span>: hidden;</span><br></pre></td></tr></table></figure>
</li>
<li><p>层级覆盖，z-index 属性</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="attribute">position</span>: relative;</span><br><span class="line"><span class="attribute">z-index</span>: -<span class="number">999</span>;</span><br></pre></td></tr></table></figure>
<p>再设置一个层级较高的元素覆盖在此元素上。</p>
</li>
<li><p>clip-path 裁剪</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="attribute">clip-path</span>: <span class="built_in">polygon</span>(<span class="number">0</span> <span class="number">0</span>, <span class="number">0</span> <span class="number">0</span>, <span class="number">0</span> <span class="number">0</span>, <span class="number">0</span> <span class="number">0</span>);</span><br></pre></td></tr></table></figure>
<blockquote>
<p>语义上的隐藏</p>
</blockquote>
</li>
<li><p>aria-hidden 属性</p>
</li>
</ul>
<p>读屏软件不可读，占据空间，可见。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;div aria-hidden=&quot;true&quot;&gt;&lt;/div&gt;</span><br></pre></td></tr></table></figure>
<h2 id="11-let、const、var-的区别有哪些？"><a href="#11-let、const、var-的区别有哪些？" class="headerlink" title="11. let、const、var 的区别有哪些？"></a>11. let、const、var 的区别有哪些？</h2><table>
<thead>
<tr>
<th>声明方式</th>
<th>变量提升</th>
<th>暂时性死区</th>
<th>重复声明</th>
<th>块作用域有效</th>
<th>初始值</th>
<th>初始值</th>
</tr>
</thead>
<tbody><tr>
<td>var</td>
<td>会</td>
<td>不存在</td>
<td>允许</td>
<td>不是</td>
<td>非必须</td>
<td>允许</td>
</tr>
<tr>
<td>let</td>
<td>不会</td>
<td>存在</td>
<td>不允许</td>
<td>是</td>
<td>非必须</td>
<td>允许</td>
</tr>
<tr>
<td>const</td>
<td>不会</td>
<td>存在</td>
<td>不允许</td>
<td>是</td>
<td>非必须</td>
<td>不允许</td>
</tr>
</tbody></table>
<p>1.let&#x2F;const 定义的变量不会出现变量提升，而 var 定义的变量会提升。</p>
<p>2.相同作用域中，let 和 const 不允许重复声明，var 允许重复声明。</p>
<p>3.const 声明变量时必须设置初始值</p>
<p>4.const 声明一个只读的常量，这个常量不可改变。</p>
<p>这里有一个非常重要的点即是：在JS中，复杂数据类型，存储在栈中的是堆内存的地址，存在栈中的这个地址是不变的，但是存在堆中的值是可以变得。有没有相当常量指针&#x2F;指针常量~</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> a = <span class="number">20</span>;</span><br><span class="line"><span class="keyword">const</span> b = &#123;</span><br><span class="line">    <span class="attr">age</span>: <span class="number">18</span>,</span><br><span class="line">    <span class="attr">star</span>: <span class="number">500</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="12-prototype-和-proto-区别是什么？"><a href="#12-prototype-和-proto-区别是什么？" class="headerlink" title="12. prototype 和 proto 区别是什么？"></a>12. prototype 和 <strong>proto</strong> 区别是什么？</h2><p>prototype是构造函数的属性。</p>
<p><strong>proto</strong> 是每个实例都有的属性，可以访问 [[prototype]] 属性。</p>
<p>实例的__proto__ 与其构造函数的prototype指向的是同一个对象。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Student</span>(<span class="params">name</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">name</span> = name;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title class_">Student</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">setAge</span> = <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">age</span>=<span class="number">20</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> <span class="title class_">Jack</span> = <span class="keyword">new</span> <span class="title class_">Student</span>(<span class="string">&#x27;jack&#x27;</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Jack</span>.<span class="property">__proto__</span>);</span><br><span class="line"><span class="comment">//console.log(Object.getPrototypeOf(Jack));;</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Student</span>.<span class="property"><span class="keyword">prototype</span></span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Jack</span>.<span class="property">__proto__</span> === <span class="title class_">Student</span>.<span class="property"><span class="keyword">prototype</span></span>);<span class="comment">//true</span></span><br></pre></td></tr></table></figure>

<h2 id="13-防抖函数的作用是什么？请实现一个防抖函数"><a href="#13-防抖函数的作用是什么？请实现一个防抖函数" class="headerlink" title="13. 防抖函数的作用是什么？请实现一个防抖函数"></a>13. 防抖函数的作用是什么？请实现一个防抖函数</h2><blockquote>
<p>防抖函数的作用</p>
</blockquote>
<p>防抖函数的作用就是控制函数在一定时间内的执行次数。防抖意味着N秒内函数只会被执行一次，如果N秒内再次被触发，则重新计算延迟时间。</p>
<p>举例说明： 小思最近在减肥，但是她非常吃吃零食。为此，与其男朋友约定好，如果10天不吃零食，就可以购买一个包(不要问为什么是包，因为包治百病)。但是如果中间吃了一次零食，那么就要重新计算时间，直到小思坚持10天没有吃零食，才能购买一个包。所以，管不住嘴的小思，没有机会买包(悲伤的故事)… 这就是 防抖。</p>
<blockquote>
<p>防抖函数实现</p>
</blockquote>
<ul>
<li>事件第一次触发时，timer 是 null，调用 later()，若 immediate 为true，那么立即调用 func.apply(this, params)；如果 immediate 为 false，那么过 wait 之后，调用 func.apply(this, params)</li>
<li>事件第二次触发时，如果 timer 已经重置为 null(即 setTimeout 的倒计时结束)，那么流程与第一次触发时一样，若 timer 不为 null(即 setTimeout 的倒计时未结束)，那么清空定时器，重新开始计时。</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">debounce</span>(<span class="params">func, wait, immediate = <span class="literal">true</span></span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> timeout, result;</span><br><span class="line">    <span class="comment">// 延迟执行函数</span></span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">later</span> = (<span class="params">context, args</span>) =&gt; <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        timeout = <span class="literal">null</span>;<span class="comment">// 倒计时结束</span></span><br><span class="line">        <span class="keyword">if</span> (!immediate) &#123;</span><br><span class="line">            <span class="comment">//执行回调</span></span><br><span class="line">            result = func.<span class="title function_">apply</span>(context, args);</span><br><span class="line">            context = args = <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;, wait);</span><br><span class="line">    <span class="keyword">let</span> debounced = <span class="keyword">function</span> (<span class="params">...params</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!timeout) &#123;</span><br><span class="line">            timeout = <span class="title function_">later</span>(<span class="variable language_">this</span>, params);</span><br><span class="line">            <span class="keyword">if</span> (immediate) &#123;</span><br><span class="line">                <span class="comment">//立即执行</span></span><br><span class="line">                result = func.<span class="title function_">apply</span>(<span class="variable language_">this</span>, params);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="built_in">clearTimeout</span>(timeout);</span><br><span class="line">            <span class="comment">//函数在每个等待时延的结束被调用</span></span><br><span class="line">            timeout = <span class="title function_">later</span>(<span class="variable language_">this</span>, params);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//提供在外部清空定时器的方法</span></span><br><span class="line">    debounced.<span class="property">cancel</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="built_in">clearTimeout</span>(timer);</span><br><span class="line">        timer = <span class="literal">null</span>;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">return</span> debounced;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>immediate 为 true 时，表示函数在每个等待时延的开始被调用。immediate 为 false 时，表示函数在每个等待时延的结束被调用。</p>
<blockquote>
<p>防抖的应用场景</p>
</blockquote>
<ul>
<li>搜索框输入查询，如果用户一直在输入中，没有必要不停地调用去请求服务端接口，等用户停止输入的时候，再调用，设置一个合适的时间间隔，有效减轻服务端压力。</li>
<li>表单验证</li>
<li>按钮提交事件。</li>
<li>浏览器窗口缩放，resize事件(如窗口停止改变大小之后重新计算布局)等。</li>
</ul>
<h2 id="14-节流函数的作用是什么？有哪些应用场景，请实现一个节流函数"><a href="#14-节流函数的作用是什么？有哪些应用场景，请实现一个节流函数" class="headerlink" title="14. 节流函数的作用是什么？有哪些应用场景，请实现一个节流函数"></a>14. 节流函数的作用是什么？有哪些应用场景，请实现一个节流函数</h2><blockquote>
<p>节流函数的作用</p>
</blockquote>
<p>节流函数的作用是规定一个单位时间，在这个单位时间内最多只能触发一次函数执行，如果这个单位时间内多次触发函数，只能有一次生效。</p>
<blockquote>
<p>节流函数实现</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">throttle</span>(<span class="params">func, wait, options = &#123;&#125;</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> timeout, context, args, result;</span><br><span class="line">    <span class="keyword">var</span> previous = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">var</span> later = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        previous = options.<span class="property">leading</span> === <span class="literal">false</span> ? <span class="number">0</span> : (<span class="title class_">Date</span>.<span class="title function_">now</span>() || <span class="keyword">new</span> <span class="title class_">Date</span>().<span class="title function_">getTime</span>());</span><br><span class="line">        timeout = <span class="literal">null</span>;</span><br><span class="line">        result = func.<span class="title function_">apply</span>(context, args);</span><br><span class="line">        <span class="keyword">if</span> (!timeout) context = args = <span class="literal">null</span>;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> throttled = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> now = <span class="title class_">Date</span>.<span class="title function_">now</span>() || <span class="keyword">new</span> <span class="title class_">Date</span>().<span class="title function_">getTime</span>();</span><br><span class="line">        <span class="keyword">if</span> (!previous &amp;&amp; options.<span class="property">leading</span> === <span class="literal">false</span>) previous = now;</span><br><span class="line">        <span class="comment">//remaining 为距离下次执行 func 的时间</span></span><br><span class="line">        <span class="comment">//remaining &gt; wait，表示客户端系统时间被调整过</span></span><br><span class="line">        <span class="keyword">var</span> remaining = wait - (now - previous);</span><br><span class="line">        context = <span class="variable language_">this</span>;</span><br><span class="line">        args = <span class="variable language_">arguments</span>;</span><br><span class="line">        <span class="comment">//remaining 小于等于0，表示事件触发的间隔时间大于设置的 wait</span></span><br><span class="line">        <span class="keyword">if</span> (remaining &lt;= <span class="number">0</span> || remaining &gt; wait) &#123;</span><br><span class="line">            <span class="keyword">if</span> (timeout) &#123;</span><br><span class="line">                <span class="comment">//清空定时器</span></span><br><span class="line">                <span class="built_in">clearTimeout</span>(timeout);</span><br><span class="line">                timeout = <span class="literal">null</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//重置 previous</span></span><br><span class="line">            previous = now;</span><br><span class="line">            <span class="comment">//执行函数</span></span><br><span class="line">            result = func.<span class="title function_">apply</span>(context, args); </span><br><span class="line">            <span class="keyword">if</span> (!timeout) context = args = <span class="literal">null</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (!timeout &amp;&amp; options.<span class="property">trailing</span> !== <span class="literal">false</span>) &#123;</span><br><span class="line">            timeout = <span class="built_in">setTimeout</span>(later, remaining);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    throttled.<span class="property">cancel</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="built_in">clearTimeout</span>(timeout);</span><br><span class="line">        previous = <span class="number">0</span>;</span><br><span class="line">        timeout = context = args = <span class="literal">null</span>;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> throttled;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>禁用第一次首先执行，传递 {leading: false} ；想禁用最后一次执行，传递 {trailing: false}</p>
<blockquote>
<p>节流的应用场景</p>
</blockquote>
<ul>
<li>按钮点击事件</li>
<li>拖拽事件</li>
<li>onScoll</li>
<li>计算鼠标移动的距离(mousemove)</li>
</ul>
<h2 id="15-什么是闭包？闭包的作用是什么？"><a href="#15-什么是闭包？闭包的作用是什么？" class="headerlink" title="15. 什么是闭包？闭包的作用是什么？"></a>15. 什么是闭包？闭包的作用是什么？</h2><p><strong>闭包的定义</strong></p>
<p>《JavaScript高级程序设计》:</p>
<blockquote>
<p>闭包是指有权访问另一个函数作用域中的变量的函数</p>
</blockquote>
<p>《JavaScript权威指南》：</p>
<blockquote>
<p>从技术的角度讲，所有的JavaScript函数都是闭包：它们都是对象，它们都关联到作用域链。</p>
</blockquote>
<p>《你不知道的JavaScript》</p>
<blockquote>
<p>当函数可以记住并访问所在的词法作用域时，就产生了闭包，即使函数是在当前词法作用域之外执行。</p>
</blockquote>
<p><strong>创建一个闭包</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> a = <span class="number">2</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">function</span> <span class="title function_">fn</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(a);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> func = <span class="title function_">foo</span>();</span><br><span class="line"><span class="title function_">func</span>(); <span class="comment">//输出2</span></span><br></pre></td></tr></table></figure>
<p>闭包使得函数可以继续访问定义时的词法作用域。拜 fn 所赐，在 foo() 执行后，foo 内部作用域不会被销毁。</p>
<p><strong>闭包的作用</strong></p>
<ul>
<li><p>能够访问函数定义时所在的词法作用域(阻止其被回收)。</p>
</li>
<li><p>私有化变量</p>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">base</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> x = <span class="number">10</span>; <span class="comment">//私有变量</span></span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        <span class="attr">getX</span>: <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> x;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> obj = <span class="title function_">base</span>();</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(obj.<span class="title function_">getX</span>()); <span class="comment">//10</span></span><br></pre></td></tr></table></figure>
<ul>
<li>模拟块级作用域</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> a = [];</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">    a[i] = (<span class="keyword">function</span>(<span class="params">j</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(j);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)(i);</span><br><span class="line">&#125;</span><br><span class="line">a[<span class="number">6</span>](); <span class="comment">// 6</span></span><br></pre></td></tr></table></figure>
<ul>
<li>创建模块</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">coolModule</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> name = <span class="string">&#x27;Yvette&#x27;</span>;</span><br><span class="line">    <span class="keyword">let</span> age = <span class="number">20</span>;</span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">sayName</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(name);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">sayAge</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(age);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        sayName,</span><br><span class="line">        sayAge</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> info = <span class="title function_">coolModule</span>();</span><br><span class="line">info.<span class="title function_">sayName</span>(); <span class="comment">//&#x27;Yvette&#x27;</span></span><br></pre></td></tr></table></figure>

<p>模块模式具有两个必备的条件(来自《你不知道的JavaScript》)</p>
<ul>
<li>必须有外部的封闭函数，该函数必须至少被调用一次(每次调用都会创建一个新的模块实例)</li>
<li>封闭函数必须返回至少一个内部函数，这样内部函数才能在私有作用域中形成闭包，并且可以访问或者修改私有的状态。</li>
</ul>
<h2 id="16-实现-Promise-all-方法"><a href="#16-实现-Promise-all-方法" class="headerlink" title="16. 实现 Promise.all 方法"></a>16. 实现 Promise.all 方法</h2><p>在实现 Promise.all 方法之前，我们首先要知道 Promise.all 的功能和特点，因为在清楚了 Promise.all 功能和特点的情况下，我们才能进一步去写实现。</p>
<blockquote>
<p>Promise.all 功能</p>
</blockquote>
<p>Promise.all(iterable) 返回一个新的 Promise 实例。此实例在 iterable 参数内所有的 promise 都 fulfilled 或者参数中不包含 promise 时，状态变成 fulfilled；如果参数中 promise 有一个失败rejected，此实例回调失败，失败原因的是第一个失败 promise 的返回结果。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> p = <span class="title class_">Promise</span>.<span class="title function_">all</span>([p1, p2, p3]);</span><br></pre></td></tr></table></figure>
<p>p的状态由 p1,p2,p3决定，分成以下；两种情况：</p>
<p>（1）只有p1、p2、p3的状态都变成 fulfilled，p的状态才会变成 fulfilled，此时p1、p2、p3的返回值组成一个数组，传递给p的回调函数。</p>
<p>（2）只要p1、p2、p3之中有一个被 rejected，p的状态就变成 rejected，此时第一个被reject的实例的返回值，会传递给p的回调函数。</p>
<blockquote>
<p>Promise.all 的特点</p>
</blockquote>
<p>Promise.all 的返回值是一个 promise 实例</p>
<ul>
<li>如果传入的参数为空的可迭代对象，Promise.all 会 同步 返回一个已完成状态的 promise</li>
<li>如果传入的参数中不包含任何 promise,Promise.all 会 异步 返回一个已完成状态的 promise</li>
<li>其它情况下，Promise.all 返回一个 处理中（pending） 状态的 promise.</li>
</ul>
<blockquote>
<p>Promise.all 返回的 promise 的状态</p>
</blockquote>
<ul>
<li>如果传入的参数中的 promise 都变成完成状态，Promise.all 返回的 promise 异步地变为完成。</li>
<li>如果传入的参数中，有一个 promise 失败，Promise.all 异步地将失败的那个结果给失败状态的回调函数，而不管其它 promise 是否完成</li>
<li>在任何情况下，Promise.all 返回的 promise 的完成状态的结果都是一个数组<blockquote>
<p>Promise.all 实现</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="title class_">Promise</span>.<span class="property">all</span> = <span class="keyword">function</span> (<span class="params">promises</span>) &#123;</span><br><span class="line">    <span class="comment">//promises 是可迭代对象，省略参数合法性检查</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">//Array.from 将可迭代对象转换成数组</span></span><br><span class="line">        promises = <span class="title class_">Array</span>.<span class="title function_">from</span>(promises);</span><br><span class="line">        <span class="keyword">if</span> (promises.<span class="property">length</span> === <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="title function_">resolve</span>([]);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">let</span> result = [];</span><br><span class="line">            <span class="keyword">let</span> index = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>;  i &lt; promises.<span class="property">length</span>; i++ ) &#123;</span><br><span class="line">                <span class="comment">//考虑到 i 可能是 thenable 对象也可能是普通值</span></span><br><span class="line">                <span class="title class_">Promise</span>.<span class="title function_">resolve</span>(promises[i]).<span class="title function_">then</span>(<span class="function"><span class="params">data</span> =&gt;</span> &#123;</span><br><span class="line">                    result[i] = data;</span><br><span class="line">                    <span class="keyword">if</span> (++index === promises.<span class="property">length</span>) &#123;</span><br><span class="line">                        <span class="comment">//所有的 promises 状态都是 fulfilled，promise.all返回的实例才变成 fulfilled 态</span></span><br><span class="line">                        <span class="title function_">resolve</span>(result);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;, <span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">                    <span class="title function_">reject</span>(err);</span><br><span class="line">                    <span class="keyword">return</span>;</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="17-请实现一个-flattenDeep-函数，把嵌套的数组扁平化"><a href="#17-请实现一个-flattenDeep-函数，把嵌套的数组扁平化" class="headerlink" title="17. 请实现一个 flattenDeep 函数，把嵌套的数组扁平化"></a>17. 请实现一个 flattenDeep 函数，把嵌套的数组扁平化</h2><p>例如:</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="title function_">flattenDeep</span>([<span class="number">1</span>, [<span class="number">2</span>, [<span class="number">3</span>, [<span class="number">4</span>]], <span class="number">5</span>]]); <span class="comment">//[1, 2, 3, 4, 5]</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>利用 Array.prototype.flat</p>
</blockquote>
<p>ES6 为数组实例新增了 flat 方法，用于将嵌套的数组“拉平”，变成一维的数组。该方法返回一个新数组，对原数组没有影响。</p>
<p>flat 默认只会 “拉平” 一层，如果想要 “拉平” 多层的嵌套数组，需要给 flat 传递一个整数，表示想要拉平的层数。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">flattenDeep</span>(<span class="params">arr, deepLength</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> arr.<span class="title function_">flat</span>(deepLength);</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">flattenDeep</span>([<span class="number">1</span>, [<span class="number">2</span>, [<span class="number">3</span>, [<span class="number">4</span>]], <span class="number">5</span>]], <span class="number">3</span>));</span><br></pre></td></tr></table></figure>

<p>当传递的整数大于数组嵌套的层数时，会将数组拉平为一维数组，JS能表示的最大数字为 Math.pow(2, 53) - 1，因此我们可以这样定义 flattenDeep 函数</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">flattenDeep</span>(<span class="params">arr</span>) &#123;</span><br><span class="line">    <span class="comment">//当然，大多时候我们并不会有这么多层级的嵌套</span></span><br><span class="line">    <span class="keyword">return</span> arr.<span class="title function_">flat</span>(<span class="title class_">Math</span>.<span class="title function_">pow</span>(<span class="number">2</span>,<span class="number">53</span>) - <span class="number">1</span>); </span><br><span class="line">&#125;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">flattenDeep</span>([<span class="number">1</span>, [<span class="number">2</span>, [<span class="number">3</span>, [<span class="number">4</span>]], <span class="number">5</span>]]));</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<blockquote>
<p>利用 reduce 和 concat</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">flattenDeep</span>(<span class="params">arr</span>)&#123;</span><br><span class="line">    <span class="keyword">return</span> arr.<span class="title function_">reduce</span>(<span class="function">(<span class="params">acc, val</span>) =&gt;</span> <span class="title class_">Array</span>.<span class="title function_">isArray</span>(val) ? acc.<span class="title function_">concat</span>(<span class="title function_">flattenDeep</span>(val)) : acc.<span class="title function_">concat</span>(val), []);</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">flattenDeep</span>([<span class="number">1</span>, [<span class="number">2</span>, [<span class="number">3</span>, [<span class="number">4</span>]], <span class="number">5</span>]]));</span><br></pre></td></tr></table></figure>
<blockquote>
<p>使用 stack 无限反嵌套多层嵌套数组</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">flattenDeep</span>(<span class="params">input</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> stack = [...input];</span><br><span class="line">    <span class="keyword">const</span> res = [];</span><br><span class="line">    <span class="keyword">while</span> (stack.<span class="property">length</span>) &#123;</span><br><span class="line">        <span class="comment">// 使用 pop 从 stack 中取出并移除值</span></span><br><span class="line">        <span class="keyword">const</span> next = stack.<span class="title function_">pop</span>();</span><br><span class="line">        <span class="keyword">if</span> (<span class="title class_">Array</span>.<span class="title function_">isArray</span>(next)) &#123;</span><br><span class="line">            <span class="comment">// 使用 push 送回内层数组中的元素，不会改动原始输入 original input</span></span><br><span class="line">            stack.<span class="title function_">push</span>(...next);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            res.<span class="title function_">push</span>(next);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 使用 reverse 恢复原数组的顺序</span></span><br><span class="line">    <span class="keyword">return</span> res.<span class="title function_">reverse</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">flattenDeep</span>([<span class="number">1</span>, [<span class="number">2</span>, [<span class="number">3</span>, [<span class="number">4</span>]], <span class="number">5</span>]]));</span><br></pre></td></tr></table></figure>

<h2 id="18-请实现一个-uniq-函数，实现数组去重"><a href="#18-请实现一个-uniq-函数，实现数组去重" class="headerlink" title="18. 请实现一个 uniq 函数，实现数组去重"></a>18. 请实现一个 uniq 函数，实现数组去重</h2><p>例如:</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="title function_">uniq</span>([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">3</span>, <span class="number">2</span>]);<span class="comment">//[1, 2, 3, 5]</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>1: 利用ES6新增数据类型 Set</p>
</blockquote>
<p>Set类似于数组，但是成员的值都是唯一的，没有重复的值。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">uniq</span>(<span class="params">arry</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> [...<span class="keyword">new</span> <span class="title class_">Set</span>(arry)];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>2: 利用 indexOf</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">uniq</span>(<span class="params">arry</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> result = [];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; arry.<span class="property">length</span>; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (result.<span class="title function_">indexOf</span>(arry[i]) === -<span class="number">1</span>) &#123;</span><br><span class="line">            <span class="comment">//如 result 中没有 arry[i],则添加到数组中</span></span><br><span class="line">            result.<span class="title function_">push</span>(arry[i])</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>3: 利用 includes</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">uniq</span>(<span class="params">arry</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> result = [];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; arry.<span class="property">length</span>; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!result.<span class="title function_">includes</span>(arry[i])) &#123;</span><br><span class="line">            <span class="comment">//如 result 中没有 arry[i],则添加到数组中</span></span><br><span class="line">            result.<span class="title function_">push</span>(arry[i])</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>4：利用 reduce</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">uniq</span>(<span class="params">arry</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> arry.<span class="title function_">reduce</span>(<span class="function">(<span class="params">prev, cur</span>) =&gt;</span> prev.<span class="title function_">includes</span>(cur) ? prev : [...prev, cur], []);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>5.利用 Map</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">uniq</span>(<span class="params">arry</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> map = <span class="keyword">new</span> <span class="title class_">Map</span>();</span><br><span class="line">    <span class="keyword">let</span> result = <span class="keyword">new</span> <span class="title class_">Array</span>();</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; arry.<span class="property">length</span>; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (map.<span class="title function_">has</span>(arry[i])) &#123;</span><br><span class="line">            map.<span class="title function_">set</span>(arry[i], <span class="literal">true</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            map.<span class="title function_">set</span>(arry[i], <span class="literal">false</span>);</span><br><span class="line">            result.<span class="title function_">push</span>(arry[i]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="19-在JS中什么是变量提升？什么是暂时性死区？"><a href="#19-在JS中什么是变量提升？什么是暂时性死区？" class="headerlink" title="19. 在JS中什么是变量提升？什么是暂时性死区？"></a>19. 在JS中什么是变量提升？什么是暂时性死区？</h2><p>变量提升就是变量在声明之前就可以使用，值为undefined。</p>
<p>在代码块内，使用 let&#x2F;const 命令声明变量之前，该变量都是不可用的(会抛出错误)。这在语法上，称为“暂时性死区”。暂时性死区也意味着 typeof 不再是一个百分百安全的操作。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">typeof x; // ReferenceError(暂时性死区，抛错)</span><br><span class="line">let x;</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">typeof y; // 值是undefined,不会报错</span><br></pre></td></tr></table></figure>
<p>暂时性死区的本质就是，只要一进入当前作用域，所要使用的变量就已经存在了，但是不可获取，只有等到声明变量的那一行代码出现，才可以获取和使用该变量。</p>
<h2 id="20-JSONP-的原理是什么？"><a href="#20-JSONP-的原理是什么？" class="headerlink" title="20. JSONP 的原理是什么？"></a>20. JSONP 的原理是什么？</h2><p>尽管浏览器有同源策略，但是 &lt;script&gt; 标签的 src 属性不会被同源策略所约束，可以获取任意服务器上的脚本并执行。jsonp 通过插入 script 标签的方式来实现跨域，参数只能通过 url 传入，仅能支持 get 请求。</p>
<blockquote>
<p>实现原理:</p>
</blockquote>
<ul>
<li>Step1: 创建 callback 方法</li>
<li>Step2: 插入 script 标签</li>
<li>Step3: 后台接受到请求，解析前端传过去的 callback 方法，返回该方法的调用，并且数据作为参数传入该方法</li>
<li>Step4: 前端执行服务端返回的方法调用</li>
</ul>
<blockquote>
<p>jsonp源码实现</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">jsonp</span>(<span class="params">&#123;url, params, callback&#125;</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">//创建script标签</span></span><br><span class="line">        <span class="keyword">let</span> script = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;script&#x27;</span>);</span><br><span class="line">        <span class="comment">//将回调函数挂在 window 上</span></span><br><span class="line">        <span class="variable language_">window</span>[callback] = <span class="keyword">function</span>(<span class="params">data</span>) &#123;</span><br><span class="line">            <span class="title function_">resolve</span>(data);</span><br><span class="line">            <span class="comment">//代码执行后，删除插入的script标签</span></span><br><span class="line">            <span class="variable language_">document</span>.<span class="property">body</span>.<span class="title function_">removeChild</span>(script);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//回调函数加在请求地址上</span></span><br><span class="line">        params = &#123;...params, callback&#125; <span class="comment">//wb=b&amp;callback=show</span></span><br><span class="line">        <span class="keyword">let</span> arrs = [];</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">let</span> key <span class="keyword">in</span> params) &#123;</span><br><span class="line">            arrs.<span class="title function_">push</span>(<span class="string">`<span class="subst">$&#123;key&#125;</span>=<span class="subst">$&#123;params[key]&#125;</span>`</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        script.<span class="property">src</span> = <span class="string">`<span class="subst">$&#123;url&#125;</span>?<span class="subst">$&#123;arrs.join(<span class="string">&#x27;&amp;&#x27;</span>)&#125;</span>`</span>;</span><br><span class="line">        <span class="variable language_">document</span>.<span class="property">body</span>.<span class="title function_">appendChild</span>(script);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>使用</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">show</span>(<span class="params">data</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(data);</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">jsonp</span>(&#123;</span><br><span class="line">    <span class="attr">url</span>: <span class="string">&#x27;http://localhost:3000/show&#x27;</span>,</span><br><span class="line">    <span class="attr">params</span>: &#123;</span><br><span class="line">        <span class="comment">//code</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">callback</span>: <span class="string">&#x27;show&#x27;</span></span><br><span class="line">&#125;).<span class="title function_">then</span>(<span class="function"><span class="params">data</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(data);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<blockquote>
<p>服务端代码(node):</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">//express启动一个后台服务</span></span><br><span class="line"><span class="keyword">let</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"><span class="keyword">let</span> app = <span class="title function_">express</span>();</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/show&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> &#123;callback&#125; = req.<span class="property">query</span>; <span class="comment">//获取传来的callback函数名，callback是key</span></span><br><span class="line">    res.<span class="title function_">send</span>(<span class="string">`<span class="subst">$&#123;callback&#125;</span>(&#x27;Hello!&#x27;)`</span>);</span><br><span class="line">&#125;);</span><br><span class="line">app.<span class="title function_">listen</span>(<span class="number">3000</span>);</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>前端</category>
      </categories>
      <tags>
        <tag>JavaScript</tag>
        <tag>面试</tag>
      </tags>
  </entry>
  <entry>
    <title>H5 调用支付宝小程序 Alipay JSAPI</title>
    <url>/test/post/Alipay-JSAPI/</url>
    <content><![CDATA[<h2 id="H5-调用支付宝小程序-Alipay-JSAPI"><a href="#H5-调用支付宝小程序-Alipay-JSAPI" class="headerlink" title="H5 调用支付宝小程序 Alipay JSAPI"></a>H5 调用支付宝小程序 Alipay JSAPI</h2><p>参考链接 <a href="https://opendocs.alipay.com/open/02502i">官方文档：</a>。<br>demo：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;!<span class="variable constant_">DOCTYPE</span> html&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;X-UA-Compatible&quot;</span> <span class="attr">content</span>=<span class="string">&quot;IE=edge&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://gw.alipayobjects.com/as/g/h5-lib/alipayjsapi/3.1.1/alipayjsapi.inc.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://cdn.bootcss.com/vConsole/3.2.0/vconsole.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Alipay-demo<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;parent&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      hello</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;child&quot;</span> <span class="attr">contenteditable</span>=<span class="string">&quot;true&quot;</span>&gt;</span>world<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">&quot;btn1&quot;</span> <span class="attr">onclick</span>=<span class="string">&quot;fn()&quot;</span>&gt;</span>点击1<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">&quot;btn2&quot;</span>&gt;</span>点击2<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="keyword">var</span> vConsole = <span class="keyword">new</span> <span class="title class_">VConsole</span>();</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="keyword">function</span> <span class="title function_">ready</span>(<span class="params">callback</span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="keyword">if</span> (<span class="variable language_">window</span>.<span class="property">AlipayJSBridge</span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          callback &amp;&amp; <span class="title function_">callback</span>();</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">1</span>);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        &#125; <span class="keyword">else</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;请在支付宝打开&quot;</span>);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          <span class="variable language_">document</span>.<span class="title function_">addEventListener</span>(<span class="string">&quot;AlipayJSBridgeReady&quot;</span>, callback, <span class="literal">false</span>);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          <span class="variable language_">window</span>.<span class="property">AlipayJSBridge</span> = &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            <span class="attr">call</span>: <span class="keyword">function</span> (<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">              <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;mock AlipayJSBridge call&quot;</span>);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          &#125;;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="title function_">ready</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&quot;.btn2&quot;</span>).<span class="title function_">addEventListener</span>(<span class="string">&quot;click&quot;</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          <span class="title class_">AlipayJSBridge</span>.<span class="title function_">call</span>(</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            <span class="string">&quot;beehiveOptionsPicker&quot;</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">              <span class="attr">title</span>: <span class="string">&quot;还款日选择&quot;</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">              <span class="attr">optionsOne</span>: [</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">                <span class="string">&quot;每周一&quot;</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">                <span class="string">&quot;每周二&quot;</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">                <span class="string">&quot;每周三&quot;</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">                <span class="string">&quot;每周四&quot;</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">                <span class="string">&quot;每周五&quot;</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">                <span class="string">&quot;每周六&quot;</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">                <span class="string">&quot;每周日&quot;</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">              ],</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">              <span class="attr">selectedOneIndex</span>: <span class="number">2</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            <span class="keyword">function</span> (<span class="params">result</span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">              <span class="title function_">alert</span>(<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(result));</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          );</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          <span class="comment">// AlipayJSBridge.call(</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          <span class="comment">//   &quot;chooseContact&quot;,</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          <span class="comment">//   &#123;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          <span class="comment">//     title: &quot;choose contacts&quot;, // title show on the title bar</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          <span class="comment">//     multiMax: 2, // max contact items size, default 50</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          <span class="comment">//     multiMaxText: &quot;max!&quot;, // message if selected more than max</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          <span class="comment">//   &#125;,</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          <span class="comment">//   function (result) &#123;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          <span class="comment">//     alert(JSON.stringify(result));</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          <span class="comment">//   &#125;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          <span class="comment">// );</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        &#125;);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      &#125;);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="keyword">function</span> <span class="title function_">fn</span>(<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="title class_">AlipayJSBridge</span>.<span class="title function_">call</span>(<span class="string">&quot;toast&quot;</span>, &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          <span class="attr">content</span>: <span class="string">&quot;请填写正确的姓名&quot;</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          <span class="attr">type</span>: <span class="string">&quot;none&quot;</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          <span class="attr">duration</span>: <span class="number">2000</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        &#125;);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

<p>用 open with live server 方式打开生成二维码，然后用支付宝扫码预览</p>
]]></content>
      <categories>
        <category>小程序</category>
      </categories>
      <tags>
        <tag>小程序</tag>
      </tags>
  </entry>
  <entry>
    <title>60个JS实用的代码小技巧</title>
    <url>/test/post/60%E4%B8%AAJS%E5%AE%9E%E7%94%A8%E7%9A%84%E4%BB%A3%E7%A0%81%E5%B0%8F%E6%8A%80%E5%B7%A7/</url>
    <content><![CDATA[<p>JavaScript 有很多很酷的特性，大多数初学者和中级开发人员都不知道。今天分享一些，我经常在项目中使用一些技巧。</p>
<h2 id="1-JS-为什么单线程"><a href="#1-JS-为什么单线程" class="headerlink" title="1. JS 为什么单线程"></a>1. JS 为什么单线程</h2><p>一个简单的原因就是，<code>js</code>在设计之初只是进行一些简单的表单校验，这完全不需要多线程，单线程完全可以胜任这项工作。即便后来前端发展迅速，承载的能力越来越多，也没有发展到非多线程不可的程度。</p>
<p>而且还有一个主要的原因，设想一下，如果<code>js</code>是多线程的，在运行时多个线程同时对<code>DOM</code>元素进行操作，那具体以哪个线程为主就是个问题了，线程的调度问题是一个比较复杂的问题。</p>
<p><code>HTML5</code>新的标准中允许使用<code>new Worker</code>的方式来开启一个新的线程，去运行一段单独的<code>js</code>文件脚本，但是在这个新线程中严格的要求了可以使用的功能，比如说他只能使用<code>ECMAScript</code>, 不能访问<code>DOM</code>和<code>BOM</code>。这也就限制死了多个线程同时操作<code>DOM</code>元素的可能。</p>
<h2 id="2-使用-css-写出一个三角形角标"><a href="#2-使用-css-写出一个三角形角标" class="headerlink" title="2.使用 css 写出一个三角形角标"></a>2.使用 css 写出一个三角形角标</h2><p>元素宽高设置为<code>0</code>，通过<code>border</code>属性来设置，让其它三个方向的<code>border</code>颜色为透明或者和背景色保持一致，剩余一条<code>border</code>的颜色设置为需要的颜色。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">div &#123;</span><br><span class="line">    <span class="attr">width</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attr">height</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attr">border</span>: 5px solid #transparent;</span><br><span class="line">    border-top-<span class="attr">color</span>: red;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="3-水平垂直居中"><a href="#3-水平垂直居中" class="headerlink" title="3.水平垂直居中"></a>3.水平垂直居中</h2><p>我一般只使用两种方式<code>定位</code>或者<code>flex</code>，我觉得够用了。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">div &#123;</span><br><span class="line">    <span class="attr">width</span>: 100px;</span><br><span class="line">    <span class="attr">height</span>: 100px;</span><br><span class="line">    <span class="attr">position</span>: absolute;</span><br><span class="line">    <span class="attr">top</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attr">right</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attr">bottom</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attr">left</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attr">margin</span>: auto;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>父级控制子集居中</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">.<span class="property">parent</span> &#123;</span><br><span class="line">    <span class="attr">display</span>: flex;</span><br><span class="line">    justify-<span class="attr">content</span>: center;</span><br><span class="line">    align-<span class="attr">items</span>: center;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="4-css-一行文本超出…"><a href="#4-css-一行文本超出…" class="headerlink" title="4. css 一行文本超出…"></a>4. css 一行文本超出…</h2><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="attr">overflow</span>: hidden;</span><br><span class="line">text-<span class="attr">overflow</span>:ellipsis;</span><br><span class="line">white-<span class="attr">space</span>: nowrap;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="5-多行文本超出显示…"><a href="#5-多行文本超出显示…" class="headerlink" title="5.多行文本超出显示…"></a>5.多行文本超出显示…</h2><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="attr">display</span>: -webkit-box;</span><br><span class="line">-webkit-box-<span class="attr">orient</span>: vertical;</span><br><span class="line">-webkit-line-<span class="attr">clamp</span>: <span class="number">3</span>;</span><br><span class="line"><span class="attr">overflow</span>: hidden;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="6-IOS-手机容器滚动条滑动不流畅"><a href="#6-IOS-手机容器滚动条滑动不流畅" class="headerlink" title="6.IOS 手机容器滚动条滑动不流畅"></a>6.IOS 手机容器滚动条滑动不流畅</h2><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="attr">overflow</span>: auto;</span><br><span class="line">-webkit-overflow-<span class="attr">scrolling</span>: touch;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="7-修改滚动条样式"><a href="#7-修改滚动条样式" class="headerlink" title="7.修改滚动条样式"></a>7.修改滚动条样式</h2><p>隐藏<code>div</code>元素的滚动条</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="attr">div</span>::-webkit-scrollbar &#123;</span><br><span class="line">    <span class="attr">display</span>: none;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>div::-webkit-scrollbar 滚动条整体部分</p>
<p>div::-webkit-scrollbar-thumb 滚动条里面的小方块，能向上向下移动（或往左往右移动，取决于是垂直滚动条还是水平滚动条）</p>
<p>div::-webkit-scrollbar-track 滚动条的轨道</p>
<p>div::-webkit-scrollbar-button 滚动条的轨道的两端按钮，允许通过点击微调小方块的位置。</p>
<p>div::-webkit-scrollbar-track-piece 内层轨道，滚动条中间部分</p>
<p>div::-webkit-scrollbar-corner 边角，即两个滚动条的交汇处</p>
<p>div::-webkit-resizer 两个滚动条的交汇处上用于通过拖动调整元素大小的小控件</p>
<p>注意此方案有兼容性问题，一般需要隐藏滚动条时我都是用一个色块通过定位盖上去，或者将子级元素调大，父级元素使用 overflow-hidden 截掉滚动条部分。暴力且直接。</p>
<h2 id="8-解决-ios-audio-无法自动播放、循环播放的问题"><a href="#8-解决-ios-audio-无法自动播放、循环播放的问题" class="headerlink" title="8.解决 ios audio 无法自动播放、循环播放的问题"></a>8.解决 ios audio 无法自动播放、循环播放的问题</h2><p><code>ios</code>手机在使用<code>audio</code>或者<code>video</code>播放的时候，个别机型无法实现自动播放，可使用下面的代码<code>hack</code>。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 解决ios audio无法自动播放、循环播放的问题</span></span><br><span class="line"><span class="keyword">var</span> music = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;video&quot;</span>);</span><br><span class="line"><span class="keyword">var</span> state = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">document</span>.<span class="title function_">addEventListener</span>(</span><br><span class="line">  <span class="string">&quot;touchstart&quot;</span>,</span><br><span class="line">  <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (state == <span class="number">0</span>) &#123;</span><br><span class="line">      music.<span class="title function_">play</span>();</span><br><span class="line">      state = <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="literal">false</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">document</span>.<span class="title function_">addEventListener</span>(</span><br><span class="line">  <span class="string">&quot;WeixinJSBridgeReady&quot;</span>,</span><br><span class="line">  <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    music.<span class="title function_">play</span>();</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="literal">false</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">//循环播放</span></span><br><span class="line">music.<span class="property">onended</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  music.<span class="title function_">load</span>();</span><br><span class="line">  music.<span class="title function_">play</span>();</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h2 id="9-隐藏页面元素"><a href="#9-隐藏页面元素" class="headerlink" title="9.隐藏页面元素"></a>9.隐藏页面元素</h2><p>display-none: 元素不会占用空间，在页面中不显示，子元素也不会显示。</p>
<p>opacity-0: 元素透明度将为<code>0</code>，但元素仍然存在，绑定的事件仍旧有效仍可触发执行。</p>
<p>visibility-hidden：元素隐藏，但元素仍旧存在，占用空间，页面中无法触发该元素的事件。</p>
<h2 id="10-前端工程化"><a href="#10-前端工程化" class="headerlink" title="10.前端工程化"></a>10.前端工程化</h2><p>一提到前端工程化很多人想到的都是<code>webpack</code>，这是不对的，<code>webpack</code>仅仅是前端工程化中的一环。在整个工程化过程中他帮我们解决了绝大多数的问题，但并没有解决所有问题。</p>
<p>前端工程化是通过工具提升效率，降低成本的一种手段。</p>
<p>近些年被广泛的关注和探讨，究其原因主要是因为现代化前端应用功能要求不断提高，业务逻辑日益复杂，作为当下互联网时代唯一不可或缺的技术，前端可以说是占据了整个开发行业的半壁江山。从传统的网站，到现在的<code>H5</code>,移动<code>App</code>,桌面应用，以及小程序。前端技术几乎是无所不能的全面覆盖。</p>
<p>在这些表象的背后呢，实际上是行业对开发人员的要求发生了天翻地覆的变化，以往前端写 demo，套模板，调页面这种刀耕火种的方式已经完全不符合当下对开发效率的要求，前端工程化就是在这样一个背景下被提上台面，成为前端工程师必备的手段之一。</p>
<p>一般来说前端工程包含，项目初始化，项目开发，提交，构建，部署，测试，监控等流程。工程化就是以工程的角度来解决这些问题。比如项目初始化我们一般使用<code>npm init</code>, 创建页面模板使用<code>plop</code>，我们喜欢使用<code>ES6+</code>开发，但是需要通过<code>babel</code>编码成<code>ES5</code>，持续集成的时候我们使用<code>git/ci cd</code>，但是为了保持开发规范我们引入了<code>ESLint</code>，部署一般使用<code>git/cd</code>或者<code>jenkins</code>等等。</p>
<h2 id="11-contenteditable"><a href="#11-contenteditable" class="headerlink" title="11.contenteditable"></a>11.contenteditable</h2><p><code>html</code>中大部分标签都是不可以编辑的，但是添加了<code>contenteditable</code>属性之后，标签会变成可编辑状态。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;div contenteditable=<span class="string">&quot;true&quot;</span>&gt;&lt;/div&gt;</span><br></pre></td></tr></table></figure>

<p>不过通过这个属性把标签变为可编辑状态后只有<code>input</code>事件，没有<code>change</code>事件。也不能像表单一样通过<code>maxlength</code>控制最大长度。我也忘记我在什么情况下用到过了，后面想起来再补吧。</p>
<h2 id="12-calc"><a href="#12-calc" class="headerlink" title="12.calc"></a>12.calc</h2><p>这是一个<code>css</code>属性，我一般称之为<code>css</code>表达式。可以计算<code>css</code>的值。最有趣的是他可以计算不同单位的差值。很好用的一个功能，缺点是不容易阅读。接盘侠没办法一眼看出<code>20px</code>是啥。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">div &#123;</span><br><span class="line">    <span class="attr">width</span>: <span class="title function_">calc</span>(<span class="number">25</span>% - 20px);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="13-Date-对象"><a href="#13-Date-对象" class="headerlink" title="13.Date 对象"></a>13.Date 对象</h2><p>获取当前时间毫秒值</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 方式一</span></span><br><span class="line"><span class="title class_">Date</span>.<span class="title function_">now</span>(); <span class="comment">// 1606381881650</span></span><br><span class="line"><span class="comment">// 方式二</span></span><br><span class="line"><span class="keyword">new</span> <span class="title class_">Date</span>() - <span class="number">0</span>; <span class="comment">// 1606381881650</span></span><br><span class="line"><span class="comment">// 方式三</span></span><br><span class="line"><span class="keyword">new</span> <span class="title class_">Date</span>().<span class="title function_">getTime</span>(); <span class="comment">// 1606381881650</span></span><br></pre></td></tr></table></figure>

<p>创建<code>Date</code>对象的兼容性问题。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// window和安卓支持，ios和mac不支持</span></span><br><span class="line"><span class="keyword">new</span> <span class="title class_">Date</span>(<span class="string">&quot;2020-11-26&quot;</span>);</span><br><span class="line"><span class="comment">// window和安卓支持，ios和mac支持</span></span><br><span class="line"><span class="keyword">new</span> <span class="title class_">Date</span>(<span class="string">&quot;2020/11/26&quot;</span>);</span><br></pre></td></tr></table></figure>

<h2 id="14-Proxy-和-Object-defineProperty-区别"><a href="#14-Proxy-和-Object-defineProperty-区别" class="headerlink" title="14.Proxy 和 Object.defineProperty 区别"></a>14.Proxy 和 Object.defineProperty 区别</h2><p><code>Proxy</code>的意思是代理，我一般叫他拦截器，可以拦截对象上的一个操作。用法如下，通过<code>new</code>的方式创建对象，第一个参数是被拦截的对象，第二个参数是对象操作的描述。实例化后返回一个新的对象，当我们对这个新的对象进行操作时就会调用我们描述中对应的方法。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="title class_">Proxy</span>(target, &#123;</span><br><span class="line">  <span class="title function_">get</span>(<span class="params">target, property</span>) &#123;&#125;,</span><br><span class="line">  <span class="title function_">set</span>(<span class="params">target, property</span>) &#123;&#125;,</span><br><span class="line">  <span class="title function_">deleteProperty</span>(<span class="params">target, property</span>) &#123;&#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p><code>Proxy</code>区别于<code>Object.definedProperty</code>。</p>
<p><code>Object.defineProperty</code>只能监听到属性的读写，而<code>Proxy</code>除读写外还可以监听属性的删除，方法的调用等。</p>
<p>通常情况下我们想要监视数组的变化，基本要依靠重写数组方法的方式实现，这也是<code>Vue</code>的实现方式，而<code>Proxy</code>可以直接监视数组的变化。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> list = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];</span><br><span class="line"><span class="keyword">const</span> listproxy = <span class="keyword">new</span> <span class="title class_">Proxy</span>(list, &#123;</span><br><span class="line">  <span class="title function_">set</span>(<span class="params">target, property, value</span>) &#123;</span><br><span class="line">    target[property] = value;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>; <span class="comment">// 标识设置成功</span></span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">list.<span class="title function_">push</span>(<span class="number">4</span>);</span><br></pre></td></tr></table></figure>

<p><code>Proxy</code>是以非入侵的方式监管了对象的读写，而<code>defineProperty</code>需要按特定的方式定义对象的属性。</p>
<h2 id="15-Reflect"><a href="#15-Reflect" class="headerlink" title="15.Reflect"></a>15.Reflect</h2><p>他是<code>ES2015</code>新增的对象，纯静态对象也就是不能被实例画，只能通过静态方法的方式调用，和<code>Math</code>对象类似，只能类似<code>Math.random()</code>的方式调用。</p>
<p><code>Reflect</code>内部封装了一系列对对象的底层操作，一共<code>14</code>个，其中<code>1</code>个被废弃，还剩下<code>13</code>个。</p>
<p><code>Reflect</code>的静态方法和<code>Proxy</code>描述中的方法完全一致。也就是说<code>Reflect</code>成员方法就是<code>Proxy</code>处理对象的默认实现。</p>
<p><code>Proxy</code>对象默认的方法就是调用了<code>Reflect</code>内部的处理逻辑，也就是如果我们调用<code>get</code>方法，那么在内部，<code>Reflect</code>就是将<code>get</code>原封不动的交给了<code>Reflect</code>，如下。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> proxy = <span class="keyword">new</span> <span class="title class_">Proxy</span>(obj, &#123;</span><br><span class="line">  <span class="title function_">get</span>(<span class="params">target, property</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">Reflect</span>.<span class="title function_">get</span>(target, property);</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p><code>Reflect</code>和<code>Proxy</code>没有绝对的关系，我们一般将他们两个放在一起讲是为了方便对二者的理解。</p>
<p>那为什么会有<code>Reflect</code>对象呢，其实他最大的用处就是提供了一套统一操作<code>Object</code>的<code>API</code>。</p>
<p>判断对象是否存在某一个属性，可以使用<code>in</code>操作符，但是不够优雅，还可以使用<code>Reflect.has(obj, name)</code>; 删除一个属性可以使用<code>delete</code>，也可以使用<code>Reflect.deleteProperty(obj, name)</code>; 获取所有属性名可以使用<code>Object.keys</code>, 也可以使用<code>Reflect.ownKeys(obj)</code>; 我们更推荐使用<code>Reflect</code>的<code>API</code>来操作对象，因为他才是未来。</p>
<h2 id="16-解析-get-参数"><a href="#16-解析-get-参数" class="headerlink" title="16.解析 get 参数"></a>16.解析 get 参数</h2><p>通过<code>replace</code>方法获取<code>url</code>中的参数键值对，可以快速解析<code>get</code>参数。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> q = &#123;&#125;;</span><br><span class="line">location.<span class="property">search</span>.<span class="title function_">replace</span>(<span class="regexp">/([^?&amp;=]+)=([^&amp;]+)/g</span>, <span class="function">(<span class="params">_, k, v</span>) =&gt;</span> (q[k] = v));</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(q);</span><br></pre></td></tr></table></figure>

<h2 id="17-解析连接-url"><a href="#17-解析连接-url" class="headerlink" title="17.解析连接 url"></a>17.解析连接 url</h2><p>可以通过创建<code>a</code>标签，给<code>a</code>标签赋值<code>href</code>属性的方式，获取<code>到协议</code>，<code>pathname</code>，<code>origin</code>等<code>location</code>对象上的属性。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 创建a标签</span></span><br><span class="line"><span class="keyword">const</span> aEle = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;a&#x27;</span>);</span><br><span class="line"><span class="comment">// 给a标签赋值href路径</span></span><br><span class="line">aEle.<span class="property">href</span> = <span class="string">&#x27;/test.html&#x27;</span>;</span><br><span class="line"><span class="comment">// 访问aEle中的属性</span></span><br><span class="line">aEle.<span class="property">protocol</span>; <span class="comment">// 获取协议</span></span><br><span class="line">aEle.<span class="property">pathname</span>; <span class="comment">// 获取path</span></span><br><span class="line">aEle.<span class="property">origin</span>;</span><br><span class="line">aEle.<span class="property">host</span>;</span><br><span class="line">aEle.<span class="property">search</span>;</span><br><span class="line">...</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="18-localStorage"><a href="#18-localStorage" class="headerlink" title="18.localStorage"></a>18.localStorage</h2><p><code>localStorage</code>是<code>H5</code>提供的永久存储空间，一般最大可存储<code>5M</code>数据，并且支持跨域隔离，他的出现极大提高了前端开发的可能性。<code>localStorage</code>的使用很多人都知道<code>setItem</code>，<code>getItem</code>,<code>removeItem</code>, 但他也可以直接以成员的方式操作。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 存储</span></span><br><span class="line"><span class="variable language_">localStorage</span>.<span class="property">name</span> = <span class="string">&quot;yd&quot;</span>;</span><br><span class="line"><span class="comment">// 获取</span></span><br><span class="line"><span class="variable language_">localStorage</span>.<span class="property">name</span>; <span class="comment">// yd</span></span><br><span class="line"><span class="comment">// 删除</span></span><br><span class="line"><span class="keyword">delete</span> <span class="variable language_">localStorage</span>.<span class="property">name</span>;</span><br><span class="line"><span class="comment">// 清除全部</span></span><br><span class="line"><span class="variable language_">localStorage</span>.<span class="title function_">clear</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 遍历</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="variable language_">localStorage</span>.<span class="property">length</span>; i++) &#123;</span><br><span class="line">  <span class="keyword">const</span> key = <span class="variable language_">localStorage</span>.<span class="title function_">key</span>(i); <span class="comment">// 获取本地存储的Key</span></span><br><span class="line">  <span class="variable language_">localStorage</span>[key]; <span class="comment">// 获取本地存储的value</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>localStorage</code>满了的情况下仍继续存储并不会覆盖其他的值，而是直接报错(<code>QuotaExceededError</code>)，并且当前存储的值也会被清空。浏览器支持每个域名下存储<code>5M</code>数据。</p>
<h2 id="19-sessionStorage"><a href="#19-sessionStorage" class="headerlink" title="19.sessionStorage"></a>19.sessionStorage</h2><p><code>sessionStorage</code>和<code>localStorage</code>的区别是，存在当前会话，很多人理解的是浏览器关闭，这是不对的，假设你在<code>A</code>页面存储了<code>sessionStorage</code>，新开选项卡将<code>A</code>页面的链接粘贴进去打开页面，<code>sessionStorage</code>也是不存在的。</p>
<p>所以<code>sessionStorage</code>存在的条件是页面间的跳转，<code>A</code>页面存储了<code>sessionStorage</code>，他要通过<code>超链接</code>或者<code>location.href</code>或者<code>window.open</code>来打开另一个同域页面才能访问<code>sessionStorage</code>。</p>
<p>这一点在混合开发嵌套<code>H5</code>的开发模式中尤为重要，如果以新开<code>webview</code>的方式打开页面，很可能<code>sessionStorage</code>就没有了。</p>
<h2 id="20-会话-cookie"><a href="#20-会话-cookie" class="headerlink" title="20.会话 cookie"></a>20.会话 cookie</h2><p><code>cookie</code>在设置的时候如果不设置过期时间，就表示是个会话<code>cookie</code>，以前我以为关闭浏览器会话<code>cookie</code>就消失了，然而…喜提<code>bug</code>一个。</p>
<p>在多数情况下<code>windows</code>系统或者安卓系统确实是这样的。但是在<code>macOS</code>系统或者<code>ios</code>系统中，关闭浏览器并不会清除掉会话<code>cookie</code>，结束浏览器进程才行。</p>
<h2 id="21-标签模板字符串"><a href="#21-标签模板字符串" class="headerlink" title="21.标签模板字符串"></a>21.标签模板字符串</h2><p>模板字符串支持在前面添加一个函数，第一个参数是一个有固定内容组成的数组，后面参数依次为传入的变量，函数返回值为模板字符串真正展示的值。不过这个功能个人感觉没啥用。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">tag</span> = (<span class="params">params, ...args</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> params[<span class="number">0</span>] + args[<span class="number">0</span>]; <span class="comment">// 返回值为模板字符串的真实值。</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> str = tag<span class="string">`hello <span class="subst">$&#123;<span class="string">&quot;world&quot;</span>&#125;</span>`</span>;</span><br></pre></td></tr></table></figure>

<h2 id="22-字符串常用的几个方法"><a href="#22-字符串常用的几个方法" class="headerlink" title="22.字符串常用的几个方法"></a>22.字符串常用的几个方法</h2><h3 id="1-includes"><a href="#1-includes" class="headerlink" title="1. includes();"></a>1. includes();</h3><p>字符串中是否包含某个字符串，这个不说了，其实就是<code>indexOf</code>的替代方案，用起来更优雅，</p>
<h3 id="2-startsWith"><a href="#2-startsWith" class="headerlink" title="2. startsWith();"></a>2. startsWith();</h3><p>字符串是否为某个字符串开始，我一般用它判断<code>url</code>是否有<code>http</code></p>
<h3 id="3-endsWith"><a href="#3-endsWith" class="headerlink" title="3. endsWith();"></a>3. endsWith();</h3><p>字符串是否为某个字符串结尾。判断后缀名的时候尤其有效。</p>
<h3 id="4-repeat-number"><a href="#4-repeat-number" class="headerlink" title="4. repeat(number);"></a>4. repeat(number);</h3><p>得到一个重复<code>number</code>次的字符串。额…我也不知道什么时候有用，一般我用它造测试数据。</p>
<h3 id="5-‘abc’-padEnd-5-‘1’-abc11"><a href="#5-‘abc’-padEnd-5-‘1’-abc11" class="headerlink" title="5. ‘abc’.padEnd(5, ‘1’); &#x2F;&#x2F; abc11;"></a>5. ‘abc’.padEnd(5, ‘1’); &#x2F;&#x2F; abc11;</h3><p>用给定的字符串在尾部拼接到指定长度，第一个参数为长度，第二个参数为用于拼接的值。</p>
<h3 id="6-‘abc’-padStart-5-‘1’-11abc"><a href="#6-‘abc’-padStart-5-‘1’-11abc" class="headerlink" title="6. ‘abc’.padStart(5, ‘1’); &#x2F;&#x2F; 11abc;"></a>6. ‘abc’.padStart(5, ‘1’); &#x2F;&#x2F; 11abc;</h3><p>用给定的字符串在首部拼接到指定长度第一个参数为长度，第二个参数为用于拼接的值。首部补 0？</p>
<h2 id="23-数组快速去重"><a href="#23-数组快速去重" class="headerlink" title="23.数组快速去重"></a>23.数组快速去重</h2><p>应该很多人都知道这个，数组转换成<code>Set</code>, 再转换为数组，不过这种去重方式只能去除基本数据类型组成的数组。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> arr = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> arr2 = <span class="keyword">new</span> <span class="title class_">Set</span>(arr);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> arr3 = [...arr2];</span><br></pre></td></tr></table></figure>

<h2 id="24-Object-keys-values-entries"><a href="#24-Object-keys-values-entries" class="headerlink" title="24.Object.keys, values, entries"></a>24.Object.keys, values, entries</h2><p>一般我们常用<code>Object.keys</code>，返回一个对象的键组成的数组，其实还有<code>Object.values</code>，返回对象值组成的数组，<code>Object.entries</code>将对象转成数组，每个元素是键值对组成的数组，可以使用此功能快速将对象转为<code>Map</code>。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> obj = &#123; <span class="attr">name</span>: <span class="string">&quot;yd&quot;</span>, <span class="attr">age</span>: <span class="number">18</span> &#125;;</span><br><span class="line"></span><br><span class="line"><span class="title class_">Object</span>.<span class="title function_">keys</span>(obj); <span class="comment">// [&#x27;name&#x27;, &#x27;age&#x27;];</span></span><br><span class="line"></span><br><span class="line"><span class="title class_">Object</span>.<span class="title function_">values</span>(obj); <span class="comment">// [&#x27;yd&#x27;, 18];</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> l = <span class="title class_">Object</span>.<span class="title function_">entries</span>(obj); <span class="comment">// [[&#x27;name&#x27;, &#x27;yd&#x27;], [&#x27;age&#x27;: 18]];</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> m = <span class="keyword">new</span> <span class="title class_">Map</span>(l);</span><br></pre></td></tr></table></figure>

<h2 id="25-Object-getOwnPropertyDescriptors"><a href="#25-Object-getOwnPropertyDescriptors" class="headerlink" title="25.Object.getOwnPropertyDescriptors"></a>25.Object.getOwnPropertyDescriptors</h2><p>获取对象的描述信息</p>
<p><code>Object.assign</code>复制时，将对象的属性和方法当做普通属性来复制，并不会复制完整的描述信息，比如<code>this</code>。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> p1 = &#123;</span><br><span class="line">  <span class="attr">a</span>: <span class="string">&quot;y&quot;</span>,</span><br><span class="line">  <span class="attr">b</span>: <span class="string">&quot;d&quot;</span>,</span><br><span class="line">  <span class="keyword">get</span> <span class="title function_">name</span>() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.a&#125;</span> <span class="subst">$&#123;<span class="variable language_">this</span>.b&#125;</span>`</span>;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">const</span> p2 = <span class="title class_">Object</span>.<span class="title function_">assign</span>(&#123;&#125;, p1);</span><br><span class="line"></span><br><span class="line">p2.<span class="property">a</span> = <span class="string">&quot;z&quot;</span>;</span><br><span class="line"></span><br><span class="line">p2.<span class="property">name</span>; <span class="comment">// y d; 发现并没有修改p2.a的值，是因为this仍旧指向p1</span></span><br></pre></td></tr></table></figure>

<p>使用<code>Object.getOwnPropertyDescriptors</code>获取完整描述信息</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> description = <span class="title class_">Object</span>.<span class="title function_">getOwnPropertyDescriptors</span>(p1);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> p2 = <span class="title class_">Object</span>.<span class="title function_">defineProperty</span>(&#123;&#125;, description);</span><br><span class="line"></span><br><span class="line">p2.<span class="property">a</span> = <span class="string">&quot;z&quot;</span>;</span><br><span class="line"></span><br><span class="line">p2.<span class="property">name</span>; <span class="comment">// z d</span></span><br></pre></td></tr></table></figure>

<h2 id="26-BigInt"><a href="#26-BigInt" class="headerlink" title="26.BigInt"></a>26.BigInt</h2><p><code>JavaScript</code>可以处理的最大数字是<code>2</code>的<code>53</code>次方 <code>- 1</code>，这一点我们可以在<code>Number.MAX_SAFE_INTEGER</code>中看到。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">consoel.<span class="title function_">log</span>(<span class="title class_">Number</span>.<span class="property">MAX_SAFE_INTEGER</span>); <span class="comment">//9007199254740991</span></span><br></pre></td></tr></table></figure>

<p>更大的数字则无法处理，<code>ECMAScript2020</code>引入<code>BigInt</code>数据类型来解决这个问题。通过把字母<code>n</code>放在末尾, 可以运算大数据。</p>
<p><code>BigInt</code>可以使用算数运算符进行加、减、乘、除、余数及幂等运算。它可以由数字和十六进制或二进制字符串构造。此外它还支持<code>AND</code>、<code>OR</code>、<code>NOT</code>和<code>XOR</code>之类的按位运算。唯一无效的位运算是零填充右移运算符。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> bigNum = <span class="number">100000000000000000000000000000n</span>;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(bigNum * <span class="number">2n</span>); <span class="comment">// 200000000000000000000000000000n</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> bigInt = <span class="title class_">BigInt</span>(<span class="number">1</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(bigInt); <span class="comment">// 1n;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> bigInt2 = <span class="title class_">BigInt</span>(<span class="string">&quot;2222222222222222222&quot;</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(bigInt2); <span class="comment">// 2222222222222222222n;</span></span><br></pre></td></tr></table></figure>

<p>BigInt 是一个大整数，所以他不能用来存储小数。</p>
<h2 id="27-合并空运算符"><a href="#27-合并空运算符" class="headerlink" title="27.??合并空运算符"></a>27.??合并空运算符</h2><p>假设变量<code>a</code>不存在，我们希望给系统一个默认值，一般我们会使用<code>||</code>运算符。但是在<code>javascript</code>中空字符串，<code>0</code>，<code>false</code>都会执行<code>||</code>运算符，所以<code>ECMAScript2020</code>引入合并空运算符解决该问题，只允许在值为<code>null</code>或未定义时使用默认值。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> name = <span class="string">&quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(name || <span class="string">&quot;yd&quot;</span>); <span class="comment">// yd;</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(name ?? <span class="string">&quot;yd&quot;</span>); <span class="comment">// &#x27;&#x27;;</span></span><br></pre></td></tr></table></figure>

<h2 id="28-可选链运算符"><a href="#28-可选链运算符" class="headerlink" title="28.?可选链运算符"></a>28.?可选链运算符</h2><p>业务代码中经常会遇到这样的情况，<code>a</code>对象有个属性<code>b</code>,<code>b</code>也是一个对象有个属性<code>c</code>,</p>
<p>我们需要访问<code>c</code>，经常会写成<code>a.b.c</code>，但是如果<code>f</code>不存在时，就会出错。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> a = &#123;</span><br><span class="line">  <span class="attr">b</span>: &#123;</span><br><span class="line">    <span class="attr">c</span>: <span class="number">123</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(a.<span class="property">b</span>.<span class="property">c</span>); <span class="comment">// 123;</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(a.<span class="property">f</span>.<span class="property">c</span>); <span class="comment">// f不存在所以会报错</span></span><br></pre></td></tr></table></figure>

<p><code>ECMAScript2020</code>定义可选链运算符解决该问题，通过在<code>.</code>之前添加一个<code>?</code>将键名变成可选</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> person = &#123;&#125;;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(person?.<span class="property">profile</span>?.<span class="property">age</span> ?? <span class="number">18</span>); <span class="comment">// 18</span></span><br></pre></td></tr></table></figure>

<h2 id="29-import"><a href="#29-import" class="headerlink" title="29.import"></a>29.import</h2><p><code>import</code>是<code>ECMAScript2015</code>当中定义的一套<code>ES Module</code>模块系统，语法特性绝大多数浏览器已经支持了，通过给<code>script</code>标签添加<code>type=module</code>的属性就可以使用<code>ES Module</code>的标准去执行<code>javascript</code>代码了。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;script type=<span class="string">&quot;module&quot;</span>&gt;<span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;this is es module&#x27;</span>);&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p>在<code>ES Module</code>规范下，会采用严格模式(<code>use strict</code>)运行<code>javascript</code>代码。每个<code>ES Module</code>都运行在单独的作用域中，也就意味着变量间不会互相干扰。外部<code>js</code>文件是通过<code>CORS</code>的方式请求的，所以要求我们外部的<code>js</code>文件地址要支持跨域请求，也就是文件服务器要支持<code>CORS</code>。我们可以在任意网站控制台输入下面代码。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> script = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&quot;script&quot;</span>);</span><br><span class="line"></span><br><span class="line">script.<span class="property">type</span> = <span class="string">&quot;module&quot;</span>;</span><br><span class="line"></span><br><span class="line">script.<span class="property">innerHTML</span> = <span class="string">`import React from &#x27;https://cdn.bootcdn.net/ajax/libs/react/17.0.1/cjs/react-jsx-dev-runtime.development.js&#x27;;`</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">document</span>.<span class="property">body</span>.<span class="title function_">append</span>(script);</span><br></pre></td></tr></table></figure>

<p>可以发现在<code>network</code>中请求了<code>https://cdn.bootcdn.net/ajax/libs/react/17.0.1/cjs/react-jsx-dev-runtime.development.js</code>资源。</p>
<p><code>ES Module</code>的<code>script</code>标签会延迟脚本加载，等待网页请求完资源之后才执行，和使用<code>deffer</code>的方式加载资源相同。</p>
<p>需要注意的是，<code>import &#123;&#125; from &#39;xx&#39;</code>导入模块的时候，并不是对象的解构，而是<code>import</code>的固定语法，这一点很多人容易弄错。</p>
<p>并且<code>ECMAScript2020</code>中<code>import</code>开始支持动态导入功能，在此之前<code>import</code>只能写在模块代码的顶部，一开始就要声明模块依赖的其它模块。支持动态引入后就可以按需引入对应的模块，这个功能我们早在<code>SPA</code>中就已经用到了。动态导入返回的是一个<code>Promise</code>。</p>
<p>a.js</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> a = <span class="number">123</span>;</span><br><span class="line"><span class="keyword">export</span> &#123; a &#125;;</span><br></pre></td></tr></table></figure>

<p>b.js</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span>(<span class="string">&quot;./a.js&quot;</span>).<span class="title function_">then</span>(<span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(data.<span class="property">a</span>); <span class="comment">// 123;</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="30-0-1-0-2-0-3-false"><a href="#30-0-1-0-2-0-3-false" class="headerlink" title="30. 0.1 + 0.2 &#x3D;&#x3D;&#x3D; 0.3 &#x2F;&#x2F; false"></a>30. 0.1 + 0.2 &#x3D;&#x3D;&#x3D; 0.3 &#x2F;&#x2F; false</h2><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">0.1</span> + <span class="number">0.2</span>); <span class="comment">// 0.30000000000000004</span></span><br></pre></td></tr></table></figure>

<p>在<code>JS</code>当中，<code>Number</code>类型实际上是<code>double</code>类型，运算小数时存在精度问题。因为计算机只认识二进制，在进行运算时，需要将其他进制的数值转换成二进制，然后再进行计算</p>
<p>小数用二进制表达时是无穷的。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 将0.1转换成二进制</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>((<span class="number">0.1</span>).<span class="title function_">toString</span>(<span class="number">2</span>)); <span class="comment">// 0.0001100110011001100110011001100110011001100110011001101</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 将0.2转换成二进制</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>((<span class="number">0.2</span>).<span class="title function_">toString</span>(<span class="number">2</span>)); <span class="comment">// 0.001100110011001100110011001100110011001100110011001101</span></span><br></pre></td></tr></table></figure>

<p>双精度浮点数的小数部分最多支持<code>53</code>位二进制位，所以两者相加后，因浮点数小数位的限制而截断的二进制数字，再转换为十进制，就成了<code>0.30000000000000004</code>，这样在进行算术计算时会产生误差。</p>
<p><code>ES6 在Number</code>对象上面，新增一个极小的常量<code>Number.EPSILON</code>。根据规格，它表示<code>1</code>与大于<code>1</code>的最小浮点数之间的差。对于<code>64</code>位浮点数来说，大于<code>1</code>的最小浮点数相当于二进制的<code>1.00..001</code>，小数点后面有连续<code>51</code>个零。这个值减去<code>1</code>之后，就等于<code>2的-52次方</code>。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="title class_">Number</span>.<span class="property">EPSILON</span> === <span class="title class_">Math</span>.<span class="title function_">pow</span>(<span class="number">2</span>, -<span class="number">52</span>);</span><br><span class="line"><span class="comment">// true</span></span><br><span class="line"><span class="title class_">Number</span>.<span class="property">EPSILON</span>;</span><br><span class="line"><span class="comment">// 2.220446049250313e-16</span></span><br><span class="line"><span class="title class_">Number</span>.<span class="property">EPSILON</span>.<span class="title function_">toFixed</span>(<span class="number">20</span>);</span><br><span class="line"><span class="comment">// &quot;0.00000000000000022204&quot;</span></span><br></pre></td></tr></table></figure>

<p><code>Number.EPSILON</code>实际上是<code>JavaScript</code>能够表示的最小精度。误差如果小于这个值，就可以认为已经没有意义了，即不存在误差了。</p>
<p>引入一个这么小的量的目的，在于为浮点数计算，设置一个误差范围。我们知道浮点数计算是不精确的。</p>
<p><code>Number.EPSILON</code>可以用来设置<code>能够接受的误差范围</code>。比如，误差范围设为<code>2</code>的<code>-50</code>次方（即<code>Number.EPSILON * Math.pow(2, 2)</code>），即如果两个浮点数的差小于这个值，我们就认为这两个浮点数相等。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="number">0.1</span> + <span class="number">0.2</span> - <span class="number">0.3</span> &lt; <span class="title class_">Number</span>.<span class="property">EPSILON</span>; <span class="comment">// true</span></span><br></pre></td></tr></table></figure>

<h2 id="31-有条件地向对象添加属性"><a href="#31-有条件地向对象添加属性" class="headerlink" title="31. 有条件地向对象添加属性"></a>31. 有条件地向对象添加属性</h2><p>我们可以使用展开运算符号(<code>...</code>)来有条件地向 JS 对象快速添加属性。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> condition = <span class="literal">true</span>;</span><br><span class="line"><span class="keyword">const</span> person = &#123;</span><br><span class="line">  <span class="attr">id</span>: <span class="number">1</span>,</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&quot;John Doe&quot;</span>,</span><br><span class="line">  ...(condition &amp;&amp; &#123; <span class="attr">age</span>: <span class="number">16</span> &#125;),</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>如果每个操作数的值都为 <code>true</code>，则 <code>&amp;&amp;</code> 操作符返回最后一个求值表达式。因此返回一个对象<code>&#123;age: 16&#125;</code>，然后将其扩展为<code>person</code>对象的一部分。</p>
<p>如果 <code>condition</code> 为 <code>false</code>，JavaScript 会做这样的事情:</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> person = &#123;</span><br><span class="line">  <span class="attr">id</span>: <span class="number">1</span>,</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&quot;前端小智&quot;</span>,</span><br><span class="line">  ...<span class="literal">false</span>,</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// 展开 `false` 对对象没有影响</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(person); <span class="comment">// &#123; id: 1, name: &#x27;John Doe&#x27; &#125;</span></span><br></pre></td></tr></table></figure>

<h2 id="32-检查属性是否存在对象中"><a href="#32-检查属性是否存在对象中" class="headerlink" title="32.检查属性是否存在对象中"></a>32.检查属性是否存在对象中</h2><p>可以使用 <code>in</code> 关键字来检查 JavaScript 对象中是否存在某个属性。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> person = &#123; <span class="attr">name</span>: <span class="string">&quot;前端小智&quot;</span>, <span class="attr">salary</span>: <span class="number">1000</span> &#125;;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;salary&quot;</span> <span class="keyword">in</span> person); <span class="comment">// true</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;age&quot;</span> <span class="keyword">in</span> person); <span class="comment">// false</span></span><br></pre></td></tr></table></figure>

<h2 id="33-对象中的动态属性名称"><a href="#33-对象中的动态属性名称" class="headerlink" title="33.对象中的动态属性名称"></a>33.对象中的动态属性名称</h2><p>使用动态键设置对象属性很简单。只需使用<code>[&#39;key name&#39;]</code>来添加属性:</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> dynamic = <span class="string">&quot;flavour&quot;</span>;</span><br><span class="line"><span class="keyword">var</span> item = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&quot;前端小智&quot;</span>,</span><br><span class="line">  [dynamic]: <span class="string">&quot;巧克力&quot;</span>,</span><br><span class="line">&#125;;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(item); <span class="comment">// &#123; name: &#x27;前端小智&#x27;, flavour: &#x27;巧克力&#x27; &#125;</span></span><br></pre></td></tr></table></figure>

<p>同样的技巧也可用于使用动态键引用对象属性：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> keyName = <span class="string">&quot;name&quot;</span>;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(item[keyName]); <span class="comment">// returns &#x27;前端小智&#x27;</span></span><br></pre></td></tr></table></figure>

<h2 id="34-使用动态键进行对象解构"><a href="#34-使用动态键进行对象解构" class="headerlink" title="34. 使用动态键进行对象解构"></a>34. 使用动态键进行对象解构</h2><p>我们知道在对象解构时，可以使用 <code>:</code> 来对解构的属性进行重命名。但，你是否知道键名是动态的时，也可以解构对象的属性？</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> person = &#123; <span class="attr">id</span>: <span class="number">1</span>, <span class="attr">name</span>: <span class="string">&quot;前端小智&quot;</span> &#125;;</span><br><span class="line"><span class="keyword">const</span> &#123; <span class="attr">name</span>: personName &#125; = person;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(personName); <span class="comment">// &#x27;前端小智&#x27;</span></span><br></pre></td></tr></table></figure>

<p>现在，我们用动态键来解构属性：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> templates = &#123;</span><br><span class="line">  <span class="attr">hello</span>: <span class="string">&quot;Hello there&quot;</span>,</span><br><span class="line">  <span class="attr">bye</span>: <span class="string">&quot;Good bye&quot;</span>,</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">const</span> templateName = <span class="string">&quot;bye&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> &#123; [templateName]: template &#125; = templates;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(template); <span class="comment">// Good bye</span></span><br></pre></td></tr></table></figure>

<h2 id="35-空值合并-操作符"><a href="#35-空值合并-操作符" class="headerlink" title="35. 空值合并 ?? 操作符"></a>35. 空值合并 <code>??</code> 操作符</h2><p>当我们想检查一个变量是否为 <code>null</code> 或 <code>undefined</code> 时，<code>??</code>操作符很有用。当它的左侧操作数为<code>null</code> 或 <code>undefined</code>时，它返回右侧的操作数，否则返回其左侧的操作数。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> foo = <span class="literal">null</span> ?? <span class="string">&quot;Hello&quot;</span>;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(foo); <span class="comment">// &#x27;Hello&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> bar = <span class="string">&quot;Not null&quot;</span> ?? <span class="string">&quot;Hello&quot;</span>;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(bar); <span class="comment">// &#x27;Not null&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> baz = <span class="number">0</span> ?? <span class="string">&quot;Hello&quot;</span>;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(baz); <span class="comment">// 0</span></span><br></pre></td></tr></table></figure>

<p>在第三个示例中，返回 <code>0</code>，因为即使 <code>0</code> 在 JS 中被认为是假的，但它不是<code>null</code>的或<code>undefined</code>的。你可能认为我们可以用||算子但这两者之间是有区别的</p>
<p>你可能认为我们可以在这里使用 <code>||</code> 操作符，但这两者之间是有区别的。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> cannotBeZero = <span class="number">0</span> || <span class="number">5</span>;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(cannotBeZero); <span class="comment">// 5</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> canBeZero = <span class="number">0</span> ?? <span class="number">5</span>;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(canBeZero); <span class="comment">// 0</span></span><br></pre></td></tr></table></figure>

<h2 id="36-可选链"><a href="#36-可选链" class="headerlink" title="36.可选链 ?."></a>36.可选链 <code>?.</code></h2><p>我们是不是经常遇到这样的错误：<code>TypeError: Cannot read property ‘foo’ of null</code>。这对每一个毅开发人员来说都是一个烦人的问题。引入可选链就是为了解决这个问题。一起来看看：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> book = &#123; <span class="attr">id</span>: <span class="number">1</span>, <span class="attr">title</span>: <span class="string">&quot;Title&quot;</span>, <span class="attr">author</span>: <span class="literal">null</span> &#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 通常情况下，你会这样做</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(book.<span class="property">author</span>.<span class="property">age</span>); <span class="comment">// throws error</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(book.<span class="property">author</span> &amp;&amp; book.<span class="property">author</span>.<span class="property">age</span>); <span class="comment">// null</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用可选链</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(book.<span class="property">author</span>?.<span class="property">age</span>); <span class="comment">// undefined</span></span><br><span class="line"><span class="comment">// 或深度可选链</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(book.<span class="property">author</span>?.<span class="property">address</span>?.<span class="property">city</span>); <span class="comment">// undefined</span></span><br></pre></td></tr></table></figure>

<p>还可以使用如下函数可选链：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> person = &#123;</span><br><span class="line">  <span class="attr">firstName</span>: <span class="string">&quot;前端&quot;</span>,</span><br><span class="line">  <span class="attr">lastName</span>: <span class="string">&quot;小智&quot;</span>,</span><br><span class="line">  <span class="attr">printName</span>: <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.firstName&#125;</span> <span class="subst">$&#123;<span class="variable language_">this</span>.lastName&#125;</span>`</span>;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(person.<span class="title function_">printName</span>()); <span class="comment">// &#x27;前端 小智&#x27;</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(persone.<span class="property">doesNotExist</span>?.()); <span class="comment">// undefined</span></span><br></pre></td></tr></table></figure>

<h2 id="37-使用-操作符"><a href="#37-使用-操作符" class="headerlink" title="37. 使用 !! 操作符"></a>37. 使用 <code>!!</code> 操作符</h2><p><code>!!</code> 运算符可用于将表达式的结果快速转换为布尔值(<code>true</code>或<code>false</code>):</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> greeting = <span class="string">&quot;Hello there!&quot;</span>;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(!!greeting); <span class="comment">// true</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> noGreeting = <span class="string">&quot;&quot;</span>;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(!!noGreeting); <span class="comment">// false</span></span><br></pre></td></tr></table></figure>

<h2 id="38-字符串和整数转换"><a href="#38-字符串和整数转换" class="headerlink" title="38. 字符串和整数转换"></a>38. 字符串和整数转换</h2><p>使用 <code>+</code> 操作符将字符串快速转换为数字:</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> stringNumer = <span class="string">&quot;123&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(+stringNumer); <span class="comment">//123</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="keyword">typeof</span> +stringNumer); <span class="comment">//&#x27;number&#x27;</span></span><br></pre></td></tr></table></figure>

<p>要将数字快速转换为字符串，也可以使用 <code>+</code> 操作符，后面跟着一个空字符串:</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> myString = <span class="number">25</span> + <span class="string">&quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(myString); <span class="comment">//&#x27;25&#x27;</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="keyword">typeof</span> myString); <span class="comment">//&#x27;string&#x27;</span></span><br></pre></td></tr></table></figure>

<p>这些类型转换非常方便，但它们的清晰度和代码可读性较差。<strong>所以实际开发，需要慎重的选择使用。</strong></p>
<h2 id="39-检查数组中的假值"><a href="#39-检查数组中的假值" class="headerlink" title="39. 检查数组中的假值"></a>39. 检查数组中的假值</h2><p>大家应该都用过数组方法：<code>filter</code>、<code>some</code>、<code>every</code>，这些方法可以配合 <code>Boolean</code> 方法来测试真假值。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> myArray = [<span class="literal">null</span>, <span class="literal">false</span>, <span class="string">&quot;Hello&quot;</span>, <span class="literal">undefined</span>, <span class="number">0</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 过滤虚值</span></span><br><span class="line"><span class="keyword">const</span> filtered = myArray.<span class="title function_">filter</span>(<span class="title class_">Boolean</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(filtered); <span class="comment">// [&#x27;Hello&#x27;]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 检查至少一个值是否为真</span></span><br><span class="line"><span class="keyword">const</span> anyTruthy = myArray.<span class="title function_">some</span>(<span class="title class_">Boolean</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(anyTruthy); <span class="comment">// true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 检查所有的值是否为真</span></span><br><span class="line"><span class="keyword">const</span> allTruthy = myArray.<span class="title function_">every</span>(<span class="title class_">Boolean</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(allTruthy); <span class="comment">// false</span></span><br></pre></td></tr></table></figure>

<p>下面是它的工作原理。我们知道这些数组方法接受一个回调函数，所以我们传递 <code>Boolean</code> 作为回调函数。<code>Boolean</code> 函数本身接受一个参数，并根据参数的真实性返回 <code>true</code> 或 <code>false</code>。所以：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">myArray.<span class="title function_">filter</span>(<span class="function">(<span class="params">val</span>) =&gt;</span> <span class="title class_">Boolean</span>(val));</span><br></pre></td></tr></table></figure>

<p>等价于：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">myArray.<span class="title function_">filter</span>(<span class="title class_">Boolean</span>);</span><br></pre></td></tr></table></figure>

<h2 id="40-扁平化数组"><a href="#40-扁平化数组" class="headerlink" title="40. 扁平化数组"></a>40. 扁平化数组</h2><p>在原型 Array 上有一个方法 <code>flat</code>，可以从一个数组的数组中制作一个单一的数组。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> myArray = [&#123; <span class="attr">id</span>: <span class="number">1</span> &#125;, [&#123; <span class="attr">id</span>: <span class="number">2</span> &#125;], [&#123; <span class="attr">id</span>: <span class="number">3</span> &#125;]];</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> flattedArray = myArray.<span class="title function_">flat</span>();</span><br><span class="line"><span class="comment">//[ &#123; id: 1 &#125;, &#123; id: 2 &#125;, &#123; id: 3 &#125; ]</span></span><br></pre></td></tr></table></figure>

<p>你也可以定义一个深度级别，指定一个嵌套的数组结构应该被扁平化的深度。例如：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> arr = [<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, [[[<span class="number">3</span>, <span class="number">4</span>]]]];</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(arr.<span class="title function_">flat</span>(<span class="number">2</span>)); <span class="comment">// returns [0, 1, 2, [3,4]]</span></span><br></pre></td></tr></table></figure>

<h2 id="41-Object-entries"><a href="#41-Object-entries" class="headerlink" title="41.Object.entries"></a>41.Object.entries</h2><p>大多数开发人员使用 <code>Object.keys</code> 方法来迭代对象。此方法仅返回对象键的数组，而不返回值。我们可以使用 <code>Object.entries</code> 来获取键和值。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> person = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&quot;前端小智&quot;</span>,</span><br><span class="line">  <span class="attr">age</span>: <span class="number">20</span>,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="title class_">Object</span>.<span class="title function_">keys</span>(person); <span class="comment">// [&#x27;name&#x27;, &#x27;age&#x27;]</span></span><br><span class="line"><span class="title class_">Object</span>.<span class="title function_">entries</span>(data); <span class="comment">// [[&#x27;name&#x27;, &#x27;前端小智&#x27;], [&#x27;age&#x27;, 20]]</span></span><br></pre></td></tr></table></figure>

<p>为了迭代一个对象，我们可以执行以下操作：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="title class_">Object</span>.<span class="title function_">keys</span>(person).<span class="title function_">forEach</span>(<span class="function">(<span class="params">key</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`<span class="subst">$&#123;key&#125;</span> is <span class="subst">$&#123;person[key]&#125;</span>`</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用 entries 获取键和值</span></span><br><span class="line"><span class="title class_">Object</span>.<span class="title function_">entries</span>(person).<span class="title function_">forEach</span>(<span class="function">(<span class="params">[key, value]</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`<span class="subst">$&#123;key&#125;</span> is <span class="subst">$&#123;value&#125;</span>`</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// name is 前端小智</span></span><br><span class="line"><span class="comment">// age is 20</span></span><br></pre></td></tr></table></figure>

<p>上述两种方法都返回相同的结果，但 <code>Object.entries</code> 获取键值对更容易。</p>
<h2 id="42-replaceAll-方法"><a href="#42-replaceAll-方法" class="headerlink" title="42.replaceAll 方法"></a>42.replaceAll 方法</h2><p>在 JS 中，要将所有出现的字符串替换为另一个字符串，我们需要使用如下所示的正则表达式：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> str = <span class="string">&quot;Red-Green-Blue&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 只规制第一次出现的</span></span><br><span class="line">str.<span class="title function_">replace</span>(<span class="string">&quot;-&quot;</span>, <span class="string">&quot; &quot;</span>); <span class="comment">// Red Green-Blue</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用 RegEx 替换所有匹配项</span></span><br><span class="line">str.<span class="title function_">replace</span>(<span class="regexp">/\-/g</span>, <span class="string">&quot; &quot;</span>); <span class="comment">// Red Green Blue</span></span><br></pre></td></tr></table></figure>

<p>但是在 ES12 中，一个名为 <code>replaceAll</code> 的新方法被添加到 <code>String.prototype</code> 中，它用另一个字符串值替换所有出现的字符串。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">str.<span class="title function_">replaceAll</span>(<span class="string">&quot;-&quot;</span>, <span class="string">&quot; &quot;</span>); <span class="comment">// Red Green Blue</span></span><br></pre></td></tr></table></figure>

<h2 id="43-数字分隔符"><a href="#43-数字分隔符" class="headerlink" title="43.数字分隔符"></a>43.数字分隔符</h2><p>可以使用下划线作为数字分隔符，这样可以方便地计算数字中 0 的个数。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 难以阅读</span></span><br><span class="line"><span class="keyword">const</span> billion = <span class="number">1000000000</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 易于阅读</span></span><br><span class="line"><span class="keyword">const</span> readableBillion = <span class="number">1000_000_000</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(readableBillion); <span class="comment">//1000000000</span></span><br></pre></td></tr></table></figure>

<p>下划线分隔符也可以用于 BigInt 数字，如下例所示</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> trillion = <span class="number">1000_000_000_000n</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(trillion); <span class="comment">// 1000000000000</span></span><br></pre></td></tr></table></figure>

<h2 id="44-document-designMode"><a href="#44-document-designMode" class="headerlink" title="44.document.designMode"></a>44.document.designMode</h2><p>与前端的 JavaScript 有关，设计模式让你可以编辑页面上的任何内容。只要打开浏览器控制台，输入以下内容即可。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="variable language_">document</span>.<span class="property">designMode</span> = <span class="string">&quot;on&quot;</span>;</span><br></pre></td></tr></table></figure>

<p><img src="https://alianck.oss-cn-beijing.aliyuncs.com/60js1.gif" alt="图片"></p>
<h2 id="45-逻辑赋值运算符"><a href="#45-逻辑赋值运算符" class="headerlink" title="45.逻辑赋值运算符"></a>45.逻辑赋值运算符</h2><p>逻辑赋值运算符是由逻辑运算符<code>&amp;&amp;</code>、<code>||</code>、<code>??</code>和赋值运算符<code>=</code>组合而成。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> a = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">const</span> b = <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line">a &amp;&amp;= b;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(a); <span class="comment">// 2</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 上面等价于</span></span><br><span class="line">a &amp;&amp; (a = b);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 或者</span></span><br><span class="line"><span class="keyword">if</span> (a) &#123;</span><br><span class="line">  a = b;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>检查<code>a</code>的值是否为真，如果为真，那么更新<code>a</code>的值。使用逻辑或 <code>||</code>操作符也可以做同样的事情。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> a = <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">const</span> b = <span class="number">3</span>;</span><br><span class="line"></span><br><span class="line">a ||= b;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(a); <span class="comment">// 3</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 上面等价于</span></span><br><span class="line">a || (a = b);</span><br></pre></td></tr></table></figure>

<p>使用空值合并操作符 <code>??</code>:</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> a = <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">const</span> b = <span class="number">3</span>;</span><br><span class="line"></span><br><span class="line">a ??= b;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(a); <span class="comment">// 3</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 上面等价于</span></span><br><span class="line"><span class="keyword">if</span> (a === <span class="literal">null</span> || a === <span class="literal">undefined</span>) &#123;</span><br><span class="line">  a = b;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>注意：<code>??</code>操作符只检查 <code>null</code> 或 <code>undefined</code> 的值。</p>
<h2 id="46-同步阻塞法实现-sleep-函数"><a href="#46-同步阻塞法实现-sleep-函数" class="headerlink" title="46.同步阻塞法实现 sleep 函数"></a>46.同步阻塞法实现 sleep 函数</h2><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">sleep</span> = (<span class="params">delay</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> start = <span class="keyword">new</span> <span class="title class_">Date</span>().<span class="title function_">getTime</span>();</span><br><span class="line">  <span class="keyword">while</span> (<span class="keyword">new</span> <span class="title class_">Date</span>().<span class="title function_">getTime</span>() &lt; start + delay) &#123;</span><br><span class="line">    <span class="keyword">continue</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">1</span>);</span><br><span class="line"><span class="title function_">sleep</span>(<span class="number">3000</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">2</span>);</span><br></pre></td></tr></table></figure>

<h2 id="47-利用-new-URL-解析-URL"><a href="#47-利用-new-URL-解析-URL" class="headerlink" title="47.利用 new URL 解析 URL"></a>47.利用 new URL 解析 URL</h2><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">parseURL</span> = (<span class="params">url = <span class="string">&quot;&quot;</span></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> res = <span class="keyword">new</span> <span class="title function_">URL</span>(url);</span><br><span class="line">  res.<span class="property">queryParams</span> = <span class="function">(<span class="params">key</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (key) &#123;</span><br><span class="line">      <span class="keyword">return</span> res.<span class="property">searchParams</span>.<span class="title function_">get</span>(key);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">const</span> params = &#123;&#125;;</span><br><span class="line">    <span class="keyword">const</span> paramGroup = res.<span class="property">search</span>.<span class="title function_">replace</span>(<span class="regexp">/^\?/</span>, <span class="string">&quot;&quot;</span>).<span class="title function_">split</span>(<span class="string">&quot;&amp;&quot;</span>);</span><br><span class="line">    paramGroup.<span class="title function_">forEach</span>(<span class="function">(<span class="params">param</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> [key, val] = param.<span class="title function_">split</span>(<span class="string">&quot;=&quot;</span>);</span><br><span class="line">      params[key] = val;</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">return</span> params;</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">return</span> res;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="title function_">parseURL</span>(<span class="string">&quot;https://www.example.com/a/b?c=1&amp;d=2&quot;</span>);</span><br></pre></td></tr></table></figure>

<h2 id="48-一行代码实现星级评分"><a href="#48-一行代码实现星级评分" class="headerlink" title="48.一行代码实现星级评分"></a>48.一行代码实现星级评分</h2><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">getRate</span> = (<span class="params">rate = <span class="number">0</span></span>) =&gt; <span class="string">&quot;★★★★★☆☆☆☆☆&quot;</span>.<span class="title function_">slice</span>(<span class="number">5</span> - rate, <span class="number">10</span> - rate);</span><br><span class="line"><span class="title function_">getRate</span>(<span class="number">3</span>);</span><br></pre></td></tr></table></figure>

<h2 id="49-用位运算提升效率"><a href="#49-用位运算提升效率" class="headerlink" title="49.用位运算提升效率"></a>49.用位运算提升效率</h2><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ｜ 取整</span></span><br><span class="line"><span class="keyword">let</span> num1 = <span class="number">1.7</span>;</span><br><span class="line">num1 = num1 | <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// &gt;&gt; 取半</span></span><br><span class="line"><span class="keyword">let</span> num2 = <span class="number">6</span>;</span><br><span class="line">num2 = num2 &gt;&gt; <span class="number">1</span>; <span class="comment">// 3</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// &lt;&lt; 加倍</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> num3 = <span class="number">6</span>;</span><br><span class="line">num3 = num3 &lt;&lt; <span class="number">1</span>; <span class="regexp">/ /</span> <span class="number">12</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ^ 交换值</span></span><br><span class="line"><span class="keyword">let</span> num4 = <span class="number">10</span>;</span><br><span class="line"><span class="keyword">let</span> num5 = <span class="number">20</span>;</span><br><span class="line"></span><br><span class="line">num4 ^= num5;</span><br><span class="line">num5 ^= num4;</span><br><span class="line">num4 ^= num5; <span class="comment">// num4 === 2, num5 === 1</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// &amp; 判断奇数</span></span><br><span class="line"><span class="keyword">let</span> num6 = <span class="number">10</span>;</span><br><span class="line"><span class="keyword">let</span> num7 = <span class="number">11</span>;</span><br><span class="line"></span><br><span class="line">num6 &amp; <span class="number">1</span> === <span class="number">1</span>; <span class="comment">// true</span></span><br><span class="line">num7 &amp; <span class="number">1</span> === <span class="number">1</span>; <span class="comment">// false</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ~ 判断是否存在</span></span><br><span class="line"><span class="keyword">const</span> data = <span class="string">&#x27;123456&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> key = <span class="string">&#x27;3&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> keyIsExist = !!~data.<span class="title function_">indexOf</span>(key); <span class="comment">// true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 是否 2 的整数幂</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">isPowerOf2</span> = num =&gt; (num &amp; (num - <span class="number">1</span>)) === <span class="number">0</span>;</span><br><span class="line"><span class="title function_">isPowerOf2</span>(<span class="number">8</span>) <span class="comment">// true</span></span><br><span class="line"><span class="title function_">isPowerOf2</span>(<span class="number">7</span>) <span class="comment">// false</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="50-判断是否是千分符字符"><a href="#50-判断是否是千分符字符" class="headerlink" title="50.判断是否是千分符字符"></a>50.判断是否是千分符字符</h2><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">numberIsThousand</span> = (<span class="params">str</span>) =&gt; <span class="regexp">/^-?\d&#123;1,3&#125;(,\d&#123;3&#125;)*(\.\d+)?$/</span>.<span class="title function_">test</span>(str);</span><br><span class="line"><span class="title function_">numberIsThousand</span>(<span class="string">&quot;100,000,000,000&quot;</span>); <span class="comment">// true</span></span><br><span class="line"><span class="title function_">numberIsThousand</span>(<span class="string">&quot;100,000,000,00&quot;</span>); <span class="comment">// false</span></span><br></pre></td></tr></table></figure>

<h2 id="51-复制文本到剪切板"><a href="#51-复制文本到剪切板" class="headerlink" title="51.复制文本到剪切板"></a>51.复制文本到剪切板</h2><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">copyToClipboard</span> = (<span class="params">content</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> clipboardData = <span class="variable language_">window</span>.<span class="property">clipboardData</span>;</span><br><span class="line">  <span class="keyword">if</span> (clipboardData) &#123;</span><br><span class="line">    clipboardData.<span class="title function_">clearData</span>();</span><br><span class="line">    clipboardData.<span class="title function_">setData</span>(<span class="string">&quot;Text&quot;</span>, content);</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="variable language_">document</span>.<span class="property">execCommand</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> el = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&quot;textarea&quot;</span>);</span><br><span class="line">    el.<span class="property">value</span> = content;</span><br><span class="line">    el.<span class="title function_">setAttribute</span>(<span class="string">&quot;readonly&quot;</span>, <span class="string">&quot;&quot;</span>);</span><br><span class="line">    el.<span class="property">style</span>.<span class="property">position</span> = <span class="string">&quot;absolute&quot;</span>;</span><br><span class="line">    el.<span class="property">style</span>.<span class="property">left</span> = <span class="string">&quot;-9999px&quot;</span>;</span><br><span class="line">    <span class="variable language_">document</span>.<span class="property">body</span>.<span class="title function_">appendChild</span>(el);</span><br><span class="line">    el.<span class="title function_">select</span>();</span><br><span class="line">    <span class="variable language_">document</span>.<span class="title function_">execCommand</span>(<span class="string">&quot;copy&quot;</span>);</span><br><span class="line">    <span class="variable language_">document</span>.<span class="property">body</span>.<span class="title function_">removeChild</span>(el);</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="title function_">copyToClipboard</span>(<span class="string">&quot;hello world&quot;</span>);</span><br></pre></td></tr></table></figure>

<h2 id="52-一行代码生成指定长度的数组"><a href="#52-一行代码生成指定长度的数组" class="headerlink" title="52.一行代码生成指定长度的数组"></a>52.一行代码生成指定长度的数组</h2><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">List</span> = (<span class="params">len</span>) =&gt; [...<span class="keyword">new</span> <span class="title class_">Array</span>(len).<span class="title function_">keys</span>()];</span><br><span class="line"><span class="keyword">const</span> list = <span class="title class_">List</span>(<span class="number">10</span>); <span class="comment">// [0, 1, 2, 3, 4, 5, 6, 7, 8, 9]</span></span><br></pre></td></tr></table></figure>

<h2 id="53-判断数据类型"><a href="#53-判断数据类型" class="headerlink" title="53.判断数据类型"></a>53.判断数据类型</h2><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">type</span> = (<span class="params">data</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">let</span> toString = <span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">toString</span>;</span><br><span class="line">  <span class="keyword">const</span> dataType =</span><br><span class="line">    data <span class="keyword">instanceof</span> <span class="title class_">Element</span></span><br><span class="line">      ? <span class="string">&quot;element&quot;</span> <span class="comment">// 为了统一DOM节点类型输出</span></span><br><span class="line">      : toString</span><br><span class="line">          .<span class="title function_">call</span>(data)</span><br><span class="line">          .<span class="title function_">replace</span>(<span class="regexp">/\[object\s(.+)\]/</span>, <span class="string">&quot;$1&quot;</span>)</span><br><span class="line">          .<span class="title function_">toLowerCase</span>();</span><br><span class="line">  <span class="keyword">return</span> dataType;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="title function_">type</span>(&#123;&#125;); <span class="comment">// object</span></span><br></pre></td></tr></table></figure>

<h2 id="54-正则判断字符重复次数不超过两次"><a href="#54-正则判断字符重复次数不超过两次" class="headerlink" title="54.正则判断字符重复次数不超过两次"></a>54.正则判断字符重复次数不超过两次</h2><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">strIsRepeatThan2</span> = (<span class="params">str = <span class="string">&quot;&quot;</span></span>) =&gt;</span><br><span class="line">  <span class="regexp">/^(?!.*(.).*\1&#123;2&#125;)[\da-zA-Z].+$/</span>.<span class="title function_">test</span>(str);</span><br><span class="line"><span class="title function_">strIsRepeatThan2</span>(<span class="string">&quot;123456&quot;</span>); <span class="comment">// true</span></span><br><span class="line"><span class="title function_">strIsRepeatThan2</span>(<span class="string">&quot;1234566&quot;</span>); <span class="comment">// true</span></span><br><span class="line"><span class="title function_">strIsRepeatThan2</span>(<span class="string">&quot;12345666&quot;</span>); <span class="comment">// false</span></span><br></pre></td></tr></table></figure>

<h2 id="55-正则匹配可以只有-0-但开头不能是-0-的数字"><a href="#55-正则匹配可以只有-0-但开头不能是-0-的数字" class="headerlink" title="55.正则匹配可以只有 0 但开头不能是 0 的数字"></a>55.正则匹配可以只有 0 但开头不能是 0 的数字</h2><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">getCorrectNumber</span> = (<span class="params">str = <span class="string">&quot;&quot;</span></span>) =&gt; <span class="regexp">/^(\d|[1-9]\d*)$/</span>.<span class="title function_">test</span>(str);</span><br><span class="line"><span class="title function_">getCorrectNumber</span>(<span class="string">&quot;0&quot;</span>); <span class="comment">// true</span></span><br><span class="line"><span class="title function_">getCorrectNumber</span>(<span class="string">&quot;011&quot;</span>); <span class="comment">// false</span></span><br><span class="line"><span class="title function_">getCorrectNumber</span>(<span class="string">&quot;101&quot;</span>); <span class="comment">// true</span></span><br></pre></td></tr></table></figure>

<h2 id="56-使用-history-back-可以创建一个浏览器“返回”按钮。"><a href="#56-使用-history-back-可以创建一个浏览器“返回”按钮。" class="headerlink" title="56.使用 history.back() 可以创建一个浏览器“返回”按钮。"></a>56.使用 history.back() 可以创建一个浏览器“返回”按钮。</h2><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;button onclick=<span class="string">&quot;history.back()&quot;</span>&gt;返回&lt;/button&gt;</span><br></pre></td></tr></table></figure>

<h2 id="57-事件监听器只运行一次"><a href="#57-事件监听器只运行一次" class="headerlink" title="57.事件监听器只运行一次"></a>57.事件监听器只运行一次</h2><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">element.<span class="title function_">addEventListener</span>(<span class="string">&quot;click&quot;</span>, <span class="function">() =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;I run only once&quot;</span>), &#123;</span><br><span class="line">  <span class="attr">once</span>: <span class="literal">true</span>,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="58-从数组中过滤所有虚值"><a href="#58-从数组中过滤所有虚值" class="headerlink" title="58.从数组中过滤所有虚值"></a>58.从数组中过滤所有虚值</h2><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> myArray = [<span class="number">1</span>, <span class="literal">undefined</span>, <span class="title class_">NaN</span>, <span class="number">2</span>, <span class="literal">null</span>, <span class="string">&quot;@denicmarko&quot;</span>, <span class="literal">true</span>, <span class="number">3</span>, <span class="literal">false</span>];</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(myArray.<span class="title function_">filter</span>(<span class="title class_">Boolean</span>)); <span class="comment">// [1, 2, &quot;@denicmarko&quot;, true, 3]</span></span><br></pre></td></tr></table></figure>

<h2 id="59-妙用-reduce-对数组求和"><a href="#59-妙用-reduce-对数组求和" class="headerlink" title="59.妙用 reduce 对数组求和"></a>59.妙用 reduce 对数组求和</h2><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> myArray = [<span class="number">10</span>, <span class="number">20</span>, <span class="number">30</span>, <span class="number">40</span>];</span><br><span class="line"><span class="keyword">const</span> <span class="title function_">reducer</span> = (<span class="params">total, currentValue</span>) =&gt; total + currentValue;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(myArray.<span class="title function_">reduce</span>(reducer)); <span class="comment">// 100</span></span><br></pre></td></tr></table></figure>

<h2 id="60-从数组中获取最小值-最大值"><a href="#60-从数组中获取最小值-最大值" class="headerlink" title="60.从数组中获取最小值&#x2F;最大值"></a>60.从数组中获取最小值&#x2F;最大值</h2><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> numbers = [<span class="number">6</span>, <span class="number">8</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">9</span>];</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Math</span>.<span class="title function_">max</span>(...numbers)); <span class="comment">// 9</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Math</span>.<span class="title function_">min</span>(...numbers)); <span class="comment">// 1</span></span><br></pre></td></tr></table></figure>

<p>::: tip 提示<br>有部分重复内容，欢迎指正！:stuck_out_tongue_winking_eye:<br>:::</p>
]]></content>
      <categories>
        <category>前端</category>
      </categories>
      <tags>
        <tag>JavaScript</tag>
      </tags>
  </entry>
  <entry>
    <title>25 条示例代码让你的代码更简洁</title>
    <url>/test/post/25%E6%9D%A1%E7%A4%BA%E4%BE%8B%E8%AE%A9%E4%BD%A0%E7%9A%84%E4%BB%A3%E7%A0%81%E6%9B%B4%E7%AE%80%E6%B4%81/</url>
    <content><![CDATA[<h1 id="25-条示例代码让你的代码更简洁"><a href="#25-条示例代码让你的代码更简洁" class="headerlink" title="25 条示例代码让你的代码更简洁"></a>25 条示例代码让你的代码更简洁</h1><p>JavaScript 无处不在，从 PC 端到移动设备端，甚至是后端，都在使用 JavaScript。</p>
<p>在本文中，我将尝试一些可用来使代码看起来更简洁的实践方案。</p>
<h2 id="1、使用默认参数代替短路或条件"><a href="#1、使用默认参数代替短路或条件" class="headerlink" title="1、使用默认参数代替短路或条件"></a>1、使用默认参数代替短路或条件</h2><p>默认参数通常比短路更简洁。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">SomeMethod</span>(<span class="params">paramThatCanBeUndefined</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> localValue = paramThatCanBeUndefined || <span class="string">&quot;Default Value&quot;</span>;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(localValue);</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="title class_">SomeMethod</span>(); <span class="comment">// Default Value</span></span><br><span class="line"><span class="title class_">SomeMethod</span>(<span class="string">&quot;SomeValue&quot;</span>); <span class="comment">// SomeValue</span></span><br></pre></td></tr></table></figure>

<p>尝试以下方法：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">SomeMethod</span>(<span class="params"></span></span><br><span class="line"><span class="params">  <span class="variable language_">console</span>.log(paramThatCanBeUndefined)</span></span><br><span class="line"><span class="params">  <span class="comment">// ...</span></span></span><br><span class="line"><span class="params">&#125;</span></span><br><span class="line"><span class="params">SomeMethod() <span class="comment">// Default Value</span></span></span><br><span class="line"><span class="params">SomeMethod(<span class="string">&quot;SomeValue&quot;</span>) <span class="comment">// SomeValue</span></span></span><br></pre></td></tr></table></figure>

<p>声明：Falsy 值，如’’，””，false，null，0，和 NaN 将不会被默认值替代：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">SomeMethod</span>(<span class="params">paramThatCanBeUndefined = <span class="string">&quot;Default Value&quot;</span></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(paramThatCanBeUndefined);</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="title class_">SomeMethod</span>(<span class="literal">null</span>); <span class="comment">// will not Default Value, will null Instead</span></span><br><span class="line"><span class="title class_">SomeMethod</span>(<span class="string">&quot;SomeValue&quot;</span>); <span class="comment">// SomeValue</span></span><br></pre></td></tr></table></figure>

<h2 id="2、处理多个条件"><a href="#2、处理多个条件" class="headerlink" title="2、处理多个条件"></a>2、处理多个条件</h2><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> conditions = [<span class="string">&quot;Condition 2&quot;</span>,<span class="string">&quot;Condition String2&quot;</span>];</span><br><span class="line"><span class="title function_">someFunction</span>(<span class="params">str</span>)&#123;</span><br><span class="line">  <span class="keyword">if</span>(str.<span class="title function_">includes</span>(<span class="string">&quot;someValue1&quot;</span>) || str.<span class="title function_">includes</span>(<span class="string">&quot;someValue2&quot;</span>))&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">  &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>一种更简洁的方法是：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="title function_">someFunction</span>(<span class="params">str</span>)&#123;</span><br><span class="line">   <span class="keyword">const</span> conditions = [<span class="string">&quot;someValue1&quot;</span>,<span class="string">&quot;someValue2&quot;</span>];</span><br><span class="line">   <span class="keyword">return</span> conditions.<span class="title function_">some</span>(<span class="function"><span class="params">condition</span>=&gt;</span>str.<span class="title function_">includes</span>(condition));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="3、用动态键值对替换开关（即对象文字）"><a href="#3、用动态键值对替换开关（即对象文字）" class="headerlink" title="3、用动态键值对替换开关（即对象文字）"></a>3、用动态键值对替换开关（即对象文字）</h2><p>开关版本（或将开关替换为 if &#x2F; else）：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">UserRole</span> = &#123;</span><br><span class="line">  <span class="attr">ADMIN</span>: <span class="string">&quot;Admin&quot;</span>,</span><br><span class="line">  <span class="attr">GENERAL_USER</span>: <span class="string">&quot;GeneralUser&quot;</span>,</span><br><span class="line">  <span class="attr">SUPER_ADMIN</span>: <span class="string">&quot;SuperAdmin&quot;</span>,</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">getRoute</span>(<span class="params">userRole = <span class="string">&quot;default role&quot;</span></span>) &#123;</span><br><span class="line">  <span class="keyword">switch</span> (userRole) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="title class_">UserRole</span>.<span class="property">ADMIN</span>:</span><br><span class="line">      <span class="keyword">return</span> <span class="string">&quot;/admin&quot;</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="title class_">UserRole</span>.<span class="property">GENERAL_USER</span>:</span><br><span class="line">      <span class="keyword">return</span> <span class="string">&quot;/GENERAL_USER&quot;</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="title class_">UserRole</span>.<span class="property">SUPER_ADMIN</span>:</span><br><span class="line">      <span class="keyword">return</span> <span class="string">&quot;/superadmin&quot;</span>;</span><br><span class="line">    <span class="attr">default</span>:</span><br><span class="line">      <span class="keyword">return</span> <span class="string">&quot;/&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">getRoute</span>(<span class="title class_">UserRole</span>.<span class="property">ADMIN</span>)); <span class="comment">// return &quot;/admin&quot;</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">getRoute</span>(<span class="string">&quot;Anything&quot;</span>)); <span class="comment">// return Default path</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">getRoute</span>()); <span class="comment">// return Default path</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">getRoute</span>(<span class="literal">null</span>)); <span class="comment">// return Default path</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// More cases if new arrive</span></span><br><span class="line"><span class="comment">// You can think if else instead of switch</span></span><br></pre></td></tr></table></figure>

<p>动态键值对版本：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">UserRole</span> = &#123;</span><br><span class="line">  <span class="attr">ADMIN</span>: <span class="string">&quot;Admin&quot;</span>,</span><br><span class="line">  <span class="attr">GENERAL_USER</span>: <span class="string">&quot;GeneralUser&quot;</span>,</span><br><span class="line">  <span class="attr">SUPER_ADMIN</span>: <span class="string">&quot;SuperAdmin&quot;</span>,</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">getRoute</span>(<span class="params">userRole = <span class="string">&quot;default role&quot;</span></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> appRoute = &#123;</span><br><span class="line">    [<span class="title class_">UserRole</span>.<span class="property">ADMIN</span>]: <span class="string">&quot;/admin&quot;</span>,</span><br><span class="line">    [<span class="title class_">UserRole</span>.<span class="property">GENERAL_USER</span>]: <span class="string">&quot;/user&quot;</span>,</span><br><span class="line">    [<span class="title class_">UserRole</span>.<span class="property">SUPER_ADMIN</span>]: <span class="string">&quot;/superadmin&quot;</span>,</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">return</span> appRoute[userRole] || <span class="string">&quot;Default path&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">getRoute</span>(<span class="title class_">UserRole</span>.<span class="property">ADMIN</span>)); <span class="comment">// return &quot;/admin&quot;</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">getRoute</span>(<span class="string">&quot;Anything&quot;</span>)); <span class="comment">// return Default path</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">getRoute</span>()); <span class="comment">// return Default path</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">getRoute</span>(<span class="literal">null</span>)); <span class="comment">// return Default path</span></span><br><span class="line"><span class="comment">// No more switch/if-else here.</span></span><br><span class="line"><span class="comment">// Easy to Further expansion</span></span><br></pre></td></tr></table></figure>

<h2 id="4、避免过多的函数参数"><a href="#4、避免过多的函数参数" class="headerlink" title="4、避免过多的函数参数"></a>4、避免过多的函数参数</h2><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">myFunction</span>(<span class="params">employeeName, jobTitle, yrExp, majorExp</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">`<span class="subst">$&#123;employeeName&#125;</span> is working as <span class="subst">$&#123;jobTitle&#125;</span> with <span class="subst">$&#123;yrExp&#125;</span>    years of experience in <span class="subst">$&#123;majorExp&#125;</span>`</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//output be like John is working as Project Manager with 12 year of experience in Project Management</span></span><br><span class="line"><span class="comment">// you can call it via</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">myFunction</span>(<span class="string">&quot;John&quot;</span>, <span class="string">&quot;Project Manager&quot;</span>, <span class="number">12</span>, <span class="string">&quot;Project Management&quot;</span>));</span><br><span class="line"><span class="comment">//    ***** PROBLEMS ARE *****</span></span><br><span class="line"><span class="comment">// Violation of &#x27;clean code&#x27; principle</span></span><br><span class="line"><span class="comment">// Parameter sequencing is important</span></span><br><span class="line"><span class="comment">// Unused Params warning if not used</span></span><br><span class="line"><span class="comment">// Testing need to consider a lot of edge cases.</span></span><br></pre></td></tr></table></figure>

<p>这是一种更清洁的方法：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">myFunction</span>(<span class="params">&#123; employeeName, jobTitle, yrExp, majorExp &#125;</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">`<span class="subst">$&#123;employeeName&#125;</span> is working as <span class="subst">$&#123;jobTitle&#125;</span> with <span class="subst">$&#123;yrExp&#125;</span> years of experience in <span class="subst">$&#123;majorExp&#125;</span>`</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//output be like John is working as Project Manager with 12 year of experience in Project Management</span></span><br><span class="line"><span class="comment">// you can call it via</span></span><br><span class="line"><span class="keyword">const</span> mockTechPeople = &#123;</span><br><span class="line">  <span class="attr">employeeName</span>: <span class="string">&quot;John&quot;</span>,</span><br><span class="line">  <span class="attr">jobTitle</span>: <span class="string">&quot;Project Manager&quot;</span>,</span><br><span class="line">  <span class="attr">yrExp</span>: <span class="number">12</span>,</span><br><span class="line">  <span class="attr">majorExp</span>: <span class="string">&quot;Project Management&quot;</span>,</span><br><span class="line">&#125;;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">myFunction</span>(mockTechPeople));</span><br><span class="line"><span class="comment">// ES2015/ES6 destructuring syntax is in action</span></span><br><span class="line"><span class="comment">// map your desired value to variable you need.</span></span><br></pre></td></tr></table></figure>

<h2 id="5、使用-Object-assign-设置默认对象"><a href="#5、使用-Object-assign-设置默认对象" class="headerlink" title="5、使用 Object.assign 设置默认对象"></a>5、使用 Object.assign 设置默认对象</h2><p>这看起来很繁琐：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> someObject = &#123;</span><br><span class="line">  <span class="attr">title</span>: <span class="literal">null</span>,</span><br><span class="line">  <span class="attr">subTitle</span>: <span class="string">&quot;Subtitle&quot;</span>,</span><br><span class="line">  <span class="attr">buttonColor</span>: <span class="literal">null</span>,</span><br><span class="line">  <span class="attr">disabled</span>: <span class="literal">true</span>,</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">createOption</span>(<span class="params">someObject</span>) &#123;</span><br><span class="line">  someObject.<span class="property">title</span> = someObject.<span class="property">title</span> || <span class="string">&quot;Default Title&quot;</span>;</span><br><span class="line">  someObject.<span class="property">subTitle</span> = someObject.<span class="property">subTitle</span> || <span class="string">&quot;Default Subtitle&quot;</span>;</span><br><span class="line">  someObject.<span class="property">buttonColor</span> = someObject.<span class="property">buttonColor</span> || <span class="string">&quot;blue&quot;</span>;</span><br><span class="line">  someObject.<span class="property">disabled</span> =</span><br><span class="line">    someObject.<span class="property">disabled</span> !== <span class="literal">undefined</span> ? someObject.<span class="property">disabled</span> : <span class="literal">true</span>;</span><br><span class="line">  <span class="keyword">return</span> someObject;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">createOption</span>(someObject));</span><br><span class="line"></span><br><span class="line"><span class="comment">// Output be like</span></span><br><span class="line"><span class="comment">// &#123;title: &#x27;Default Title&#x27;, subTitle: &#x27;Subtitle&#x27;, buttonColor: &#x27;blue&#x27;, disabled: true&#125;</span></span><br></pre></td></tr></table></figure>

<p>这种方法看起来更好：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> someObject = &#123;</span><br><span class="line">  <span class="attr">title</span>: <span class="literal">null</span>,</span><br><span class="line">  <span class="attr">subTitle</span>: <span class="string">&quot;Subtitle&quot;</span>,</span><br><span class="line">  <span class="attr">buttonColor</span>: <span class="literal">null</span>,</span><br><span class="line">  <span class="attr">disabled</span>: <span class="literal">true</span>,</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">creteOption</span>(<span class="params">someObject</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> newObject = <span class="title class_">Object</span>.<span class="title function_">assign</span>(</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">title</span>: <span class="string">&quot;Default Title&quot;</span>,</span><br><span class="line">      <span class="attr">subTitle</span>: <span class="string">&quot;Default Subtitle&quot;</span>,</span><br><span class="line">      <span class="attr">buttonColor</span>: <span class="string">&quot;blue&quot;</span>,</span><br><span class="line">      <span class="attr">disabled</span>: <span class="literal">true</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    someObject</span><br><span class="line">  );</span><br><span class="line">  <span class="keyword">return</span> newObject;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">creteOption</span>(someObject));</span><br></pre></td></tr></table></figure>

<h2 id="6-通过条件判断给变量赋值布尔值的正确姿势"><a href="#6-通过条件判断给变量赋值布尔值的正确姿势" class="headerlink" title="6.通过条件判断给变量赋值布尔值的正确姿势"></a>6.通过条件判断给变量赋值布尔值的正确姿势</h2><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// bad</span></span><br><span class="line"><span class="keyword">if</span> (a === <span class="string">&quot;a&quot;</span>) &#123;</span><br><span class="line">  b = <span class="literal">true</span>;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  b = <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// good</span></span><br><span class="line">b = a === <span class="string">&quot;a&quot;</span>;</span><br></pre></td></tr></table></figure>

<h2 id="7-在-if-中判断数组长度不为零的正确姿势"><a href="#7-在-if-中判断数组长度不为零的正确姿势" class="headerlink" title="7.在 if 中判断数组长度不为零的正确姿势"></a>7.在 if 中判断数组长度不为零的正确姿势</h2><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// bad</span></span><br><span class="line"><span class="keyword">if</span> (arr.<span class="property">length</span> !== <span class="number">0</span>) &#123;</span><br><span class="line">  <span class="comment">// todo</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// good</span></span><br><span class="line"><span class="keyword">if</span> (arr.<span class="property">length</span>) &#123;</span><br><span class="line">  <span class="comment">// todo</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="8-同理，在-if-中判断数组长度为零的正确姿势"><a href="#8-同理，在-if-中判断数组长度为零的正确姿势" class="headerlink" title="8.同理，在 if 中判断数组长度为零的正确姿势"></a>8.同理，在 if 中判断数组长度为零的正确姿势</h2><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// bad</span></span><br><span class="line"><span class="keyword">if</span> (arr.<span class="property">length</span> === <span class="number">0</span>) &#123;</span><br><span class="line">  <span class="comment">// todo</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// good</span></span><br><span class="line"><span class="keyword">if</span> (!arr.<span class="property">length</span>) &#123;</span><br><span class="line">  <span class="comment">// todo</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="9-简单的-if-判断使用三元表达式"><a href="#9-简单的-if-判断使用三元表达式" class="headerlink" title="9.简单的 if 判断使用三元表达式"></a>9.简单的 if 判断使用三元表达式</h2><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// bad</span></span><br><span class="line"><span class="keyword">if</span> (a === <span class="string">&quot;a&quot;</span>) &#123;</span><br><span class="line">  b = a;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  b = c;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// good</span></span><br><span class="line">b = a === <span class="string">&quot;a&quot;</span> ? a : c;</span><br></pre></td></tr></table></figure>

<h2 id="10-使用-includes-简化-if-判断"><a href="#10-使用-includes-简化-if-判断" class="headerlink" title="10.使用 includes 简化 if 判断"></a>10.使用 includes 简化 if 判断</h2><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// bad</span></span><br><span class="line"><span class="keyword">if</span> (a === <span class="number">1</span> || a === <span class="number">2</span> || a === <span class="number">3</span> || a === <span class="number">4</span>) &#123;</span><br><span class="line">  <span class="comment">// todo</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// good</span></span><br><span class="line"><span class="keyword">let</span> arr = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>];</span><br><span class="line"><span class="keyword">if</span> (arr.<span class="title function_">includes</span>(a)) &#123;</span><br><span class="line">  <span class="comment">// todo</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>巧用数组方法，尽量避免用 for 循环</p>
<h2 id="11-使用-some-方法判断是否有满足条件的元素"><a href="#11-使用-some-方法判断是否有满足条件的元素" class="headerlink" title="11.使用 some 方法判断是否有满足条件的元素"></a>11.使用 some 方法判断是否有满足条件的元素</h2><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// bad</span></span><br><span class="line"><span class="keyword">let</span> arr = [<span class="number">1</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">7</span>];</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">isHasNum</span>(<span class="params">n</span>) &#123;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; arr.<span class="property">length</span>; i++) &#123;</span><br><span class="line">    <span class="keyword">if</span> (arr[i] === n) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// good</span></span><br><span class="line"><span class="keyword">let</span> arr = [<span class="number">1</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">7</span>];</span><br><span class="line"><span class="keyword">let</span> <span class="title function_">isHasNum</span> = (<span class="params">n</span>) =&gt; arr.<span class="title function_">some</span>(<span class="function">(<span class="params">num</span>) =&gt;</span> num === n);</span><br><span class="line"></span><br><span class="line"><span class="comment">// best</span></span><br><span class="line"><span class="keyword">let</span> arr = [<span class="number">1</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">7</span>];</span><br><span class="line"><span class="keyword">let</span> <span class="title function_">isHasNum</span> = (<span class="params">n, arr</span>) =&gt; arr.<span class="title function_">some</span>(<span class="function">(<span class="params">num</span>) =&gt;</span> num === n);</span><br></pre></td></tr></table></figure>

<h2 id="12-使用-forEach-方法遍历数组，不形成新数组"><a href="#12-使用-forEach-方法遍历数组，不形成新数组" class="headerlink" title="12.使用 forEach 方法遍历数组，不形成新数组"></a>12.使用 forEach 方法遍历数组，不形成新数组</h2><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// bad</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; arr.<span class="property">length</span>; i++) &#123;</span><br><span class="line">  <span class="comment">// todo</span></span><br><span class="line">  arr[i].<span class="property">key</span> = balabala;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// good</span></span><br><span class="line">arr.<span class="title function_">forEach</span>(<span class="function">(<span class="params">item</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// todo</span></span><br><span class="line">  item.<span class="property">key</span> = balabala;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="13-使用-filter-方法过滤原数组，形成新数组"><a href="#13-使用-filter-方法过滤原数组，形成新数组" class="headerlink" title="13.使用 filter 方法过滤原数组，形成新数组"></a>13.使用 filter 方法过滤原数组，形成新数组</h2><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// bad</span></span><br><span class="line"><span class="keyword">let</span> arr = [<span class="number">1</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">7</span>],</span><br><span class="line">  newArr = [];</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; arr.<span class="property">length</span>; i++) &#123;</span><br><span class="line">  <span class="keyword">if</span> (arr[i] &gt; <span class="number">4</span>) &#123;</span><br><span class="line">    newArr.<span class="title function_">push</span>(arr[i]);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// good</span></span><br><span class="line"><span class="keyword">let</span> arr = [<span class="number">1</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">7</span>];</span><br><span class="line"><span class="keyword">let</span> newArr = arr.<span class="title function_">filter</span>(<span class="function">(<span class="params">n</span>) =&gt;</span> n &gt; <span class="number">4</span>); <span class="comment">// [5, 7]</span></span><br></pre></td></tr></table></figure>

<h2 id="14-使用-map-对数组中所有元素批量处理，形成新数组"><a href="#14-使用-map-对数组中所有元素批量处理，形成新数组" class="headerlink" title="14.使用 map 对数组中所有元素批量处理，形成新数组"></a>14.使用 map 对数组中所有元素批量处理，形成新数组</h2><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// bad</span></span><br><span class="line"><span class="keyword">let</span> arr = [<span class="number">1</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">7</span>],</span><br><span class="line">  newArr = [];</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; arr.<span class="property">length</span>; i++) &#123;</span><br><span class="line">  newArr.<span class="title function_">push</span>(arr[i] + <span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// good</span></span><br><span class="line"><span class="keyword">let</span> arr = [<span class="number">1</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">7</span>];</span><br><span class="line"><span class="keyword">let</span> newArr = arr.<span class="title function_">map</span>(<span class="function">(<span class="params">n</span>) =&gt;</span> n + <span class="number">1</span>); <span class="comment">// [2, 4, 6, 8]</span></span><br></pre></td></tr></table></figure>

<p>巧用对象方法，避免使用 for…in</p>
<h2 id="15-使用-Object-values-快速获取对象键值"><a href="#15-使用-Object-values-快速获取对象键值" class="headerlink" title="15.使用 Object.values 快速获取对象键值"></a>15.使用 Object.values 快速获取对象键值</h2><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> obj = &#123;</span><br><span class="line">  <span class="attr">a</span>: <span class="number">1</span>,</span><br><span class="line">  <span class="attr">b</span>: <span class="number">2</span>,</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// bad</span></span><br><span class="line"><span class="keyword">let</span> values = [];</span><br><span class="line"><span class="keyword">for</span> (key <span class="keyword">in</span> obj) &#123;</span><br><span class="line">  values.<span class="title function_">push</span>(obj[key]);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// good</span></span><br><span class="line"><span class="keyword">let</span> values = <span class="title class_">Object</span>.<span class="title function_">values</span>(obj); <span class="comment">// [1, 2]</span></span><br></pre></td></tr></table></figure>

<h2 id="16-使用-Object-keys-快速获取对象键名"><a href="#16-使用-Object-keys-快速获取对象键名" class="headerlink" title="16.使用 Object.keys 快速获取对象键名"></a>16.使用 Object.keys 快速获取对象键名</h2><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> obj = &#123;</span><br><span class="line">  <span class="attr">a</span>: <span class="number">1</span>,</span><br><span class="line">  <span class="attr">b</span>: <span class="number">2</span>,</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// bad</span></span><br><span class="line"><span class="keyword">let</span> keys = [];</span><br><span class="line"><span class="keyword">for</span> (value <span class="keyword">in</span> obj) &#123;</span><br><span class="line">  keys.<span class="title function_">push</span>(value);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// good</span></span><br><span class="line"><span class="keyword">let</span> keys = <span class="title class_">Object</span>.<span class="title function_">keys</span>(obj); <span class="comment">// [&#x27;a&#x27;, &#x27;b&#x27;]</span></span><br></pre></td></tr></table></figure>

<p>巧用解构简化代码</p>
<h2 id="17-解构数组进行变量值的替换"><a href="#17-解构数组进行变量值的替换" class="headerlink" title="17.解构数组进行变量值的替换"></a>17.解构数组进行变量值的替换</h2><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// bad</span></span><br><span class="line"><span class="keyword">let</span> a = <span class="number">1</span>,</span><br><span class="line">  b = <span class="number">2</span>;</span><br><span class="line"><span class="keyword">let</span> temp = a;</span><br><span class="line">a = b;</span><br><span class="line">b = temp;</span><br><span class="line"></span><br><span class="line"><span class="comment">// good</span></span><br><span class="line"><span class="keyword">let</span> a = <span class="number">1</span>,</span><br><span class="line">  b = ((<span class="number">2</span>)[(b, a)] = [a, b]);</span><br></pre></td></tr></table></figure>

<h2 id="18-解构对象"><a href="#18-解构对象" class="headerlink" title="18.解构对象"></a>18.解构对象</h2><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// bad</span></span><br><span class="line">setForm (person) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">name</span> = person.<span class="property">name</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">age</span> = person.<span class="property">age</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// good</span></span><br><span class="line">setForm (&#123;name, age&#125;) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">name</span> = name</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">age</span> = age</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="19-解构时重命名简化命名"><a href="#19-解构时重命名简化命名" class="headerlink" title="19.解构时重命名简化命名"></a>19.解构时重命名简化命名</h2><p>有的后端返回的键名特别长，你可以这样干</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// bad</span></span><br><span class="line">setForm (data) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">one</span> = data.<span class="property">aaa_bbb_ccc_ddd</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">two</span> = data.<span class="property">eee_fff_ggg</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// good</span></span><br><span class="line">setForm (&#123;aaa_bbb_ccc_ddd, eee_fff_ggg&#125;) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">one</span> = aaa_bbb_ccc_ddd</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">two</span> = eee_fff_ggg</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// best</span></span><br><span class="line">setForm (&#123;<span class="attr">aaa_bbb_ccc_ddd</span>: one, <span class="attr">eee_fff_ggg</span>: two&#125;) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">one</span> = one</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">two</span> = two</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="20-解构时设置默认值"><a href="#20-解构时设置默认值" class="headerlink" title="20.解构时设置默认值"></a>20.解构时设置默认值</h2><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// bad</span></span><br><span class="line">setForm (&#123;name, age&#125;) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!age) age = <span class="number">16</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">name</span> = name</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">age</span> = age</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// good</span></span><br><span class="line">setForm (&#123;name, age = <span class="number">16</span>&#125;) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">name</span> = name</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">age</span> = age</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="21-短路符设置默认值"><a href="#21-短路符设置默认值" class="headerlink" title="21.||短路符设置默认值"></a>21.||短路符设置默认值</h2><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> person = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&quot;张三&quot;</span>,</span><br><span class="line">  <span class="attr">age</span>: <span class="number">38</span>,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> name = person.<span class="property">name</span> || <span class="string">&quot;佚名&quot;</span>;</span><br></pre></td></tr></table></figure>

<h2 id="22-短路符判断依赖的键是否存在防止报错’xxx-of-undfined’"><a href="#22-短路符判断依赖的键是否存在防止报错’xxx-of-undfined’" class="headerlink" title="22.&amp;&amp;短路符判断依赖的键是否存在防止报错’xxx of undfined’"></a>22.&amp;&amp;短路符判断依赖的键是否存在防止报错’xxx of undfined’</h2><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> person = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&quot;张三&quot;</span>,</span><br><span class="line">  <span class="attr">age</span>: <span class="number">38</span>,</span><br><span class="line">  <span class="attr">children</span>: &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&quot;张小三&quot;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> childrenName = person.<span class="property">children</span> &amp;&amp; person.<span class="property">childre</span>.<span class="property">name</span>;</span><br></pre></td></tr></table></figure>

<h2 id="23-字符串拼接使用"><a href="#23-字符串拼接使用" class="headerlink" title="23.字符串拼接使用${}"></a>23.字符串拼接使用<code>$&#123;&#125;</code></h2><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> person = &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;LiMing&#x27;</span>,</span><br><span class="line">    <span class="attr">age</span>: <span class="number">18</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// bad</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">sayHi</span> (obj) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;大家好，我叫&#x27;</span> + person.<span class="property">name</span> = <span class="string">&#x27;，我今年&#x27;</span> + person.<span class="property">age</span> + <span class="string">&#x27;了&#x27;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// good</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">sayHi</span> (person) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`大家好，我叫<span class="subst">$&#123;person.name&#125;</span>，我今年<span class="subst">$&#123;person.age&#125;</span>了`</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// best</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">sayHi</span> (&#123;name, age&#125;) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`大家好，我叫<span class="subst">$&#123;name&#125;</span>，我今年<span class="subst">$&#123;age&#125;</span>了`</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="24-函数使用箭头函数"><a href="#24-函数使用箭头函数" class="headerlink" title="24.函数使用箭头函数"></a>24.函数使用箭头函数</h2><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> arr [<span class="number">18</span>, <span class="number">19</span>, <span class="number">20</span>, <span class="number">21</span>, <span class="number">22</span>]</span><br><span class="line"><span class="comment">// bad</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">findStudentByAge</span> (arr, age) &#123;</span><br><span class="line">    <span class="keyword">return</span> arr.<span class="title function_">filter</span>(<span class="keyword">function</span> (<span class="params">num</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> num === age</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// good</span></span><br><span class="line"><span class="keyword">let</span> <span class="title function_">findStudentByAge</span> = (<span class="params">arr, age</span>)=&gt; arr.<span class="title function_">filter</span>(<span class="function"><span class="params">num</span> =&gt;</span> num === age)</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="25-函数参数校验"><a href="#25-函数参数校验" class="headerlink" title="25.函数参数校验"></a>25.函数参数校验</h2><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// bad</span></span><br><span class="line"><span class="keyword">let</span> <span class="title function_">findStudentByAge</span> = (<span class="params">arr, age</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">if</span> (!age) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&quot;参数不能为空&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> arr.<span class="title function_">filter</span>(<span class="function">(<span class="params">num</span>) =&gt;</span> num === age);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// good</span></span><br><span class="line"><span class="keyword">let</span> <span class="title function_">checkoutType</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&quot;参数不能为空&quot;</span>);</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">let</span> <span class="title function_">findStudentByAge</span> = (<span class="params">arr, age = checkoutType()</span>) =&gt;</span><br><span class="line">  arr.<span class="title function_">filter</span>(<span class="function">(<span class="params">num</span>) =&gt;</span> num === age);</span><br></pre></td></tr></table></figure>

<p>欢迎大佬们指正交流，感谢支持</p>
]]></content>
      <categories>
        <category>前端</category>
      </categories>
      <tags>
        <tag>JavaScript</tag>
      </tags>
  </entry>
  <entry>
    <title>ES6来简化代码,你都用过哪些</title>
    <url>/test/post/ES6%E6%9D%A5%E7%AE%80%E5%8C%96%E4%BB%A3%E7%A0%81,%E4%BD%A0%E9%83%BD%E7%94%A8%E8%BF%87%E5%93%AA%E4%BA%9B/</url>
    <content><![CDATA[<h3 id="块级作用域"><a href="#块级作用域" class="headerlink" title="块级作用域"></a>块级作用域</h3><p>为什么需要块级作用域?</p>
<p>ES5 只有全局作用域和函数作用域，没有块级作用域，这导致很多场景不合理。</p>
<ul>
<li>第一种场景，内层变量可能会覆盖外层变量。</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> tmp = <span class="keyword">new</span> <span class="title class_">Date</span>();</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">fn</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(tmp);</span><br><span class="line">  <span class="keyword">if</span> (<span class="literal">false</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> tmp = <span class="string">&quot;hello world&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">fn</span>(); <span class="comment">// undefined</span></span><br><span class="line">复制代码;</span><br></pre></td></tr></table></figure>

<p>以上代码的原意是， if 代码块的外部使用外层的 tmp 变量，内部使用内层的 tmp 变量。但是，函数 <code>fn</code> 执行后，输出结果为 <code>undefined</code> ，原因在于变量提升导致内层的 tmp 变量覆盖了外层的 tmp 变量。</p>
<ul>
<li>第二种场景，用来计数的循环变量泄露为全局变量。</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> s = <span class="string">&quot;hello&quot;</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i = O; i &lt; s.<span class="property">length</span>; i++) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(s[i]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(i); <span class="comment">// 5</span></span><br><span class="line">复制代码;</span><br></pre></td></tr></table></figure>

<p>上面的代码中，变量 <code>i</code> 只用来控制循环，但是循环结束后，它并没有消失，而是泄露成了全局变量。</p>
<p><code>let</code> 实际上为 <code>JavaScript</code> 新增了块级作用域。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">fl</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> n = <span class="number">5</span>;</span><br><span class="line">  <span class="keyword">if</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> n = <span class="number">10</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(n); <span class="comment">// 5</span></span><br><span class="line">&#125;</span><br><span class="line">复制代码;</span><br></pre></td></tr></table></figure>

<p>上面的函数有两个代码块，都声明了变量 <code>n</code>，运行后输出 <code>5</code> 。这表示外层代码块不受内层代码块的影响。如果使用 <code>var</code> 定义变量 ，最后输出的值就是 <code>10</code></p>
<p>那么我们能利用<code>块级作用域</code>做什么呢？</p>
<p>我们先来做道面试题</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; i++) &#123;</span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(i);</span><br><span class="line">  &#125;, <span class="number">1000</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 5 5 5 5 5</span></span><br><span class="line">复制代码;</span><br></pre></td></tr></table></figure>

<p>改成 <code>ES6</code> 中的 let</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; i++) &#123;</span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(i);</span><br><span class="line">  &#125;, <span class="number">1000</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 0 1 2 3 4</span></span><br><span class="line">复制代码;</span><br></pre></td></tr></table></figure>

<p>看到这，相信聪明的你已经理解块级作用域的好处了 O(∩_∩)O</p>
<p>那么 <code>ES5</code> 能不能实现 <code>块级作用域</code> 的效果呢? 可以的，我们可以利用闭包</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; i++) &#123;</span><br><span class="line">  (<span class="keyword">function</span> (<span class="params">index</span>) &#123;</span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(index);</span><br><span class="line">    &#125;, <span class="number">1000</span>);</span><br><span class="line">  &#125;)(i);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 0 1 2 3 4</span></span><br><span class="line">复制代码;</span><br></pre></td></tr></table></figure>

<h3 id="解构"><a href="#解构" class="headerlink" title="解构"></a>解构</h3><blockquote>
<p>解构 ：是将一个数据结构分解为更小的部分的过程。ES6 中，从数组和对象中提取值，对变量进行赋值。</p>
</blockquote>
<p>那么解构有什么用处呢？</p>
<ol>
<li>可以大大的简化变量声明操作。</li>
</ol>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ES5</span></span><br><span class="line"><span class="keyword">var</span> foo = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">var</span> bar = <span class="number">2</span>;</span><br><span class="line"><span class="keyword">var</span> baz = <span class="number">3</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ES6</span></span><br><span class="line"><span class="keyword">let</span> [foo, bar, baz] = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];</span><br><span class="line">复制代码;</span><br></pre></td></tr></table></figure>

<ol>
<li>变量交换：看起来如同镜像。赋值语句的左侧的解构模式，右侧是临时创建的数组字面量。x 被赋值为数组中的 y，y 被赋值为数组中的 x。</li>
</ol>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> x = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">let</span> y = <span class="number">2</span>;</span><br><span class="line">[x, y] = [y, x];</span><br><span class="line"><span class="comment">// x = 2, y = 1</span></span><br><span class="line">复制代码;</span><br></pre></td></tr></table></figure>

<ol>
<li>对象解构</li>
</ol>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> obj = &#123; <span class="attr">x</span>: <span class="number">1</span>, <span class="attr">y</span>: <span class="number">2</span>, <span class="attr">c</span>: <span class="number">1</span> &#125;;</span><br><span class="line"><span class="keyword">let</span> &#123; x, y &#125; = obj;</span><br><span class="line"><span class="comment">// x = 1</span></span><br><span class="line"><span class="comment">// y = 2</span></span><br><span class="line">复制代码;</span><br></pre></td></tr></table></figure>

<ol>
<li>字符串解构</li>
</ol>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> [a, b, c, d, e] = <span class="string">&quot;hello&quot;</span>;</span><br><span class="line"><span class="comment">// a =&gt; h</span></span><br><span class="line"><span class="comment">// b =&gt; e</span></span><br><span class="line"><span class="comment">// c =&gt; l</span></span><br><span class="line"><span class="comment">// d =&gt; l</span></span><br><span class="line"><span class="comment">// e =&gt; o</span></span><br><span class="line">复制代码;</span><br></pre></td></tr></table></figure>

<ol>
<li>函数参数解构</li>
</ol>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> xueyue = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&quot;雪月&quot;</span>,</span><br><span class="line">  <span class="attr">age</span>: <span class="number">18</span>,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">getAge</span>(<span class="params">&#123; name, age &#125;</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">`<span class="subst">$&#123;name&#125;</span>今年<span class="subst">$&#123;age&#125;</span>岁`</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">getAge</span>(xueyue); <span class="comment">// 雪月今年18岁</span></span><br><span class="line">复制代码;</span><br></pre></td></tr></table></figure>

<h3 id="箭头函数"><a href="#箭头函数" class="headerlink" title="箭头函数"></a>箭头函数</h3><p><code>ES6</code> 允许使用箭头 <code>=&gt;</code> 定义函数</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> <span class="title function_">f</span> = (<span class="params">v</span>) =&gt; v;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 等同于 ES5 的</span></span><br><span class="line"><span class="keyword">var</span> f = <span class="keyword">function</span> (<span class="params">v</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> v;</span><br><span class="line">&#125;;</span><br><span class="line">复制代码;</span><br></pre></td></tr></table></figure>

<p>如果箭头函数不需要参数或需要多个参数，就使用圆括号代表参数部分。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> <span class="title function_">f</span> = (<span class="params"></span>) =&gt; <span class="number">5</span>;</span><br><span class="line"><span class="comment">// 等同于 ES5 的</span></span><br><span class="line"><span class="keyword">var</span> f = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">5</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> <span class="title function_">sum</span> = (<span class="params">numl, num2</span>) =&gt; numl + num2;</span><br><span class="line"><span class="comment">// 等同于 ES5 的</span></span><br><span class="line"><span class="keyword">var</span> sum = <span class="keyword">function</span> (<span class="params">numl, num2</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> numl + num2;</span><br><span class="line">&#125;;</span><br><span class="line">复制代码;</span><br></pre></td></tr></table></figure>

<p>箭头函数可以与解构结合使用。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">full</span> = (<span class="params">&#123; first, last &#125;</span>) =&gt; first + <span class="string">&quot; &quot;</span> + last;</span><br><span class="line"><span class="comment">// 等同于 ES5 的</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">full</span>(<span class="params">person</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> person.<span class="property">first</span> + <span class="string">&quot; &quot;</span> + person.<span class="property">last</span>;</span><br><span class="line">&#125;</span><br><span class="line">复制代码;</span><br></pre></td></tr></table></figure>

<p>箭头函数使得表达更加简洁</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">isEven</span> = (<span class="params">n</span>) =&gt; n % <span class="number">2</span> === <span class="number">0</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="title function_">square</span> = (<span class="params">n</span>) =&gt; n * n;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> result = values.<span class="title function_">sort</span>(<span class="function">(<span class="params">a, b</span>) =&gt;</span> a - b);</span><br><span class="line"><span class="comment">// 等同于 ES5 的</span></span><br><span class="line"><span class="keyword">var</span> result = values.<span class="title function_">sort</span>(<span class="keyword">function</span> (<span class="params">a, b</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> a - b;</span><br><span class="line">&#125;);</span><br><span class="line">复制代码;</span><br></pre></td></tr></table></figure>

<p>上面代码只用了两行，就定义了两个简单的工具函数。如果不用箭头函数，可能就要占用多行，而且还不如现在这样写醒目。</p>
<p><strong>箭头函数使用注意点</strong></p>
<ol>
<li>函数体内的 <code>this</code> 对象，就是定义时所在的对象，而不是使用时所在的对象。</li>
<li>不可以当作构造函数，也就是说，不可以使用 <code>new</code> 命令，否则会抛出一个错误。</li>
<li>不可以使用 <code>arguments</code> 对象，该对象在函数体内不存在。如果要用，可以用 <code>rest</code> 参数代替。</li>
<li>不可以使用 <code>yield</code> 命令，因此箭头函数不能用作 <code>Generator</code> 函数。</li>
</ol>
<p>上面四点中，第一点尤其值得注意。<code>this</code> 对象的指向是可变的，但是在箭头函数中，它是固定的。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ES6</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;id:&quot;</span>, <span class="variable language_">this</span>.<span class="property">id</span>);</span><br><span class="line">  &#125;, <span class="number">100</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 转换成ES5</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> _this = <span class="variable language_">this</span>;</span><br><span class="line"></span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;id:&quot;</span>, _this.<span class="property">id</span>);</span><br><span class="line">  &#125;, <span class="number">100</span>);</span><br><span class="line">&#125;</span><br><span class="line">复制代码;</span><br></pre></td></tr></table></figure>

<p>上面代码中，转换后的 <code>ES5</code> 版本清楚地说明了，箭头函数里面根本没有自己的 <code>this</code>，而是引用外层的 <code>this</code>。</p>
<h3 id="模板字符串"><a href="#模板字符串" class="headerlink" title="模板字符串"></a>模板字符串</h3><blockquote>
<p>模板字符串（ template string ）是增强版的字符串 ，用反引号 <code>(``)</code> 标识 。它可以当作普通字符串使用，也可以用来定义多行字符串，或者在字符串中嵌入变量。</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; log &#125; = <span class="variable language_">console</span>;</span><br><span class="line"><span class="keyword">const</span> name = <span class="string">&quot;雪月&quot;</span>;</span><br><span class="line"><span class="keyword">const</span> age = <span class="number">18</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 普通字符串拼接</span></span><br><span class="line"><span class="keyword">const</span> result = name + <span class="string">&quot;今年&quot;</span> + age + <span class="string">&quot;岁&quot;</span>;</span><br><span class="line"><span class="comment">// 使用模板字符串</span></span><br><span class="line"><span class="keyword">const</span> result2 = <span class="string">`<span class="subst">$&#123;name&#125;</span>今年<span class="subst">$&#123;age&#125;</span>岁`</span>;</span><br><span class="line"><span class="title function_">log</span>(result); <span class="comment">// 雪月今年18岁</span></span><br><span class="line"><span class="title function_">log</span>(result2); <span class="comment">// 雪月今年18岁</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// $&#123;&#125; 大括号可以放入任意的 JavaScript 表达式，可以进行运算</span></span><br><span class="line"><span class="keyword">const</span> result3 = <span class="string">`<span class="subst">$&#123;name&#125;</span>今年<span class="subst">$&#123;age * <span class="number">2</span>&#125;</span>岁`</span>;</span><br><span class="line"><span class="title function_">log</span>(result3); <span class="comment">// 雪月今年36岁</span></span><br><span class="line">复制代码;</span><br></pre></td></tr></table></figure>

<h3 id="剩余参数-展开语法"><a href="#剩余参数-展开语法" class="headerlink" title="剩余参数 &#x2F; 展开语法"></a>剩余参数 &#x2F; 展开语法</h3><p>ES6 引入了 rest 参数（形式为<code>...变量名</code>），用于获取函数的多余参数，这样就不需要使用 <code>arguments</code> 对象了。<code>rest</code> 参数搭配的变量是一个数组，该变量将多余的参数放入其中。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">sortNumbers</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title class_">Array</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">slice</span>.<span class="title function_">call</span>(<span class="variable language_">arguments</span>).<span class="title function_">sort</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 使用 rest</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">sortNumbers</span> = (<span class="params">...numbers</span>) =&gt; numbers.<span class="title function_">sort</span>();</span><br><span class="line">复制代码;</span><br></pre></td></tr></table></figure>

<p>比较上面的两种写法可以发现， <code>rest</code> 参数的写法更自然也更简洁。</p>
<p>扩展运算符（ <code>spread</code> ）是三个点（…） 如同 <code>rest</code> 参数的逆运算 将一个数组转为用逗号分隔的参数序列</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(...[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]);</span><br><span class="line"><span class="comment">// 1 2 3</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">1</span>, ...[<span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>], <span class="number">5</span>);</span><br><span class="line"><span class="comment">// 1 2 3 4 5</span></span><br><span class="line">复制代码;</span><br></pre></td></tr></table></figure>

<p>下面是扩展运算符取代 <code>apply</code> 方法的一个实际例子 应用 <code>Math.max</code> 方法简化求出数组中的最大元素。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ESS 的写法</span></span><br><span class="line"><span class="title class_">Math</span>.<span class="property">max</span>.<span class="title function_">apply</span>(<span class="literal">null</span>, [<span class="number">14</span>, <span class="number">3</span>, <span class="number">77</span>]);</span><br><span class="line"><span class="comment">// ES6 的写法</span></span><br><span class="line"><span class="title class_">Math</span>.<span class="title function_">max</span>(...[<span class="number">14</span>, <span class="number">3</span>, <span class="number">77</span>]);</span><br><span class="line"><span class="comment">// 等同于</span></span><br><span class="line"><span class="title class_">Math</span>.<span class="title function_">max</span>(<span class="number">14</span>, <span class="number">3</span>, <span class="number">77</span>);</span><br><span class="line">复制代码;</span><br></pre></td></tr></table></figure>

<p>扩展运算符提供了数组合并的新写法。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">//  ESS</span></span><br><span class="line">[<span class="number">1</span>, <span class="number">2</span>].<span class="title function_">concat</span>(more);</span><br><span class="line"><span class="comment">// ES6</span></span><br><span class="line">[<span class="number">1</span>, <span class="number">2</span>, ...more];</span><br><span class="line">复制代码;</span><br></pre></td></tr></table></figure>

<p>对象的扩展运算符（…）用于取出参数对象的所有可遍历属性，拷贝到当前对象之中。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> z = &#123; <span class="attr">a</span>: <span class="number">3</span>, <span class="attr">b</span>: <span class="string">&quot;bb&quot;</span> &#125;;</span><br><span class="line"><span class="keyword">let</span> n = &#123; ...z &#125;;</span><br><span class="line">n; <span class="comment">// &#123; a: 3, b: &#x27;bb&#x27; &#125;</span></span><br><span class="line">n === z; <span class="comment">// false</span></span><br><span class="line">复制代码;</span><br></pre></td></tr></table></figure>

<p><strong>特别注意：</strong> <code>...</code>扩展对象，只能做到当对象属性是 <code>基本数据类型</code> 才是 <code>深拷贝</code>，如果是 <code>引用数据类型</code>，那就是<code>浅拷贝</code>。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> z = &#123; <span class="attr">a</span>: <span class="number">3</span>, <span class="attr">b</span>: <span class="string">&quot;bb&quot;</span>, <span class="attr">c</span>: &#123; <span class="attr">name</span>: <span class="string">&quot;ccc&quot;</span> &#125; &#125;;</span><br><span class="line"><span class="keyword">let</span> n = &#123; ...z &#125;;</span><br><span class="line"></span><br><span class="line">n; <span class="comment">// &#123; a: 3, b: &#x27;bb&#x27;, c: &#123; name: &#x27;ccc&#x27; &#125; &#125;</span></span><br><span class="line">n === z; <span class="comment">// false</span></span><br><span class="line">n.<span class="property">c</span> === z.<span class="property">c</span>; <span class="comment">// true</span></span><br><span class="line"><span class="comment">// n.c 跟 z.c 是同一个引用地址</span></span><br><span class="line">复制代码;</span><br></pre></td></tr></table></figure>

<h3 id="对象字面量简写语法"><a href="#对象字面量简写语法" class="headerlink" title="对象字面量简写语法"></a>对象字面量简写语法</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> name = <span class="string">&quot;雪月&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ES5写法</span></span><br><span class="line"><span class="keyword">const</span> obj = &#123;</span><br><span class="line">  <span class="attr">name</span>: name,</span><br><span class="line">  <span class="attr">f</span>: <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">name</span>);</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ES6简写</span></span><br><span class="line"><span class="keyword">const</span> obj2 = &#123;</span><br><span class="line">  name,</span><br><span class="line">  <span class="title function_">f</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">name</span>);</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">obj.<span class="title function_">f</span>(); <span class="comment">// 雪月</span></span><br><span class="line">obj2.<span class="title function_">f</span>(); <span class="comment">// 雪月</span></span><br><span class="line">复制代码;</span><br></pre></td></tr></table></figure>

<p>使用 <code>vue</code> 的同学是不是感到很熟悉</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span><br><span class="line">  <span class="attr">el</span>: <span class="string">&quot;#app&quot;</span>,</span><br><span class="line">  <span class="title function_">data</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="attr">list</span>: [],</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br><span class="line">复制代码;</span><br></pre></td></tr></table></figure>

<h3 id="数组实例的-includes"><a href="#数组实例的-includes" class="headerlink" title="数组实例的 includes()"></a>数组实例的 includes()</h3><p>Array.prototype.includes 方法返回一个布尔值，表示某个数组是否包含给定的值，与字符串的 includes 方法类似。ES2016 引入了该方法。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>].<span class="title function_">includes</span>(<span class="number">2</span>); <span class="comment">// true</span></span><br><span class="line">[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>].<span class="title function_">includes</span>(<span class="number">4</span>); <span class="comment">// false</span></span><br><span class="line">[<span class="number">1</span>, <span class="number">2</span>, <span class="title class_">NaN</span>].<span class="title function_">includes</span>(<span class="title class_">NaN</span>); <span class="comment">// true</span></span><br><span class="line">复制代码;</span><br></pre></td></tr></table></figure>

<p>没有该方法之前，我们通常使用数组的 indexOf 方法，检查是否包含某个值。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ES5</span></span><br><span class="line"><span class="keyword">if</span> (arr.<span class="title function_">indexOf</span>(el) !== -<span class="number">1</span>) &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ES6</span></span><br><span class="line"><span class="keyword">if</span> (arr.<span class="title function_">includes</span>(el)) &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 那么 indexOf 能不能做到类似于 includes 的写法呢？ 我们可以利用 ~ 位运算符</span></span><br><span class="line"><span class="keyword">if</span> (~arr.<span class="title function_">indexOf</span>(el)) &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line">复制代码;</span><br></pre></td></tr></table></figure>

<p><code>indexOf</code> 方法有两个缺点，一是不够语义化，它的含义是找到参数值的第一个出现位置，所以要去比较是否不等于-1，表达起来不够直观。二是，它内部使用严格相等运算符（&#x3D;&#x3D;&#x3D;）进行判断，这会导致对 <code>NaN</code> 的误判。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">[<span class="title class_">NaN</span>].<span class="title function_">indexOf</span>(<span class="title class_">NaN</span>);</span><br><span class="line"><span class="comment">// -1</span></span><br><span class="line">复制代码;</span><br></pre></td></tr></table></figure>

<p><code>includes</code> 使用的是不一样的判断算法，就没有这个问题</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">[<span class="title class_">NaN</span>].<span class="title function_">includes</span>(<span class="title class_">NaN</span>);</span><br><span class="line"><span class="comment">// true</span></span><br><span class="line">复制代码;</span><br></pre></td></tr></table></figure>

<h3 id="Async-await-异步语法"><a href="#Async-await-异步语法" class="headerlink" title="Async&#x2F;await 异步语法"></a>Async&#x2F;await 异步语法</h3><p><code>ES2017</code> 标准引入了 <code>async</code> 函数，使得异步操作变得更加方便。</p>
<p><code>async</code> 函数是什么？一句话，它就是 <code>Generator</code> 函数的语法糖。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">getTitle</span>(<span class="params">url</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> response = <span class="keyword">await</span> <span class="title function_">fetch</span>(url);</span><br><span class="line">  <span class="keyword">let</span> html = <span class="keyword">await</span> response.<span class="title function_">text</span>();</span><br><span class="line">  <span class="keyword">return</span> html.<span class="title function_">match</span>(<span class="regexp">/&lt;title&gt;([\s\S]+)&lt;\/title&gt;/i</span>)[<span class="number">1</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">getTitle</span>(<span class="string">&quot;https://tc39.github.io/ecma262/&quot;</span>).<span class="title function_">then</span>(<span class="function">(<span class="params">res</span>) =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(res));</span><br><span class="line">复制代码;</span><br></pre></td></tr></table></figure>

<p>上面代码中，函数 <code>getTitle</code> 内部有三个操作：<code>抓取网页</code>、<code>取出文本</code>、<code>匹配页面标题</code>。只有这三个操作全部完成，才会执行 <code>then</code> 方法里面的 <code>console.log</code></p>
<h3 id="结束（意犹未尽）"><a href="#结束（意犹未尽）" class="headerlink" title="结束（意犹未尽）"></a>结束（意犹未尽）</h3><p>文章介绍了 <code>ES6</code> 常用的一些语法以及使用场景; 但是 <code>ES6</code> 内容远不止于此，感兴趣的同学可以去 <code>阮一峰老师的</code> ES6 入门教程[1] 一书中查看详细内容。如果您认可这本书，也可以去正版渠道购买书籍。这样可以使出版社不因出版开源书籍而亏钱，进而鼓励更多的作者开源自己的书籍。</p>
<h3 id="后记（列举-API）"><a href="#后记（列举-API）" class="headerlink" title="后记（列举 API）"></a>后记（列举 API）</h3><p>还有很多 <code>ES6</code> 实用的 <code>API</code> 我就简单提及一下，朋友们看看平时是否有用到</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">[<span class="number">1</span>, <span class="number">4</span>, -<span class="number">5</span>, <span class="number">10</span>].<span class="title function_">find</span>(<span class="function">(<span class="params">n</span>) =&gt;</span> n &lt; <span class="number">0</span>);</span><br><span class="line"><span class="comment">// -5</span></span><br><span class="line">[<span class="number">1</span>, <span class="number">5</span>, <span class="number">10</span>, <span class="number">15</span>].<span class="title function_">findIndex</span>(<span class="function">(<span class="params">value, index, arr</span>) =&gt;</span> value &gt; <span class="number">9</span>);</span><br><span class="line"><span class="comment">// 2</span></span><br><span class="line">[<span class="number">1</span>, <span class="number">2</span>, [<span class="number">3</span>, [<span class="number">4</span>, <span class="number">5</span>]]].<span class="title function_">flat</span>();</span><br><span class="line"><span class="comment">// [1, 2, 3, [4, 5]]</span></span><br><span class="line">[<span class="number">1</span>, <span class="number">2</span>, [<span class="number">3</span>, [<span class="number">4</span>, <span class="number">5</span>]]].<span class="title function_">flat</span>(<span class="number">2</span>);</span><br><span class="line"><span class="comment">// [1, 2, 3, 4, 5]</span></span><br><span class="line">[<span class="number">3</span>, <span class="number">8</span>, <span class="number">54</span>, <span class="number">8</span>, <span class="number">3</span>, <span class="title class_">NaN</span>, <span class="title class_">NaN</span>, <span class="string">&quot;NaN&quot;</span>, <span class="string">&quot;NaN&quot;</span>].<span class="title function_">filter</span>(</span><br><span class="line">  <span class="function">(<span class="params">number, index, arr</span>) =&gt;</span> arr.<span class="title function_">indexOf</span>(number) === index</span><br><span class="line">);</span><br><span class="line"><span class="comment">// [3, 8, 54, &quot;NaN&quot;] 利用filter过滤去重，注意会漏掉NaN</span></span><br><span class="line">[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>].<span class="title function_">map</span>(<span class="function">(<span class="params">item</span>) =&gt;</span> item * <span class="number">2</span>);</span><br><span class="line"><span class="comment">// [2, 4, 6, 8] 利用map返回一个新数组，不改变原数组</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用 reduce 求和; reduce功能极其强大 ! yyds</span></span><br><span class="line">[<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>].<span class="title function_">reduce</span>(<span class="keyword">function</span> (<span class="params"></span></span><br><span class="line"><span class="params">  accumulator,</span></span><br><span class="line"><span class="params">  currentValue,</span></span><br><span class="line"><span class="params">  currentIndex,</span></span><br><span class="line"><span class="params">  array</span></span><br><span class="line"><span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> accumulator + currentValue;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// 10</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ES2017 引入了跟 Object.keys 配套的 Object.values 和 Object.entries，作为遍历一个对象的补充手段，</span></span><br><span class="line"><span class="comment">// 供 for...of 循环使用。</span></span><br><span class="line"><span class="keyword">let</span> &#123; keys, values, entries &#125; = <span class="title class_">Object</span>;</span><br><span class="line"><span class="keyword">let</span> obj = &#123; <span class="attr">a</span>: <span class="number">1</span>, <span class="attr">b</span>: <span class="number">2</span>, <span class="attr">c</span>: <span class="number">3</span> &#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> key <span class="keyword">of</span> <span class="title function_">keys</span>(obj)) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(key); <span class="comment">// &#x27;a&#x27;, &#x27;b&#x27;, &#x27;c&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> value <span class="keyword">of</span> <span class="title function_">values</span>(obj)) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(value); <span class="comment">// 1, 2, 3</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> [key, value] <span class="keyword">of</span> <span class="title function_">entries</span>(obj)) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>([key, value]); <span class="comment">// [&#x27;a&#x27;, 1], [&#x27;b&#x27;, 2], [&#x27;c&#x27;, 3]</span></span><br><span class="line">&#125;</span><br><span class="line">复制代码;</span><br></pre></td></tr></table></figure>

<blockquote>
</blockquote>
]]></content>
      <categories>
        <category>前端</category>
      </categories>
      <tags>
        <tag>JavaScript</tag>
        <tag>面试</tag>
        <tag>ES6</tag>
      </tags>
  </entry>
  <entry>
    <title>ES6面试理论知识点汇总</title>
    <url>/test/post/ES6%E9%9D%A2%E8%AF%95%E7%90%86%E8%AE%BA%E7%9F%A5%E8%AF%86%E7%82%B9%E6%B1%87%E6%80%BB/</url>
    <content><![CDATA[<h3 id="一、问：ES6-是什么，为什么要学习它，不学习-ES6-会怎么样"><a href="#一、问：ES6-是什么，为什么要学习它，不学习-ES6-会怎么样" class="headerlink" title="一、问：ES6 是什么，为什么要学习它，不学习 ES6 会怎么样?"></a>一、问：ES6 是什么，为什么要学习它，不学习 ES6 会怎么样?</h3><p>答：ES6 是新一代的 JS 语言标准，对分 JS 语言核心内容做了升级优化，规范了 JS 使用标准，新增了 JS 原生方法，使得 JS 使用更加规范，更加优雅，更适合大型应用的开发。学习 ES6 是成为专业前端正规军的必经之路。不学习 ES6 也可以写代码打鬼子，但是最多只能当个游击队长。</p>
<h3 id="二、问：ES5、ES6-和-ES2015-有什么区别"><a href="#二、问：ES5、ES6-和-ES2015-有什么区别" class="headerlink" title="二、问：ES5、ES6 和 ES2015 有什么区别?"></a>二、问：ES5、ES6 和 ES2015 有什么区别?</h3><p>答：ES2015 特指在 2015 年发布的新一代 JS 语言标准，ES6 泛指下一代 JS 语言标准，包含 ES2015、ES2016、ES2017、ES2018 等。现阶段在绝大部分场景下，ES2015 默认等同 ES6。ES5 泛指上一代语言标准。ES2015 可以理解为 ES5 和 ES6 的时间分界线。</p>
<h3 id="三、问：babel-是什么，有什么作用"><a href="#三、问：babel-是什么，有什么作用" class="headerlink" title="三、问：babel 是什么，有什么作用?"></a>三、问：babel 是什么，有什么作用?</h3><p>答：babel 是一个 ES6 转码器，可以将 ES6 代码转为 ES5 代码，以便兼容那些还没支持 ES6 的平台。</p>
<h3 id="四、问：let-有什么用，有了-var-为什么还要用-let？"><a href="#四、问：let-有什么用，有了-var-为什么还要用-let？" class="headerlink" title="四、问：let 有什么用，有了 var 为什么还要用 let？"></a>四、问：let 有什么用，有了 var 为什么还要用 let？</h3><p>答：在 ES6 之前，声明变量只能用 var，var 方式声明变量其实是很不合理的，准确的说，是因为 ES5 里面没有块级作用域是很不合理的，甚至可以说是一个语言层面的 bug(这也是很多 c++、java 开发人员看不懂，也瞧不起 JS 语言的劣势之一)。没有块级作用域会带来很多难以理解的问题，比如 for 循环 var 变量泄露，变量覆盖等问题。let 声明的变量<strong>拥有自己的块级作用域</strong>，且修复了 var 声明变量带来的<strong>变量提升问题</strong>。</p>
<h3 id="五、问：举一些-ES6-对-String-字符串类型做的常用升级优化"><a href="#五、问：举一些-ES6-对-String-字符串类型做的常用升级优化" class="headerlink" title="五、问：举一些 ES6 对 String 字符串类型做的常用升级优化?"></a>五、问：举一些 ES6 对 String 字符串类型做的常用升级优化?</h3><p>答：</p>
<h4 id="1、优化部分："><a href="#1、优化部分：" class="headerlink" title="1、优化部分："></a>1、优化部分：</h4><p>ES6 新增了字符串模板，在拼接大段字符串时，用反斜杠(&#96;)取代以往的字符串相加的形式，能保留所有空格和换行，使得字符串拼接看起来更加直观，更加优雅。</p>
<h4 id="2、升级部分"><a href="#2、升级部分" class="headerlink" title="2、升级部分:"></a>2、升级部分:</h4><p>ES6 在 String 原型上新增了 includes()方法，用于取代传统的只能用 indexOf 查找包含字符的方法(indexOf 返回-1 表示没查到不如 includes 方法返回 false 更明确，语义更清晰), 此外还新增了 startsWith(), endsWith(), padStart(),padEnd(),repeat()等方法，可方便的用于查找，补全字符串。</p>
<h3 id="六、问：举一些-ES6-对-Array-数组类型做的常用升级优化"><a href="#六、问：举一些-ES6-对-Array-数组类型做的常用升级优化" class="headerlink" title="六、问：举一些 ES6 对 Array 数组类型做的常用升级优化?"></a>六、问：举一些 ES6 对 Array 数组类型做的常用升级优化?</h3><p>答：</p>
<h4 id="1、优化部分：-1"><a href="#1、优化部分：-1" class="headerlink" title="1、优化部分："></a>1、优化部分：</h4><p><strong>a.</strong> 数组解构赋值。ES6 可以直接以<code>let [a,b,c] = [1,2,3]</code>形式进行变量赋值，在声明较多变量时，不用再写很多 let(var),且映射关系清晰，且支持赋默认值。</p>
<p><strong>b.</strong> 扩展运算符。ES6 新增的扩展运算符(…)(重要),可以轻松的实现数组和松散序列的相互转化，可以取代 arguments 对象和 apply 方法，轻松获取未知参数个数情况下的参数集合。（尤其是在 ES5 中，arguments 并不是一个真正的数组，而是一个类数组的对象，但是扩展运算符的逆运算却可以返回一个真正的数组）。扩展运算符还可以轻松方便的实现数组的复制和解构赋值（<code>let a = [2,3,4]; let b = [...a]</code>）。</p>
<h4 id="2、升级部分-1"><a href="#2、升级部分-1" class="headerlink" title="2、升级部分:"></a>2、升级部分:</h4><p>ES6 在 Array 原型上新增了 find()方法，用于取代传统的只能用 indexOf 查找包含数组项目的方法,且修复了 indexOf 查找不到 NaN 的 bug(<code>[NaN].indexOf(NaN) === -1</code>).此外还新增了 copyWithin(), includes(), fill(),flat()等方法，可方便的用于字符串的查找，补全,转换等。</p>
<h3 id="七、问：举一些-ES6-对-Number-数字类型做的常用升级优化"><a href="#七、问：举一些-ES6-对-Number-数字类型做的常用升级优化" class="headerlink" title="七、问：举一些 ES6 对 Number 数字类型做的常用升级优化?"></a>七、问：举一些 ES6 对 Number 数字类型做的常用升级优化?</h3><p>答：</p>
<h4 id="1、优化部分：-2"><a href="#1、优化部分：-2" class="headerlink" title="1、优化部分："></a>1、优化部分：</h4><p>ES6 在 Number 原型上新增了 isFinite(), isNaN()方法，用来取代传统的全局 isFinite(), isNaN()方法检测数值是否有限、是否是 NaN。ES5 的 isFinite(), isNaN()方法都会先将非数值类型的参数转化为 Number 类型再做判断，这其实是不合理的，最造成<code>isNaN(&#39;NaN&#39;) === true</code>的奇怪行为–’NaN’是一个字符串，但是 isNaN 却说这就是 NaN。而 Number.isFinite()和 Number.isNaN()则不会有此类问题(<code>Number.isNaN(&#39;NaN&#39;) === false</code>)。（isFinite()同上）</p>
<h4 id="2、升级部分-2"><a href="#2、升级部分-2" class="headerlink" title="2、升级部分:"></a>2、升级部分:</h4><p>ES6 在 Math 对象上新增了 Math.cbrt()，trunc()，hypot()等等较多的科学计数法运算方法，可以更加全面的进行立方根、求和立方根等等科学计算。</p>
<h3 id="八、问：举一些-ES6-对-Object-类型做的常用升级优化-重要"><a href="#八、问：举一些-ES6-对-Object-类型做的常用升级优化-重要" class="headerlink" title="八、问：举一些 ES6 对 Object 类型做的常用升级优化?(重要)"></a>八、问：举一些 ES6 对 Object 类型做的常用升级优化?(重要)</h3><p>答：</p>
<h4 id="1、优化部分：-3"><a href="#1、优化部分：-3" class="headerlink" title="1、优化部分："></a>1、优化部分：</h4><p><strong>a.</strong> 对象属性变量式声明。ES6 可以直接以变量形式声明对象属性或者方法，。比传统的键值对形式声明更加简洁，更加方便，语义更加清晰。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> [apple, orange] = [<span class="string">&quot;red appe&quot;</span>, <span class="string">&quot;yellow orange&quot;</span>];</span><br><span class="line"><span class="keyword">let</span> myFruits = &#123; apple, orange &#125;; <span class="comment">// let myFruits = &#123;apple: &#x27;red appe&#x27;, orange: &#x27;yellow orange&#x27;&#125;;</span></span><br></pre></td></tr></table></figure>

<p>尤其在对象解构赋值(见优化部分 b.)或者模块输出变量时，这种写法的好处体现的最为明显:</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> &#123; keys, values, entries &#125; = <span class="title class_">Object</span>;</span><br><span class="line"><span class="keyword">let</span> <span class="title class_">MyOwnMethods</span> = &#123; keys, values, entries &#125;; <span class="comment">// let MyOwnMethods = &#123;keys: keys, values: values, entries: entries&#125;</span></span><br></pre></td></tr></table></figure>

<p>可以看到属性变量式声明属性看起来更加简洁明了。方法也可以采用简洁写法：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> es5Fun = &#123;</span><br><span class="line">  <span class="attr">method</span>: <span class="keyword">function</span> (<span class="params"></span>) &#123;&#125;,</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">let</span> es6Fun = &#123;</span><br><span class="line">  <span class="title function_">method</span>(<span class="params"></span>) &#123;&#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p><strong>b.</strong> 对象的解构赋值。ES6 对象也可以像数组解构赋值那样，进行变量的解构赋值：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> &#123; apple, orange &#125; = &#123; <span class="attr">apple</span>: <span class="string">&quot;red appe&quot;</span>, <span class="attr">orange</span>: <span class="string">&quot;yellow orange&quot;</span> &#125;;</span><br></pre></td></tr></table></figure>

<p><strong>c.</strong> 对象的扩展运算符(…)。ES6 对象的扩展运算符和数组扩展运算符用法本质上差别不大，毕竟数组也就是特殊的对象。对象的扩展运算符一个最常用也最好用的用处就在于可以轻松的取出一个目标对象内部全部或者部分的可遍历属性，从而进行对象的合并和分解。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> &#123; apple, orange, ...otherFruits &#125; = &#123;</span><br><span class="line">  <span class="attr">apple</span>: <span class="string">&quot;red apple&quot;</span>,</span><br><span class="line">  <span class="attr">orange</span>: <span class="string">&quot;yellow orange&quot;</span>,</span><br><span class="line">  <span class="attr">grape</span>: <span class="string">&quot;purple grape&quot;</span>,</span><br><span class="line">  <span class="attr">peach</span>: <span class="string">&quot;sweet peach&quot;</span>,</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// otherFruits  &#123;grape: &#x27;purple grape&#x27;, peach: &#x27;sweet peach&#x27;&#125;</span></span><br><span class="line"><span class="comment">// 注意: 对象的扩展运算符用在解构赋值时，扩展运算符只能用在最后一个参数(otherFruits后面不能再跟其他参数)</span></span><br><span class="line"><span class="keyword">let</span> moreFruits = &#123; <span class="attr">watermelon</span>: <span class="string">&quot;nice watermelon&quot;</span> &#125;;</span><br><span class="line"><span class="keyword">let</span> allFruits = &#123; apple, orange, ...otherFruits, ...moreFruits &#125;;</span><br></pre></td></tr></table></figure>

<p><strong>d.</strong> super 关键字。ES6 在 Class 类里新增了类似 this 的关键字 super。同 this 总是指向当前函数所在的对象不同，super 关键字总是指向当前函数所在对象的原型对象。</p>
<h4 id="2、升级部分-3"><a href="#2、升级部分-3" class="headerlink" title="2、升级部分:"></a>2、升级部分:</h4><p><strong>a.</strong> ES6 在 Object 原型上新增了 is()方法，做两个目标对象的相等比较，用来完善’&#x3D;&#x3D;&#x3D;’方法。’&#x3D;&#x3D;&#x3D;’方法中<code>NaN === NaN //false</code>其实是不合理的，Object.is 修复了这个小 bug。(<code>Object.is(NaN, NaN) // true</code>)</p>
<p><strong>b.</strong> ES6 在 Object 原型上新增了 assign()方法，用于对象新增属性或者多个对象合并。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> target = &#123; <span class="attr">a</span>: <span class="number">1</span> &#125;;</span><br><span class="line"><span class="keyword">const</span> source1 = &#123; <span class="attr">b</span>: <span class="number">2</span> &#125;;</span><br><span class="line"><span class="keyword">const</span> source2 = &#123; <span class="attr">c</span>: <span class="number">3</span> &#125;;</span><br><span class="line"><span class="title class_">Object</span>.<span class="title function_">assign</span>(target, source1, source2);</span><br><span class="line">target; <span class="comment">// &#123;a:1, b:2, c:3&#125;</span></span><br></pre></td></tr></table></figure>

<p>注意: assign 合并的对象 target 只能合并 source1、source2 中的自身属性，并不会合并 source1、source2 中的继承属性，也不会合并不可枚举的属性，且无法正确复制 get 和 set 属性（会直接执行 get&#x2F;set 函数，取 return 的值）。</p>
<p><strong>c.</strong> ES6 在 Object 原型上新增了 getOwnPropertyDescriptors()方法，此方法增强了 ES5 中 getOwnPropertyDescriptor()方法，可以获取指定对象所有自身属性的描述对象。结合 defineProperties()方法，可以完美复制对象，包括复制 get 和 set 属性。</p>
<p><strong>d.</strong> ES6 在 Object 原型上新增了 getPrototypeOf()和 setPrototypeOf()方法，用来获取或设置当前对象的 prototype 对象。这个方法存在的意义在于，ES5 中获取设置 prototype 对像是通过<strong>proto</strong>属性来实现的，然而<strong>proto</strong>属性并不是 ES 规范中的明文规定的属性，只是浏览器各大产商“私自”加上去的属性，只不过因为适用范围广而被默认使用了，再非浏览器环境中并不一定就可以使用，所以为了稳妥起见，获取或设置当前对象的 prototype 对象时，都应该采用 ES6 新增的标准用法。</p>
<p><strong>e.</strong> ES6 在 Object 原型上还新增了 Object.keys()，Object.values()，Object.entries()方法，用来获取对象的所有键、所有值和所有键值对数组。</p>
<h3 id="九、问：举一些-ES6-对-Function-函数类型做的常用升级优化-重要"><a href="#九、问：举一些-ES6-对-Function-函数类型做的常用升级优化-重要" class="headerlink" title="九、问：举一些 ES6 对 Function 函数类型做的常用升级优化?(重要)"></a>九、问：举一些 ES6 对 Function 函数类型做的常用升级优化?(重要)</h3><p>答：</p>
<h4 id="1、优化部分：-4"><a href="#1、优化部分：-4" class="headerlink" title="1、优化部分："></a>1、优化部分：</h4><p><strong>a.</strong> 箭头函数**(核心)**。箭头函数是 ES6 核心的升级项之一，箭头函数里没有自己的 this,这改变了以往 JS 函数中最让人难以理解的 this 运行机制。主要优化点:</p>
<p>Ⅰ. <strong>箭头函数内的 this 指向的是函数定义时所在的对象，而不是函数执行时所在的对象</strong>。ES5 函数里的 this 总是指向函数执行时所在的对象，这使得在很多情况下 this 的指向变得很难理解，尤其是非严格模式情况下，this 有时候会指向全局对象，这甚至也可以归结为语言层面的 bug 之一。ES6 的箭头函数优化了这一点，它的内部没有自己的 this,这也就导致了 this 总是指向上一层的 this，如果上一层还是箭头函数，则继续向上指，直到指向到有自己 this 的函数为止，并作为自己的 this。</p>
<p>Ⅱ. 箭头函数不能用作构造函数，因为它没有自己的 this，无法实例化。</p>
<p>Ⅲ. 也是因为箭头函数没有自己的 this,所以箭头函数 内也不存在 arguments 对象。（可以用扩展运算符代替）</p>
<p><strong>b.</strong> 函数默认赋值。ES6 之前，函数的形参是无法给默认值得，只能在函数内部通过变通方法实现。ES6 以更简洁更明确的方式进行函数默认赋值。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">es6Fuc</span>(<span class="params">x, y = <span class="string">&quot;default&quot;</span></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(x, y);</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">es6Fuc</span>(<span class="number">4</span>); <span class="comment">// 4, default</span></span><br></pre></td></tr></table></figure>

<h4 id="2、升级部分-4"><a href="#2、升级部分-4" class="headerlink" title="2、升级部分:"></a>2、升级部分:</h4><p>ES6 新增了双冒号运算符，用来取代以往的 bind，call,和 apply。(浏览器暂不支持，Babel 已经支持转码)</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="attr">foo</span>::bar;</span><br><span class="line"><span class="comment">// 等同于</span></span><br><span class="line">bar.<span class="title function_">bind</span>(foo);</span><br><span class="line"></span><br><span class="line"><span class="attr">foo</span>::<span class="title function_">bar</span>(...<span class="variable language_">arguments</span>);</span><br><span class="line"><span class="comment">// 等同于</span></span><br><span class="line">bar.<span class="title function_">apply</span>(foo, <span class="variable language_">arguments</span>);</span><br><span class="line">复制代码;</span><br></pre></td></tr></table></figure>

<h3 id="十、问：Symbol-是什么，有什么作用？"><a href="#十、问：Symbol-是什么，有什么作用？" class="headerlink" title="十、问：Symbol 是什么，有什么作用？"></a>十、问：Symbol 是什么，有什么作用？</h3><p>答：Symbol 是 ES6 引入的第七种原始数据类型（说法不准确，应该是第七种数据类型，Object 不是原始数据类型之一，已更正），所有 Symbol()生成的值都是独一无二的，可以从根本上解决对象属性太多导致属性名冲突覆盖的问题。对象中 Symbol()属性不能被 for…in 遍历，但是也不是私有属性。</p>
<h3 id="十一、问：Set-是什么，有什么作用？"><a href="#十一、问：Set-是什么，有什么作用？" class="headerlink" title="十一、问：Set 是什么，有什么作用？"></a>十一、问：Set 是什么，有什么作用？</h3><p>答：Set 是 ES6 引入的一种类似 Array 的新的数据结构，Set 实例的成员类似于数组 item 成员，区别是 Set 实例的成员都是唯一，不重复的。这个特性可以轻松地实现数组去重。</p>
<h3 id="十二、问：Map-是什么，有什么作用？"><a href="#十二、问：Map-是什么，有什么作用？" class="headerlink" title="十二、问：Map 是什么，有什么作用？"></a>十二、问：Map 是什么，有什么作用？</h3><p>答：Map 是 ES6 引入的一种类似 Object 的新的数据结构，Map 可以理解为是 Object 的超集，打破了以传统键值对形式定义对象，对象的 key 不再局限于字符串，也可以是 Object。可以更加全面的描述对象的属性。</p>
<h3 id="十三、问：Proxy-是什么，有什么作用？"><a href="#十三、问：Proxy-是什么，有什么作用？" class="headerlink" title="十三、问：Proxy 是什么，有什么作用？"></a>十三、问：Proxy 是什么，有什么作用？</h3><p>答：Proxy 是 ES6 新增的一个构造函数，可以理解为 JS 语言的一个代理，用来改变 JS 默认的一些语言行为，包括拦截默认的 get&#x2F;set 等底层方法，使得 JS 的使用自由度更高，可以最大限度的满足开发者的需求。比如通过拦截对象的 get&#x2F;set 方法，可以轻松地定制自己想要的 key 或者 value。下面的例子可以看到，随便定义一个 myOwnObj 的 key,都可以变成自己想要的函数。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">createMyOwnObj</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="comment">//想把所有的key都变成函数，或者Promise,或者anything</span></span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Proxy</span>(</span><br><span class="line">    &#123;&#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="title function_">get</span>(<span class="params">target, propKey, receiver</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">          <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">let</span> randomBoolean = <span class="title class_">Math</span>.<span class="title function_">random</span>() &gt; <span class="number">0.5</span>;</span><br><span class="line">            <span class="keyword">let</span> <span class="title class_">Message</span>;</span><br><span class="line">            <span class="keyword">if</span> (randomBoolean) &#123;</span><br><span class="line">              <span class="title class_">Message</span> = <span class="string">`你的<span class="subst">$&#123;propKey&#125;</span>运气不错，成功了`</span>;</span><br><span class="line">              <span class="title function_">resolve</span>(<span class="title class_">Message</span>);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">              <span class="title class_">Message</span> = <span class="string">`你的<span class="subst">$&#123;propKey&#125;</span>运气不行，失败了`</span>;</span><br><span class="line">              <span class="title function_">reject</span>(<span class="title class_">Message</span>);</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;, <span class="number">1000</span>);</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> myOwnObj = <span class="title function_">createMyOwnObj</span>();</span><br><span class="line"></span><br><span class="line">myOwnObj.<span class="property">hahaha</span></span><br><span class="line">  .<span class="title function_">then</span>(<span class="function">(<span class="params">result</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(result); <span class="comment">//你的hahaha运气不错，成功了</span></span><br><span class="line">  &#125;)</span><br><span class="line">  .<span class="title function_">catch</span>(<span class="function">(<span class="params">error</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(error); <span class="comment">//你的hahaha运气不行，失败了</span></span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">myOwnObj.<span class="property">wuwuwu</span></span><br><span class="line">  .<span class="title function_">then</span>(<span class="function">(<span class="params">result</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(result); <span class="comment">//你的wuwuwu运气不错，成功了</span></span><br><span class="line">  &#125;)</span><br><span class="line">  .<span class="title function_">catch</span>(<span class="function">(<span class="params">error</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(error); <span class="comment">//你的wuwuwu运气不行，失败了</span></span><br><span class="line">  &#125;);</span><br></pre></td></tr></table></figure>

<h3 id="十四、问：Reflect-是什么，有什么作用？"><a href="#十四、问：Reflect-是什么，有什么作用？" class="headerlink" title="十四、问：Reflect 是什么，有什么作用？"></a>十四、问：Reflect 是什么，有什么作用？</h3><p>答：Reflect 是 ES6 引入的一个新的对象，他的主要作用有两点，一是将原生的一些零散分布在 Object、Function 或者全局函数里的方法(如 apply、delete、get、set 等等)，统一整合到 Reflect 上，这样可以更加方便更加统一的管理一些原生 API。其次就是因为 Proxy 可以改写默认的原生 API，如果一旦原生 API 别改写可能就找不到了，所以 Reflect 也可以起到备份原生 API 的作用，使得即使原生 API 被改写了之后，也可以在被改写之后的 API 用上默认的 API。</p>
<h3 id="十五、问：Promise-是什么，有什么作用？"><a href="#十五、问：Promise-是什么，有什么作用？" class="headerlink" title="十五、问：Promise 是什么，有什么作用？"></a>十五、问：Promise 是什么，有什么作用？</h3><p>答：Promise 是 ES6 引入的一个新的对象，他的主要作用是用来解决 JS 异步机制里，回调机制产生的“回调地狱”。它并不是什么突破性的 API，只是封装了异步回调形式，使得异步回调可以写的更加优雅，可读性更高，而且可以链式调用。</p>
<p>附录：<a href="http://mp.weixin.qq.com/s?__biz=MzAxODE4MTEzMA==&mid=2650084846&idx=2&sn=df481aa2f00e749f8223782c069bb86a&chksm=83db888bb4ac019d839c04bf0751f013adeef8dd426c9882b5a0583abb276e52783367910125&scene=21#wechat_redirect">15 道 ES6 Promise 实战练习题</a></p>
<h3 id="十六、问：Iterator-是什么，有什么作用？-重要"><a href="#十六、问：Iterator-是什么，有什么作用？-重要" class="headerlink" title="十六、问：Iterator 是什么，有什么作用？(重要)"></a>十六、问：Iterator 是什么，有什么作用？(重要)</h3><p>答：Iterator 是 ES6 中一个很重要概念，它并不是对象，也不是任何一种数据类型。因为 ES6 新增了 Set、Map 类型，他们和 Array、Object 类型很像，Array、Object 都是可以遍历的，但是 Set、Map 都不能用 for 循环遍历，解决这个问题有两种方案，一种是为 Set、Map 单独新增一个用来遍历的 API，另一种是为 Set、Map、Array、Object 新增一个统一的遍历 API，显然，第二种更好，ES6 也就顺其自然的需要一种设计标准，来统一所有可遍历类型的遍历方式。Iterator 正是这样一种标准。或者说是一种规范理念。</p>
<p>就好像 JavaScript 是 ECMAScript 标准的一种具体实现一样，Iterator 标准的具体实现是 Iterator 遍历器。Iterator 标准规定，所有部署了 key 值为[Symbol.iterator]，且[Symbol.iterator]的 value 是标准的 Iterator 接口函数(标准的 Iterator 接口函数: 该函数必须返回一个对象，且对象中包含 next 方法，且执行 next()能返回包含 value&#x2F;done 属性的 Iterator 对象)的对象，都称之为可遍历对象，next()后返回的 Iterator 对象也就是 Iterator 遍历器。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">//obj就是可遍历的，因为它遵循了Iterator标准，且包含[Symbol.iterator]方法，方法函数也符合标准的Iterator接口规范。</span></span><br><span class="line"><span class="comment">//obj.[Symbol.iterator]() 就是Iterator遍历器</span></span><br><span class="line"><span class="keyword">let</span> obj = &#123;</span><br><span class="line">  <span class="attr">data</span>: [<span class="string">&quot;hello&quot;</span>, <span class="string">&quot;world&quot;</span>],</span><br><span class="line">  [<span class="title class_">Symbol</span>.<span class="property">iterator</span>]() &#123;</span><br><span class="line">    <span class="keyword">const</span> self = <span class="variable language_">this</span>;</span><br><span class="line">    <span class="keyword">let</span> index = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="title function_">next</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (index &lt; self.<span class="property">data</span>.<span class="property">length</span>) &#123;</span><br><span class="line">          <span class="keyword">return</span> &#123;</span><br><span class="line">            <span class="attr">value</span>: self.<span class="property">data</span>[index++],</span><br><span class="line">            <span class="attr">done</span>: <span class="literal">false</span>,</span><br><span class="line">          &#125;;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="keyword">return</span> &#123; <span class="attr">value</span>: <span class="literal">undefined</span>, <span class="attr">done</span>: <span class="literal">true</span> &#125;;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>ES6 给 Set、Map、Array、String 都加上了[Symbol.iterator]方法，且[Symbol.iterator]方法函数也符合标准的 Iterator 接口规范，所以 Set、Map、Array、String 默认都是可以遍历的。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">//Array</span></span><br><span class="line"><span class="keyword">let</span> array = [<span class="string">&#x27;red&#x27;</span>, <span class="string">&#x27;green&#x27;</span>, <span class="string">&#x27;blue&#x27;</span>];</span><br><span class="line">array[<span class="title class_">Symbol</span>.<span class="property">iterator</span>]() <span class="comment">//Iterator遍历器</span></span><br><span class="line">array[<span class="title class_">Symbol</span>.<span class="property">iterator</span>]().<span class="title function_">next</span>() <span class="comment">//&#123;value: &quot;red&quot;, done: false&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//String</span></span><br><span class="line"><span class="keyword">let</span> string = <span class="string">&#x27;1122334455&#x27;</span>;</span><br><span class="line">string[<span class="title class_">Symbol</span>.<span class="property">iterator</span>]() <span class="comment">//Iterator遍历器</span></span><br><span class="line">string[<span class="title class_">Symbol</span>.<span class="property">iterator</span>]().<span class="title function_">next</span>() <span class="comment">//&#123;value: &quot;1&quot;, done: false&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//set</span></span><br><span class="line"><span class="keyword">let</span> set = <span class="keyword">new</span> <span class="title class_">Set</span>([<span class="string">&#x27;red&#x27;</span>, <span class="string">&#x27;green&#x27;</span>, <span class="string">&#x27;blue&#x27;</span>]);</span><br><span class="line">set[<span class="title class_">Symbol</span>.<span class="property">iterator</span>]() <span class="comment">//Iterator遍历器</span></span><br><span class="line">set[<span class="title class_">Symbol</span>.<span class="property">iterator</span>]().<span class="title function_">next</span>() <span class="comment">//&#123;value: &quot;red&quot;, done: false&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Map</span></span><br><span class="line"><span class="keyword">let</span> map = <span class="keyword">new</span> <span class="title class_">Map</span>();</span><br><span class="line"><span class="keyword">let</span> obj= &#123;<span class="attr">map</span>: <span class="string">&#x27;map&#x27;</span>&#125;;</span><br><span class="line">map.<span class="title function_">set</span>(obj, <span class="string">&#x27;mapValue&#x27;</span>);</span><br><span class="line">map[<span class="title class_">Symbol</span>.<span class="property">iterator</span>]().<span class="title function_">next</span>(<span class="params"></span>)  &#123;<span class="attr">value</span>: <span class="title class_">Array</span>(<span class="number">2</span>), <span class="attr">done</span>: <span class="literal">false</span>&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="十七、问：for…in-和-for…of-有什么区别？"><a href="#十七、问：for…in-和-for…of-有什么区别？" class="headerlink" title="十七、问：for…in 和 for…of 有什么区别？"></a>十七、问：for…in 和 for…of 有什么区别？</h3><p>答：如果看到问题十六，那么就很好回答。问题十六提到了 ES6 统一了遍历标准，制定了可遍历对象，那么用什么方法去遍历呢？答案就是用 for…of。ES6 规定，有所部署了载了 Iterator 接口的对象(可遍历对象)都可以通过 for…of 去遍历，而 for..in 仅仅可以遍历对象。</p>
<p>这也就意味着，数组也可以用 for…of 遍历，这极大地方便了数组的取值，且避免了很多程序用 for..in 去遍历数组的恶习。</p>
<p>上面提到的扩展运算符本质上也就是 for..of 循环的一种实现。</p>
<h3 id="十八、Generator-函数是什么，有什么作用？"><a href="#十八、Generator-函数是什么，有什么作用？" class="headerlink" title="十八、Generator 函数是什么，有什么作用？"></a>十八、Generator 函数是什么，有什么作用？</h3><p>答：如果说 JavaScript 是 ECMAScript 标准的一种具体实现、Iterator 遍历器是 Iterator 的具体实现，那么 Generator 函数可以说是 Iterator 接口的具体实现方式。</p>
<p>执行 Generator 函数会返回一个遍历器对象，每一次 Generator 函数里面的 yield 都相当一次遍历器对象的 next()方法，并且可以通过 next(value)方法传入自定义的 value,来改变 Generator 函数的行为。</p>
<p>Generator 函数可以通过配合 Thunk 函数更轻松更优雅的实现异步编程和控制流管理。</p>
<h3 id="十九、async-函数是什么，有什么作用？"><a href="#十九、async-函数是什么，有什么作用？" class="headerlink" title="十九、async 函数是什么，有什么作用？"></a>十九、async 函数是什么，有什么作用？</h3><p>答：async 函数可以理解为内置自动执行器的 Generator 函数语法糖，它配合 ES6 的 Promise 近乎完美的实现了异步编程解决方案。</p>
<p>附录：<a href="http://mp.weixin.qq.com/s?__biz=MzAxODE4MTEzMA==&mid=2650079079&idx=2&sn=9eede14eaa71459e0854de70a44585d4&chksm=83da6202b4adeb1408232a8db0b3e6d470564fce73b63c4618d9e2303fec7ef34d8f33eb38cf&scene=21#wechat_redirect">手写 async await 的最简实现（20 行搞定）！阿里字节面试必考</a></p>
<h3 id="二十、Class、extends-是什么，有什么作用？"><a href="#二十、Class、extends-是什么，有什么作用？" class="headerlink" title="二十、Class、extends 是什么，有什么作用？"></a>二十、Class、extends 是什么，有什么作用？</h3><p>答：ES6 的 class 可以看作只是一个 ES5 生成实例对象的构造函数的语法糖。它参考了 java 语言，定义了一个类的概念，让对象原型写法更加清晰，对象实例化更像是一种面向对象编程。Class 类可以通过 extends 实现继承。它和 ES5 构造函数的不同点：</p>
<p><strong>a</strong>. 类的内部定义的所有方法，都是不可枚举的。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">///ES5</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">ES5Fun</span>(<span class="params">x, y</span>) &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">x</span> = x;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">y</span> = y;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title class_">ES5Fun</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">toString</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">&quot;(&quot;</span> + <span class="variable language_">this</span>.<span class="property">x</span> + <span class="string">&quot;, &quot;</span> + <span class="variable language_">this</span>.<span class="property">y</span> + <span class="string">&quot;)&quot;</span>;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">var</span> p = <span class="keyword">new</span> <span class="title class_">ES5Fun</span>(<span class="number">1</span>, <span class="number">3</span>);</span><br><span class="line">p.<span class="title function_">toString</span>();</span><br><span class="line"><span class="title class_">Object</span>.<span class="title function_">keys</span>(<span class="title class_">ES5Fun</span>.<span class="property"><span class="keyword">prototype</span></span>); <span class="comment">//[&#x27;toString&#x27;]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//ES6</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ES6Fun</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">x, y</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">x</span> = x;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">y</span> = y;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">toString</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;(&quot;</span> + <span class="variable language_">this</span>.<span class="property">x</span> + <span class="string">&quot;, &quot;</span> + <span class="variable language_">this</span>.<span class="property">y</span> + <span class="string">&quot;)&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title class_">Object</span>.<span class="title function_">keys</span>(<span class="title class_">ES6Fun</span>.<span class="property"><span class="keyword">prototype</span></span>); <span class="comment">//[]</span></span><br></pre></td></tr></table></figure>

<p><strong>b</strong>.ES6 的 class 类必须用 new 命令操作，而 ES5 的构造函数不用 new 也可以执行。</p>
<p><strong>c</strong>.ES6 的 class 类不存在变量提升，必须先定义 class 之后才能实例化，不像 ES5 中可以将构造函数写在实例化之后。</p>
<p><strong>d</strong>.ES5 的继承，实质是先创造子类的实例对象 this，然后再将父类的方法添加到 this 上面。ES6 的继承机制完全不同，实质是先将父类实例对象的属性和方法，加到 this 上面（所以必须先调用 super 方法），然后再用子类的构造函数修改 this。</p>
<h3 id="二十一、module、export、import-是什么，有什么作用？"><a href="#二十一、module、export、import-是什么，有什么作用？" class="headerlink" title="二十一、module、export、import 是什么，有什么作用？"></a>二十一、module、export、import 是什么，有什么作用？</h3><p>答：module、export、import 是 ES6 用来统一前端模块化方案的设计思路和实现方案。export、import 的出现统一了前端模块化的实现方案，整合规范了浏览器&#x2F;服务端的模块化方法，用来取代传统的 AMD&#x2F;CMD、requireJS、seaJS、commondJS 等等一系列前端模块不同的实现方案，使前端模块化更加统一规范，JS 也能更加能实现大型的应用程序开发。</p>
<p>import 引入的模块是静态加载（编译阶段加载）而不是动态加载（运行时加载）。</p>
<p>import 引入 export 导出的接口值是动态绑定关系，即通过该接口，可以取到模块内部实时的值。</p>
<h3 id="二十二、日常前端代码开发中，有哪些值得用-ES6-去改进的编程优化或者规范？"><a href="#二十二、日常前端代码开发中，有哪些值得用-ES6-去改进的编程优化或者规范？" class="headerlink" title="二十二、日常前端代码开发中，有哪些值得用 ES6 去改进的编程优化或者规范？"></a>二十二、日常前端代码开发中，有哪些值得用 ES6 去改进的编程优化或者规范？</h3><p>答：</p>
<ol>
<li>常用箭头函数来取代<code>var self = this;</code>的做法。</li>
<li>常用 let 取代 var 命令。</li>
<li>常用数组&#x2F;对象的结构赋值来命名变量，结构更清晰，语义更明确，可读性更好。</li>
<li>在长字符串多变量组合场合，用模板字符串来取代字符串累加，能取得更好地效果和阅读体验。</li>
<li>用 Class 类取代传统的构造函数，来生成实例化对象。</li>
<li>在大型应用开发中，要保持 module 模块化开发思维，分清模块之间的关系，常用 import、export 方法。</li>
</ol>
]]></content>
      <categories>
        <category>前端</category>
      </categories>
      <tags>
        <tag>JavaScript</tag>
        <tag>面试</tag>
        <tag>ES6</tag>
      </tags>
  </entry>
  <entry>
    <title>什么是 Proxy</title>
    <url>/test/post/Proxy%E5%8F%8A%E5%85%B6%E4%BC%98%E7%82%B9/</url>
    <content><![CDATA[<h2 id="什么是-Proxy"><a href="#什么是-Proxy" class="headerlink" title="什么是 Proxy"></a>什么是 Proxy</h2><p>通常，当谈到JavaScript语言时，我们讨论的是ES6标准提供的新特性，本文也不例外。 我们将讨论JavaScript代理以及它们的作用，但在我们深入研究之前，我们先来看一下Proxy的定义是什么。</p>
<p>MDN上的定义是：代理对象是用于定义基本操作的自定义行为（例如，属性查找，赋值，枚举，函数调用等）。</p>
<p>换句话说，我们可以说代理对象是我们的目标对象的包装器，我们可以在其中操纵其属性并阻止对它的直接访问。 你可能会发现将它们应用到实际代码中很困难，我鼓励你仔细阅读这个概念，它可能会改变你的观点。</p>
<h3 id="术语"><a href="#术语" class="headerlink" title="术语"></a>术语</h3><p>handler</p>
<p>包含陷阱（traps）的占位符对象。</p>
<p>traps</p>
<p>提供属性访问的方法。这类似于操作系统中捕获器的概念。</p>
<p>target</p>
<p>代理虚拟化的对象。(由代理对象包装和操作的实际对象)</p>
<p>在本文中，我将为 get 和 set 陷阱 提供简单的用例，考虑到最后，我们将看到如何使用它们并包含更复杂的功能，如API。</p>
<h3 id="语法和用例"><a href="#语法和用例" class="headerlink" title="语法和用例"></a>语法和用例</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> p = <span class="keyword">new</span> <span class="title class_">Proxy</span>(target, handler);</span><br></pre></td></tr></table></figure>
<p>将目标和处理程序传递给Proxy构造函数，这样就创建了一个proxy对象。现在，让我们看看如何利用它。为了更清楚地看出Proxy的好处，首先，我们需要编写一些没有它的代码。</p>
<p>想象一下，我们有一个带有几个属性的用户对象，如果属性存在，我们想要打印用户信息，如果不存在，则抛出异常。在不使用代理对象时，判断属性值是否存在的代码也放在了打印用户信息的函数，即 printUser 中(这并不是我们所希望的)，如下demo所示：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> user = &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;John&#x27;</span>,</span><br><span class="line">    <span class="attr">surname</span>: <span class="string">&#x27;Doe&#x27;</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="title function_">printUser</span> = (<span class="params">property</span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">let</span> value = user[property];</span><br><span class="line">    <span class="keyword">if</span> (!value) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">`The property [<span class="subst">$&#123;property&#125;</span>] does not exist`</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`The user <span class="subst">$&#123;property&#125;</span> is <span class="subst">$&#123;value&#125;</span>`</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">printUser</span>(<span class="string">&#x27;name&#x27;</span>); <span class="comment">// 输出: &#x27;The user name is John&#x27;</span></span><br><span class="line"><span class="title function_">printUser</span>(<span class="string">&#x27;email&#x27;</span>); <span class="comment">// 抛出错误: The property [email] does not exist</span></span><br></pre></td></tr></table></figure>
<h3 id="get"><a href="#get" class="headerlink" title="get"></a>get</h3><p>通过查看上面的代码，你会发现：将条件和异常移到其他地方，而printUser中仅关注显示用户信息的实际逻辑会更好。这是我们可以使用代理对象的地方，让我们更新一下这个例子。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> user = &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;John&#x27;</span>,</span><br><span class="line">    <span class="attr">surname</span>: <span class="string">&#x27;Doe&#x27;</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> proxy = <span class="keyword">new</span> <span class="title class_">Proxy</span>(user, &#123;</span><br><span class="line">    <span class="title function_">get</span>(<span class="params">target, property</span>) &#123;</span><br><span class="line">        <span class="keyword">let</span> value = target[property];</span><br><span class="line">        <span class="keyword">if</span> (!value) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">`The property [<span class="subst">$&#123;property&#125;</span>] does not exist`</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> value;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="title function_">printUser</span> = (<span class="params">property</span>) =&gt; &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`The user <span class="subst">$&#123;property&#125;</span> is <span class="subst">$&#123;proxy[property]&#125;</span>`</span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="title function_">printUser</span>(<span class="string">&#x27;name&#x27;</span>); <span class="comment">// 输出： &#x27;The user name is John&#x27;</span></span><br><span class="line"><span class="title function_">printUser</span>(<span class="string">&#x27;email&#x27;</span>); <span class="comment">// 抛出错误: The property [email] does not exist</span></span><br></pre></td></tr></table></figure>
<p>在上面的示例中，我们包装了 user 对象，并设置了一个 get 方法。 此方法充当拦截器，在返回值之前，会首先对属性值进行检查，如果不存在，则抛出异常。</p>
<p>输出与第一种情况相同，但此时 printUser 函数专注于逻辑，只处理消息。</p>
<h3 id="set"><a href="#set" class="headerlink" title="set"></a>set</h3><p>代理可能有用的另一个例子是属性值验证。在这种情况下，我们需要使用 set 方法，并在其中进行验证。例如，当我们需要确保目标类型时，这是一个非常有用的钩子。我们来看一下实际使用：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> user = <span class="keyword">new</span> <span class="title class_">Proxy</span>(&#123;&#125;, &#123;</span><br><span class="line">    <span class="title function_">set</span>(<span class="params">target, property, value</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (property === <span class="string">&#x27;name&#x27;</span> &amp;&amp; <span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">toString</span>.<span class="title function_">call</span>(value) !== <span class="string">&#x27;[object String]&#x27;</span>) &#123; <span class="comment">// 确保是 string 类型</span></span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">`The value for [<span class="subst">$&#123;property&#125;</span>] must be a string`</span>);</span><br><span class="line">        &#125;;</span><br><span class="line">        target[property] = value;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">user.<span class="property">name</span> = <span class="number">1</span>; <span class="comment">// 抛出错误: The value for [name] must be a string</span></span><br></pre></td></tr></table></figure>
<p>这些是相当简单的用例，以下场景，proxy均可以派上用场：</p>
<ul>
<li>格式化</li>
<li>价值和类型修正</li>
<li>数据绑定</li>
<li>调试</li>
<li>…<br>现在是时候创建一个更复杂的用例了。</li>
</ul>
<h3 id="具有代理的API-更复杂的示例"><a href="#具有代理的API-更复杂的示例" class="headerlink" title="具有代理的API - 更复杂的示例"></a>具有代理的API - 更复杂的示例</h3><p>通过使用简单用例中的知识，我们可以创建一个API包装器，以便在我们的应用程序中使用。 当前只支持 get 和 post 请求，但它可以很容易地扩展。代码如下所示。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> api = <span class="keyword">new</span> <span class="title class_">Proxy</span>(&#123;&#125;, &#123;</span><br><span class="line">    <span class="title function_">get</span>(<span class="params">target, key, context</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> target[key] || [<span class="string">&#x27;get&#x27;</span>, <span class="string">&#x27;post&#x27;</span>].<span class="title function_">reduce</span>(<span class="function">(<span class="params">acc, key</span>) =&gt;</span> &#123;</span><br><span class="line">            acc[key] = <span class="function">(<span class="params">config, data</span>) =&gt;</span> &#123;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (!config &amp;&amp; !config.<span class="property">url</span> || config.<span class="property">url</span> === <span class="string">&#x27;&#x27;</span>) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;Url cannot be empty.&#x27;</span>);</span><br><span class="line">                <span class="keyword">let</span> isPost = key === <span class="string">&#x27;post&#x27;</span>;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (isPost &amp;&amp; !data) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;Please provide data in JSON format when using POST request.&#x27;</span>);</span><br><span class="line"></span><br><span class="line">                config.<span class="property">headers</span> = isPost ? <span class="title class_">Object</span>.<span class="title function_">assign</span>(config.<span class="property">headers</span> || &#123;&#125;, &#123; <span class="string">&#x27;content-type&#x27;</span>: <span class="string">&#x27;application/json;chartset=utf8&#x27;</span> &#125;) :</span><br><span class="line">                    config.<span class="property">headers</span>;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">                    <span class="keyword">let</span> xhr = <span class="keyword">new</span> <span class="title class_">XMLHttpRequest</span>();</span><br><span class="line">                    xhr.<span class="title function_">open</span>(key, config.<span class="property">url</span>);</span><br><span class="line">                    <span class="keyword">if</span> (config.<span class="property">headers</span>) &#123;</span><br><span class="line">                        <span class="title class_">Object</span>.<span class="title function_">keys</span>(config.<span class="property">headers</span>).<span class="title function_">forEach</span>(<span class="function">(<span class="params">header</span>) =&gt;</span> &#123;</span><br><span class="line">                            xhr.<span class="title function_">setRequestHeader</span>(header, config.<span class="property">headers</span>[header]);</span><br><span class="line">                        &#125;);</span><br><span class="line">                    &#125;</span><br><span class="line">                    xhr.<span class="property">onload</span> = <span class="function">() =&gt;</span> (xhr.<span class="property">status</span> === <span class="number">200</span> ? resolve : reject)(xhr);</span><br><span class="line">                    xhr.<span class="property">onerror</span> = <span class="function">() =&gt;</span> <span class="title function_">reject</span>(xhr);</span><br><span class="line">                    xhr.<span class="title function_">send</span>(isPost ? <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(data) : <span class="literal">null</span>);</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;;</span><br><span class="line">            <span class="keyword">return</span> acc;</span><br><span class="line">        &#125;, target)[key];</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="title function_">set</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;API methods are readonly&#x27;</span>);</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="title function_">deleteProperty</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;API methods cannot be deleted!&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>让我们解释一下简单实现，set 和 deleteProperty。 我们添加了一个保护级别，并确保每当有人意外或无意地尝试为任何API属性设置新值时，都会抛出异常。</p>
<p>每次尝试删除属性时都会调用 deleteProperty 方法。可以确保没有人可以从我们的代理(即此处的 api)中删除任何属性，因为通常我们都不想丢失API方法。</p>
<p>get 在这里很有趣，它做了几件事。target 是一个空对象，get 方法将在第一次有人使用 api 时创建所有方法(如当前的 get 和 post请求)，在 reduce 回调中，我们根据提供的配置执行API规范所需的验证和检查。在此示例中，我们不允许空URL和发布请求而不提供数据。这些检查可以扩展和修改，但重要的是我们只能在这一个地方集中处理。</p>
<p>reduce 仅在第一次API调用时完成，之后都会跳过整个 reduce 进程，get 只会执行默认行为并返回属性值，即API处理程序。每个处理程序返回一个Promise对象，负责创建请求并调用服务。</p>
<p>使用：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">api.<span class="title function_">get</span>(&#123;</span><br><span class="line">    <span class="attr">url</span>: <span class="string">&#x27;my-url&#x27;</span></span><br><span class="line">&#125;).<span class="title function_">then</span>(<span class="function">(<span class="params">xhr</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">alert</span>(<span class="string">&#x27;Success&#x27;</span>);</span><br><span class="line">&#125;, <span class="function">(<span class="params">xhr</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">alert</span>(<span class="string">&#x27;Fail&#x27;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">delete api.get; //throw new Error(&#x27;API methods cannot be deleted!&#x27;); </span><br></pre></td></tr></table></figure>
<p>结论</p>
<p>当您需要对数据进行更多控制时，代理可以派上用场。你可以根据受控规则扩展或拒绝对原始数据的访问，从而监视对象并确保正确行为。</p>
]]></content>
      <categories>
        <category>前端</category>
      </categories>
      <tags>
        <tag>JavaScript</tag>
      </tags>
  </entry>
  <entry>
    <title>JS数字精度丢失的问题</title>
    <url>/test/post/JS%E6%95%B0%E5%AD%97%E7%B2%BE%E5%BA%A6%E4%B8%A2%E5%A4%B1%E7%9A%84%E9%97%AE%E9%A2%98/</url>
    <content><![CDATA[<h2 id="一、场景复现"><a href="#一、场景复现" class="headerlink" title="一、场景复现"></a>一、场景复现</h2><p>一个经典的面试题</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="number">0.1</span> + <span class="number">0.2</span> === <span class="number">0.3</span> <span class="comment">// false</span></span><br></pre></td></tr></table></figure>

<p>为什么是false呢?</p>
<p>先看下面这个比喻</p>
<p>比如一个数 1÷3&#x3D;0.33333333……</p>
<p>3会一直无限循环，数学可以表示，但是计算机要存储，方便下次取出来再使用，但0.333333…… 这个数无限循环，再大的内存它也存不下，所以不能存储一个相对于数学来说的值，只能存储一个近似值，当计算机存储后再取出时就会出现精度丢失问题</p>
<h2 id="二、浮点数"><a href="#二、浮点数" class="headerlink" title="二、浮点数"></a>二、浮点数</h2><p>“浮点数”是一种表示数字的标准，整数也可以用浮点数的格式来存储</p>
<p>我们也可以理解成，浮点数就是小数</p>
<p>在JavaScript中，现在主流的数值类型是Number，而Number采用的是IEEE754规范中64位双精度浮点数编码</p>
<p>这样的存储结构优点是可以归一化处理整数和小数，节省存储空间</p>
<p>对于一个整数，可以很轻易转化成十进制或者二进制。但是对于一个浮点数来说，因为小数点的存在，小数点的位置不是固定的。解决思路就是使用科学计数法，这样小数点位置就固定了</p>
<p>而计算机只能用二进制（0或1）表示，二进制转换为科学记数法的公式如下：</p>
<p>其中，a的值为0或者1，e为小数点移动的位置</p>
<p>举个例子：</p>
<p>27.0转化成二进制为11011.0 ，科学计数法表示为：</p>
<p><img src="https://camo.githubusercontent.com/12f207d2ee94ded7dfaaf7e7ca89966aae123735bbe544e411f7df3e63b0b1f8/68747470733a2f2f7374617469632e7675652d6a732e636f6d2f31623462313632302d383666342d313165622d616239302d6439616538313462323430642e706e67" alt="Alt text"></p>
<p>其中，a的值为0或者1，e为小数点移动的位置</p>
<p>举个例子：</p>
<p>27.0转化成二进制为11011.0 ，科学计数法表示为：</p>
<p><img src="https://camo.githubusercontent.com/c8ece8a9c352fe775bd4152606a148caf8b4de664e4fbc0d3d046bf492db8647/68747470733a2f2f7374617469632e7675652d6a732e636f6d2f33373030373039302d383666342d313165622d616239302d6439616538313462323430642e706e67" alt="Alt text"></p>
<p>前面讲到，javaScript存储方式是双精度浮点数，其长度为8个字节，即64位比特</p>
<p>64位比特又可分为三个部分：</p>
<p>符号位S：第 1 位是正负数符号位（sign），0代表正数，1代表负数<br>指数位E：中间的 11 位存储指数（exponent），用来表示次方数，可以为正负数。在双精度浮点数中，指数的固定偏移量为1023<br>尾数位M：最后的 52 位是尾数（mantissa），超出的部分自动进一舍零<br>如下图所示：</p>
<p><img src="https://camo.githubusercontent.com/f19ec5ac0b29d0362429db14f835d79fef3fb569bd0e9cae6e57229aa8e3ba5c/68747470733a2f2f7374617469632e7675652d6a732e636f6d2f34333064303130302d383666342d313165622d383566362d3666616337376330633962332e706e67" alt="Alt text"></p>
<p>举个例子：</p>
<p>27.5 转换为二进制11011.1</p>
<p>11011.1转换为科学记数法 [公式]</p>
<p>符号位为1(正数)，指数位为4+，1023+4，即1027</p>
<p>因为它是十进制的需要转换为二进制，即 10000000011，小数部分为10111，补够52位即： 1011 1000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000&#96;</p>
<p>所以27.5存储为计算机的二进制标准形式（符号位+指数位+小数部分 (阶数)），既下面所示</p>
<p>0+10000000011+011 1000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000&#96;</p>
<h2 id="二、问题分析"><a href="#二、问题分析" class="headerlink" title="二、问题分析"></a>二、问题分析</h2><p>再回到问题上</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="number">0.1</span> + <span class="number">0.2</span> === <span class="number">0.3</span> <span class="comment">// false</span></span><br></pre></td></tr></table></figure>

<p>通过上面的学习，我们知道，在javascript语言中，0.1 和 0.2 都转化成二进制后再进行运算</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">// 0.1 和 0.2 都转化成二进制后再进行运算</span><br><span class="line">0.00011001100110011001100110011001100110011001100110011010 +</span><br><span class="line">0.0011001100110011001100110011001100110011001100110011010 =</span><br><span class="line">0.0100110011001100110011001100110011001100110011001100111</span><br><span class="line"></span><br><span class="line">// 转成十进制正好是 0.30000000000000004</span><br></pre></td></tr></table></figure>
<p>所以输出false</p>
<p>再来一个问题，那么为什么x&#x3D;0.1得到0.1？</p>
<p>主要是存储二进制时小数点的偏移量最大为52位，最多可以表达的位数是2^53&#x3D;9007199254740992，对应科学计数尾数是 9.007199254740992，这也是 JS 最多能表示的精度</p>
<p>它的长度是 16，所以可以使用 toPrecision(16) 来做精度运算，超过的精度会自动做凑整处理</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">.10000000000000000555.toPrecision(16)</span><br><span class="line">// 返回 0.1000000000000000，去掉末尾的零后正好为 0.1</span><br></pre></td></tr></table></figure>
<p>但看到的 0.1 实际上并不是 0.1。不信你可用更高的精度试试：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">0.1.toPrecision(21) = 0.100000000000000005551</span><br></pre></td></tr></table></figure>
<p>如果整数大于 9007199254740992 会出现什么情况呢？</p>
<p>由于指数位最大值是1023，所以最大可以表示的整数是 2^1024 - 1，这就是能表示的最大整数。但你并不能这样计算这个数字，因为从 2^1024 开始就变成了 Infinity</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&gt; Math.pow(2, 1023)</span><br><span class="line">8.98846567431158e+307</span><br><span class="line"></span><br><span class="line">&gt; Math.pow(2, 1024)</span><br><span class="line">Infinity</span><br></pre></td></tr></table></figure>
<p>那么对于 (2^53, 2^63) 之间的数会出现什么情况呢？</p>
<ul>
<li>(2^53, 2^54) 之间的数会两个选一个，只能精确表示偶数</li>
<li>(2^54, 2^55) 之间的数会四个选一个，只能精确表示4个倍数</li>
<li>… 依次跳过更多2的倍数</li>
</ul>
<p>要想解决大数的问题你可以引用第三方库 bignumber.js，原理是把所有数字当作字符串，重新实现了计算逻辑，缺点是性能比原生差很多</p>
<h3 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h3><p>计算机存储双精度浮点数需要先把十进制数转换为二进制的科学记数法的形式，然后计算机以自己的规则{符号位+(指数位+指数偏移量的二进制)+小数部分}存储二进制的科学记数法</p>
<p>因为存储时有位数限制（64位），并且某些十进制的浮点数在转换为二进制数时会出现无限循环，会造成二进制的舍入操作(0舍1入)，当再转换为十进制时就造成了计算误差</p>
<h2 id="三、解决方案"><a href="#三、解决方案" class="headerlink" title="三、解决方案"></a>三、解决方案</h2><p>理论上用有限的空间来存储无限的小数是不可能保证精确的，但我们可以处理一下得到我们期望的结果</p>
<p>当你拿到 1.4000000000000001 这样的数据要展示时，建议使用 toPrecision 凑整并 parseFloat 转成数字后再显示，如下：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">parseFloat(1.4000000000000001.toPrecision(12)) === 1.4  // True</span><br></pre></td></tr></table></figure>
<p>封装成方法就是：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">function strip(num, precision = 12) &#123;</span><br><span class="line">  return +parseFloat(num.toPrecision(precision));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>对于运算类操作，如 +-*&#x2F;，就不能使用 toPrecision 了。正确的做法是把小数转成整数后再运算。以加法为例：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">/**</span><br><span class="line"> * 精确加法</span><br><span class="line"> */</span><br><span class="line">function add(num1, num2) &#123;</span><br><span class="line">  const num1Digits = (num1.toString().split(&#x27;.&#x27;)[1] || &#x27;&#x27;).length;</span><br><span class="line">  const num2Digits = (num2.toString().split(&#x27;.&#x27;)[1] || &#x27;&#x27;).length;</span><br><span class="line">  const baseNum = Math.pow(10, Math.max(num1Digits, num2Digits));</span><br><span class="line">  return (num1 * baseNum + num2 * baseNum) / baseNum;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>最后还可以使用第三方库，如Math.js、BigDecimal.js</p>
<h2 id="参考文献"><a href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h2><ul>
<li><a href="https://zhuanlan.zhihu.com/p/100353781">https://zhuanlan.zhihu.com/p/100353781</a></li>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/BigInt">https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/BigInt</a></li>
</ul>
]]></content>
      <categories>
        <category>前端</category>
      </categories>
      <tags>
        <tag>JavaScript</tag>
      </tags>
  </entry>
  <entry>
    <title>JS异步编程</title>
    <url>/test/post/JS%E5%BC%82%E6%AD%A5%E7%BC%96%E7%A8%8B/</url>
    <content><![CDATA[<h2 id="JS异步发展历程"><a href="#JS异步发展历程" class="headerlink" title="JS异步发展历程"></a>JS异步发展历程</h2><p>知其然知其所以然，首先了解三个概念：</p>
<p><strong>1.什么是同步？</strong></p>
<p>所谓同步，就是在发出一个”调用”时，在没有得到结果之前，该“调用”就不返回。但是一旦调用返回，就得到返回值了。换句话说，就是由“调用者”主动等待这个“调用”的结果。此调用执行完之前，阻塞之后的代码执行。</p>
<p><strong>2.什么是异步？</strong></p>
<p>“调用”在发出之后，这个调用就直接返回了，所以没有返回结果。换句话说，当一个异步过程调用发出后，调用者不会立刻得到结果。而是在”调用”发出后，”被调用者”通过状态、通知来通知调用者，或通过回调函数处理这个调用。异步调用发出后，不影响后面代码的执行。</p>
<p><strong>3.JavaScript 中为什么需要异步？</strong></p>
<p>首先我们知道JavaScript是单线程的(即使新增了webworker，但是本质上JS还是单线程)。同步代码意味着什么呢？意味着有可能会阻塞，当我们有一个任务需要时间较长时，如果使用同步方式，那么就会阻塞之后的代码执行。而异步则不会，我们不会等待异步代码的之后，继续执行异步任务之后的代码。</p>
<p>概念了解完了，我们就要进入今天的正题了。首先大家思考一下：平时在工作中，主要使用了哪些异步解决方案，这些异步方案有什么优缺点？</p>
<p>异步最早的解决方案是回调函数，如事件的回调，setInterval&#x2F;setTimeout中的回调。但是回调函数有一个很常见的问题，就是回调地狱的问题(稍后会举例说明);</p>
<p>为了解决回调地狱的问题，社区提出了Promise解决方案，ES6将其写进了语言标准。Promise一定程度上解决了回调地狱的问题，但是Promise也存在一些问题，如错误不能被try catch，而且使用Promise的链式调用，其实并没有从根本上解决回调地狱的问题，只是换了一种写法。</p>
<p>ES6中引入 Generator 函数，Generator是一种异步编程解决方案，Generator 函数是协程在 ES6 的实现，最大特点就是可以交出函数的执行权，Generator 函数可以看出是异步任务的容器，需要暂停的地方，都用yield语句注明。但是 Generator 使用起来较为复杂。</p>
<p>ES7又提出了新的异步解决方案:async&#x2F;await，async是 Generator 函数的语法糖，async&#x2F;await 使得异步代码看起来像同步代码，异步编程发展的目标就是让异步逻辑的代码看起来像同步一样。</p>
<div class="tabs" id="test1"><ul class="nav-tabs no-default"></ul><div class="tab-contents"></div><div class="tab-to-top"><button type="button" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div>

<h4 id="1-callback"><a href="#1-callback" class="headerlink" title="1.callback"></a>1.callback</h4><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">//node读取文件</span></span><br><span class="line">fs.<span class="title function_">readFile</span>(xxx, <span class="string">&#x27;utf-8&#x27;</span>, <span class="keyword">function</span>(<span class="params">err, data</span>) &#123;</span><br><span class="line">    <span class="comment">//code</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>回调函数的使用场景(包括但不限于):</p>
<ul>
<li>事件回调</li>
<li>Node API</li>
<li>setTimeout&#x2F;setInterval中的回调函数</li>
<li>ajax 请求</li>
</ul>
<p>回调函数的优点: 简单。</p>
<p>回调函数的缺点：</p>
<p>异步回调嵌套会导致代码难以维护，并且不方便统一处理错误，不能 try catch 和 回调地狱(如先读取A文本内容，再根据A文本内容读取B再根据B的内容读取C…)。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">fs.<span class="title function_">readFile</span>(A, <span class="string">&#x27;utf-8&#x27;</span>, <span class="keyword">function</span>(<span class="params">err, data</span>) &#123;</span><br><span class="line">    fs.<span class="title function_">readFile</span>(B, <span class="string">&#x27;utf-8&#x27;</span>, <span class="keyword">function</span>(<span class="params">err, data</span>) &#123;</span><br><span class="line">        fs.<span class="title function_">readFile</span>(C, <span class="string">&#x27;utf-8&#x27;</span>, <span class="keyword">function</span>(<span class="params">err, data</span>) &#123;</span><br><span class="line">            fs.<span class="title function_">readFile</span>(D, <span class="string">&#x27;utf-8&#x27;</span>, <span class="keyword">function</span>(<span class="params">err, data</span>) &#123;</span><br><span class="line">                <span class="comment">//....</span></span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h3 id="2-Promise"><a href="#2-Promise" class="headerlink" title="2.Promise"></a>2.Promise</h3><p>Promise 一定程度上解决了回调地狱的问题，Promise 最早由社区提出和实现，ES6 将其写进了语言标准，统一了用法，原生提供了Promise对象。</p>
<p>那么我们看看Promise是如何解决回调地狱问题的，仍然以上文的readFile 为例(先读取A文本内容，再根据A文本内容读取B再根据B的内容读取C)。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">read</span>(<span class="params">url</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">        fs.<span class="title function_">readFile</span>(url, <span class="string">&#x27;utf8&#x27;</span>, <span class="function">(<span class="params">err, data</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">if</span>(err) <span class="title function_">reject</span>(err);</span><br><span class="line">            <span class="title function_">resolve</span>(data);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">read</span>(A).<span class="title function_">then</span>(<span class="function"><span class="params">data</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">read</span>(B);</span><br><span class="line">&#125;).<span class="title function_">then</span>(<span class="function"><span class="params">data</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">read</span>(C);</span><br><span class="line">&#125;).<span class="title function_">then</span>(<span class="function"><span class="params">data</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">read</span>(D);</span><br><span class="line">&#125;).<span class="title function_">catch</span>(<span class="function"><span class="params">reason</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(reason);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>Promise 的优点:</p>
<ul>
<li>一旦状态改变，就不会再变，任何时候都可以得到这个结果</li>
<li>可以将异步操作以同步操作的流程表达出来，避免了层层嵌套的回调函数</li>
</ul>
<p>缺点:</p>
<ul>
<li>无法取消 Promise</li>
<li>当处于pending状态时，无法得知目前进展到哪一个阶段</li>
<li>错误不能被 try catch<br>假设有这样一个需求：读取A,B,C三个文件内容，都读取成功后，再输出最终的结果。在Promise之前，我们一般可以借助发布订阅模式去实现:</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> pubsub = &#123;</span><br><span class="line">    <span class="attr">arry</span>: [],</span><br><span class="line">    <span class="title function_">emit</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">arry</span>.<span class="title function_">forEach</span>(<span class="function"><span class="params">fn</span> =&gt;</span> <span class="title function_">fn</span>());</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="title function_">on</span>(<span class="params">fn</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">arry</span>.<span class="title function_">push</span>(fn);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> data = [];</span><br><span class="line">pubsub.<span class="title function_">on</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span>(data.<span class="property">length</span> === <span class="number">3</span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(data);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line">fs.<span class="title function_">readFile</span>(A, <span class="string">&#x27;utf-8&#x27;</span>, <span class="function">(<span class="params">err, value</span>) =&gt;</span> &#123;</span><br><span class="line">    data.<span class="title function_">push</span>(value);</span><br><span class="line">    pubsub.<span class="title function_">emit</span>();</span><br><span class="line">&#125;);</span><br><span class="line">fs.<span class="title function_">readFile</span>(B, <span class="string">&#x27;utf-8&#x27;</span>, <span class="function">(<span class="params">err, value</span>) =&gt;</span> &#123;</span><br><span class="line">    data.<span class="title function_">push</span>(value);</span><br><span class="line">    pubsub.<span class="title function_">emit</span>();</span><br><span class="line">&#125;);</span><br><span class="line">fs.<span class="title function_">readFile</span>(C, <span class="string">&#x27;utf-8&#x27;</span>, <span class="function">(<span class="params">err, value</span>) =&gt;</span> &#123;</span><br><span class="line">    data.<span class="title function_">push</span>(value);</span><br><span class="line">    pubsub.<span class="title function_">emit</span>();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>Promise给我们提供了 Promise.all 的方法，对于这个需求，我们可以使用 Promise.all 来实现。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 将 fs.readFile 包装成promise接口</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">read</span>(<span class="params">url</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">        fs.<span class="title function_">readFile</span>(url, <span class="string">&#x27;utf8&#x27;</span>, <span class="function">(<span class="params">err, data</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">if</span>(err) <span class="title function_">reject</span>(err);</span><br><span class="line">            <span class="title function_">resolve</span>(data);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 使用 Promise</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * 通过 Promise.all 可以实现多个异步并行执行，同一时刻获取最终结果的问题</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="title class_">Promise</span>.<span class="title function_">all</span>([</span><br><span class="line">    <span class="title function_">read</span>(A),</span><br><span class="line">    <span class="title function_">read</span>(B),</span><br><span class="line">    <span class="title function_">read</span>(C)</span><br><span class="line">]).<span class="title function_">then</span>(<span class="function"><span class="params">data</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(data);</span><br><span class="line">&#125;).<span class="title function_">catch</span>(<span class="function"><span class="params">err</span> =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(err));</span><br></pre></td></tr></table></figure>
<h3 id="3-Generator"><a href="#3-Generator" class="headerlink" title="3.Generator"></a>3.Generator</h3><p>Generator 函数是 ES6 提供的一种异步编程解决方案，整个 Generator 函数就是一个封装的异步任务，或者说是异步任务的容器。异步操作需要暂停的地方，都用 yield 语句注明。</p>
<p>Generator 函数一般配合 yield 或 Promise 使用。Generator函数返回的是迭代器。对生成器和迭代器不了解的同学，请自行补习下基础。下面我们看一下 Generator 的简单使用:</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span>* <span class="title function_">gen</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> a = <span class="keyword">yield</span> <span class="number">111</span>;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(a);</span><br><span class="line">    <span class="keyword">let</span> b = <span class="keyword">yield</span> <span class="number">222</span>;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(b);</span><br><span class="line">    <span class="keyword">let</span> c = <span class="keyword">yield</span> <span class="number">333</span>;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(c);</span><br><span class="line">    <span class="keyword">let</span> d = <span class="keyword">yield</span> <span class="number">444</span>;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(d);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> t = <span class="title function_">gen</span>();</span><br><span class="line"><span class="comment">//next方法可以带一个参数，该参数就会被当作上一个yield表达式的返回值</span></span><br><span class="line">t.<span class="title function_">next</span>(<span class="number">1</span>); <span class="comment">//第一次调用next函数时，传递的参数无效</span></span><br><span class="line">t.<span class="title function_">next</span>(<span class="number">2</span>); <span class="comment">//a输出2;</span></span><br><span class="line">t.<span class="title function_">next</span>(<span class="number">3</span>); <span class="comment">//b输出3; </span></span><br><span class="line">t.<span class="title function_">next</span>(<span class="number">4</span>); <span class="comment">//c输出4;</span></span><br><span class="line">t.<span class="title function_">next</span>(<span class="number">5</span>); <span class="comment">//d输出5;</span></span><br></pre></td></tr></table></figure>
<p>为了让大家更好的理解上面代码是如何执行的，我画了一张图，分别对应每一次的next方法调用:</p>
<p>仍然以上文的 readFile (先读取A文本内容，再根据A文本内容读取B再根据B的内容读取C)为例，使用 Generator + co库来实现:</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> co = <span class="built_in">require</span>(<span class="string">&#x27;co&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> bluebird = <span class="built_in">require</span>(<span class="string">&#x27;bluebird&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> readFile = bluebird.<span class="title function_">promisify</span>(fs.<span class="property">readFile</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span>* <span class="title function_">read</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">yield</span> <span class="title function_">readFile</span>(A, <span class="string">&#x27;utf-8&#x27;</span>);</span><br><span class="line">    <span class="keyword">yield</span> <span class="title function_">readFile</span>(B, <span class="string">&#x27;utf-8&#x27;</span>);</span><br><span class="line">    <span class="keyword">yield</span> <span class="title function_">readFile</span>(C, <span class="string">&#x27;utf-8&#x27;</span>);</span><br><span class="line">    <span class="comment">//....</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">co</span>(<span class="title function_">read</span>()).<span class="title function_">then</span>(<span class="function"><span class="params">data</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">//code</span></span><br><span class="line">&#125;).<span class="title function_">catch</span>(<span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">//code</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>Generator的缺点大约不用我说了，除非是找虐，不然一般不会直接使用 Generator 来解决异步的(当然也不排除是因为我不熟练)~~</p>
<h3 id="4-async-await"><a href="#4-async-await" class="headerlink" title="4.async&#x2F;await"></a>4.async&#x2F;await</h3><p>ES7中引入了 async&#x2F;await 概念。async 其实是一个语法糖，它的实现就是将 Generator函数和自动执行器（co），包装在一个函数中。</p>
<p>async&#x2F;await 的优点是代码清晰，不用像 Promise 写很多 then 链，就可以处理回调地狱的问题。并且错误可以被try catch。</p>
<p>仍然以上文的readFile (先读取A文本内容，再根据A文本内容读取B再根据B的内容读取C) 为例，使用 async&#x2F;await 来实现:</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> bluebird = <span class="built_in">require</span>(<span class="string">&#x27;bluebird&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> readFile = bluebird.<span class="title function_">promisify</span>(fs.<span class="property">readFile</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">read</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">await</span> <span class="title function_">readFile</span>(A, <span class="string">&#x27;utf-8&#x27;</span>);</span><br><span class="line">    <span class="keyword">await</span> <span class="title function_">readFile</span>(B, <span class="string">&#x27;utf-8&#x27;</span>);</span><br><span class="line">    <span class="keyword">await</span> <span class="title function_">readFile</span>(C, <span class="string">&#x27;utf-8&#x27;</span>);</span><br><span class="line">    <span class="comment">//code</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">read</span>().<span class="title function_">then</span>(<span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">//code</span></span><br><span class="line">&#125;).<span class="title function_">catch</span>(<span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">//code</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>使用 async&#x2F;await 实现此需求：读取A,B,C三个文件内容，都读取成功后，再输出最终的结果。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">read</span>(<span class="params">url</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">        fs.<span class="title function_">readFile</span>(url, <span class="string">&#x27;utf8&#x27;</span>, <span class="function">(<span class="params">err, data</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">if</span>(err) <span class="title function_">reject</span>(err);</span><br><span class="line">            <span class="title function_">resolve</span>(data);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">readAsync</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> data = <span class="keyword">await</span> <span class="title class_">Promise</span>.<span class="title function_">all</span>([</span><br><span class="line">        <span class="title function_">read</span>(A),</span><br><span class="line">        <span class="title function_">read</span>(B),</span><br><span class="line">        <span class="title function_">read</span>(C)</span><br><span class="line">    ]);</span><br><span class="line">    <span class="keyword">return</span> data;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">readAsync</span>().<span class="title function_">then</span>(<span class="function"><span class="params">data</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(data);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>所以JS的异步发展史，可以认为是从 callback -&gt; promise -&gt; generator -&gt; async&#x2F;await。async&#x2F;await 使得异步代码看起来像同步代码，异步编程发展的目标就是让异步逻辑的代码看起来像同步一样。</p>
<p>因本人水平有限，文中内容未必百分百正确，如有不对的地方，请给我留言，谢谢。</p>
]]></content>
      <categories>
        <category>前端</category>
      </categories>
      <tags>
        <tag>JavaScript</tag>
      </tags>
  </entry>
  <entry>
    <title>Spring-SpringMVC-Mybatis整合</title>
    <url>/test/post/Spring-SpringMVC-Mybatis%E6%95%B4%E5%90%88/</url>
    <content><![CDATA[<h1 id="Maven-Spring-SpringMVC-Mybatis-整合"><a href="#Maven-Spring-SpringMVC-Mybatis-整合" class="headerlink" title="Maven + Spring + SpringMVC + Mybatis 整合"></a>Maven + Spring + SpringMVC + Mybatis 整合</h1><p>通过这篇文章你可以获取的内容：</p>
<ol>
<li>整个配置流程。</li>
<li>对于每一个配置项，Spring 到底帮我们做了什么？</li>
</ol>
<p>本文假设读者：</p>
<ol>
<li>未使用 IDEA 进行过 Web 项目开发</li>
<li>未使用过 Maven 进行项目构建</li>
<li>已学习过 Spring、SpringMVC、Mybatis</li>
</ol>
<p>环境搭建：</p>
<ul>
<li>IDE： <code>IntelliJ IDEA 2017.1.1（Ultimate)</code></li>
<li>Web Server: <code>Tomcat 8.0.43</code></li>
<li>Spring: <code>4.3.7.RELEASE</code></li>
<li>Mybatis: <code>3.4.4</code></li>
</ul>
<p>如果需要示例代码，可以参考 <a href="https://github.com/c-rainstorm/ssm-Demo">SSM-Demo</a>.</p>
<hr>
<!-- TOC -->

<ul>
<li><a href="#maven--spring--springmvc--mybatis-%E6%95%B4%E5%90%88">Maven + Spring + SpringMVC + Mybatis 整合</a><ul>
<li><a href="#spring--springmvc">Spring &amp;&amp; SpringMVC</a><ul>
<li><a href="#%E5%B7%A5%E7%A8%8B%E6%90%AD%E5%BB%BA">工程搭建</a><ul>
<li><a href="#%E6%96%B0%E5%BB%BA-web-application">新建 Web Application</a></li>
<li><a href="#%E6%B7%BB%E5%8A%A0-maven-%E6%94%AF%E6%8C%81">添加 Maven 支持</a></li>
<li><a href="#%E5%B7%A5%E7%A8%8B%E7%9B%AE%E5%BD%95%E7%AE%80%E4%BB%8B">工程目录简介</a></li>
</ul>
</li>
<li><a href="#%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0">代码实现</a><ul>
<li><a href="#view-%E5%B1%82">View 层</a></li>
<li><a href="#controller">Controller</a></li>
<li><a href="#service">Service</a></li>
</ul>
</li>
<li><a href="#%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E7%BC%96%E5%86%99">配置文件编写</a><ul>
<li><a href="#springxml"><code>Spring.xml</code></a></li>
<li><a href="#spring-mvcxml"><code>Spring-mvc.xml</code></a></li>
<li><a href="#webxml"><code>web.xml</code></a></li>
</ul>
</li>
<li><a href="#%E8%BF%90%E8%A1%8C%E6%B5%8B%E8%AF%95">运行测试</a></li>
</ul>
</li>
<li><a href="#spring--springmvc--mybatis">Spring &amp;&amp; SpringMVC &amp;&amp; Mybatis</a><ul>
<li><a href="#%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0-1">代码实现</a><ul>
<li><a href="#dao">Dao</a></li>
<li><a href="#service-1">service</a></li>
</ul>
</li>
<li><a href="#%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E7%BC%96%E5%86%99-1">配置文件编写</a><ul>
<li><a href="#userdaoxml"><code>UserDao.xml</code></a></li>
<li><a href="#springxml-1"><code>Spring.xml</code></a></li>
<li><a href="#pomxml">pom.xml</a></li>
</ul>
</li>
<li><a href="#%E8%BF%90%E8%A1%8C%E6%B5%8B%E8%AF%95-1">运行测试</a></li>
</ul>
</li>
<li><a href="#%E5%8F%82%E8%80%83">参考</a></li>
</ul>
</li>
</ul>
<!-- /TOC -->

<hr>
<h2 id="Spring-SpringMVC"><a href="#Spring-SpringMVC" class="headerlink" title="Spring &amp;&amp; SpringMVC"></a>Spring &amp;&amp; SpringMVC</h2><h3 id="工程搭建"><a href="#工程搭建" class="headerlink" title="工程搭建"></a>工程搭建</h3><h4 id="新建-Web-Application"><a href="#新建-Web-Application" class="headerlink" title="新建 Web Application"></a>新建 Web Application</h4><ol>
<li>File -&gt; new -&gt; project..</li>
<li>Java -&gt; Web Application<ul>
<li><img src="/test/../res/ssm-newProject.png"></li>
</ul>
</li>
</ol>
<h4 id="添加-Maven-支持"><a href="#添加-Maven-支持" class="headerlink" title="添加 Maven 支持"></a>添加 Maven 支持</h4><ol>
<li>右键工程名，点击 Add Framwork Support..<ul>
<li><img src="/test/../res/ssm-addFS.png"></li>
</ul>
</li>
<li>配置编译器源版本及目标字节码版本<ul>
<li>在 <code>pom.xml</code> 配置文件中添加以下配置。</li>
<li><strong>Tips：不添加的话目标字节码版本默认使用 <code>JDK1.5</code></strong> <figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">maven.compiler.source</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">maven.compiler.source</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">maven.compiler.target</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">maven.compiler.target</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ol>
<h4 id="工程目录简介"><a href="#工程目录简介" class="headerlink" title="工程目录简介"></a>工程目录简介</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">.</span><br><span class="line">|-- pom.xml                    // Maven 配置文件</span><br><span class="line">|-- src</span><br><span class="line">|   |-- main</span><br><span class="line">|   |   |-- java               // Java 代码存放位置</span><br><span class="line">|   |   `-- resources          // 配置文件存放位置</span><br><span class="line">|   `-- test</span><br><span class="line">|       `-- java               // 测试类存放位置</span><br><span class="line">`-- web                        // 存放 View 层用到的文件，会直接部署到服务器</span><br><span class="line">    |-- index.jsp</span><br><span class="line">    `-- WEB-INF</span><br><span class="line">        `-- web.xml            // Web 应用程序的 Web 组件的配置和部署信息</span><br></pre></td></tr></table></figure>


<h3 id="代码实现"><a href="#代码实现" class="headerlink" title="代码实现"></a>代码实现</h3><p>我们以一个最简单的用户登陆操作来说明配置的过程。</p>
<h4 id="View-层"><a href="#View-层" class="headerlink" title="View 层"></a>View 层</h4><ol>
<li>form 表单 <figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 1. 对应控制层 URL 为 /user/checkLogin --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 2. input 标签中的 class 属性在 JS 中进行元素定位需要用到 --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 3. input 标签中的 name 属性在控制层中提取表单数据时需要用到，即必须与控制层中对应方法的参数名或参数实体类中的域的名称一致，否则获取不到数据 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;$&#123;pageContext.request.contextPath&#125;/user/checkLogin&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span>&gt;</span></span><br><span class="line">    username: <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">class</span>=<span class="string">&quot;username&quot;</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;username...&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">    password: <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;password&quot;</span> <span class="attr">class</span>=<span class="string">&quot;password&quot;</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;password...&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;submit&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li>使用 JS 在传输之前进行加密 <figure class="highlight js"><table><tr><td class="code"><pre><span class="line">$(<span class="variable language_">document</span>).<span class="title function_">ready</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// 以为网络传输时使用明文，所以直接将密码提交到后台的方式很不安全，所以在传输之前就进行加密。</span></span><br><span class="line">    <span class="comment">// 在这里加密方法用的是 MD5 。你也可以选择其他的加密方式，加密用的 JS 库应该很容易着，</span></span><br><span class="line">    <span class="comment">// 这里我用的是 [JavaScript-MD5](https://github.com/blueimp/JavaScript-MD5)。</span></span><br><span class="line">    $(<span class="string">&quot;form&quot;</span>).<span class="title function_">on</span>(<span class="string">&quot;submit&quot;</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> pass = $(<span class="string">&quot;.password&quot;</span>);</span><br><span class="line">        pass.<span class="title function_">val</span>(<span class="title function_">md5</span>(pass.<span class="title function_">val</span>()));</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></li>
</ol>
<h4 id="Controller"><a href="#Controller" class="headerlink" title="Controller"></a>Controller</h4><ol>
<li><p>因为 Controller 需要用到 Spring 的注解，所以需要先添加 Maven 依赖，即将下面的配置写入 pom.xml 中，并 Import Change。</p>
 <figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">org.springframework.version</span>&gt;</span>4.3.7.RELEASE<span class="tag">&lt;/<span class="name">org.springframework.version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;org.springframework.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-beans<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;org.springframework.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-orm<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;org.springframework.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-context<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;org.springframework.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;org.springframework.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-webmvc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;org.springframework.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-aop<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;org.springframework.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.logging.log4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>log4j-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.8.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.logging.log4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>log4j-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.8.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li><p>Controller</p>
 <figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.github.crainstorm.oss.user.action;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/user&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserAction</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">Logger</span> <span class="variable">logger</span> <span class="operator">=</span> LogManager.getLogger(UserAction.class);</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserService service;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/checkLogin&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">checkLogin</span><span class="params">(User user)</span> &#123;</span><br><span class="line">        logger.trace(<span class="string">&quot;enter checkLogin...&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (logger.isDebugEnabled()) &#123;</span><br><span class="line">            logger.debug(user);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (service.loginSuccess(user)) &#123;</span><br><span class="line">            logger.info(<span class="string">&quot;login success...&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;redirect:/index.jsp&quot;</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            logger.info(<span class="string">&quot;login failed...&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;login/user&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>用到了 <code>log4j2</code>, 简单配置一下</p>
 <figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">Configuration</span> <span class="attr">status</span>=<span class="string">&quot;WARN&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Appenders</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Console</span> <span class="attr">name</span>=<span class="string">&quot;Console&quot;</span> <span class="attr">target</span>=<span class="string">&quot;SYSTEM_OUT&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">PatternLayout</span> <span class="attr">pattern</span>=<span class="string">&quot;%d [%t] %-5level %logger&#123;36&#125; - %msg%n&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">Console</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">Appenders</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Loggers</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 类寻找 Logger 时会根据包名一层一层向上找，如果没有找到，则默认使用 Root --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Root</span> <span class="attr">level</span>=<span class="string">&quot;trace&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">AppenderRef</span> <span class="attr">ref</span>=<span class="string">&quot;Console&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">Root</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">Loggers</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">Configuration</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
</ol>
<h4 id="Service"><a href="#Service" class="headerlink" title="Service"></a>Service</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.github.crainstorm.oss.user.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">loginSuccess</span><span class="params">(User user)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.github.crainstorm.oss.user.service;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Logger</span> <span class="variable">LOGGER</span> <span class="operator">=</span> LogManager.getLogger(UserServiceImpl.class);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 因为先配置 Spring + SpringMVC， 所以 dao 层先不管</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">loginSuccess</span><span class="params">(User user)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="配置文件编写"><a href="#配置文件编写" class="headerlink" title="配置文件编写"></a>配置文件编写</h3><p>配置文件编写前我们需要简单了解一下整个请求流程：</p>
<ul>
<li><img src="/test/../res/springmvc-flow.png"></li>
</ul>
<h4 id="Spring-xml"><a href="#Spring-xml" class="headerlink" title="Spring.xml"></a><code>Spring.xml</code></h4><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- context:annotation-config 配置可以使 Spring 帮我们加载几个常用的 BeanPostProcessor --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 1. AutowiredAnnotationBeanPostProcessor： 用于处理 @Autowired --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 2. CommonAnnotationBeanPostProcessor： 用于处理 @PostConstruct、@PreDestory、@Resource --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 3. PersistenceAnnotationBeanPostProcessor： 用于处理 @PersistenceUnit、@ PersistenceContext --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 4. RequiredAnnotationBeanPostProcessor： 用于处理 @Required --&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--&lt;context:annotation-config&gt;&lt;/context:annotation-config&gt;--&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 1. context:component-scan 隐含实现了 context:annotation-config 的功能， 所以使用了 context:component-scan 就不需要 context:annotation-config 了 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;com.github.crainstorm.oss&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 不扫描控制层组件，控制层组件的扫描放到 SpringMVC 配置文件中进行 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:exclude-filter</span> <span class="attr">type</span>=<span class="string">&quot;annotation&quot;</span></span></span><br><span class="line"><span class="tag">                                <span class="attr">expression</span>=<span class="string">&quot;org.springframework.stereotype.Controller&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:exclude-filter</span> <span class="attr">type</span>=<span class="string">&quot;annotation&quot;</span></span></span><br><span class="line"><span class="tag">                                <span class="attr">expression</span>=<span class="string">&quot;org.springframework.web.bind.annotation.ControllerAdvice&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">context:component-scan</span>&gt;</span></span><br></pre></td></tr></table></figure>


<h4 id="Spring-mvc-xml"><a href="#Spring-mvc-xml" class="headerlink" title="Spring-mvc.xml"></a><code>Spring-mvc.xml</code></h4><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 该注解帮我们注册了 DefaultServletHttpRequestHandler，用来处理静态资源。--&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 我们一般配置 DispatcherServlet 的 url-pattern 为 &#x27;/&#x27; --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 这种方法只能映射到我们编写的 Controller，如果直接请求 JSP 文件的话会直接返回 404 --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 加上该注解后，JSP 这种静态文件可以交给 DefaultServletHttpRequestHandler 来处理，就可以正常返回了--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mvc:default-servlet-handler</span>&gt;</span><span class="tag">&lt;/<span class="name">mvc:default-servlet-handler</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- mvc:annotation-driven 配置使 Spring 加载了多个类，这里只举出几个： --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 1. @RequestMapping： RequestMappingHandlerMapping(用来注册 Mapping)、RequestMappingHandlerAdapter(根据 Mapping 调用相应的 Controller) --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 2. @ExceptionHandler： ExceptionHandlerExceptionResolver --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 2. HttpMessageConverter: 转换器，用来提取 Request 中的参数(@RequestBody)，和将返回值转换成相应的格式(JSON 等)写入 Response 中(@ResponseBody)--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mvc:annotation-driven</span>&gt;</span><span class="tag">&lt;/<span class="name">mvc:annotation-driven</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 组件扫描，只扫描 Controller--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;com.github.crainstorm.oss&quot;</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">context:include-filter</span> <span class="attr">type</span>=<span class="string">&quot;annotation&quot;</span></span></span><br><span class="line"><span class="tag">                                <span class="attr">expression</span>=<span class="string">&quot;org.springframework.stereotype.Controller&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">context:include-filter</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">context:include-filter</span> <span class="attr">type</span>=<span class="string">&quot;annotation&quot;</span></span></span><br><span class="line"><span class="tag">                                <span class="attr">expression</span>=<span class="string">&quot;org.springframework.web.bind.annotation.ControllerAdvice&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">context:include-filter</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">context:component-scan</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 注册 ViewResolver, mvc:annotation-driven 其实已经注册过一个默认的了，该定义会覆盖原来的定义 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;viewResolver&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.web.servlet.view.InternalResourceViewResolver&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;prefix&quot;</span> <span class="attr">value</span>=<span class="string">&quot;/views/&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;suffix&quot;</span> <span class="attr">value</span>=<span class="string">&quot;.jsp&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="web-xml"><a href="#web-xml" class="headerlink" title="web.xml"></a><code>web.xml</code></h4><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">    作用：基于 &quot;contextClass&quot; and &quot;contextConfigLocation&quot; servlet context-params 初始化 root application context</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    ContextLoaderListener 是 ContextLoader 的子类，实际的初始化工作由 ContextLoader 来做。</span></span><br><span class="line"><span class="comment">    1. ContextLoader 先在 web.xml 查找一个叫 contextClass 的 context-params, 如果找到了就创建一个该类型的 ApplicationContext，如果找不到就创建一个 XmlWebApplicationContext。我们通常都没有配置该参数，所以用的都是默认的这种.</span></span><br><span class="line"><span class="comment">    2. 从 web.xml 中查找一个叫 contextConfigLocation 的 context-param。如果找到了就将该值传递给之前创建的 XmlWebApplicationContext 实例，如果没有找到，就使用 XmlWebApplicationContext 默认的路径 `/WEB-INF/applicationContext.xml`</span></span><br><span class="line"><span class="comment">    3. 解析 contextConfigLocation 配置文件，加载 BeanBefinition</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">listener</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">listener-class</span>&gt;</span>org.springframework.web.context.ContextLoaderListener<span class="tag">&lt;/<span class="name">listener-class</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">listener</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 指定配置文件位置 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">context-param</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextConfigLocation<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>classpath:spring.xml<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">context-param</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 字符编码过滤器 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">filter</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>CharacterEncodingFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-class</span>&gt;</span>org.springframework.web.filter.CharacterEncodingFilter<span class="tag">&lt;/<span class="name">filter-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>encoding<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>CharacterEncodingFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 注册 DispatcherServlet --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>DispatcherServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>org.springframework.web.servlet.DispatcherServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 初始化该 Servlet 时会创建一个 XmlWebApplicationContext, 该参数指定了对应的配置文件所在位置 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextConfigLocation<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>classpath:spring-mvc.xml<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 启动时加载，小于 0 则忽略该配置 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">load-on-startup</span>&gt;</span>1<span class="tag">&lt;/<span class="name">load-on-startup</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 该 Servlet 拦截所有请求 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>DispatcherServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>Tomcat 运行时逻辑模型：<ul>
<li><img src="/test/../res/ssm-tomcatRuntimeModel.png"></li>
</ul>
<ol>
<li>Tomcat 容器中一个 Context 为一个工程，一个 wrapper 封装一个 Servlet。注意这里的 Context 跟 Spring 中的 ApplicationContext 没有关系，它代表的是一个容器，实现类是 <code>org.apache.catalina.core.StandardContext</code></li>
<li>Tomcat 容器中的 Context 与 Spring 中的 ApplicationContext 的关系如下图(不是类图)：<ul>
<li><img src="/test/../res/ssm-contextInTomcatAndSpring.png"></li>
</ul>
</li>
</ol>
</li>
</ul>
<h3 id="运行测试"><a href="#运行测试" class="headerlink" title="运行测试"></a>运行测试</h3><ol>
<li>因为 IDEA 不会自动帮我们部署 Maven 库，所以我们需要将这些库添加到 &#x2F;WEB-INF&#x2F;lib&#x2F; 下：<ol>
<li>右键工程，点击 Open Module Settings，点击左侧的 Artifacts</li>
<li>我们可以看到的是 Output Layout，左侧是 WEB-INF，右侧是添加的 Maven 依赖，全选右侧 Maven，右键并点击 put into &#x2F;WEB-INF&#x2F;lib</li>
<li>这样在启动服务器时依赖库就可以自动部署到服务器了，需要注意的是<strong>每增加一些 Maven 依赖，在启动服务器前都需要将这些依赖添加到 &#x2F;WEB-INF&#x2F;lib</strong></li>
</ol>
</li>
<li>配置 Tomcat 服务器<ol>
<li>File -&gt; settings -&gt; Build,Execution,Deployment -&gt; Application Servers ,添加一个 Tomcat 服务器</li>
<li>Run -&gt; Edit Configurations 添加一个 Tomcat Server(Local)</li>
<li>Application server 选择刚配置的 Tomcat 服务器</li>
<li>Deployment 添加 Artifacts，右侧的 Application context 指的是如何访问该工程，比如 如果填了 <code>/oss</code>， 那么可以通过 <code>http://localhost:8080/oss</code> 来访问首页，如果这个地方做了修改 Server 下的默认连接也需要作相应修改，否则是无法访问的。</li>
<li>也可以修改一下配置的命名，默认是 Unnamed。</li>
</ol>
</li>
<li>使用 log4j2 来输出 Spring 的日志，这样万一出了什么问题的话就能很快的定位问题位置<ol>
<li>配置 Logger <figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">logger</span> <span class="attr">name</span>=<span class="string">&quot;org.springframework&quot;</span> <span class="attr">level</span>=<span class="string">&quot;debug&quot;</span> <span class="attr">additivity</span>=<span class="string">&quot;false&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">AppenderRef</span> <span class="attr">ref</span>=<span class="string">&quot;Console&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">logger</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li>导入适配器依赖 <figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.logging.log4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>log4j-jcl<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
</ol>
</li>
<li>测试结果<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">2017-04-23 10:23:09,422 [http-nio-8080-exec-11] TRACE com.github.crainstorm.oss.user.action.UserAction - enter checkLogin...</span><br><span class="line">2017-04-23 10:23:09,422 [http-nio-8080-exec-11] DEBUG com.github.crainstorm.oss.user.action.UserAction - User&#123;username=&#x27;17839918876&#x27;, password=&#x27;f217305153bc4761daaf98b3e5bb41c7&#x27;, nickname=&#x27;17839918876&#x27;, phone=&#x27;null&#x27;, birthday=null&#125;</span><br><span class="line">2017-04-23 10:23:09,422 [http-nio-8080-exec-11] INFO  com.github.crainstorm.oss.user.action.UserAction - login success...</span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="Spring-SpringMVC-Mybatis"><a href="#Spring-SpringMVC-Mybatis" class="headerlink" title="Spring &amp;&amp; SpringMVC &amp;&amp; Mybatis"></a>Spring &amp;&amp; SpringMVC &amp;&amp; Mybatis</h2><h3 id="代码实现-1"><a href="#代码实现-1" class="headerlink" title="代码实现"></a>代码实现</h3><h4 id="Dao"><a href="#Dao" class="headerlink" title="Dao"></a>Dao</h4><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> <span class="keyword">user</span></span><br><span class="line">(</span><br><span class="line">   user_id              <span class="type">int</span> <span class="keyword">not</span> <span class="keyword">null</span> AUTO_INCREMENT,</span><br><span class="line">   username             <span class="type">varchar</span>(<span class="number">25</span>) <span class="keyword">not</span> <span class="keyword">null</span> <span class="keyword">unique</span>,</span><br><span class="line">   password             <span class="type">varchar</span>(<span class="number">120</span>) <span class="keyword">not</span> <span class="keyword">null</span>,</span><br><span class="line">   nickname             <span class="type">varchar</span>(<span class="number">20</span>),</span><br><span class="line">   phone                <span class="type">char</span>(<span class="number">11</span>) <span class="keyword">unique</span> <span class="keyword">not</span> <span class="keyword">null</span>,</span><br><span class="line">   avatar               <span class="type">varchar</span>(<span class="number">50</span>) <span class="keyword">default</span> <span class="string">&#x27;/images/avatars/default.jpg&#x27;</span>,</span><br><span class="line">   sex                  <span class="type">varchar</span>(<span class="number">8</span>) <span class="keyword">default</span> <span class="string">&#x27;保密&#x27;</span>,</span><br><span class="line">   birthday             <span class="type">date</span>,</span><br><span class="line">   is_valid             bool <span class="keyword">not</span> <span class="keyword">null</span> <span class="keyword">default</span> <span class="literal">true</span>,</span><br><span class="line">   <span class="keyword">primary</span> key (user_id),</span><br><span class="line">   index (username),</span><br><span class="line">   <span class="keyword">check</span>(sex <span class="keyword">in</span>(<span class="string">&#x27;男&#x27;</span>,<span class="string">&#x27;女&#x27;</span>,<span class="string">&#x27;保密&#x27;</span>))</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.github.crainstorm.oss.user.dao;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Created by chen on 4/17/17.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Repository</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserDao</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="title function_">checkLogin</span><span class="params">(User user)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="service"><a href="#service" class="headerlink" title="service"></a>service</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Transactional</span>                               <span class="comment">// 事务</span></span><br><span class="line"><span class="meta">@EnableTransactionManagement</span>                 <span class="comment">// 重要！重要！重要！ 如果不加的话，部署到服务器上以后事务无法生效，即 JDBC 无法被 Spring 的事务管理器管理，执行过程中出现问题无法回滚</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Logger</span> <span class="variable">LOGGER</span> <span class="operator">=</span> LogManager.getLogger(UserServiceImpl.class);</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserDao dao;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Transactional(readOnly = true)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">loginSuccess</span><span class="params">(User user)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">num</span> <span class="operator">=</span> dao.checkLogin(user);</span><br><span class="line">        <span class="keyword">if</span> (LOGGER.isDebugEnabled()) &#123;</span><br><span class="line">            LOGGER.debug(<span class="string">&quot;selected &quot;</span> + num + <span class="string">&quot; records....&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> num &gt; <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="配置文件编写-1"><a href="#配置文件编写-1" class="headerlink" title="配置文件编写"></a>配置文件编写</h3><h4 id="UserDao-xml"><a href="#UserDao-xml" class="headerlink" title="UserDao.xml"></a><code>UserDao.xml</code></h4><ul>
<li>与 UserDao 放在同一目录下<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">mapper</span></span></span><br><span class="line"><span class="meta">        <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.github.crainstorm.oss.user.dao.UserDao&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;checkLogin&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;com.github.crainstorm.oss.user.entity.User&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;int&quot;</span>&gt;</span></span><br><span class="line">        SELECT COUNT(*)</span><br><span class="line">        FROM user</span><br><span class="line">        WHERE username = #&#123;username&#125; AND password = #&#123;password&#125;;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="Spring-xml-1"><a href="#Spring-xml-1" class="headerlink" title="Spring.xml"></a><code>Spring.xml</code></h4><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 导入 db 配置文件 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">context:property-placeholder</span> <span class="attr">location</span>=<span class="string">&quot;classpath:db.properties&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 配置数据源，使用的是 Druid 连接池 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.alibaba.druid.pool.DruidDataSource&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- mysql-connector 6.0 以后会自动配置驱动，之前常用的 com.mysql.jdbc.Driver 已经被弃用了 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--&lt;property name=&quot;driverClassName&quot; value=&quot;$&#123;jdbc_mysql_driver&#125;&quot;/&gt;--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc_mysql_url&#125;&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc_mysql_username&#125;&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc_mysql_password&#125;&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 配置 sqlSessionFactory --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;sqlSessionFactory&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.mybatis.spring.SqlSessionFactoryBean&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;dataSource&quot;</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--&lt;property name=&quot;configLocation&quot; value=&quot;classpath:mybatis.xml&quot;/&gt;--&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 配置 MapperScannerConfigurer， 配置文件都与 Dao 层接口在一块 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.mybatis.spring.mapper.MapperScannerConfigurer&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--须扫描的基本包以分号或逗号分割，扫描器无法处理通配符--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;basePackage&quot;</span> <span class="attr">value</span>=<span class="string">&quot;com.github.crainstorm.oss.user.dao&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--绑定 sqlSessionFactory--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--注意是 value，不是 ref--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;sqlSessionFactoryBeanName&quot;</span> <span class="attr">value</span>=<span class="string">&quot;sqlSessionFactory&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"> <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">    启用事务注解，部署到服务器上以后 annotation-driven 不管用，事务执行出了异常无法回滚，所以就直接用 @EnableTransactionManagement 注解替换了</span></span><br><span class="line"><span class="comment"> --&gt;</span></span><br><span class="line"><span class="comment">&lt;!--&lt;tx:annotation-driven/&gt;--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--配置Spring的事务管理 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;transactionManager&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">class</span>=<span class="string">&quot;org.springframework.jdbc.datasource.DataSourceTransactionManager&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;dataSource&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="pom-xml"><a href="#pom-xml" class="headerlink" title="pom.xml"></a>pom.xml</h4><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>druid<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0.29<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.4.4<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- mybatis-spring 的版本与使用的 Spring 和 Mybatis 的版本有关，具体的请查看官网 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-spring<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.3.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>6.0.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="运行测试-1"><a href="#运行测试-1" class="headerlink" title="运行测试"></a>运行测试</h3><ol>
<li>配置 log4j2 输出 Mybatis 和 spring-mybatis 的日志 <figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">logger</span> <span class="attr">name</span>=<span class="string">&quot;org.mybatis&quot;</span> <span class="attr">level</span>=<span class="string">&quot;debug&quot;</span> <span class="attr">additivity</span>=<span class="string">&quot;false&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">AppenderRef</span> <span class="attr">ref</span>=<span class="string">&quot;Console&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">logger</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">logger</span> <span class="attr">name</span>=<span class="string">&quot;org.apache.ibatis&quot;</span> <span class="attr">level</span>=<span class="string">&quot;debug&quot;</span> <span class="attr">additivity</span>=<span class="string">&quot;false&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">AppenderRef</span> <span class="attr">ref</span>=<span class="string">&quot;Console&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">logger</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li>部署 Dao 层 Mapper。IDEA 会将 <code>src/main/java</code> 下的类编译好以后部署到 <code>/WEB-INF/class</code>， 但是 <code>src/main/java</code> 里的其他文件默认是不部署的，所以我们需要配置 <code>pom.xml</code> 将 Mapper 也部署到服务器 <figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">resources</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">resource</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">directory</span>&gt;</span>src/main/java<span class="tag">&lt;/<span class="name">directory</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">includes</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">include</span>&gt;</span>**/dao/*.xml<span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">includes</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">resource</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">resource</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">directory</span>&gt;</span>src/main/resources<span class="tag">&lt;/<span class="name">directory</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">resource</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">resources</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li>测试结果 <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">2017-04-23 12:42:07,682 [http-nio-8080-exec-2] TRACE com.github.crainstorm.oss.user.action.UserAction - enter checkLogin...</span><br><span class="line">2017-04-23 12:42:07,682 [http-nio-8080-exec-2] DEBUG com.github.crainstorm.oss.user.action.UserAction - User&#123;username=&#x27;rainstorm&#x27;, password=&#x27;f217305153bc4761daaf98b3e5bb41c7&#x27;, nickname=&#x27;rainstorm&#x27;, phone=&#x27;null&#x27;, birthday=null&#125;</span><br><span class="line">2017-04-23 12:42:07,682 [http-nio-8080-exec-2] DEBUG org.springframework.jdbc.datasource.DataSourceTransactionManager - Creating new transaction with name [com.github.crainstorm.oss.user.service.UserServiceImpl.loginSuccess]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT,readOnly; &#x27;&#x27;</span><br><span class="line">2017-04-23 12:42:07,687 [http-nio-8080-exec-2] DEBUG org.springframework.jdbc.datasource.DataSourceTransactionManager - Acquired Connection [com.mysql.cj.jdbc.ConnectionImpl@20c3cf2a] for JDBC transaction</span><br><span class="line">2017-04-23 12:42:07,687 [http-nio-8080-exec-2] DEBUG org.springframework.jdbc.datasource.DataSourceUtils - Setting JDBC Connection [com.mysql.cj.jdbc.ConnectionImpl@20c3cf2a] read-only</span><br><span class="line">2017-04-23 12:42:07,688 [http-nio-8080-exec-2] DEBUG org.springframework.jdbc.datasource.DataSourceTransactionManager - Switching JDBC Connection [com.mysql.cj.jdbc.ConnectionImpl@20c3cf2a] to manual commit</span><br><span class="line">2017-04-23 12:42:07,688 [http-nio-8080-exec-2] DEBUG org.mybatis.spring.SqlSessionUtils - Creating a new SqlSession</span><br><span class="line">2017-04-23 12:42:07,688 [http-nio-8080-exec-2] DEBUG org.mybatis.spring.SqlSessionUtils - Registering transaction synchronization for SqlSession [org.apache.ibatis.session.defaults.DefaultSqlSession@34a6aa63]</span><br><span class="line">2017-04-23 12:42:07,688 [http-nio-8080-exec-2] DEBUG org.mybatis.spring.transaction.SpringManagedTransaction - JDBC Connection [com.mysql.cj.jdbc.ConnectionImpl@20c3cf2a] will be managed by Spring</span><br><span class="line">2017-04-23 12:42:07,688 [http-nio-8080-exec-2] DEBUG com.github.crainstorm.oss.user.dao.UserDao.checkLogin - ==&gt;  Preparing: SELECT COUNT(*) FROM user WHERE username = ? AND password = ?;</span><br><span class="line">2017-04-23 12:42:07,689 [http-nio-8080-exec-2] DEBUG com.github.crainstorm.oss.user.dao.UserDao.checkLogin - ==&gt; Parameters: rainstorm(String), f217305153bc4761daaf98b3e5bb41c7(String)</span><br><span class="line">2017-04-23 12:42:07,705 [http-nio-8080-exec-2] TRACE com.github.crainstorm.oss.user.dao.UserDao.checkLogin - &lt;==    Columns: COUNT(*)</span><br><span class="line">2017-04-23 12:42:07,705 [http-nio-8080-exec-2] TRACE com.github.crainstorm.oss.user.dao.UserDao.checkLogin - &lt;==        Row: 1</span><br><span class="line">2017-04-23 12:42:07,705 [http-nio-8080-exec-2] DEBUG com.github.crainstorm.oss.user.dao.UserDao.checkLogin - &lt;==      Total: 1</span><br><span class="line">2017-04-23 12:42:07,705 [http-nio-8080-exec-2] DEBUG org.mybatis.spring.SqlSessionUtils - Releasing transactional SqlSession [org.apache.ibatis.session.defaults.DefaultSqlSession@34a6aa63]</span><br><span class="line">2017-04-23 12:42:07,705 [http-nio-8080-exec-2] DEBUG com.github.crainstorm.oss.user.service.UserServiceImpl - selected 1 records....</span><br><span class="line">2017-04-23 12:42:07,705 [http-nio-8080-exec-2] DEBUG org.mybatis.spring.SqlSessionUtils - Transaction synchronization committing SqlSession [org.apache.ibatis.session.defaults.DefaultSqlSession@34a6aa63]</span><br><span class="line">2017-04-23 12:42:07,705 [http-nio-8080-exec-2] DEBUG org.mybatis.spring.SqlSessionUtils - Transaction synchronization deregistering SqlSession [org.apache.ibatis.session.defaults.DefaultSqlSession@34a6aa63]</span><br><span class="line">2017-04-23 12:42:07,706 [http-nio-8080-exec-2] DEBUG org.mybatis.spring.SqlSessionUtils - Transaction synchronization closing SqlSession [org.apache.ibatis.session.defaults.DefaultSqlSession@34a6aa63]</span><br><span class="line">2017-04-23 12:42:07,706 [http-nio-8080-exec-2] DEBUG org.springframework.jdbc.datasource.DataSourceTransactionManager - Initiating transaction commit</span><br><span class="line">2017-04-23 12:42:07,706 [http-nio-8080-exec-2] DEBUG org.springframework.jdbc.datasource.DataSourceTransactionManager - Committing JDBC transaction on Connection [com.mysql.cj.jdbc.ConnectionImpl@20c3cf2a]</span><br><span class="line">2017-04-23 12:42:07,708 [http-nio-8080-exec-2] DEBUG org.springframework.jdbc.datasource.DataSourceUtils - Resetting read-only flag of JDBC Connection [com.mysql.cj.jdbc.ConnectionImpl@20c3cf2a]</span><br><span class="line">2017-04-23 12:42:07,709 [http-nio-8080-exec-2] DEBUG org.springframework.jdbc.datasource.DataSourceTransactionManager - Releasing JDBC Connection [com.mysql.cj.jdbc.ConnectionImpl@20c3cf2a] after transaction</span><br><span class="line">2017-04-23 12:42:07,709 [http-nio-8080-exec-2] DEBUG org.springframework.jdbc.datasource.DataSourceUtils - Returning JDBC Connection to DataSource</span><br><span class="line">2017-04-23 12:42:07,709 [http-nio-8080-exec-2] INFO  com.github.crainstorm.oss.user.action.UserAction - login success...</span><br><span class="line">2017-</span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ol>
<li><a href="https://docs.spring.io/spring/docs/4.3.7.RELEASE/spring-framework-reference/html/beans.html#beans-annotation-config">Annotation-based container configuration</a></li>
<li><a href="https://docs.spring.io/spring/docs/4.3.7.RELEASE/spring-framework-reference/html/beans.html#beans-classpath-scanning">Classpath scanning and managed components</a></li>
<li><a href="https://docs.spring.io/spring/docs/4.3.7.RELEASE/spring-framework-reference/html/mvc.html#mvc-config">Configuring Spring MVC</a></li>
<li><a href="http://blog.csdn.net/walkerjong/article/details/7520896"> @RequestBody, @ResponseBody 注解详解 </a></li>
<li><a href="http://stackoverflow.com/questions/23325111/spring-mvc-handlermapping-vs-handleradapter">Spring mvc HandlerMapping VS HandlerAdapter</a></li>
<li><a href="https://docs.spring.io/spring/docs/4.3.7.RELEASE/javadoc-api/org/springframework/web/context/ContextLoaderListener.html">org.springframework.web.context.ContextLoaderListener</a></li>
<li><a href="https://docs.spring.io/spring/docs/4.3.7.RELEASE/javadoc-api/org/springframework/web/context/ContextLoader.html">org.springframework.web.context.ContextLoader</a></li>
<li><a href="https://docs.spring.io/spring/docs/4.3.7.RELEASE/spring-framework-reference/html/mvc.html#mvc-servlet">22.2 The DispatcherServlet</a></li>
<li><a href="https://schoudari.wordpress.com/2012/07/23/purpose-of-contextloaderlistener-spring-mvc/">Purpose of ContextLoaderListener – Spring MVC</a></li>
<li><a href="https://www.ibm.com/developerworks/cn/java/j-lo-servlet/">Servlet 工作原理解析</a></li>
<li><a href="http://www.mybatis.org/mybatis-3/zh/">mybatis</a></li>
<li><a href="http://www.mybatis.org/spring/zh/index.html">mybatis-spring</a></li>
</ol>
]]></content>
      <categories>
        <category>Java</category>
      </categories>
      <tags>
        <tag>Java</tag>
      </tags>
  </entry>
  <entry>
    <title>Vue 和 React 的区别</title>
    <url>/test/post/Vue%E5%92%8CReact%E7%9A%84%E5%8C%BA%E5%88%AB/</url>
    <content><![CDATA[<p>Vue 和 React 的区别看这里</p>
<h2 id="简单说说-Vue-和-React-的区别"><a href="#简单说说-Vue-和-React-的区别" class="headerlink" title="简单说说 Vue 和 React 的区别"></a>简单说说 Vue 和 React 的区别</h2><h3 id="青铜级"><a href="#青铜级" class="headerlink" title="青铜级"></a>青铜级</h3><p>只要真正了解一些，或者用过两个框架开发，就一定能说上来的一些语法层面：</p>
<ul>
<li>Vue API 多，React API 少</li>
<li>Vue 双向绑定，修改数据自动更新视图，而 React 单向数据流，需要手动 setState</li>
<li>Vue template 结构表现分离，React 用 jsx 结构表现融合，html&#x2F;css都可以写到js里</li>
<li>都可以通过 props 进行父子组件数据传递，只是 Vue props 要声明，React 不用声明可能直接使用</li>
<li>Vue 可以用插槽，React 是万物皆可 props</li>
<li>Vue2 利用基本都是 Mixin，React 可以用高阶函数、自定义 hook 实现</li>
<li>Vue 的 frgments、hook 到 Vue3 才有，Vue 还有丰富的指令，过滤器</li>
</ul>
<p>都支持服务端渲染，都有虚拟 DOM，数据驱动，组件化开发，响应式，组件通信，生命周期，Diff，都有状态管理 Vuex&#x2F;Pinia、Redux&#x2F;Mobx，等等等等….</p>
<h3 id="白银级"><a href="#白银级" class="headerlink" title="白银级"></a>白银级</h3><p>1、可以加一些偏感受方面的，比如：<br>React 官方只关注底层，上层应用解决方案都交给社区，所以 React 生态体系丰富，社区强，而且每次更新改动小等 等，而 Vue 是由官方主导开发和维护，生态没那么丰富，虽然上手比 React 简单一些，但每次更新堪称破土重来，改的倒是潇洒得很，这就注定我们学习成本大大增加，并不能做到学习一次就可以一直使用这个框架，1.0 改版 2.0 需要重新学习一遍，2.0 改版 3.0 又要学习一遍，甚至 3.0 到 3.2 都要重学一部分，有些程序员到了 35 退休不是不想干，也是学不动了吧。像是需要记的 API，React 就那么几个，剩下的自己去写就行了，Vue 虽然在代码维护上有一定优势，可是它的 API 就多得多了，而且还分版本，比如 Vue2 有过滤器，Vue3 却没了，不仅要多记很多 API 和自定义指令，还需要对自己所学的 API 根据版本进行选择使用，感觉不怎么严谨</p>
<p>2、也可以将青铜级上面的某些点展开说一下细节，比如：</p>
<p><strong>组件化：</strong></p>
<ul>
<li>Vue2 组件说白了就是一个挂满一堆东西的 Vue 核心类，通过 new Vue() 拿到实例。就是说 Vue 组件的 script 导出的是一个挂满各种 options 的纯对象而已，所以 options API 的 this 指向 Vue 实例，这对我们开发者来说是不透明的，需要文档才能知道上面一堆 this.$xxx 是干嘛用的，而且 Vue 的插件也都是基于 Vue 原型类基础上的，Vue.install 挂到 Vue 实例上去嘛，以保证和第三方库的 Vue 调的是同一个 Vue 对象</li>
<li>而 React 则比较简单，直接定义 render 函数生成 vnode，里面通过四个组件类包装 vnode 而已，不同类型的 vnode 用相对应的组件类处理，就像责任划分一样，各自只负责自己的。而且 React 类组件都是继承于 React.Component 类，它的 this 指向我们自定义的类，可以说对我们开发者来说是透明的</li>
</ul>
<p><strong>hook</strong>：</p>
<ul>
<li>React hook 是根据调用顺序来确定下一次重新渲染时的 state 是来源于哪个，所以有一些限制，比如不能在循环&#x2F;条件判断&#x2F;嵌套函数里使用，而且必须在函数最顶层调用 hook 等<br>Vue3 hook 是基于响应式实现的，它是声明在 setup 里，一次组件实例化只调用一次 setup，而 React 每次重新渲染都要重新调用，性能上自然不言而喻，而且可以在循环&#x2F;条件判断&#x2F;嵌套函数里使用，并且正因为是基于响应式实现的，还自动实现了依赖收集，而 React 需要手动传入依赖等</li>
</ul>
<p>等等…</p>
<h3 id="黄金级"><a href="#黄金级" class="headerlink" title="黄金级"></a>黄金级</h3><p>起码得深入源码吧，比如：</p>
<p><strong>响应式：</strong></p>
<ul>
<li>Vue2 响应式的特点就是依赖收集，数据可变，自动派发更新，初始化时通过 Object.defineProperty 递归劫持 data 所有属性添加 getter&#x2F;setter，触发 getter 的时候进行依赖收集，修改时触发 setter 自动派发更新找到引用组件重新渲染</li>
<li>Vue3 响应式使用原生 Proxy 重构了响应式，一是 proxy 不存在 Vue2响应式存在的缺陷，二是性能更好，不仅支持更多的数据结构，而且不再一开始递归劫持对象属性，而是代理第一层对象本身。运行时才递归，用到才代理，用 effect 副作用来代替 Vue2 里的 watcher，用一个依赖管理中心 trackMap 来统一管理依赖代替 Vue2 中的 Dep，这样也不需要维护特别多的依赖关系，性能上取得很大进步</li>
<li>相比 Vue 的自动化，React 则是基于状态，单向数据流，数据不可变，需要手动 setState 来更新，而且当数据改变时会以组件根为目录，默认全部重新渲染整个组件树，只能额外用 pureComponent&#x2F;shouldComponentUpdate&#x2F;useMemo&#x2F;useCallback 等方法来进行控制，更新粒度更大一些</li>
</ul>
<p><strong>Diff 算法：</strong></p>
<ul>
<li>Vue2 是同层比较新老 vnode，新的不存在老的存在就删除，新的存在老的不存在就创建，子节点采用双指针头对尾两端对比的方式，全量diff，然后移动节点时通过 splice 进行数组操作</li>
<li>Vue3 是采用 Map 数据结构以及动静结合的方式，在编译阶段提前标记静态节点，Diff 过程中直接跳过有静态标记的节点，并且子节点对比会使用一个 source 数组来记录节点位置及最长递增子序列算法优化了对比流程，快速 Diff，需要处理的边际条件会更少</li>
<li>React 是递归同层比较，标识差异点保存到 Diff 队列保存，得到 patch 树，再统一操作批量更新 DOM。Diff 总共就是移动、删除、增加三个操作，如果结构发生改变就直接卸载重新创建，如果没有则将节点在新集合中的位置和老集合中的 lastIndex 进行比较是否需要移动，如果遍历过程中发现新集合没有，但老集合有就删除</li>
</ul>
<h3 id="钻石级"><a href="#钻石级" class="headerlink" title="钻石级"></a>钻石级</h3><p>这得要脱离代码层面，上升到更加宏观的层面吧，区别摆在那里是死的，固定的，就主要看人怎么说了，比如</p>
<p>1、以突出核心思想和设计理念开头：</p>
<p>我觉得最主要就是核心思想和设计理念上的区别，React 一开始定位的就是 UI 开发的新思路，这种思想说白了就是要改变开发者，我制定规则，你们都照我的来，因为背靠大公司(facebook)，所以不缺用户，而 Vue 是尽可能降低前端开发的门槛来适应不同的开发者，让开发者怎么爽怎么来，正是因为这种设计理念上的差别对后续设计也产生了一些不可逆的影响，或者说这两框架后续架构的变化都是围绕这个来的。</p>
<p>2、以突出数据管理开头：</p>
<p>我觉得这两最主要的区别是在数据管理方式上，虽然都是数据驱动，但 Vue 是响应式的，React 是手动 setState，可以说正是因为这个对后面架构的设计都产生了一些不可逆的影响，或者说这两框架后续架构的变化都是围绕这个来的。</p>
<p>主要体现在这些方面：</p>
<p>比如 Vue 是对数据进行劫持&#x2F;代理，它对监测数据的变化更加精准，动了多少数据就触发多少更新，更新粒度很小，而 React 推崇函数式，这是没办法感知数据变化的，就是说不知道什么时候应该刷新，而且即便是手动 setState 触发更新，它也也不知道哪些组件需要刷新，而是渲染整个 DOM，说白了就是无脑刷新嘛，这样就导致性能不好，所以后面只能不断通过其他办法来避免不必要的刷新，或者优化无脑刷新的性能。当然 Vue 也不是那么完美，它实现精准刷新也是有代价的，就是需要给每个组件配置监视器，管理依赖收集和派发更新，这同样是有消耗的。且不是说性能谁好吧，我们可以对比下这两框架版本迭代可以发现，React 迭代是增加了一个个避免刷新的钩子函数或者 API 还有采用 Fiber 的架构来做时间分片也是来优化渲染的性能。而 Vue1&#x2F;Vue2&#x2F;Vue3 每个版本虽然改的东西多，但核心都是围绕响应式来优化的，所以我觉得这是这两框架之间最重要的区别</p>
<p>比如正是这种设计上的区别，也直接影响了 hooks 的实现和表现，React hook 底层是基于链表实现的，每次组件被 render 的时候都会按顺序执行所有 hooks，而且正因为底层是链表，每个 hook 的 next 是指向下一个 hook 的，所以我们写代码是不能在不同的 hooks 调用里使用条件判断&#x2F;函数嵌套之类的，因为这会导致执行顺序不对，从而出错。而 Vue hook 只会被注册调用一次，因为它是声明在 setup 里，一次组件实例化只调用一次 setup，Vue 之所以能避开这些问题，主要还是得益于数据响应式，不需要链表对 hooks 进行记录，而是直接对数据代理观察，但它也有困扰的地方，就是不得不返回一个包装对象，通过 .value 获取。因为在 JS 里基础类型只有值，没有引用，或者说只存在栈里，使用完就回收了，无法追踪后续变化，自然做不到数据的代理和拦截，这算是这个设计的一个缺点吧</p>
<p>再比如编译优化的问题，Vue 能够做到数据劫持，再到 Vue3 动静结合的 Diff 思想也得益于它的模板语法实现了静态编译。就是能做到预编译优化，可以静态分析，在解析模板时能根据解析到的不同的标签、文本等分别执行对应的回调函数来构造 AST，而 React 虽然 JSX 语法更加灵活，可也正是因为这样导致可以优化的地方不足，重新渲染时就是一堆递归调用 React.createElement，无法从模板层面进行静态分析，也就做不到双向绑定，即使是很厉害的 fiber，也是因为伤害已经造成，所以通过时间分片的优化来弥补伤害吧，因为已经无法在编译阶段进行优化了，这也是这个设计所带来的问题吧</p>
<h3 id="王者级"><a href="#王者级" class="headerlink" title="王者级"></a>王者级</h3><p><strong>项目选型怎么考虑？怎么选择？</strong></p>
<p>从加载速度，运行时性能来说，我觉得这两个框架综合各种场景应该是没什么质的差别的。硬要说的话，Vue 在更新时性能优化方面需要的心智负担可能会少那么一点，特别是 Vue3，而 React 如果不注意，容易导致一些组件无用的 Diff，但其实实际项目中真正能遇到这种性能瓶颈的也是极少数，所以(这里有两种说法)：</p>
<p>(如果公司主要用 Vue 技术栈的话)：所以总的来说我觉得 Vue 性能上会更有优势一点，特别是 Vue3 更加灵活，有很好的可扩展性，同时有更快的渲染速度和更小的打包体积。从 mixins 到 HOC 到 render props 再到 hooks，React 基本已经废掉了过去很多基于组件的逻辑抽象模式，抹掉了 JSX 对比模板的一个优势，Vue3 中现在也都能做到，所以我会偏向 Vue3。</p>
<p>(如果公司主要用 React 技术栈的话)：所以总的来说我觉得要是一些不大的系统或者 H5 就用 Vue，因为不管是上手还是开发难度上都很简单，开发效率也高嘛，而且它有更小的打包体积，毕竟在移动端网络差异大的情况下，资源体积是非常重要的。但像是一些中后台系统，或者一些大点的项目，会越做越大的，多人协作开发的，就用 React，因为它的函数式编程有更加灵活的结构和可扩展性，丰富的生态圈和工具链，解决方案多，后期也更方便迭代与维护，还适用原生 APP，所以我会偏向 React。</p>
]]></content>
      <categories>
        <category>前端</category>
      </categories>
      <tags>
        <tag>JavaScript</tag>
      </tags>
  </entry>
  <entry>
    <title>小案例</title>
    <url>/test/post/all/</url>
    <content><![CDATA[<h2 id="修改数组对象的属性（key）名"><a href="#修改数组对象的属性（key）名" class="headerlink" title="修改数组对象的属性（key）名"></a>修改数组对象的属性（key）名</h2><p>方法一</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> array = [</span><br><span class="line">  &#123; <span class="attr">id</span>: <span class="number">1</span>, <span class="attr">name</span>: <span class="string">&quot;小明&quot;</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">id</span>: <span class="number">2</span>, <span class="attr">name</span>: <span class="string">&quot;小红&quot;</span> &#125;,</span><br><span class="line">];</span><br><span class="line"><span class="comment">/**/</span></span><br><span class="line"><span class="comment">//旧key到新key的映射</span></span><br><span class="line"><span class="keyword">var</span> keyMap = &#123; <span class="attr">id</span>: <span class="string">&quot;value&quot;</span>, <span class="attr">name</span>: <span class="string">&quot;label&quot;</span> &#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; array.<span class="property">length</span>; i++) &#123;</span><br><span class="line">  <span class="keyword">var</span> obj = array[i];</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> key <span class="keyword">in</span> obj) &#123;</span><br><span class="line">    <span class="keyword">var</span> newKey = keyMap[key];</span><br><span class="line">    <span class="keyword">if</span> (newKey) &#123;</span><br><span class="line">      obj[newKey] = obj[key];</span><br><span class="line">      <span class="keyword">delete</span> obj[key];</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(array);</span><br></pre></td></tr></table></figure>

<p>方法二</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> arr = [</span><br><span class="line">  &#123; <span class="attr">evaluateResult</span>: <span class="string">&quot;A类&quot;</span>, <span class="attr">evaluateTotal</span>: <span class="number">22</span>, <span class="attr">a</span>: <span class="number">1</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">evaluateResult</span>: <span class="string">&quot;B类&quot;</span>, <span class="attr">evaluateTotal</span>: <span class="number">22</span>, <span class="attr">b</span>: <span class="number">2</span> &#125;,</span><br><span class="line">];</span><br><span class="line"><span class="keyword">let</span> keyMap = &#123; <span class="attr">evaluateResult</span>: <span class="string">&quot;name&quot;</span>, <span class="attr">evaluateTotal</span>: <span class="string">&quot;value&quot;</span> &#125;;</span><br><span class="line">arr.<span class="title function_">map</span>(<span class="function">(<span class="params">item</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">var</span> objs = <span class="title class_">Object</span>.<span class="title function_">keys</span>(item).<span class="title function_">reduce</span>(<span class="function">(<span class="params">newData, key</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> newKey = keyMap[key] || key;</span><br><span class="line">    newData[newKey] = item[key];</span><br><span class="line">    <span class="keyword">return</span> newData;</span><br><span class="line">  &#125;, &#123;&#125;);</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(objs);</span><br><span class="line">  <span class="comment">//&#123;name: &quot;A类&quot;, value: 22, a: 1&#125;</span></span><br><span class="line">  <span class="comment">//&#123;name: &quot;B类&quot;, value: 22, b: 2&#125;</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>方法三</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="variable language_">this</span>.<span class="property">categoryOption</span> = res.<span class="property">data</span>.<span class="title function_">map</span>(<span class="function"><span class="params">item</span> =&gt;</span> &#123;</span><br><span class="line">          <span class="keyword">return</span> &#123;</span><br><span class="line">            <span class="attr">value</span>: item.<span class="property">id</span>,</span><br><span class="line">            <span class="attr">label</span>: item.<span class="property">name</span>,</span><br><span class="line">            <span class="attr">children</span>: item.<span class="property">sonList</span>.<span class="title function_">map</span>(<span class="function"><span class="params">sonItem</span> =&gt;</span> &#123;</span><br><span class="line">              <span class="keyword">return</span> &#123;</span><br><span class="line">                <span class="attr">value</span>: sonItem.<span class="property">id</span>,</span><br><span class="line">                <span class="attr">label</span>: sonItem.<span class="property">name</span></span><br><span class="line">              &#125;;</span><br><span class="line">            &#125;)</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">categoryOption</span>);</span><br></pre></td></tr></table></figure>



<h2 id="JS-时间对象-new-Date-的常用方法"><a href="#JS-时间对象-new-Date-的常用方法" class="headerlink" title="JS 时间对象 new Date()的常用方法"></a>JS 时间对象 new Date()的常用方法</h2><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="title class_">Date</span>(), <span class="comment">//Sat May 22 2021 10:38:06 GMT+0800 (中国标准时间)</span></span><br><span class="line"><span class="comment">//返回时间戳</span></span><br><span class="line">+<span class="keyword">new</span> <span class="title class_">Date</span>(); <span class="comment">//1621651748005</span></span><br><span class="line"><span class="title class_">Date</span>.<span class="title function_">now</span>();<span class="comment">//1621651748005</span></span><br><span class="line"><span class="keyword">new</span> <span class="title class_">Date</span>().<span class="title function_">getTime</span>()<span class="comment">//1621651748005</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">new</span> <span class="title class_">Date</span>().<span class="title function_">toJSON</span>(), <span class="comment">//2021-05-22T02:38:06.765Z</span></span><br><span class="line"><span class="keyword">new</span> <span class="title class_">Date</span>().<span class="title function_">toISOString</span>(), <span class="comment">//2021-05-22T02:38:06.765Z</span></span><br><span class="line"><span class="keyword">new</span> <span class="title class_">Date</span>().<span class="title function_">toDateString</span>(), <span class="comment">//Sat May 22 2021</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">new</span> <span class="title class_">Date</span>().<span class="title function_">toLocaleString</span>(), <span class="comment">//2021/5/22上午10:38:06</span></span><br><span class="line"><span class="keyword">new</span> <span class="title class_">Date</span>().<span class="title function_">toLocaleDateString</span>(), <span class="comment">//2021/5/22</span></span><br><span class="line"><span class="keyword">new</span> <span class="title class_">Date</span>().<span class="title function_">toLocaleTimeString</span>(), <span class="comment">//&quot;上午10:40:24&quot;</span></span><br><span class="line"><span class="comment">//加参数的</span></span><br><span class="line"><span class="keyword">new</span> <span class="title class_">Date</span>(<span class="number">1621541748005</span>).<span class="title function_">toLocaleString</span>()<span class="comment">//2021/5/21上午4:15:48</span></span><br><span class="line"></span><br><span class="line"><span class="title function_">getDate</span>()获取当前日期对象是几日(<span class="number">1</span>-<span class="number">31</span>)</span><br><span class="line"><span class="title function_">getDay</span>()获取当前日期对象是周几(返回<span class="number">0</span>-<span class="number">6.0</span>表示周日<span class="number">.1</span>表示周一)</span><br><span class="line"><span class="title function_">getMonth</span>()获取当前月份(<span class="number">0</span>-<span class="number">11.0</span>表示一月<span class="number">.11</span>表示<span class="number">12</span>月)</span><br><span class="line"><span class="title function_">geFullYear</span>()获取当前年份</span><br><span class="line"><span class="title function_">geHours</span>()获取小时(<span class="number">0</span>-<span class="number">23</span>)</span><br><span class="line"><span class="title function_">geMinutes</span>()获取分钟(<span class="number">0</span>-<span class="number">59</span>)</span><br><span class="line"><span class="title function_">geSeconds</span>()获取秒数(<span class="number">0</span>-<span class="number">59</span>)</span><br><span class="line"><span class="title function_">geMilliseconds</span>()获取毫秒数</span><br></pre></td></tr></table></figure>

<h2 id="js-base64-转二进制-Blog-大对象"><a href="#js-base64-转二进制-Blog-大对象" class="headerlink" title="js base64 转二进制 Blog 大对象"></a>js base64 转二进制 Blog 大对象</h2><p>imgURL &#x3D; canvas.toDataURL(“image&#x2F;png”);&#x2F;&#x2F;返回的是 data:image&#x2F;png;base64,iVBORxxxx…<br>imgURL&#x3D;URL.createObjectURL(&#x2F;blob&#x2F;对象);&#x2F;&#x2F;返回的是 data:image&#x2F;png;base64,iVBORxxxx…</p>
<p>下面是将 base64 的 URL 转换成 Blob 对象<br>1.Base64 转文件格式大小（带有前缀的截取，比如 data:application&#x2F;pdf;base64,JVEwxxx…）</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">base64toBlob</span>(<span class="params">dataurl, filename</span>) &#123;</span><br><span class="line">  将base64转换为文件;</span><br><span class="line">  <span class="keyword">var</span> arr = dataurl.<span class="title function_">split</span>(<span class="string">&quot;,&quot;</span>),</span><br><span class="line">    mime = arr[<span class="number">0</span>].<span class="title function_">match</span>(<span class="regexp">/:(.*?);/</span>)[<span class="number">1</span>],</span><br><span class="line">    bstr = <span class="title function_">atob</span>(arr[<span class="number">1</span>]),</span><br><span class="line">    n = bstr.<span class="property">length</span>,</span><br><span class="line">    u8arr = <span class="keyword">new</span> <span class="title class_">Uint8Array</span>(n);</span><br><span class="line">  <span class="keyword">while</span> (n--) &#123;</span><br><span class="line">    u8arr[n] = bstr.<span class="title function_">charCodeAt</span>(n);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">File</span>([u8arr], filename, &#123; <span class="attr">type</span>: mime &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>2.Base64 转 blob 格式大小（不用处理前缀）</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">base64toBlob</span>(<span class="params">base64, type</span>) &#123;</span><br><span class="line">  <span class="comment">// 将base64转为Unicode规则编码</span></span><br><span class="line">  (bstr = <span class="title function_">atob</span>(base64, type)), (n = bstr.<span class="property">length</span>), (u8arr = <span class="keyword">new</span> <span class="title class_">Uint8Array</span>(n));</span><br><span class="line">  <span class="keyword">while</span> (n--) &#123;</span><br><span class="line">    u8arr[n] = bstr.<span class="title function_">charCodeAt</span>(n); <span class="comment">// 转换编码后才可以使用charCodeAt 找到Unicode编码</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Blob</span>([u8arr], &#123;</span><br><span class="line">    type,</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>下载图片</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> a = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&quot;a&quot;</span>);</span><br><span class="line">a.<span class="property">download</span> = <span class="string">&quot;image&quot;</span>;</span><br><span class="line">a.<span class="property">href</span> = <span class="variable constant_">URL</span>.<span class="title function_">createObjectURL</span>(blob);</span><br><span class="line">a.<span class="title function_">click</span>();</span><br><span class="line"><span class="variable constant_">URL</span>.<span class="title function_">revokeObjectURL</span>(blob);</span><br><span class="line"></span><br><span class="line"><span class="comment">//html2canvas(canvasID).then()插件可实现截图效果</span></span><br></pre></td></tr></table></figure>

<h2 id="vue-中的-render-函数介绍"><a href="#vue-中的-render-函数介绍" class="headerlink" title="vue 中的 render 函数介绍"></a>vue 中的 render 函数介绍</h2><p>使用 render 函数描述虚拟 DOM 时，vue 提供一个函数，这个函数是就构建虚拟 DOM 所需要的工具。官网上给他起了个名字叫 createElement。还有约定的简写叫 h,</p>
<p>vm 中有一个方法_c,也是这个函数的别名。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"> <span class="comment">/**</span></span><br><span class="line"><span class="comment">  * render: 渲染函数</span></span><br><span class="line"><span class="comment">  * 参数: createElement</span></span><br><span class="line"><span class="comment">  * 参数类型: Function</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"> <span class="attr">render</span>: <span class="keyword">function</span> (<span class="params">createElement</span>) &#123;</span><br><span class="line">   <span class="keyword">let</span> _this = <span class="variable language_">this</span>[<span class="string">&#x27;$options&#x27;</span>].<span class="property">parent</span>	<span class="comment">// 我这个是在 .vue 文件的 components 中写的，这样写才能访问this</span></span><br><span class="line">   <span class="keyword">let</span> _header = _this.<span class="property">$slots</span>.<span class="property">header</span>   	<span class="comment">// $slots: vue中所有分发插槽，不具名的都在default里</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * createElement 本身也是一个函数，它有三个参数</span></span><br><span class="line"><span class="comment">    * 返回值: VNode，即虚拟节点</span></span><br><span class="line"><span class="comment">    * 1. 一个 HTML 标签字符串，组件选项对象，或者解析上述任何一种的一个 async 异步函数。必需参数。&#123;String | Object | Function&#125; - 就是你要渲染的最外层标签</span></span><br><span class="line"><span class="comment">    * 2. 一个包含模板相关属性的数据对象你可以在 template 中使用这些特性。可选参数。&#123;Object&#125; - 1中的标签的属性</span></span><br><span class="line"><span class="comment">    * 3. 子虚拟节点 (VNodes)，由 `createElement()` 构建而成，也可以使用字符串来生成“文本虚拟节点”。可选参数。&#123;String | Array&#125; - 1的子节点，可以用 createElement() 创建，文本节点直接写就可以</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="keyword">return</span> <span class="title function_">createElement</span>(</span><br><span class="line">     <span class="comment">// 1. 要渲染的标签名称：第一个参数【必需】</span></span><br><span class="line">     <span class="string">&#x27;div&#x27;</span>,</span><br><span class="line">     <span class="comment">// 2. 1中渲染的标签的属性，详情查看文档：第二个参数【可选】</span></span><br><span class="line">     &#123;</span><br><span class="line">       <span class="attr">style</span>: &#123;</span><br><span class="line">         <span class="attr">color</span>: <span class="string">&#x27;#333&#x27;</span>,</span><br><span class="line">         <span class="attr">border</span>: <span class="string">&#x27;1px solid #ccc&#x27;</span></span><br><span class="line">       &#125;</span><br><span class="line">     &#125;,</span><br><span class="line">     <span class="comment">// 3. 1中渲染的标签的子元素数组：第三个参数【可选】</span></span><br><span class="line">     [</span><br><span class="line">       <span class="string">&#x27;text&#x27;</span>,   <span class="comment">// 文本节点直接写就可以</span></span><br><span class="line">       _this.<span class="property">$slots</span>.<span class="property">default</span>,  <span class="comment">// 所有不具名插槽，是个数组</span></span><br><span class="line">       <span class="title function_">createElement</span>(<span class="string">&#x27;div&#x27;</span>, _header)   <span class="comment">// createElement()创建的VNodes</span></span><br><span class="line">     ]</span><br><span class="line">   )</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>

<p>就是说 createElement（params1，params2，params3）接受三个参数，每个参数的类型官方介绍已经说明<br><strong>render 函数的用法</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="attr">render</span>: <span class="function">(<span class="params">h</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">h</span>(<span class="string">&quot;div&quot;</span>, &#123;</span><br><span class="line">    <span class="comment">//给div绑定value属性</span></span><br><span class="line">    <span class="attr">props</span>: &#123;</span><br><span class="line">      <span class="attr">value</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">    &#125;, <span class="comment">//给div绑定样式</span></span><br><span class="line">    <span class="attr">style</span>: &#123;</span><br><span class="line">      <span class="attr">width</span>: <span class="string">&quot;30px&quot;</span>,</span><br><span class="line">    &#125;, <span class="comment">//给div绑定点击事件</span></span><br><span class="line">    <span class="attr">on</span>: &#123;</span><br><span class="line">      <span class="attr">click</span>: <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;点击事件&quot;</span>);</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>前端</category>
      </categories>
      <tags>
        <tag>JavaScript</tag>
      </tags>
  </entry>
  <entry>
    <title>Hello World</title>
    <url>/test/post/hello-world/</url>
    <content><![CDATA[<p>Welcome to <a href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo new <span class="string">&quot;My New Post&quot;</span></span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/writing.html">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/server.html">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/generating.html">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>
]]></content>
      <tags>
        <tag>test</tag>
      </tags>
  </entry>
  <entry>
    <title>图片加载不出来，使用默认图片的三种方法</title>
    <url>/test/post/image-event%E5%8A%A0%E8%BD%BD%E5%85%9C%E5%BA%95%E5%9B%BE%E7%89%87/</url>
    <content><![CDATA[<h2 id="vue-自定义指令，图片加载不出来，使用默认图片的三种方法"><a href="#vue-自定义指令，图片加载不出来，使用默认图片的三种方法" class="headerlink" title="vue 自定义指令，图片加载不出来，使用默认图片的三种方法"></a>vue 自定义指令，图片加载不出来，使用默认图片的三种方法</h2><h3 id="一、常规解决方法"><a href="#一、常规解决方法" class="headerlink" title="一、常规解决方法"></a>一、常规解决方法</h3><p>我们都知道，img 标签支持 onerror 事件，在装载文档或图像的过程中如果发生了错误，就会触发 onerror 事件。可以使用一张提示错误的图片代替显示不了的图片。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;img src=<span class="string">&quot;images/logo.png&quot;</span> onerror=<span class="string">&quot;javascript:this.src=&#x27;images/logoError.png&#x27;;&quot;</span>&gt;</span><br></pre></td></tr></table></figure>

<p>当图片不存在时，将触发 onerror，而 onerror 中又为 img 指定一个 logoError.png 图片。也就是说图片存在则显示 logo.png，图片不存在将显示 logoError.png。<br>但是，注意哦，这里有个大坑哦，如果 logoError.png 也不存在，则会继续触发 onerror，导致死循环，页面卡死。而且，就算图片存在，但网络很不通畅，也可能触发 onerror。<br>当然，解决办法是有的：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;img src=<span class="string">&quot;images/logo.png&quot;</span> onerror=<span class="string">&quot;notfound();&quot;</span>/&gt;</span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">function</span> <span class="title function_">notfound</span>(<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="keyword">var</span> img = event.<span class="property">srcElement</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        img.<span class="property">src</span> = <span class="string">&quot;images/logoError.png&quot;</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        img.<span class="property">onerror</span> = <span class="literal">null</span>; <span class="comment">//解绑onerror事件</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

<h3 id="二、通过vue绑定-onerror-实现"><a href="#二、通过vue绑定-onerror-实现" class="headerlink" title="二、通过vue绑定 onerror 实现"></a>二、通过<a href="https://so.csdn.net/so/search?from=pc_blog_highlight&q=vue">vue</a>绑定 onerror 实现</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 本质上跟第一种方法是差不多的,这里也会遇到跟第一种方法类似的问题，当默认图也不存在时，图片加载死循环。</span></span><br><span class="line">&lt;img :src=<span class="string">&quot;images/logo.png&quot;</span> :onerror=<span class="string">&quot;defaultImg&quot;</span>&gt;</span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="attr">name</span>: <span class="string">&quot;imgError&quot;</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="title function_">data</span>(<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            <span class="keyword">return</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">                <span class="attr">defaultImg</span>: <span class="string">&#x27;this.src=&quot;&#x27;</span> + <span class="built_in">require</span>(<span class="string">&#x27;images/logoError.png&#x27;</span>) + <span class="string">&#x27;&quot;&#x27;</span> <span class="comment">//默认图地址</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

<h3 id="三、通过-vue-自定义指令"><a href="#三、通过-vue-自定义指令" class="headerlink" title="三、通过 vue 自定义指令"></a>三、通过 vue 自定义指令</h3><p>使用 vue 的指令都感觉好爽，特别的方便，现在自己搞一个，用起来会更爽。</p>
<p>在这之前，先了解下 vue 的自定义指令到底怎么玩，还是很有必要的。<br>这种东西呢，还是看文档吧，文档写得挺详细的。<a href="https://cn.vuejs.org/v2/guide/custom-directive.html">vue 指令</a>。</p>
<p>demo1:</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">//全局注册自定义指令，用于判断当前图片是否能够加载成功，可以加载成功则赋值为img的src属性，否则使用默认图片</span></span><br><span class="line"><span class="title class_">Vue</span>.<span class="title function_">directive</span>(<span class="string">&quot;real-img&quot;</span>, <span class="keyword">async</span> <span class="keyword">function</span> (<span class="params">el, binding</span>) &#123;</span><br><span class="line">  <span class="comment">//指令名称为：real-img</span></span><br><span class="line">  <span class="keyword">let</span> imgURL = binding.<span class="property">value</span>; <span class="comment">//获取图片地址</span></span><br><span class="line">  <span class="keyword">if</span> (imgURL) &#123;</span><br><span class="line">    <span class="keyword">let</span> exist = <span class="keyword">await</span> <span class="title function_">imageIsExist</span>(imgURL);</span><br><span class="line">    <span class="keyword">if</span> (exist) &#123;</span><br><span class="line">      el.<span class="title function_">setAttribute</span>(<span class="string">&quot;src&quot;</span>, imgURL);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 检测图片是否存在</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> <span class="variable">url</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">let</span> imageIsExist = <span class="keyword">function</span> (<span class="params">url</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> img = <span class="keyword">new</span> <span class="title class_">Image</span>();</span><br><span class="line">    img.<span class="property">onload</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">complete</span> == <span class="literal">true</span>) &#123;</span><br><span class="line">        <span class="title function_">resolve</span>(<span class="literal">true</span>);</span><br><span class="line">        img = <span class="literal">null</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    img.<span class="property">onerror</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">      <span class="title function_">resolve</span>(<span class="literal">false</span>);</span><br><span class="line">      img = <span class="literal">null</span>;</span><br><span class="line">    &#125;;</span><br><span class="line">    img.<span class="property">src</span> = url;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>然后使用的时候就特别方便了，因为是全局注册的，所以每个页面都可以直接使用</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;!--v-real-img 就是刚刚定义的指令，绑定的为真实要显示的图片地址。src为默认图片地址--&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;images/logoError.png&quot;</span> <span class="attr">v-real-img</span>=<span class="string">&quot;images/logo.png&quot;</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

<p>使用这种方法还有一个天然的优势，那就是当网速较慢或者图片一次性加载较多的话，可以达到占位图的效果。</p>
<p>demo2:</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="title class_">Vue</span>.<span class="title function_">directive</span>(<span class="string">&#x27;errorimg&#x27;</span> ,&#123;</span><br><span class="line">	<span class="comment">//执行时机：绑定了当前指令的元素的所有属性和事件</span></span><br><span class="line">	<span class="title function_">inserted</span>(<span class="params">el</span>)&#123;</span><br><span class="line">		<span class="comment">//获取的是真是的dom元素，可以使用dom的所有事件</span></span><br><span class="line">		<span class="variable language_">console</span>.<span class="title function_">log</span>(el)</span><br><span class="line">		el.<span class="property">onerror</span> = <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">			<span class="comment">//将默认图片赋值给el.src属性</span></span><br><span class="line">			el.<span class="property">src</span> = <span class="string">&#x27;默认图片地址&#x27;</span></span><br><span class="line">		&#125;</span><br><span class="line">	&#125;，</span><br><span class="line">	<span class="comment">//如果有分页，会在第二页的不会渲染，这个时候我们就换个函数</span></span><br><span class="line">	<span class="attr">componentUpdated</span>: <span class="keyword">function</span> (<span class="params">el</span>) &#123;</span><br><span class="line">		el.<span class="property">src</span> = <span class="string">&#x27;默认图片地址&#x27;</span></span><br><span class="line">	&#125;,</span><br><span class="line">&#125;)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>自定义指令简写</strong><br>在很多时候，你可能想在 bind 和 update 时触发相同行为，而不关心其它的钩子。可以简写为:<br>全局</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="title class_">Vue</span>.<span class="title function_">directive</span>(<span class="string">&quot;color&quot;</span>, <span class="keyword">function</span> (<span class="params">el, binding</span>) &#123;</span><br><span class="line">  el.<span class="property">style</span>.<span class="property">backgroundColor</span> = binding.<span class="property">value</span>;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>局部</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="attr">directives</span>: &#123;</span><br><span class="line">        <span class="string">&quot;fontweight&quot;</span>:</span><br><span class="line">        	<span class="keyword">function</span> (<span class="params">el, binding</span>) &#123;</span><br><span class="line">             	el.<span class="property">style</span>.<span class="property">fontWeight</span> = binding.<span class="property">value</span>;</span><br><span class="line">        	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
]]></content>
  </entry>
  <entry>
    <title>js倒计时</title>
    <url>/test/post/js%E5%80%92%E8%AE%A1%E6%97%B6/</url>
    <content><![CDATA[<h2 id="JS-实现倒计时功能"><a href="#JS-实现倒计时功能" class="headerlink" title="JS 实现倒计时功能"></a>JS 实现倒计时功能</h2><p>html</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;html&gt;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>30分钟倒计时<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span></span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;timer&quot;</span> <span class="attr">style</span>=<span class="string">&quot;color: red&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span></span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">var</span> oBox = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;timer&quot;</span>);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">var</span> maxtime = <span class="number">30</span> * <span class="number">60</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">function</span> <span class="title function_">CountDown</span>(<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="keyword">if</span> (maxtime &gt;= <span class="number">0</span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        minutes = <span class="title class_">Math</span>.<span class="title function_">floor</span>(maxtime / <span class="number">60</span>);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        seconds = <span class="title class_">Math</span>.<span class="title function_">floor</span>(maxtime % <span class="number">60</span>);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        msg = <span class="string">&quot;距离结束还有&quot;</span> + minutes + <span class="string">&quot;分&quot;</span> + seconds + <span class="string">&quot;秒&quot;</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        oBox.<span class="property">innerHTML</span> = msg;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="keyword">if</span> (maxtime == <span class="number">5</span> * <span class="number">60</span>) <span class="title function_">alert</span>(<span class="string">&quot;还剩5分钟&quot;</span>);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        --maxtime;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      &#125; <span class="keyword">else</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="built_in">clearInterval</span>(timer);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="title function_">alert</span>(<span class="string">&quot;时间到，结束!&quot;</span>);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    timer = <span class="built_in">setInterval</span>(<span class="string">&quot;CountDown()&quot;</span>, <span class="number">1000</span>);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line">&lt;/html&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>vue</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">//data中定义 minutes, seconds</span></span><br><span class="line"><span class="comment">//methods中的方法</span></span><br><span class="line"> <span class="title function_">madeTime</span>(<span class="params"></span>) &#123;</span><br><span class="line"> 	  <span class="comment">//let now = new Date().getTime();</span></span><br><span class="line">      <span class="comment">// 设置截止时间</span></span><br><span class="line">      <span class="comment">//let end = new Date(this.curStartTime).getTime();</span></span><br><span class="line">      <span class="comment">//let maxtime = end - now;</span></span><br><span class="line"></span><br><span class="line">      <span class="keyword">var</span> maxtime = <span class="number">30</span> * <span class="number">60</span>; <span class="comment">//30分钟(1800秒)</span></span><br><span class="line">      <span class="comment">// var minutes, seconds, msg;</span></span><br><span class="line">      <span class="keyword">var</span> _this = <span class="variable language_">this</span>;</span><br><span class="line">      <span class="keyword">var</span> timer = <span class="built_in">setInterval</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (maxtime &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">          _this.<span class="property">minutes</span> = <span class="title class_">Math</span>.<span class="title function_">floor</span>(maxtime / <span class="number">60</span>)</span><br><span class="line">            .<span class="title function_">toString</span>()</span><br><span class="line">            .<span class="title function_">padStart</span>(<span class="number">2</span>, <span class="string">&quot;0&quot;</span>);</span><br><span class="line">          _this.<span class="property">seconds</span> = <span class="title class_">Math</span>.<span class="title function_">floor</span>(maxtime % <span class="number">60</span>)</span><br><span class="line">            .<span class="title function_">toString</span>()</span><br><span class="line">            .<span class="title function_">padStart</span>(<span class="number">2</span>, <span class="string">&quot;0&quot;</span>);</span><br><span class="line">          <span class="comment">// msg = &quot;距离结束还有&quot; + minutes + &quot;分&quot; + seconds + &quot;秒&quot;;</span></span><br><span class="line">          <span class="keyword">if</span> (maxtime == <span class="number">5</span> * <span class="number">60</span>) <span class="title function_">alert</span>(<span class="string">&quot;还剩5分钟&quot;</span>);</span><br><span class="line">          --maxtime;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="built_in">clearInterval</span>(timer);</span><br><span class="line">          <span class="title function_">alert</span>(<span class="string">&quot;时间到，结束!&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;, <span class="number">1000</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>前端</category>
      </categories>
  </entry>
  <entry>
    <title>NodeJS框架Express与Koa对比</title>
    <url>/test/post/node/</url>
    <content><![CDATA[<h1 id="NodeJS框架Express与Koa对比"><a href="#NodeJS框架Express与Koa对比" class="headerlink" title="NodeJS框架Express与Koa对比"></a>NodeJS框架Express与Koa对比</h1><h2 id="框架介绍"><a href="#框架介绍" class="headerlink" title="框架介绍"></a>框架介绍</h2><p>express框架是一个基于 Node.js 平台的极简、灵活的 web 应用开发框架，主要基于 Connect 中间件，并且自身封装了路由、视图处理等功能。</p>
<p>koa是 Express 原班人马基于 ES6 新特性重新开发的框架，主要基于 co 中间件，框架自身不包含任何中间件，很多功能需要借助第三方中间件解决，但是由于其基于 ES6 generator 特性的异步流程控制，解决了 “callback hell” 和麻烦的错误处理问题。</p>
<p><strong>相同点</strong><br>两个框架都对http进行了封装。相关的api都差不多，同一批人所写。</p>
<p><strong>不同点</strong><br>express内置了许多中间件可供使用，而koa没有。</p>
<p>express包含路由，视图渲染等特性，而koa只有http模块。</p>
<p>express的中间件模型为线型，而koa的中间件模型为U型，也可称为洋葱模型构造中间件。</p>
<p>express通过回调实现异步函数，在多个回调、多个中间件中写起来容易逻辑混乱。</p>
<h2 id="一、起步：创建一个简单的服务器"><a href="#一、起步：创建一个简单的服务器" class="headerlink" title="一、起步：创建一个简单的服务器"></a>一、起步：创建一个简单的服务器</h2><p>原生node</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">&#x27;http&#x27;</span>);</span><br><span class="line"></span><br><span class="line">http.<span class="title function_">createServer</span>(<span class="keyword">function</span> (<span class="params">request, response</span>) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 发送 HTTP 头部 </span></span><br><span class="line">    <span class="comment">// HTTP 状态值: 200 : OK</span></span><br><span class="line">    <span class="comment">// 内容类型: text/plain</span></span><br><span class="line">    response.<span class="title function_">writeHead</span>(<span class="number">200</span>, &#123;<span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;text/plain&#x27;</span>&#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 发送响应数据 &quot;Hello World&quot;</span></span><br><span class="line">    response.<span class="title function_">end</span>(<span class="string">&#x27;Hello World\n&#x27;</span>);</span><br><span class="line">&#125;).<span class="title function_">listen</span>(<span class="number">8888</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 终端打印如下信息</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Server running at http://127.0.0.1:8888/&#x27;</span>);</span><br><span class="line"><span class="comment">//或</span></span><br><span class="line"><span class="keyword">const</span> app=http.<span class="title function_">createServer</span>()</span><br><span class="line">app.<span class="title function_">on</span>(<span class="string">&#x27;request&#x27;</span>,<span class="function">(<span class="params">req,res</span>)=&gt;</span>&#123;&#125;)</span><br></pre></td></tr></table></figure>

<p>express</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">//express_demo.js 文件</span></span><br><span class="line"><span class="keyword">var</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> app = <span class="title function_">express</span>();</span><br><span class="line"> </span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/&#x27;</span>, <span class="keyword">function</span> (<span class="params">req, res</span>) &#123;</span><br><span class="line">   res.<span class="title function_">send</span>(<span class="string">&#x27;Hello World&#x27;</span>);</span><br><span class="line">&#125;)</span><br><span class="line"> </span><br><span class="line"><span class="keyword">var</span> server = app.<span class="title function_">listen</span>(<span class="number">8081</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line"> </span><br><span class="line">  <span class="keyword">var</span> host = server.<span class="title function_">address</span>().<span class="property">address</span></span><br><span class="line">  <span class="keyword">var</span> port = server.<span class="title function_">address</span>().<span class="property">port</span></span><br><span class="line"> </span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;应用实例，访问地址为 http://%s:%s&quot;</span>, host, port)</span><br><span class="line"> </span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>koa</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 导入koa，和koa 1.x不同，在koa2中，我们导入的是一个class，因此用大写的Koa表示:</span></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">Koa</span> = <span class="built_in">require</span>(<span class="string">&#x27;koa&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建一个Koa对象表示web app本身:</span></span><br><span class="line"><span class="keyword">const</span> app = <span class="keyword">new</span> <span class="title class_">Koa</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 对于任何请求，app将调用该异步函数处理请求：</span></span><br><span class="line">app.<span class="title function_">use</span>(<span class="keyword">async</span> (ctx, next) =&gt; &#123;</span><br><span class="line">    <span class="keyword">await</span> <span class="title function_">next</span>();</span><br><span class="line">    ctx.<span class="property">response</span>.<span class="property">type</span> = <span class="string">&#x27;text/html&#x27;</span>;</span><br><span class="line">    ctx.<span class="property">response</span>.<span class="property">body</span> = <span class="string">&#x27;&lt;h1&gt;Hello, koa2!&lt;/h1&gt;&#x27;</span>;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 在端口3000监听:</span></span><br><span class="line">app.<span class="title function_">listen</span>(<span class="number">3000</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;app started at port 3000...&#x27;</span>);</span><br></pre></td></tr></table></figure>

<h2 id="二、请求和响应"><a href="#二、请求和响应" class="headerlink" title="二、请求和响应"></a>二、请求和响应</h2><p><strong>express</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/&#x27;</span>, <span class="keyword">function</span> (<span class="params">req, res</span>) &#123;</span><br><span class="line">   <span class="comment">// request 和 response 对象来处理请求和响应的数据</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p><strong>koa</strong><br>参数ctx是由koa传入的封装了request和response的变量，我们可以通过它访问request和response，next是koa传入的将要处理的下一个异步函数。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">async</span> (ctx, next) =&gt; &#123;</span><br><span class="line">    <span class="keyword">await</span> <span class="title function_">next</span>();</span><br><span class="line">    <span class="comment">// 设置response的Content-Type:</span></span><br><span class="line">    ctx.<span class="property">response</span>.<span class="property">type</span> = <span class="string">&#x27;text/html&#x27;</span>;</span><br><span class="line">    <span class="comment">// 设置response的内容:</span></span><br><span class="line">    ctx.<span class="property">response</span>.<span class="property">body</span> = <span class="string">&#x27;&lt;h1&gt;Hello, koa2!&lt;/h1&gt;&#x27;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="三、路由"><a href="#三、路由" class="headerlink" title="三、路由"></a>三、路由</h2><p><strong>原生node</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> server = <span class="built_in">require</span>(<span class="string">&quot;./server&quot;</span>);</span><br><span class="line"><span class="keyword">var</span> router = <span class="built_in">require</span>(<span class="string">&quot;./router&quot;</span>);</span><br><span class="line"> </span><br><span class="line">server.<span class="title function_">use</span>(router.<span class="property">route</span>);</span><br></pre></td></tr></table></figure>

<p><strong>express</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">//  GET 请求</span></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/&#x27;</span>, <span class="keyword">function</span> (<span class="params">req, res</span>) &#123;</span><br><span class="line">   <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;主页 GET 请求&quot;</span>);</span><br><span class="line">   res.<span class="title function_">send</span>(<span class="string">&#x27;Hello GET&#x27;</span>);</span><br><span class="line">&#125;) </span><br><span class="line"><span class="comment">//  POST 请求</span></span><br><span class="line">app.<span class="title function_">post</span>(<span class="string">&#x27;/&#x27;</span>, <span class="keyword">function</span> (<span class="params">req, res</span>) &#123;</span><br><span class="line">   <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;主页 POST 请求&quot;</span>);</span><br><span class="line">   res.<span class="title function_">send</span>(<span class="string">&#x27;Hello POST&#x27;</span>);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p><strong>koa</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">//  GET 请求    写法1：</span></span><br><span class="line">app.<span class="title function_">use</span>(<span class="keyword">async</span> (ctx, next) =&gt; &#123;</span><br><span class="line">    <span class="keyword">if</span> (ctx.<span class="property">request</span>.<span class="property">path</span> === <span class="string">&#x27;/&#x27;</span>) &#123;</span><br><span class="line">        ctx.<span class="property">response</span>.<span class="property">body</span> = <span class="string">&#x27;index page&#x27;</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">await</span> <span class="title function_">next</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">//  GET 请求    写法2：</span></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">Koa</span> = <span class="built_in">require</span>(<span class="string">&#x27;koa&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> router = <span class="built_in">require</span>(<span class="string">&#x27;koa-router&#x27;</span>)();<span class="comment">// 注意require(&#x27;koa-router&#x27;)返回的是函数:</span></span><br><span class="line"><span class="keyword">const</span> app = <span class="keyword">new</span> <span class="title class_">Koa</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// add url-route:</span></span><br><span class="line">router.<span class="title function_">get</span>(<span class="string">&#x27;/hello/:name&#x27;</span>, <span class="keyword">async</span> (ctx, next) =&gt; &#123;</span><br><span class="line">    <span class="keyword">var</span> name = ctx.<span class="property">params</span>.<span class="property">name</span>;</span><br><span class="line">    ctx.<span class="property">response</span>.<span class="property">body</span> = <span class="string">`&lt;h1&gt;Hello, <span class="subst">$&#123;name&#125;</span>!&lt;/h1&gt;`</span>;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">router.<span class="title function_">get</span>(<span class="string">&#x27;/&#x27;</span>, <span class="keyword">async</span> (ctx, next) =&gt; &#123;</span><br><span class="line">    ctx.<span class="property">response</span>.<span class="property">body</span> = <span class="string">&#x27;&lt;h1&gt;Index&lt;/h1&gt;&#x27;</span>;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// add router middleware:</span></span><br><span class="line">app.<span class="title function_">use</span>(router.<span class="title function_">routes</span>());</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">listen</span>(<span class="number">3000</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;app started at port 3000...&#x27;</span>);</span><br></pre></td></tr></table></figure>

<h2 id="四、静态文件"><a href="#四、静态文件" class="headerlink" title="四、静态文件"></a>四、静态文件</h2><p><strong>express</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">//  Express 提供了内置的中间件 express.static 来设置静态文件如：img， CSS, JavaScript 等。</span></span><br><span class="line">app.<span class="title function_">use</span>(<span class="string">&#x27;/public&#x27;</span>, express.<span class="title function_">static</span>(<span class="string">&#x27;public&#x27;</span>));</span><br></pre></td></tr></table></figure>

<p><strong>koa</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 方法一：自己写一个处理方法</span></span><br><span class="line"><span class="keyword">let</span> staticFiles = <span class="built_in">require</span>(<span class="string">&#x27;./static-files&#x27;</span>);</span><br><span class="line">app.<span class="title function_">use</span>(<span class="title function_">staticFiles</span>(<span class="string">&#x27;/static/&#x27;</span>, __dirname + <span class="string">&#x27;/static&#x27;</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">// 方法二：引一个包</span></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">Koa</span> = <span class="built_in">require</span>(<span class="string">&#x27;koa&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> app = <span class="keyword">new</span> <span class="title class_">Koa</span>();</span><br><span class="line"><span class="keyword">const</span> bodyParser = <span class="built_in">require</span>(<span class="string">&#x27;koa-bodyparser&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">Router</span> = <span class="built_in">require</span>(<span class="string">&#x27;koa-router&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> router = <span class="keyword">new</span> <span class="title class_">Router</span>();</span><br><span class="line"><span class="keyword">const</span> render = <span class="built_in">require</span>(<span class="string">&#x27;koa-ejs&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> serve = <span class="built_in">require</span>(<span class="string">&#x27;koa-static&#x27;</span>);</span><br><span class="line">app.<span class="title function_">use</span>(<span class="title function_">bodyParser</span>());</span><br><span class="line"></span><br><span class="line"><span class="comment">/**静态资源（服务端） */</span></span><br><span class="line">app.<span class="title function_">use</span>(<span class="title function_">serve</span>(path.<span class="title function_">join</span>(__dirname + <span class="string">&quot;/public&quot;</span>)));</span><br><span class="line"></span><br><span class="line"><span class="comment">// 初始化ejs，设置后缀为html，文件目录为`views`</span></span><br><span class="line"><span class="title function_">render</span>(app, &#123;</span><br><span class="line">    <span class="attr">root</span>: path.<span class="title function_">join</span>(__dirname, <span class="string">&#x27;views&#x27;</span>),</span><br><span class="line">    <span class="attr">layout</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">viewExt</span>: <span class="string">&#x27;html&#x27;</span>,</span><br><span class="line">    <span class="attr">cache</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">debug</span>: <span class="literal">false</span></span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// 监听3000端口</span></span><br><span class="line">app.<span class="title function_">listen</span>(<span class="number">3000</span>);</span><br></pre></td></tr></table></figure>

<h2 id="五、get-post传参接收方法"><a href="#五、get-post传参接收方法" class="headerlink" title="五、get\post传参接收方法"></a>五、get\post传参接收方法</h2><p><strong>原生node</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// get </span></span><br><span class="line"><span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">&#x27;http&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> url = <span class="built_in">require</span>(<span class="string">&#x27;url&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> util = <span class="built_in">require</span>(<span class="string">&#x27;util&#x27;</span>);</span><br><span class="line"> </span><br><span class="line">http.<span class="title function_">createServer</span>(<span class="keyword">function</span>(<span class="params">req, res</span>)&#123;</span><br><span class="line">    res.<span class="title function_">writeHead</span>(<span class="number">200</span>, &#123;<span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;text/plain&#x27;</span>&#125;);</span><br><span class="line"> </span><br><span class="line">    <span class="comment">// 解析 url 参数</span></span><br><span class="line">    <span class="keyword">var</span> params = url.<span class="title function_">parse</span>(req.<span class="property">url</span>, <span class="literal">true</span>).<span class="property">query</span>;</span><br><span class="line">    res.<span class="title function_">write</span>(<span class="string">&quot;网站名：&quot;</span> + params.<span class="property">name</span>);</span><br><span class="line">    res.<span class="title function_">write</span>(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">    res.<span class="title function_">write</span>(<span class="string">&quot;网站 URL：&quot;</span> + params.<span class="property">url</span>);</span><br><span class="line">    res.<span class="title function_">end</span>();</span><br><span class="line"> </span><br><span class="line">&#125;).<span class="title function_">listen</span>(<span class="number">3000</span>);</span><br><span class="line"><span class="comment">// post</span></span><br><span class="line"><span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">&#x27;http&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> querystring = <span class="built_in">require</span>(<span class="string">&#x27;querystring&#x27;</span>);</span><br><span class="line"></span><br><span class="line">http.<span class="title function_">createServer</span>(<span class="keyword">function</span> (<span class="params">req, res</span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> body = <span class="string">&quot;&quot;</span>;</span><br><span class="line">  req.<span class="title function_">on</span>(<span class="string">&#x27;data&#x27;</span>, <span class="keyword">function</span> (<span class="params">chunk</span>) &#123;</span><br><span class="line">    body += chunk;</span><br><span class="line">  &#125;);</span><br><span class="line">  req.<span class="title function_">on</span>(<span class="string">&#x27;end&#x27;</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// 解析参数</span></span><br><span class="line">    body = querystring.<span class="title function_">parse</span>(body);</span><br><span class="line">    <span class="comment">// 设置响应头部信息及编码</span></span><br><span class="line">    res.<span class="title function_">writeHead</span>(<span class="number">200</span>, &#123;<span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;text/html; charset=utf8&#x27;</span>&#125;);</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">if</span>(body.<span class="property">name</span> &amp;&amp; body.<span class="property">url</span>) &#123; <span class="comment">// 输出提交的数据</span></span><br><span class="line">        res.<span class="title function_">write</span>(<span class="string">&quot;网站名：&quot;</span> + body.<span class="property">name</span>);</span><br><span class="line">        res.<span class="title function_">write</span>(<span class="string">&quot;&lt;br&gt;&quot;</span>);</span><br><span class="line">        res.<span class="title function_">write</span>(<span class="string">&quot;网站 URL：&quot;</span> + body.<span class="property">url</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;  <span class="comment">// 输出表单</span></span><br><span class="line">        res.<span class="title function_">write</span>(postHTML);</span><br><span class="line">    &#125;</span><br><span class="line">    res.<span class="title function_">end</span>();</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;).<span class="title function_">listen</span>(<span class="number">3000</span>);</span><br></pre></td></tr></table></figure>

<p><strong>express</strong><br>get 传参接收方法</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/process_get&#x27;</span>, <span class="keyword">function</span> (<span class="params">req, res</span>) &#123;</span><br><span class="line"> </span><br><span class="line">   <span class="comment">// 输出 JSON 格式</span></span><br><span class="line">   <span class="keyword">var</span> response = &#123;</span><br><span class="line">       <span class="string">&quot;first_name&quot;</span>:req.<span class="property">query</span>.<span class="property">first_name</span>,</span><br><span class="line">       <span class="string">&quot;last_name&quot;</span>:req.<span class="property">query</span>.<span class="property">last_name</span></span><br><span class="line">   &#125;;</span><br><span class="line">   <span class="variable language_">console</span>.<span class="title function_">log</span>(response);</span><br><span class="line">   res.<span class="title function_">end</span>(<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(response));</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>post传参接收方法</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">app.<span class="title function_">post</span>(<span class="string">&#x27;/process_post&#x27;</span>, urlencodedParser, <span class="keyword">function</span> (<span class="params">req, res</span>) &#123;</span><br><span class="line"> </span><br><span class="line">   <span class="comment">// 输出 JSON 格式</span></span><br><span class="line">   <span class="keyword">var</span> response = &#123;</span><br><span class="line">       <span class="string">&quot;first_name&quot;</span>:req.<span class="property">body</span>.<span class="property">first_name</span>,</span><br><span class="line">       <span class="string">&quot;last_name&quot;</span>:req.<span class="property">body</span>.<span class="property">last_name</span></span><br><span class="line">   &#125;;</span><br><span class="line">   <span class="variable language_">console</span>.<span class="title function_">log</span>(response);</span><br><span class="line">   res.<span class="title function_">end</span>(<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(response));</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p><strong>koa</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// POST</span></span><br><span class="line"><span class="keyword">const</span> bodyParser = <span class="built_in">require</span>(<span class="string">&#x27;koa-bodyparser&#x27;</span>);</span><br><span class="line">router.<span class="title function_">post</span>(<span class="string">&#x27;/signin&#x27;</span>, <span class="keyword">async</span> (ctx, next) =&gt; &#123;</span><br><span class="line">    <span class="keyword">var</span></span><br><span class="line">        name = ctx.<span class="property">request</span>.<span class="property">body</span>.<span class="property">name</span> || <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">        password = ctx.<span class="property">request</span>.<span class="property">body</span>.<span class="property">password</span> || <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`signin with name: <span class="subst">$&#123;name&#125;</span>, password: <span class="subst">$&#123;password&#125;</span>`</span>);</span><br><span class="line">    <span class="keyword">if</span> (name === <span class="string">&#x27;koa&#x27;</span> &amp;&amp; password === <span class="string">&#x27;12345&#x27;</span>) &#123;</span><br><span class="line">        ctx.<span class="property">response</span>.<span class="property">body</span> = <span class="string">`&lt;h1&gt;Welcome, <span class="subst">$&#123;name&#125;</span>!&lt;/h1&gt;`</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        ctx.<span class="property">response</span>.<span class="property">body</span> = <span class="string">`&lt;h1&gt;Login failed!&lt;/h1&gt;</span></span><br><span class="line"><span class="string">        &lt;p&gt;&lt;a href=&quot;/&quot;&gt;Try again&lt;/a&gt;&lt;/p&gt;`</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line">app.<span class="title function_">use</span>(<span class="title function_">bodyParser</span>());</span><br></pre></td></tr></table></figure>



<h2 id="六、cookie管理"><a href="#六、cookie管理" class="headerlink" title="六、cookie管理"></a>六、cookie管理</h2><p><strong>express</strong><br>使用中间件向 Node.js 服务器发送 cookie 信息</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// express_cookie.js 文件</span></span><br><span class="line"><span class="keyword">var</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>)</span><br><span class="line"><span class="keyword">var</span> cookieParser = <span class="built_in">require</span>(<span class="string">&#x27;cookie-parser&#x27;</span>)</span><br><span class="line"><span class="keyword">var</span> util = <span class="built_in">require</span>(<span class="string">&#x27;util&#x27;</span>);</span><br><span class="line"> </span><br><span class="line"><span class="keyword">var</span> app = <span class="title function_">express</span>()</span><br><span class="line">app.<span class="title function_">use</span>(<span class="title function_">cookieParser</span>())</span><br><span class="line"> </span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/&#x27;</span>, <span class="keyword">function</span>(<span class="params">req, res</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Cookies: &quot;</span> + util.<span class="title function_">inspect</span>(req.<span class="property">cookies</span>));</span><br><span class="line">&#125;)</span><br><span class="line"> </span><br><span class="line">app.<span class="title function_">listen</span>(<span class="number">8081</span>)</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>NodeJS</category>
      </categories>
      <tags>
        <tag>NodeJS</tag>
        <tag>Express</tag>
        <tag>Koa</tag>
      </tags>
  </entry>
  <entry>
    <title>reduce的妙用</title>
    <url>/test/post/reduce%E7%9A%84%E4%BD%BF%E7%94%A8%E6%8A%80%E5%B7%A7/</url>
    <content><![CDATA[<p><strong>reduce</strong> 函数可以根据需要进行累加、过滤、分组、映射等操作，是一个非常强大的数组方法。在数据处理时使用的非常频繁，很多复杂的逻辑如果用reduce去处理，都非常的简洁，在实际的开发工作过程中，积累了一些常见又超级好用的 reduce 技巧的代码片段，筛选了如下 10 个，以供大家参考</p>
<h3 id="reduce-介绍"><a href="#reduce-介绍" class="headerlink" title="reduce 介绍"></a>reduce 介绍</h3><p>reduce 是数组的方法，可以对数组中的每个元素依次执行一个回调函数，从左到右依次累积计算出一个最终的值。其语法为：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">arr.reduce(callback(accumulator, currentValue[, index[, array]])[, initialValue])</span><br></pre></td></tr></table></figure>

<p>其中，callback 是每个元素执行的回调函数，其包含 4 个参数：</p>
<ul>
<li>accumulator：累积器，即上一次回调函数执行的返回值。</li>
<li>currentValue：当前元素的值。</li>
<li>index：当前元素的下标。</li>
<li>array：原始数组。</li>
<li>initialValue 是可选的，表示累积器的初始值。</li>
</ul>
<p>reduce 函数的执行过程如下：</p>
<p>1、如果没有提供 initialValue，则将数组的第一个元素作为累积器的初始值，否则将 initialValue 作为累积器的初始值。</p>
<p>2、从数组的第二个元素开始，依次对数组中的每个元素执行回调函数。</p>
<p>3、回调函数的返回值作为下一次回调函数执行时的累积器的值。</p>
<p>4、对数组中的每个元素执行完回调函数后，reduce 函数返回最后一次回调函数的返回值，即最终的累积值。</p>
<h3 id="计算数组中每个元素出现的次数"><a href="#计算数组中每个元素出现的次数" class="headerlink" title="计算数组中每个元素出现的次数"></a>计算数组中每个元素出现的次数</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> fruits = [<span class="string">&#x27;apple&#x27;</span>, <span class="string">&#x27;banana&#x27;</span>, <span class="string">&#x27;apple&#x27;</span>, <span class="string">&#x27;orange&#x27;</span>, <span class="string">&#x27;banana&#x27;</span>, <span class="string">&#x27;apple&#x27;</span>];</span><br><span class="line"><span class="keyword">const</span> count = fruits.<span class="title function_">reduce</span>(<span class="function">(<span class="params">accumulator, currentValue</span>) =&gt;</span> &#123;</span><br><span class="line">  accumulator[currentValue] = (accumulator[currentValue] || <span class="number">0</span>) + <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">return</span> accumulator;</span><br><span class="line">&#125;, &#123;&#125;);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(count); <span class="comment">// Output: &#123; apple: 3, banana: 2, orange: 1 &#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="数组扁平化"><a href="#数组扁平化" class="headerlink" title="数组扁平化"></a>数组扁平化</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> nestedArray = [[<span class="number">1</span>, <span class="number">2</span>], [<span class="number">3</span>, <span class="number">4</span>], [<span class="number">5</span>, <span class="number">6</span>]];</span><br><span class="line"><span class="keyword">const</span> flattenedArray = nestedArray.<span class="title function_">reduce</span>(<span class="function">(<span class="params">accumulator, currentValue</span>) =&gt;</span> accumulator.<span class="title function_">concat</span>(currentValue), []);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(flattenedArray); <span class="comment">// Output: [1, 2, 3, 4, 5, 6]</span></span><br></pre></td></tr></table></figure>
<h3 id="按条件分组"><a href="#按条件分组" class="headerlink" title="按条件分组"></a>按条件分组</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> people = [</span><br><span class="line">  &#123; <span class="attr">name</span>: <span class="string">&#x27;Alice&#x27;</span>, <span class="attr">age</span>: <span class="number">25</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">name</span>: <span class="string">&#x27;Bob&#x27;</span>, <span class="attr">age</span>: <span class="number">30</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">name</span>: <span class="string">&#x27;Charlie&#x27;</span>, <span class="attr">age</span>: <span class="number">35</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">name</span>: <span class="string">&#x27;David&#x27;</span>, <span class="attr">age</span>: <span class="number">25</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">name</span>: <span class="string">&#x27;Emily&#x27;</span>, <span class="attr">age</span>: <span class="number">30</span> &#125;</span><br><span class="line">];</span><br><span class="line"><span class="keyword">const</span> groupedPeople = people.<span class="title function_">reduce</span>(<span class="function">(<span class="params">accumulator, currentValue</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> key = currentValue.<span class="property">age</span>;</span><br><span class="line">  <span class="keyword">if</span> (!accumulator[key]) &#123;</span><br><span class="line">    accumulator[key] = [];</span><br><span class="line">  &#125;</span><br><span class="line">  accumulator[key].<span class="title function_">push</span>(currentValue);</span><br><span class="line">  <span class="keyword">return</span> accumulator;</span><br><span class="line">&#125;, &#123;&#125;);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(groupedPeople);</span><br><span class="line"><span class="comment">// Output: &#123;</span></span><br><span class="line"><span class="comment">//   25: [&#123; name: &#x27;Alice&#x27;, age: 25 &#125;, &#123; name: &#x27;David&#x27;, age: 25 &#125;],</span></span><br><span class="line"><span class="comment">//   30: [&#123; name: &#x27;Bob&#x27;, age: 30 &#125;, &#123; name: &#x27;Emily&#x27;, age: 30 &#125;],</span></span><br><span class="line"><span class="comment">//   35: [&#123; name: &#x27;Charlie&#x27;, age: 35 &#125;]</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br></pre></td></tr></table></figure>
<h3 id="将多个数组合并为一个对象"><a href="#将多个数组合并为一个对象" class="headerlink" title="将多个数组合并为一个对象"></a>将多个数组合并为一个对象</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> keys = [<span class="string">&#x27;name&#x27;</span>, <span class="string">&#x27;age&#x27;</span>, <span class="string">&#x27;gender&#x27;</span>];</span><br><span class="line"><span class="keyword">const</span> values = [<span class="string">&#x27;Alice&#x27;</span>, <span class="number">25</span>, <span class="string">&#x27;female&#x27;</span>];</span><br><span class="line"><span class="keyword">const</span> person = keys.<span class="title function_">reduce</span>(<span class="function">(<span class="params">accumulator, currentValue, index</span>) =&gt;</span> &#123;</span><br><span class="line">    accumulator[currentValue] = values[index];</span><br><span class="line">    <span class="keyword">return</span> accumulator;</span><br><span class="line">  &#125;, &#123;&#125;);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(person); <span class="comment">// Output: &#123; name: &#x27;Alice&#x27;, age: 25, gender: &#x27;female&#x27; &#125;</span></span><br></pre></td></tr></table></figure>
<h3 id="将字符串转换为对象"><a href="#将字符串转换为对象" class="headerlink" title="将字符串转换为对象"></a>将字符串转换为对象</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> str = <span class="string">&#x27;key1=value1&amp;key2=value2&amp;key3=value3&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> obj = str.<span class="title function_">split</span>(<span class="string">&#x27;&amp;&#x27;</span>).<span class="title function_">reduce</span>(<span class="function">(<span class="params">accumulator, currentValue</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> [key, value] = currentValue.<span class="title function_">split</span>(<span class="string">&#x27;=&#x27;</span>);</span><br><span class="line">  accumulator[key] = value;</span><br><span class="line">  <span class="keyword">return</span> accumulator;</span><br><span class="line">&#125;, &#123;&#125;);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(obj); </span><br><span class="line"><span class="comment">// Output: &#123; key1: &#x27;value1&#x27;, key2: &#x27;value2&#x27;, key3: &#x27;value3&#x27; &#125;</span></span><br></pre></td></tr></table></figure>
<h3 id="将对象转换为查询字符串"><a href="#将对象转换为查询字符串" class="headerlink" title="将对象转换为查询字符串"></a>将对象转换为查询字符串</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> params = &#123; <span class="attr">foo</span>: <span class="string">&quot;bar&quot;</span>, <span class="attr">baz</span>: <span class="number">42</span> &#125;;</span><br><span class="line"><span class="keyword">const</span> queryString = <span class="title class_">Object</span>.<span class="title function_">entries</span>(params).<span class="title function_">reduce</span>(<span class="function">(<span class="params">acc, [key, value]</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">`<span class="subst">$&#123;acc&#125;</span><span class="subst">$&#123;key&#125;</span>=<span class="subst">$&#123;value&#125;</span>&amp;`</span>;</span><br><span class="line">&#125;, <span class="string">&quot;?&quot;</span>).<span class="title function_">slice</span>(<span class="number">0</span>, -<span class="number">1</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(queryString); <span class="comment">// &quot;?foo=bar&amp;baz=42&quot;</span></span><br></pre></td></tr></table></figure>
<h3 id="打印斐波那契数列"><a href="#打印斐波那契数列" class="headerlink" title="打印斐波那契数列"></a>打印斐波那契数列</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">fibonacci</span> = n =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> [...<span class="title class_">Array</span>(n)].<span class="title function_">reduce</span>(<span class="function">(<span class="params">accumulator, currentValue, index</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (index &lt; <span class="number">2</span>) &#123;</span><br><span class="line">      accumulator.<span class="title function_">push</span>(index);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      accumulator.<span class="title function_">push</span>(accumulator[index - <span class="number">1</span>] + accumulator[index - <span class="number">2</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> accumulator;</span><br><span class="line">  &#125;, []);</span><br><span class="line">&#125;;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">fibonacci</span>(<span class="number">10</span>)); <span class="comment">// Output: [0, 1, 1, 2, 3, 5, 8, 13, 21, 34]</span></span><br></pre></td></tr></table></figure>
<h3 id="检查字符串是否是回文字符串"><a href="#检查字符串是否是回文字符串" class="headerlink" title="检查字符串是否是回文字符串"></a>检查字符串是否是回文字符串</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> str = <span class="string">&#x27;racecar&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> isPalindrome = str.<span class="title function_">split</span>(<span class="string">&#x27;&#x27;</span>).<span class="title function_">reduce</span>(<span class="function">(<span class="params">accumulator, currentValue, index, array</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> accumulator &amp;&amp; currentValue === array[array.<span class="property">length</span> - index - <span class="number">1</span>];</span><br><span class="line">&#125;, <span class="literal">true</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(isPalindrome); <span class="comment">// Output: true</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="检查括号是否匹配"><a href="#检查括号是否匹配" class="headerlink" title="检查括号是否匹配"></a>检查括号是否匹配</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> str = <span class="string">&quot;(()()())&quot;</span>;</span><br><span class="line"><span class="keyword">const</span> balanced = str.<span class="title function_">split</span>(<span class="string">&quot;&quot;</span>).<span class="title function_">reduce</span>(<span class="function">(<span class="params">acc, cur</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (cur === <span class="string">&quot;(&quot;</span>) &#123;</span><br><span class="line">    acc++;</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (cur === <span class="string">&quot;)&quot;</span>) &#123;</span><br><span class="line">    acc--;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> acc;</span><br><span class="line">&#125;, <span class="number">0</span>) === <span class="number">0</span>;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(balanced); <span class="comment">// true</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="递归获取对象属性"><a href="#递归获取对象属性" class="headerlink" title="递归获取对象属性"></a>递归获取对象属性</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> user = &#123;</span><br><span class="line">  <span class="attr">info</span>: &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&quot;Jason&quot;</span>,</span><br><span class="line">    <span class="attr">address</span>: &#123; <span class="attr">home</span>: <span class="string">&quot;Shaanxi&quot;</span>, <span class="attr">company</span>: <span class="string">&quot;Xian&quot;</span> &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">get</span>(<span class="params">config, path, defaultVal</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> path.<span class="title function_">split</span>(<span class="string">&#x27;.&#x27;</span>).<span class="title function_">reduce</span>(<span class="function">(<span class="params">config, name</span>) =&gt;</span> config[name], config) || defaultVal;</span><br><span class="line">  <span class="keyword">return</span> fallback;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">get</span>(user, <span class="string">&quot;info.name&quot;</span>); <span class="comment">// Jason</span></span><br><span class="line"><span class="title function_">get</span>(user, <span class="string">&quot;info.address.home&quot;</span>); <span class="comment">// Shaanxi</span></span><br><span class="line"><span class="title function_">get</span>(user, <span class="string">&quot;info.address.company&quot;</span>); <span class="comment">// Xian</span></span><br><span class="line"><span class="title function_">get</span>(user, <span class="string">&quot;info.address.abc&quot;</span>, <span class="string">&quot;default&quot;</span>); <span class="comment">// default</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="手写-reduce"><a href="#手写-reduce" class="headerlink" title="手写 reduce"></a>手写 reduce</h3><p>可以通过手写一个简单的 reduce 函数来更好地理解它的实现原理：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">myReduce</span>(<span class="params">arr, callback, initialValue</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> accumulator = initialValue === <span class="literal">undefined</span> ? arr[<span class="number">0</span>] : initialValue;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = initialValue === <span class="literal">undefined</span> ? <span class="number">1</span> : <span class="number">0</span>; i &lt; arr.<span class="property">length</span>; i++) &#123;</span><br><span class="line">    accumulator = <span class="title function_">callback</span>(accumulator, arr[i], i, arr);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> accumulator;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>上面的代码中，myReduce 函数接受 3 个参数：要执行 reduce 操作的数组 arr、回调函数 callback 和累积器的初始值 initialValue。如果没有提供初始值，则将数组的第一个元素作为累积器的初始值。</p>
<p>接下来，在循环中，如果有 initialValue，则从第一个元素开始遍历 callback，此时 callabck 的第二个参数是从数组的第一项开始的；如果没有 initialValue，则从第二个元素开始遍历 callback，此时 callback 的第二个参数是从数组的第二项开始的从数组的第二个元素开始，依次对数组中的每个元素执行回调函数，并将返回值作为下一次回调函数执行时的累积器的值。</p>
<p>最后，myReduce 函数返回最后一次回调函数的返回值，即最终的累积值。</p>
<p>这个简易的 reduce 函数并没有考虑很多边界情况和复杂的应用场景，但是可以帮助我们更好地理解 reduce 函数的实现原理。</p>
]]></content>
      <categories>
        <category>前端</category>
      </categories>
      <tags>
        <tag>JavaScript</tag>
      </tags>
  </entry>
  <entry>
    <title>一份前端够用的 Linux 命令</title>
    <url>/test/post/linux/</url>
    <content><![CDATA[<h2 id="一份前端够用的-Linux-命令"><a href="#一份前端够用的-Linux-命令" class="headerlink" title="一份前端够用的 Linux 命令"></a>一份前端够用的 Linux 命令</h2><p>我在建站的过程中，必不可少会用到 Linux 命令，所以此篇写一份基本够用的 Linux 命令，会涵盖博客搭建系列文章用到的各种命令，方便查询和学习使用。</p>
<h2 id="0-Owner、Group、Others、Root"><a href="#0-Owner、Group、Others、Root" class="headerlink" title="0. Owner、Group、Others、Root"></a>0. Owner、Group、Others、Root</h2><p>Linux 系统是一种多用户系统，它将文件访问者身份分为三种：</p>
<h3 id="文件所有者（Owner）"><a href="#文件所有者（Owner）" class="headerlink" title="文件所有者（Owner）"></a>文件所有者（Owner）</h3><p>当创建一个用户的时候，Linux 会为该用户创建一个主目录，路径为 <code>/home/&lt;username&gt;</code>，我们可以使用 <code>cd ~</code>，快捷进入主目录。如果你想放一个私密文件，就可以放在自己的主目录里，然后设置只能自己查看。</p>
<h3 id="群组（Group）"><a href="#群组（Group）" class="headerlink" title="群组（Group）"></a>群组（Group）</h3><p>每个用户都有一个用户组，方便多人操作的时候，为一群人分配权限。当创建用户的时候，会自动创建一个与它同名的用户组。</p>
<p>如果一个用户同时属于多个组，用户需要在用户组之间切换，才能具有其他用户组的权限。</p>
<h3 id="其他人（Others）"><a href="#其他人（Others）" class="headerlink" title="其他人（Others）"></a>其他人（Others）</h3><p>既不是文件所有者又不是文件所属群组成员的用户，就是其他人。</p>
<h3 id="超级用户（Root）"><a href="#超级用户（Root）" class="headerlink" title="超级用户（Root）"></a>超级用户（Root）</h3><p>Root 用户是一类特殊的用户，该用户可以访问所有文件。</p>
<h2 id="1-adduser-添加用户-和-passwd-更改密码"><a href="#1-adduser-添加用户-和-passwd-更改密码" class="headerlink" title="1. adduser 添加用户 和 passwd 更改密码"></a>1. adduser 添加用户 和 passwd 更改密码</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># 添加一个名为 git 的用户</span><br><span class="line">adduser git</span><br><span class="line"># 设置 git 用户的密码</span><br><span class="line">passed git</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>但是由于创建的用户权限较低，有的时候我们需要为用户提权，此时我们可以这样做：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># 会打开 sudoers 配置文件</span><br><span class="line">sudo visudo</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>注意同样是编辑 <code>sudoers</code> 配置文件，使用这个命令会比使用 <code>sudo vim /etc/ sudoers</code> 更安全， 除了对语法有校验，并且还会在多用户编辑的时候锁住文件。</p>
<p>打开 <code>sudoers</code> 配置文件后，我们添加这样一行配置：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># Allow git to run any commands anywhere</span><br><span class="line">git ALL=(ALL:ALL) ALL</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>简单解释下这句话 <code>git ALL=(ALL:ALL) ALL</code>：</p>
<ul>
<li>git 表示规则应用的用户名</li>
<li>第一个 <code>ALL</code> 表示规则应用于所有 hosts</li>
<li>第二个 <code>ALL</code> 表示规则应用于所有 users</li>
<li>第三个 <code>ALL</code> 表示规则应用于所有 groups</li>
<li>第四个 <code>ALL</code> 表示规则应用于所有 commands</li>
</ul>
<p>我们保存退出后，<code>git</code> 用户就会获得 root 权限。</p>
<h2 id="2-ls-列出文件和目录"><a href="#2-ls-列出文件和目录" class="headerlink" title="2. ls 列出文件和目录"></a>2. ls 列出文件和目录</h2><ol>
<li><code>ls</code> 列出文件和目录</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[root@iZ2ze learn-typescript.git]# ls</span><br><span class="line">branches  config  description  HEAD  hooks  index  info  objects  refs</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ol>
<li><code>ls -la</code> 由 <code>-a</code> 显示所有文件和目录（包括隐藏）和 <code>-l</code> 显示详细列表组成：</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[root@iZ2ze learn-typescript.git]# ls -la</span><br><span class="line">总用量 20</span><br><span class="line">drwxrwxr-x  7 git git  132 12月 15 12:33 .</span><br><span class="line">drwx------  3 git git  127 12月 15 14:51 ..</span><br><span class="line">drwxrwxr-x  2 git git    6 12月 15 12:21 branches</span><br><span class="line">-rw-rw-r--  1 git git   66 12月 15 12:21 config</span><br><span class="line">-rw-rw-r--  1 git git   73 12月 15 12:21 description</span><br><span class="line">-rw-rw-r--  1 git git   23 12月 15 12:21 HEAD</span><br><span class="line">drwxrwxr-x  2 git git 4096 12月 15 13:10 hooks</span><br><span class="line">-rw-rw-r--  1 git git  217 12月 15 12:33 index</span><br><span class="line">drwxrwxr-x  2 git git   21 12月 15 12:21 info</span><br><span class="line">drwxrwxr-x 10 git git   90 12月 15 12:33 objects</span><br><span class="line">drwxrwxr-x  4 git git   31 12月 15 12:21 refs</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>每一行都有 7 列，我们以 <code>branches</code> 为例讲解每列的含义：</p>
<table>
<thead>
<tr>
<th>drwxrwxr-x</th>
<th>2</th>
<th>git</th>
<th>git</th>
<th>6</th>
<th>12 月 15 12:21</th>
<th>branches</th>
</tr>
</thead>
<tbody><tr>
<td>文件类型和权限信息</td>
<td>链接数或者一级子目录数</td>
<td>所有者</td>
<td>所属组</td>
<td>文件大小，单位字节</td>
<td>最后修改时间</td>
<td>文件名</td>
</tr>
</tbody></table>
<p>重点看第 1 列的内容，以 <code>drwxrwxr-x</code> 为例，这里一共 10 位，第 1 位表示文件类型，其中 <code>-</code> 表示普通文件，<code>d</code> 表示目录文件。</p>
<p>第 2 到第 4 位，表示所有者权限，其中 <code>r</code> 表示读权限，<code>w</code> 表示写权限，<code>x</code> 表示可执行权限， <code>-</code>表示无权限，第 2 到 5 位为 <code>rwx</code>，表示所有者可读可写可执行。</p>
<p>第 5 到第 7 位，表示组用户权限，这里也是 <code>rwx</code>。</p>
<p>第 8 到第 10 位，表示其他用户权限，这里是 <code>r-x</code>，表示有可读可执行权限，无写入权限。</p>
<p>这里再额外补充一点：</p>
<p>像 <code>root</code> 用户创建文件夹的默认权限为 <code>rwxr-xr-x</code>:</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[root@iZ2ze www]# mkdir test</span><br><span class="line">[root@iZ2ze www]# ls -l</span><br><span class="line"></span><br><span class="line">drwxr-xr-x  2 root root  6 12月 17 23:53 test</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>而创建文件的默认权限是 <code>rw-r--r--</code>，注意创建文件默认会去掉 <code>x</code> 权限：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[root@iZ2ze www]# touch index.html</span><br><span class="line">[root@iZ2ze www]# ls -l</span><br><span class="line"></span><br><span class="line">-rw-r--r--  1 root root  0 12月 17 23:54 index.html</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>这就是为什么我们有的时候需要在创建文件后，又加上执行权限。</p>
<h2 id="3-chown-更改文件属主，也可以同时更改文件属组"><a href="#3-chown-更改文件属主，也可以同时更改文件属组" class="headerlink" title="3. chown 更改文件属主，也可以同时更改文件属组"></a>3. chown 更改文件属主，也可以同时更改文件属组</h2><p><strong>chown (change owner)</strong> 语法：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># -R：递归更改文件属组</span><br><span class="line">chown [–R] 属主名 文件名</span><br><span class="line">chown [-R] 属主名：属组名 文件名</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>将 <code>index.html</code> 的所有者更改为 <code>git</code>：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[root@iZ2ze www]# chown git index.html</span><br><span class="line">[root@iZ2ze www]# ls -</span><br><span class="line"></span><br><span class="line">-rw-r--r-- 1 git  root  0 12月 17 23:54 index.html</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>将 <code>index.html</code> 的所有者和群组都改为 <code>git</code>：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[root@iZ2ze www]# chown git:git index.html</span><br><span class="line">[root@iZ2ze www]# ls -l</span><br><span class="line"></span><br><span class="line">-rw-r--r-- 1 git  git   0 12月 17 23:54 index.html</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="4-chmod-更改文件权限"><a href="#4-chmod-更改文件权限" class="headerlink" title="4. chmod 更改文件权限"></a>4. chmod 更改文件权限</h2><p>权限除了用 <code>r</code> <code>w</code> <code>x</code> 这种方式表示，也可以用数字表示，数组与字母的对应关系为：</p>
<ul>
<li>r:4</li>
<li>w:2</li>
<li>x:1</li>
</ul>
<p>之所有如此对应关系，主要还是为了方便推导，比如我们希望一个文件可读可写，那我们可以方便的设置权限为 6（4 + 2），同样，如果我们知道一个权限为 3，我们也可以推导出权限为可写可执行，因为只有 2 + 1 才可能等于 3。</p>
<p>我们看下 <strong>chmod （change mode）</strong>的具体语法：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># -R：递归更改文件属组</span><br><span class="line">chmod [-R] xyz 文件或目录</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>其中 xyz 分别表示 Owner、Group、Others 的权限，如果我们这样设置一个文件的权限：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">chomd 750 index.html</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>我们可以得知，Owner 的权限为 7，为可读可写可执行，Group 的权限为 5，为可读可执行，Others 的权限为 0，表示不可读写不可执行。对应字母为：<code>rwxr-x---</code>。</p>
<p>除了这种数字的方式，还有一种使用符号类型改变权限的方式：</p>
<p>在这种方式里，我们将三种身份 <code>Owner</code>、<code>Group</code>、<code>Others</code>，分别简写为 <code>u（User）</code>、<code>g</code>、<code>o</code>，用 <code>a</code> 表示所有身份，再使用 <code>+</code> <code>-</code> <code>=</code> 表示加入、去除、设定一个权限，<code>r</code> <code>w</code> <code>x</code> 则继续表示读，写，执行权限，举个例子：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">chomd u+x,g-x,o-x index.html</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>意思就是 <code>Owner</code> 加上执行权限，<code>Group</code> 和 <code>Others</code> 去除执行权限。</p>
<p>当然我们也可以直接设定权限</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">chmod u=rwx,g=rx,o=r index.html</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>此时文件的权限就相当于 <code>-rwxr-xr--</code>。</p>
<p>此外，我们还可以省略不写 <code>ugoa</code> 这类身份内容，直接写：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">chmod +x index.html</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>此时相当于使用了 <code>a</code>，会给所有身份添加执行权限。</p>
<h2 id="5-su-切换身份"><a href="#5-su-切换身份" class="headerlink" title="5. su 切换身份"></a>5. su 切换身份</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># 切换为 git 用户</span><br><span class="line">su git</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="6-whoami-显示用户名"><a href="#6-whoami-显示用户名" class="headerlink" title="6. whoami 显示用户名"></a>6. whoami 显示用户名</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># whoami</span><br><span class="line">root</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="7-pwd-显示当前目录"><a href="#7-pwd-显示当前目录" class="headerlink" title="7. pwd 显示当前目录"></a>7. pwd 显示当前目录</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[git@iZ2ze www]$ pwd</span><br><span class="line">/home/www</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="9-cd-切换工作目录"><a href="#9-cd-切换工作目录" class="headerlink" title="9. cd 切换工作目录"></a>9. cd 切换工作目录</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># 进入 /home/www/</span><br><span class="line">cd /home/www</span><br><span class="line"></span><br><span class="line"># 进入自己的主目录</span><br><span class="line">cd ~</span><br><span class="line"></span><br><span class="line"># 进入当前目录的上上两层 :</span><br><span class="line">cd ../..</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="10-mkdir-创建目录"><a href="#10-mkdir-创建目录" class="headerlink" title="10. mkdir 创建目录"></a>10. mkdir 创建目录</h2><ol>
<li><code>mkdir</code> 创建目录：</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">mkdir new_folder</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ol>
<li><code>mkdir -p</code> 递归创建目录：</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">mkdir -p one/two/three</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="11-touch-创建文件"><a href="#11-touch-创建文件" class="headerlink" title="11. touch 创建文件"></a>11. touch 创建文件</h2><p>用于修改文件或者目录的时间属性，当文件不存在，系统会创建空白文件</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">touch new_file</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="12-echo-打印输出"><a href="#12-echo-打印输出" class="headerlink" title="12. echo 打印输出"></a>12. echo 打印输出</h2><p>echo 是 Shell 命令，用于打印输出：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># 显示转义字符</span><br><span class="line">echo &quot;\&quot;test content\&quot;&quot;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>创建或覆盖文件内容为 “test content”：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">echo &quot;test content&quot; &gt; index.html</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>如果是想追加内容，就用 <code>&gt;&gt;</code> ：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[root@iZ2ze www]# echo &quot;test content&quot; &gt; index.html</span><br><span class="line">[root@iZ2ze www]# cat index.html</span><br><span class="line">test content</span><br><span class="line">[root@iZ2ze www]# echo &quot;test content&quot; &gt;&gt; index.html</span><br><span class="line">[root@iZ2ze www]# cat index.html</span><br><span class="line">test content</span><br><span class="line">test content</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="13-cat-连接文件并打印输出"><a href="#13-cat-连接文件并打印输出" class="headerlink" title="13. cat 连接文件并打印输出"></a>13. cat 连接文件并打印输出</h2><p>查看文件内容：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">cat ~/.ssh/id_rsa.pub</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>清空 index.html 内容：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">cat /dev/null &gt; index.html</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>把 index.html 的内容写入 second.html：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">cat index.html &gt; second.html</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>把 index.html 的内容追加写入 second.html：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">cat index.html &gt;&gt; second.html</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>把 index.html 和 second.html 追加写入 third.html：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">cat index.html second.html &gt;&gt; third.html</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="14-cp-复制文件或目录"><a href="#14-cp-复制文件或目录" class="headerlink" title="14. cp 复制文件或目录"></a>14. cp 复制文件或目录</h2><p>将目录 website&#x2F; 下的所有文件复制到新目录 static 下：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># -r：若给出的源文件是一个目录文件，此时将复制该目录下所有的子目录和文件。</span><br><span class="line">cp –r website/ static</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="15-mv-移动并重命名"><a href="#15-mv-移动并重命名" class="headerlink" title="15. mv 移动并重命名"></a>15. mv 移动并重命名</h2><p>文件改名：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">mv index.html index2.html</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>隐藏文件：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># 文件名上加上 .</span><br><span class="line">mv index.html .index.html</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>移动文件：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># 仅仅移动</span><br><span class="line">mv  /home/www/index.html   /home/static/</span><br><span class="line"># 移动又重命名</span><br><span class="line">mv /home/www/index.html   /home/static/index2.html</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>批量移动：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">mv  /home/www/website/*  /home/www/static</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="16-rm-删除一个文件或者目录"><a href="#16-rm-删除一个文件或者目录" class="headerlink" title="16. rm 删除一个文件或者目录"></a>16. rm 删除一个文件或者目录</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># 系统会询问</span><br><span class="line">rm file</span><br><span class="line"></span><br><span class="line"># -f 表示直接删除</span><br><span class="line"># -r 表示目录下的所有文件删除</span><br><span class="line"></span><br><span class="line"># 删除当前目录下的所有文件及目录</span><br><span class="line">rm -r  *</span><br><span class="line"></span><br><span class="line"># 跑路</span><br><span class="line">rm -rf /*</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="17-vi-vim"><a href="#17-vi-vim" class="headerlink" title="17. vi&#x2F;vim"></a>17. vi&#x2F;vim</h2><p>Linux 内建 vi 文书编辑器，Vim 是从 vi 发展出来的一个文本编辑器。</p>
<p>基本上 vi&#x2F;vim 共分为三种模式，分别是<strong>命令模式（Command mode）</strong>，<strong>输入模式（Insert mode</strong>）和<strong>底线命令模式（Last line mode）</strong>。我们边操作边介绍这三种模式：我们执行 <code>vim index.html</code>，如果没有该文件，则会创建文件：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">vim index.html</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>此时界面为：</p>
<p><img src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" alt="图片"></p>
<p>此时是<strong>命令模式</strong>，在命令模式下，输入的任何字符都会被视为命令，接下来几个常用的命令：</p>
<ul>
<li>i 切换到输入模式。</li>
<li>x 删除当前光标所在处的字符。</li>
<li>: 切换到底线命令模式。</li>
</ul>
<p>我们按下 <code>i</code>，便会进入<strong>输入模式</strong>：</p>
<p><img src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" alt="图片"></p>
<p>输入模式下，左下角有 <code>-- INSERT --</code> 标志：</p>
<p>此时我们可以进行各种输入，当输入完毕后，按下 ESC 回到命令模式：</p>
<p><img src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" alt="图片"></p>
<p>此时左下角的 INSERT 已经消失不见了，如果我们要保存退出，我们先输入 <code>:</code> ，进入<strong>底线命令模式</strong>：</p>
<p>在底线命令模式中，常见的命令有：</p>
<ul>
<li>w 保存文件</li>
<li>q 退出程序</li>
</ul>
<p>我们输入 <code>wq</code>，表示保存并退出，此时我们就会发现并创建了一个 HTML 文件。</p>
<h2 id="18-ssh-远程连接工具"><a href="#18-ssh-远程连接工具" class="headerlink" title="18. ssh 远程连接工具"></a>18. ssh 远程连接工具</h2><p>注意 ssh 监听是 22 端口。</p>
<p>其基本语法为：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ssh [OPTIONS] [-p PORT] [USER@]HOSTNAME [COMMAND]</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>监听端口示例：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ssh -p 300 git@8.8.8.8</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>打开调试模式：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># -v 冗详模式，打印关于运行情况的调试信息</span><br><span class="line">ssh -v git@8.8.8.8</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="Linux-下安装-MySQL"><a href="#Linux-下安装-MySQL" class="headerlink" title="Linux 下安装 MySQL"></a>Linux 下安装 MySQL</h2><p>参考链接 <a href="https://blog.csdn.net/weixin_50367873/article/details/121975384?spm=1001.2014.3001.5501">Linux 下安装 Mysql（rpm 包安装）</a>。</p>
]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>Linux</tag>
      </tags>
  </entry>
  <entry>
    <title>test</title>
    <url>/test/post/test/</url>
    <content><![CDATA[<h2 id="博客目录"><a href="#博客目录" class="headerlink" title="博客目录"></a>博客目录</h2><p>打造一系列前端进阶的优质文章，博客将侧重于原生JS、 React、ReactNative和Webpack等入门与底层原理分析，只有在自己实践和深入理解后，才会输出相关博文，以确保博文内容的准确性。</p>
<p>微信公众号:</p>
<p><img src="https://i.loli.net/2020/02/27/fg2FYebTAR5hjUt.jpg"></p>
<p>欢迎关注本人的博文:</p>
<ul>
<li><h4 id="segmentFault"><a href="#segmentFault" class="headerlink" title="segmentFault"></a><a href="https://segmentfault.com/u/liuyan666/articles">segmentFault</a></h4></li>
<li><h4 id="掘金"><a href="#掘金" class="headerlink" title="掘金"></a><a href="https://juejin.im/user/5c6256596fb9a049bd42c770/posts">掘金</a></h4></li>
</ul>
<blockquote>
<h2 id="面试系列"><a href="#面试系列" class="headerlink" title="面试系列"></a>面试系列</h2></blockquote>
<ol>
<li><a href="https://github.com/YvetteLau/Blog/issues/7">【面试篇】寒冬求职季之你必须要懂的原生JS(上)</a></li>
<li><a href="https://github.com/YvetteLau/Blog/issues/28">【面试篇】寒冬求职季之你必须要懂的原生JS(中)</a></li>
<li><a href="https://github.com/YvetteLau/Blog/issues/29">【面试篇】寒冬求职之你必须要懂的Web安全</a></li>
<li><a href="https://github.com/YvetteLau/Blog/issues/35">这儿有20道大厂面试题等你查收</a></li>
</ol>
<blockquote>
<h2 id="Step-By-Step"><a href="#Step-By-Step" class="headerlink" title="Step-By-Step"></a>Step-By-Step</h2></blockquote>
<ol>
<li><a href="https://github.com/YvetteLau/Blog/issues/31">【Step-By-Step】高频面试题深入解析 &#x2F; 周刊 01</a></li>
<li><a href="https://github.com/YvetteLau/Blog/issues/32">【Step-By-Step】高频面试题深入解析&#x2F; 周刊 02</a></li>
<li><a href="https://github.com/YvetteLau/Blog/issues/33">【Step-By-Step】高频面试题深入解析&#x2F; 周刊 03</a></li>
<li><a href="https://github.com/YvetteLau/Blog/issues/34">【Step-By-Step】高频面试题深入解析&#x2F; 周刊 04</a></li>
<li><a href="https://github.com/YvetteLau/Blog/issues/36">【Step-By-Step】高频面试题深入解析&#x2F; 周刊 05</a></li>
<li><a href="https://github.com/YvetteLau/Blog/issues/37">【Step-By-Step】高频面试题深入解析&#x2F; 周刊 06</a></li>
<li><a href="https://github.com/YvetteLau/Blog/issues/38">【Step-By-Step】高频面试题深入解析&#x2F; 周刊 07</a></li>
</ol>
<blockquote>
<h2 id="Javascript"><a href="#Javascript" class="headerlink" title="Javascript"></a>Javascript</h2></blockquote>
<ol>
<li><a href="https://github.com/YvetteLau/Blog/issues/2">Promise的源码实现(完美符合PromiseA+规范)</a></li>
<li><a href="https://github.com/YvetteLau/Blog/issues/4">彻底搞懂浏览器Event-loop</a></li>
<li><a href="https://github.com/YvetteLau/Blog/issues/6">嗨，你真的懂this吗？</a></li>
<li><a href="https://github.com/YvetteLau/Blog/issues/30">细说JS异步发展历程</a></li>
<li><a href="https://github.com/YvetteLau/Blog/issues/39">【中高级前端必备】手摸手教你撸一个脚手架</a></li>
<li><a href="https://github.com/YvetteLau/Blog/issues/40">Proxy及其优点</a></li>
<li><a href="https://github.com/YvetteLau/Blog/issues/41">深入理解全能的 Reducer</a></li>
</ol>
<blockquote>
<h2 id="React"><a href="#React" class="headerlink" title="React"></a>React</h2></blockquote>
<ol>
<li><a href="https://github.com/YvetteLau/Blog/issues/3">React新旧生命周期一览</a></li>
<li><a href="https://github.com/YvetteLau/Blog/issues/42">可靠React组件设计的7个准则之SRP</a></li>
<li><a href="https://github.com/YvetteLau/Blog/issues/43">可靠React组件设计的7个准则之封装</a></li>
<li><a href="https://github.com/YvetteLau/Blog/issues/50">React中组件逻辑复用的那些事儿</a></li>
</ol>
<blockquote>
<h2 id="Webpack"><a href="#Webpack" class="headerlink" title="Webpack"></a>Webpack</h2></blockquote>
<ol>
<li><a href="https://github.com/YvetteLau/Blog/issues/1">从零开始配置webpack(基于babel 7版本)</a></li>
</ol>
<blockquote>
<h2 id="移动web"><a href="#移动web" class="headerlink" title="移动web"></a>移动web</h2></blockquote>
<ol>
<li><a href="https://github.com/YvetteLau/Blog/issues/5">9102了，你还不会移动端真机调试？</a></li>
</ol>
]]></content>
      <tags>
        <tag>test</tag>
      </tags>
  </entry>
  <entry>
    <title>JS 前端常用工具方法</title>
    <url>/test/post/utils/</url>
    <content><![CDATA[<h2 id="JS-前端常用工具方法"><a href="#JS-前端常用工具方法" class="headerlink" title="JS 前端常用工具方法"></a>JS 前端常用工具方法</h2><p>::: tip 提示<br>很实用的工具方法哦，建议收藏！:stuck_out_tongue_winking_eye:<br>:::</p>
<p>邮箱验证</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">isEmail</span> = (<span class="params">s</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="regexp">/^([a-zA-Z0-9_-])+@([a-zA-Z0-9_-])+((.[a-zA-Z0-9_-]&#123;2,3&#125;)&#123;1,2&#125;)$/</span>.<span class="title function_">test</span>(</span><br><span class="line">    s</span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>手机号码</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">isMobile</span> = (<span class="params">s</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="regexp">/^1[0-9]&#123;10&#125;$/</span>.<span class="title function_">test</span>(s);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>电话号码</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">isPhone</span> = (<span class="params">s</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="regexp">/^([0-9]&#123;3,4&#125;-)?[0-9]&#123;7,8&#125;$/</span>.<span class="title function_">test</span>(s);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>是否 url 地址</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">isURL</span> = (<span class="params">s</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="regexp">/^http[s]?:\/\/.*/</span>.<span class="title function_">test</span>(s);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>是否字符串</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">isString</span> = (<span class="params">o</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">toString</span>.<span class="title function_">call</span>(o).<span class="title function_">slice</span>(<span class="number">8</span>, -<span class="number">1</span>) === <span class="string">&quot;String&quot;</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>数据类型检测</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">toString</span></span><br><span class="line">  .<span class="title function_">call</span>(data)</span><br><span class="line">  .<span class="title function_">replace</span>(<span class="regexp">/\[object (\w+)\]/</span>, <span class="string">&quot;$1&quot;</span>)</span><br><span class="line">  .<span class="title function_">toLowerCase</span>();</span><br></pre></td></tr></table></figure>

<p>打乱数组</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">shuffleArray</span> = (<span class="params">arr</span>) =&gt; arr.<span class="title function_">sort</span>(<span class="function">() =&gt;</span> <span class="number">0.5</span> - <span class="title class_">Math</span>.<span class="title function_">random</span>());</span><br></pre></td></tr></table></figure>

<p>是否函数</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">isFunction</span> = (<span class="params">o</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">toString</span>.<span class="title function_">call</span>(o).<span class="title function_">slice</span>(<span class="number">8</span>, -<span class="number">1</span>) === <span class="string">&quot;Function&quot;</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>是否错误对象</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">isError</span> = (<span class="params">o</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">toString</span>.<span class="title function_">call</span>(o).<span class="title function_">slice</span>(<span class="number">8</span>, -<span class="number">1</span>) === <span class="string">&quot;Error&quot;</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>是否是微信浏览器</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">isWeiXin</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> ua.<span class="title function_">match</span>(<span class="regexp">/microMessenger/i</span>) == <span class="string">&quot;micromessenger&quot;</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>是否是移动端</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">isDeviceMobile</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="regexp">/android|webos|iphone|ipod|balckberry/i</span>.<span class="title function_">test</span>(ua);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>是否是 QQ 浏览器</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">isQQBrowser</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> !!ua.<span class="title function_">match</span>(<span class="regexp">/mqqbrowser|qzone|qqbrowser|qbwebviewtype/i</span>);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>是否是爬虫</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">isSpider</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="regexp">/adsbot|googlebot|bingbot|msnbot|yandexbot|baidubot|robot|careerbot|seznambot|bot|baiduspider|jikespider|symantecspider|scannerlwebcrawler|crawler|360spider|sosospider|sogou web sprider|sogou orion spider/</span>.<span class="title function_">test</span>(</span><br><span class="line">    ua</span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>是否 ios</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">isIos</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">var</span> u = navigator.<span class="property">userAgent</span>;</span><br><span class="line">  <span class="keyword">if</span> (u.<span class="title function_">indexOf</span>(<span class="string">&quot;Android&quot;</span>) &gt; -<span class="number">1</span> || u.<span class="title function_">indexOf</span>(<span class="string">&quot;Linux&quot;</span>) &gt; -<span class="number">1</span>) &#123;</span><br><span class="line">    <span class="comment">//安卓手机</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (u.<span class="title function_">indexOf</span>(<span class="string">&quot;iPhone&quot;</span>) &gt; -<span class="number">1</span>) &#123;</span><br><span class="line">    <span class="comment">//苹果手机</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (u.<span class="title function_">indexOf</span>(<span class="string">&quot;iPad&quot;</span>) &gt; -<span class="number">1</span>) &#123;</span><br><span class="line">    <span class="comment">//iPad</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (u.<span class="title function_">indexOf</span>(<span class="string">&quot;Windows Phone&quot;</span>) &gt; -<span class="number">1</span>) &#123;</span><br><span class="line">    <span class="comment">//winphone手机</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>是否为 PC 端</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">isPC</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">var</span> userAgentInfo = navigator.<span class="property">userAgent</span>;</span><br><span class="line">  <span class="keyword">var</span> <span class="title class_">Agents</span> = [</span><br><span class="line">    <span class="string">&quot;Android&quot;</span>,</span><br><span class="line">    <span class="string">&quot;iPhone&quot;</span>,</span><br><span class="line">    <span class="string">&quot;SymbianOS&quot;</span>,</span><br><span class="line">    <span class="string">&quot;Windows Phone&quot;</span>,</span><br><span class="line">    <span class="string">&quot;iPad&quot;</span>,</span><br><span class="line">    <span class="string">&quot;iPod&quot;</span>,</span><br><span class="line">  ];</span><br><span class="line">  <span class="keyword">var</span> flag = <span class="literal">true</span>;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> v = <span class="number">0</span>; v &lt; <span class="title class_">Agents</span>.<span class="property">length</span>; v++) &#123;</span><br><span class="line">    <span class="keyword">if</span> (userAgentInfo.<span class="title function_">indexOf</span>(<span class="title class_">Agents</span>[v]) &gt; <span class="number">0</span>) &#123;</span><br><span class="line">      flag = <span class="literal">false</span>;</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> flag;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>去除 html 标签</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">removeHtmltag</span> = (<span class="params">str</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> str.<span class="title function_">replace</span>(<span class="regexp">/&lt;[^&gt;]+&gt;/g</span>, <span class="string">&quot;&quot;</span>);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>获取 url 参数</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">getQueryString</span> = (<span class="params">name</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> reg = <span class="keyword">new</span> <span class="title class_">RegExp</span>(<span class="string">&quot;(^|&amp;)&quot;</span> + name + <span class="string">&quot;=([^&amp;]*)(&amp;|$)&quot;</span>, <span class="string">&quot;i&quot;</span>);</span><br><span class="line">  <span class="keyword">const</span> search = <span class="variable language_">window</span>.<span class="property">location</span>.<span class="property">search</span>.<span class="title function_">split</span>(<span class="string">&quot;?&quot;</span>)[<span class="number">1</span>] || <span class="string">&quot;&quot;</span>;</span><br><span class="line">  <span class="keyword">const</span> r = search.<span class="title function_">match</span>(reg) || [];</span><br><span class="line">  <span class="keyword">return</span> r[<span class="number">2</span>];</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>动态引入 js</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">injectScript</span> = (<span class="params">src</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> s = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&quot;script&quot;</span>);</span><br><span class="line">  s.<span class="property">type</span> = <span class="string">&quot;text/javascript&quot;</span>;</span><br><span class="line">  s.<span class="property">async</span> = <span class="literal">true</span>;</span><br><span class="line">  s.<span class="property">src</span> = src;</span><br><span class="line">  <span class="keyword">const</span> t = <span class="variable language_">document</span>.<span class="title function_">getElementsByTagName</span>(<span class="string">&quot;script&quot;</span>)[<span class="number">0</span>];</span><br><span class="line">  t.<span class="property">parentNode</span>.<span class="title function_">insertBefore</span>(s, t);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>el 是否包含某个 class</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">hasClass</span> = (<span class="params">el, className</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">let</span> reg = <span class="keyword">new</span> <span class="title class_">RegExp</span>(<span class="string">&quot;(^|\\s)&quot;</span> + className + <span class="string">&quot;(\\s|$)&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> reg.<span class="title function_">test</span>(el.<span class="property">className</span>);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>获取滚动的坐标</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">getScrollPosition</span> = (<span class="params">el = <span class="variable language_">window</span></span>) =&gt; (&#123;</span><br><span class="line">  <span class="attr">x</span>: el.<span class="property">pageXOffset</span> !== <span class="literal">undefined</span> ? el.<span class="property">pageXOffset</span> : el.<span class="property">scrollLeft</span>,</span><br><span class="line">  <span class="attr">y</span>: el.<span class="property">pageYOffset</span> !== <span class="literal">undefined</span> ? el.<span class="property">pageYOffset</span> : el.<span class="property">scrollTop</span>,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>滚动到顶部</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">scrollToTop</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> c = <span class="variable language_">document</span>.<span class="property">documentElement</span>.<span class="property">scrollTop</span> || <span class="variable language_">document</span>.<span class="property">body</span>.<span class="property">scrollTop</span>;</span><br><span class="line">  <span class="keyword">if</span> (c &gt; <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="variable language_">window</span>.<span class="title function_">requestAnimationFrame</span>(scrollToTop);</span><br><span class="line">    <span class="variable language_">window</span>.<span class="title function_">scrollTo</span>(<span class="number">0</span>, c - c / <span class="number">8</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// window.scrollTo(0,0)</span></span><br></pre></td></tr></table></figure>

<p>el 是否在视口范围内</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">elementIsVisibleInViewport</span> = (<span class="params">el, partiallyVisible = <span class="literal">false</span></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; top, left, bottom, right &#125; = el.<span class="title function_">getBoundingClientRect</span>();</span><br><span class="line">  <span class="keyword">const</span> &#123; innerHeight, innerWidth &#125; = <span class="variable language_">window</span>;</span><br><span class="line">  <span class="keyword">return</span> partiallyVisible</span><br><span class="line">    ? ((top &gt; <span class="number">0</span> &amp;&amp; top &lt; innerHeight) ||</span><br><span class="line">        (bottom &gt; <span class="number">0</span> &amp;&amp; bottom &lt; innerHeight)) &amp;&amp;</span><br><span class="line">        ((left &gt; <span class="number">0</span> &amp;&amp; left &lt; innerWidth) || (right &gt; <span class="number">0</span> &amp;&amp; right &lt; innerWidth))</span><br><span class="line">    : top &gt;= <span class="number">0</span> &amp;&amp; left &gt;= <span class="number">0</span> &amp;&amp; bottom &lt;= innerHeight &amp;&amp; right &lt;= innerWidth;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>洗牌算法随机</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">shuffle</span> = (<span class="params">arr</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">var</span> result = [],</span><br><span class="line">    random;</span><br><span class="line">  <span class="keyword">while</span> (arr.<span class="property">length</span> &gt; <span class="number">0</span>) &#123;</span><br><span class="line">    random = <span class="title class_">Math</span>.<span class="title function_">floor</span>(<span class="title class_">Math</span>.<span class="title function_">random</span>() * arr.<span class="property">length</span>);</span><br><span class="line">    result.<span class="title function_">push</span>(arr[random]);</span><br><span class="line">    arr.<span class="title function_">splice</span>(random, <span class="number">1</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>判断类型集合</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">checkStr</span> = (<span class="params">str, type</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">switch</span> (type) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&quot;phone&quot;</span>: <span class="comment">//手机号码</span></span><br><span class="line">      <span class="keyword">return</span> <span class="regexp">/^1[3|4|5|6|7|8|9][0-9]&#123;9&#125;$/</span>.<span class="title function_">test</span>(str);</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&quot;tel&quot;</span>: <span class="comment">//座机</span></span><br><span class="line">      <span class="keyword">return</span> <span class="regexp">/^(0\d&#123;2,3&#125;-\d&#123;7,8&#125;)(-\d&#123;1,4&#125;)?$/</span>.<span class="title function_">test</span>(str);</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&quot;card&quot;</span>: <span class="comment">//身份证</span></span><br><span class="line">      <span class="keyword">return</span> <span class="regexp">/(^\d&#123;15&#125;$)|(^\d&#123;18&#125;$)|(^\d&#123;17&#125;(\d|X|x)$)/</span>.<span class="title function_">test</span>(str);</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&quot;pwd&quot;</span>: <span class="comment">//密码以字母开头，长度在6~18之间，只能包含字母、数字和下划线</span></span><br><span class="line">      <span class="keyword">return</span> <span class="regexp">/^[a-zA-Z]\w&#123;5,17&#125;$/</span>.<span class="title function_">test</span>(str);</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&quot;postal&quot;</span>: <span class="comment">//邮政编码</span></span><br><span class="line">      <span class="keyword">return</span> <span class="regexp">/[1-9]\d&#123;5&#125;(?!\d)/</span>.<span class="title function_">test</span>(str);</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&quot;QQ&quot;</span>: <span class="comment">//QQ号</span></span><br><span class="line">      <span class="keyword">return</span> <span class="regexp">/^[1-9][0-9]&#123;4,9&#125;$/</span>.<span class="title function_">test</span>(str);</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&quot;email&quot;</span>: <span class="comment">//邮箱</span></span><br><span class="line">      <span class="keyword">return</span> <span class="regexp">/^[\w-]+(\.[\w-]+)*@[\w-]+(\.[\w-]+)+$/</span>.<span class="title function_">test</span>(str);</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&quot;money&quot;</span>: <span class="comment">//金额(小数点2位)</span></span><br><span class="line">      <span class="keyword">return</span> <span class="regexp">/^\d*(?:\.\d&#123;0,2&#125;)?$/</span>.<span class="title function_">test</span>(str);</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&quot;URL&quot;</span>: <span class="comment">//网址</span></span><br><span class="line">      <span class="keyword">return</span> <span class="regexp">/(http|ftp|https):\/\/[\w\-_]+(\.[\w\-_]+)+([\w\-\.,@?^=%&amp;:/~\+#]*[\w\-\@?^=%&amp;/~\+#])?/</span>.<span class="title function_">test</span>(</span><br><span class="line">        str</span><br><span class="line">      );</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&quot;IP&quot;</span>: <span class="comment">//IP</span></span><br><span class="line">      <span class="keyword">return</span> <span class="regexp">/((?:(?:25[0-5]|2[0-4]\\d|[01]?\\d?\\d)\\.)&#123;3&#125;(?:25[0-5]|2[0-4]\\d|[01]?\\d?\\d))/</span>.<span class="title function_">test</span>(</span><br><span class="line">        str</span><br><span class="line">      );</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&quot;date&quot;</span>: <span class="comment">//日期时间</span></span><br><span class="line">      <span class="keyword">return</span> (</span><br><span class="line">        <span class="regexp">/^(\d&#123;4&#125;)\-(\d&#123;2&#125;)\-(\d&#123;2&#125;) (\d&#123;2&#125;)(?:\:\d&#123;2&#125;|:(\d&#123;2&#125;):(\d&#123;2&#125;))$/</span>.<span class="title function_">test</span>(</span><br><span class="line">          str</span><br><span class="line">        ) || <span class="regexp">/^(\d&#123;4&#125;)\-(\d&#123;2&#125;)\-(\d&#123;2&#125;)$/</span>.<span class="title function_">test</span>(str)</span><br><span class="line">      );</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&quot;number&quot;</span>: <span class="comment">//数字</span></span><br><span class="line">      <span class="keyword">return</span> <span class="regexp">/^[0-9]$/</span>.<span class="title function_">test</span>(str);</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&quot;english&quot;</span>: <span class="comment">//英文</span></span><br><span class="line">      <span class="keyword">return</span> <span class="regexp">/^[a-zA-Z]+$/</span>.<span class="title function_">test</span>(str);</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&quot;chinese&quot;</span>: <span class="comment">//中文</span></span><br><span class="line">      <span class="keyword">return</span> <span class="regexp">/^[\\u4E00-\\u9FA5]+$/</span>.<span class="title function_">test</span>(str);</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&quot;lower&quot;</span>: <span class="comment">//小写</span></span><br><span class="line">      <span class="keyword">return</span> <span class="regexp">/^[a-z]+$/</span>.<span class="title function_">test</span>(str);</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&quot;upper&quot;</span>: <span class="comment">//大写</span></span><br><span class="line">      <span class="keyword">return</span> <span class="regexp">/^[A-Z]+$/</span>.<span class="title function_">test</span>(str);</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&quot;HTML&quot;</span>: <span class="comment">//HTML标记</span></span><br><span class="line">      <span class="keyword">return</span> <span class="regexp">/&lt;(&quot;[^&quot;]*&quot;|&#x27;[^&#x27;]*&#x27;|[^&#x27;&quot;&gt;])*&gt;/</span>.<span class="title function_">test</span>(str);</span><br><span class="line">    <span class="attr">default</span>:</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>严格的身份证校验</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">isCardID</span> = (<span class="params">sId</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">if</span> (!<span class="regexp">/(^\d&#123;15&#125;$)|(^\d&#123;17&#125;(\d|X|x)$)/</span>.<span class="title function_">test</span>(sId)) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;你输入的身份证长度或格式错误&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//身份证城市</span></span><br><span class="line">  <span class="keyword">var</span> aCity = &#123;</span><br><span class="line">    <span class="number">11</span>: <span class="string">&quot;北京&quot;</span>,</span><br><span class="line">    <span class="number">12</span>: <span class="string">&quot;天津&quot;</span>,</span><br><span class="line">    <span class="number">13</span>: <span class="string">&quot;河北&quot;</span>,</span><br><span class="line">    <span class="number">14</span>: <span class="string">&quot;山西&quot;</span>,</span><br><span class="line">    <span class="number">15</span>: <span class="string">&quot;内蒙古&quot;</span>,</span><br><span class="line">    <span class="number">21</span>: <span class="string">&quot;辽宁&quot;</span>,</span><br><span class="line">    <span class="number">22</span>: <span class="string">&quot;吉林&quot;</span>,</span><br><span class="line">    <span class="number">23</span>: <span class="string">&quot;黑龙江&quot;</span>,</span><br><span class="line">    <span class="number">31</span>: <span class="string">&quot;上海&quot;</span>,</span><br><span class="line">    <span class="number">32</span>: <span class="string">&quot;江苏&quot;</span>,</span><br><span class="line">    <span class="number">33</span>: <span class="string">&quot;浙江&quot;</span>,</span><br><span class="line">    <span class="number">34</span>: <span class="string">&quot;安徽&quot;</span>,</span><br><span class="line">    <span class="number">35</span>: <span class="string">&quot;福建&quot;</span>,</span><br><span class="line">    <span class="number">36</span>: <span class="string">&quot;江西&quot;</span>,</span><br><span class="line">    <span class="number">37</span>: <span class="string">&quot;山东&quot;</span>,</span><br><span class="line">    <span class="number">41</span>: <span class="string">&quot;河南&quot;</span>,</span><br><span class="line">    <span class="number">42</span>: <span class="string">&quot;湖北&quot;</span>,</span><br><span class="line">    <span class="number">43</span>: <span class="string">&quot;湖南&quot;</span>,</span><br><span class="line">    <span class="number">44</span>: <span class="string">&quot;广东&quot;</span>,</span><br><span class="line">    <span class="number">45</span>: <span class="string">&quot;广西&quot;</span>,</span><br><span class="line">    <span class="number">46</span>: <span class="string">&quot;海南&quot;</span>,</span><br><span class="line">    <span class="number">50</span>: <span class="string">&quot;重庆&quot;</span>,</span><br><span class="line">    <span class="number">51</span>: <span class="string">&quot;四川&quot;</span>,</span><br><span class="line">    <span class="number">52</span>: <span class="string">&quot;贵州&quot;</span>,</span><br><span class="line">    <span class="number">53</span>: <span class="string">&quot;云南&quot;</span>,</span><br><span class="line">    <span class="number">54</span>: <span class="string">&quot;西藏&quot;</span>,</span><br><span class="line">    <span class="number">61</span>: <span class="string">&quot;陕西&quot;</span>,</span><br><span class="line">    <span class="number">62</span>: <span class="string">&quot;甘肃&quot;</span>,</span><br><span class="line">    <span class="number">63</span>: <span class="string">&quot;青海&quot;</span>,</span><br><span class="line">    <span class="number">64</span>: <span class="string">&quot;宁夏&quot;</span>,</span><br><span class="line">    <span class="number">65</span>: <span class="string">&quot;新疆&quot;</span>,</span><br><span class="line">    <span class="number">71</span>: <span class="string">&quot;台湾&quot;</span>,</span><br><span class="line">    <span class="number">81</span>: <span class="string">&quot;香港&quot;</span>,</span><br><span class="line">    <span class="number">82</span>: <span class="string">&quot;澳门&quot;</span>,</span><br><span class="line">    <span class="number">91</span>: <span class="string">&quot;国外&quot;</span>,</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">if</span> (!aCity[<span class="built_in">parseInt</span>(sId.<span class="title function_">substr</span>(<span class="number">0</span>, <span class="number">2</span>))]) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;你的身份证地区非法&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 出生日期验证</span></span><br><span class="line">  <span class="keyword">var</span> sBirthday = (</span><br><span class="line">      sId.<span class="title function_">substr</span>(<span class="number">6</span>, <span class="number">4</span>) +</span><br><span class="line">      <span class="string">&quot;-&quot;</span> +</span><br><span class="line">      <span class="title class_">Number</span>(sId.<span class="title function_">substr</span>(<span class="number">10</span>, <span class="number">2</span>)) +</span><br><span class="line">      <span class="string">&quot;-&quot;</span> +</span><br><span class="line">      <span class="title class_">Number</span>(sId.<span class="title function_">substr</span>(<span class="number">12</span>, <span class="number">2</span>))</span><br><span class="line">    ).<span class="title function_">replace</span>(<span class="regexp">/-/g</span>, <span class="string">&quot;/&quot;</span>),</span><br><span class="line">    d = <span class="keyword">new</span> <span class="title class_">Date</span>(sBirthday);</span><br><span class="line">  <span class="keyword">if</span> (</span><br><span class="line">    sBirthday !=</span><br><span class="line">    d.<span class="title function_">getFullYear</span>() + <span class="string">&quot;/&quot;</span> + (d.<span class="title function_">getMonth</span>() + <span class="number">1</span>) + <span class="string">&quot;/&quot;</span> + d.<span class="title function_">getDate</span>()</span><br><span class="line">  ) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;身份证上的出生日期非法&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 身份证号码校验</span></span><br><span class="line">  <span class="keyword">var</span> sum = <span class="number">0</span>,</span><br><span class="line">    weights = [<span class="number">7</span>, <span class="number">9</span>, <span class="number">10</span>, <span class="number">5</span>, <span class="number">8</span>, <span class="number">4</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">6</span>, <span class="number">3</span>, <span class="number">7</span>, <span class="number">9</span>, <span class="number">10</span>, <span class="number">5</span>, <span class="number">8</span>, <span class="number">4</span>, <span class="number">2</span>],</span><br><span class="line">    codes = <span class="string">&quot;10X98765432&quot;</span>;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; sId.<span class="property">length</span> - <span class="number">1</span>; i++) &#123;</span><br><span class="line">    sum += sId[i] * weights[i];</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">var</span> last = codes[sum % <span class="number">11</span>]; <span class="comment">//计算出来的最后一位身份证号码</span></span><br><span class="line">  <span class="keyword">if</span> (sId[sId.<span class="property">length</span> - <span class="number">1</span>] != last) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;你输入的身份证号非法&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>将阿拉伯数字翻译成中文的大写数字</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">numberToChinese</span> = (<span class="params">num</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">var</span> <span class="variable constant_">AA</span> = <span class="keyword">new</span> <span class="title class_">Array</span>(</span><br><span class="line">    <span class="string">&quot;零&quot;</span>,</span><br><span class="line">    <span class="string">&quot;一&quot;</span>,</span><br><span class="line">    <span class="string">&quot;二&quot;</span>,</span><br><span class="line">    <span class="string">&quot;三&quot;</span>,</span><br><span class="line">    <span class="string">&quot;四&quot;</span>,</span><br><span class="line">    <span class="string">&quot;五&quot;</span>,</span><br><span class="line">    <span class="string">&quot;六&quot;</span>,</span><br><span class="line">    <span class="string">&quot;七&quot;</span>,</span><br><span class="line">    <span class="string">&quot;八&quot;</span>,</span><br><span class="line">    <span class="string">&quot;九&quot;</span>,</span><br><span class="line">    <span class="string">&quot;十&quot;</span></span><br><span class="line">  );</span><br><span class="line">  <span class="keyword">var</span> <span class="variable constant_">BB</span> = <span class="keyword">new</span> <span class="title class_">Array</span>(<span class="string">&quot;&quot;</span>, <span class="string">&quot;十&quot;</span>, <span class="string">&quot;百&quot;</span>, <span class="string">&quot;仟&quot;</span>, <span class="string">&quot;萬&quot;</span>, <span class="string">&quot;億&quot;</span>, <span class="string">&quot;点&quot;</span>, <span class="string">&quot;&quot;</span>);</span><br><span class="line">  <span class="keyword">var</span> a = (<span class="string">&quot;&quot;</span> + num).<span class="title function_">replace</span>(<span class="regexp">/(^0*)/g</span>, <span class="string">&quot;&quot;</span>).<span class="title function_">split</span>(<span class="string">&quot;.&quot;</span>),</span><br><span class="line">    k = <span class="number">0</span>,</span><br><span class="line">    re = <span class="string">&quot;&quot;</span>;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i = a[<span class="number">0</span>].<span class="property">length</span> - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i--) &#123;</span><br><span class="line">    <span class="keyword">switch</span> (k) &#123;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">0</span>:</span><br><span class="line">        re = <span class="variable constant_">BB</span>[<span class="number">7</span>] + re;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">4</span>:</span><br><span class="line">        <span class="keyword">if</span> (!<span class="keyword">new</span> <span class="title class_">RegExp</span>(<span class="string">&quot;0&#123;4&#125;//d&#123;&quot;</span> + (a[<span class="number">0</span>].<span class="property">length</span> - i - <span class="number">1</span>) + <span class="string">&quot;&#125;$&quot;</span>).<span class="title function_">test</span>(a[<span class="number">0</span>]))</span><br><span class="line">          re = <span class="variable constant_">BB</span>[<span class="number">4</span>] + re;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">8</span>:</span><br><span class="line">        re = <span class="variable constant_">BB</span>[<span class="number">5</span>] + re;</span><br><span class="line">        <span class="variable constant_">BB</span>[<span class="number">7</span>] = <span class="variable constant_">BB</span>[<span class="number">5</span>];</span><br><span class="line">        k = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (k % <span class="number">4</span> == <span class="number">2</span> &amp;&amp; a[<span class="number">0</span>].<span class="title function_">charAt</span>(i + <span class="number">2</span>) != <span class="number">0</span> &amp;&amp; a[<span class="number">0</span>].<span class="title function_">charAt</span>(i + <span class="number">1</span>) == <span class="number">0</span>)</span><br><span class="line">      re = <span class="variable constant_">AA</span>[<span class="number">0</span>] + re;</span><br><span class="line">    <span class="keyword">if</span> (a[<span class="number">0</span>].<span class="title function_">charAt</span>(i) != <span class="number">0</span>) re = <span class="variable constant_">AA</span>[a[<span class="number">0</span>].<span class="title function_">charAt</span>(i)] + <span class="variable constant_">BB</span>[k % <span class="number">4</span>] + re;</span><br><span class="line">    k++;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (a.<span class="property">length</span> &gt; <span class="number">1</span>) &#123;</span><br><span class="line">    <span class="comment">// 加上小数部分(如果有小数部分)</span></span><br><span class="line">    re += <span class="variable constant_">BB</span>[<span class="number">6</span>];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; a[<span class="number">1</span>].<span class="property">length</span>; i++) re += <span class="variable constant_">AA</span>[a[<span class="number">1</span>].<span class="title function_">charAt</span>(i)];</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (re == <span class="string">&quot;一十&quot;</span>) re = <span class="string">&quot;十&quot;</span>;</span><br><span class="line">  <span class="keyword">if</span> (re.<span class="title function_">match</span>(<span class="regexp">/^一/</span>) &amp;&amp; re.<span class="property">length</span> == <span class="number">3</span>) re = re.<span class="title function_">replace</span>(<span class="string">&quot;一&quot;</span>, <span class="string">&quot;&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> re;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>将数字转换为大写金额</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">changeToChinese</span> = (<span class="params">Num</span>) =&gt; &#123;</span><br><span class="line">  <span class="comment">//判断如果传递进来的不是字符的话转换为字符</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> <span class="title class_">Num</span> == <span class="string">&quot;number&quot;</span>) &#123;</span><br><span class="line">    <span class="title class_">Num</span> = <span class="keyword">new</span> <span class="title class_">String</span>(<span class="title class_">Num</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title class_">Num</span> = <span class="title class_">Num</span>.<span class="title function_">replace</span>(<span class="regexp">/,/g</span>, <span class="string">&quot;&quot;</span>); <span class="comment">//替换tomoney()中的“,”</span></span><br><span class="line">  <span class="title class_">Num</span> = <span class="title class_">Num</span>.<span class="title function_">replace</span>(<span class="regexp">/ /g</span>, <span class="string">&quot;&quot;</span>); <span class="comment">//替换tomoney()中的空格</span></span><br><span class="line">  <span class="title class_">Num</span> = <span class="title class_">Num</span>.<span class="title function_">replace</span>(<span class="regexp">/￥/g</span>, <span class="string">&quot;&quot;</span>); <span class="comment">//替换掉可能出现的￥字符</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="built_in">isNaN</span>(<span class="title class_">Num</span>)) &#123;</span><br><span class="line">    <span class="comment">//验证输入的字符是否为数字</span></span><br><span class="line">    <span class="comment">//alert(&quot;请检查小写金额是否正确&quot;);</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//字符处理完毕后开始转换，采用前后两部分分别转换</span></span><br><span class="line">  <span class="keyword">var</span> part = <span class="title class_">String</span>(<span class="title class_">Num</span>).<span class="title function_">split</span>(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">  <span class="keyword">var</span> newchar = <span class="string">&quot;&quot;</span>;</span><br><span class="line">  <span class="comment">//小数点前进行转化</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i = part[<span class="number">0</span>].<span class="property">length</span> - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i--) &#123;</span><br><span class="line">    <span class="keyword">if</span> (part[<span class="number">0</span>].<span class="property">length</span> &gt; <span class="number">10</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">      <span class="comment">//若数量超过拾亿单位，提示</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">var</span> tmpnewchar = <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="keyword">var</span> perchar = part[<span class="number">0</span>].<span class="title function_">charAt</span>(i);</span><br><span class="line">    <span class="keyword">switch</span> (perchar) &#123;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">&quot;0&quot;</span>:</span><br><span class="line">        tmpnewchar = <span class="string">&quot;零&quot;</span> + tmpnewchar;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">&quot;1&quot;</span>:</span><br><span class="line">        tmpnewchar = <span class="string">&quot;壹&quot;</span> + tmpnewchar;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">&quot;2&quot;</span>:</span><br><span class="line">        tmpnewchar = <span class="string">&quot;贰&quot;</span> + tmpnewchar;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">&quot;3&quot;</span>:</span><br><span class="line">        tmpnewchar = <span class="string">&quot;叁&quot;</span> + tmpnewchar;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">&quot;4&quot;</span>:</span><br><span class="line">        tmpnewchar = <span class="string">&quot;肆&quot;</span> + tmpnewchar;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">&quot;5&quot;</span>:</span><br><span class="line">        tmpnewchar = <span class="string">&quot;伍&quot;</span> + tmpnewchar;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">&quot;6&quot;</span>:</span><br><span class="line">        tmpnewchar = <span class="string">&quot;陆&quot;</span> + tmpnewchar;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">&quot;7&quot;</span>:</span><br><span class="line">        tmpnewchar = <span class="string">&quot;柒&quot;</span> + tmpnewchar;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">&quot;8&quot;</span>:</span><br><span class="line">        tmpnewchar = <span class="string">&quot;捌&quot;</span> + tmpnewchar;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">&quot;9&quot;</span>:</span><br><span class="line">        tmpnewchar = <span class="string">&quot;玖&quot;</span> + tmpnewchar;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">switch</span> (part[<span class="number">0</span>].<span class="property">length</span> - i - <span class="number">1</span>) &#123;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">0</span>:</span><br><span class="line">        tmpnewchar = tmpnewchar + <span class="string">&quot;元&quot;</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">        <span class="keyword">if</span> (perchar != <span class="number">0</span>) tmpnewchar = tmpnewchar + <span class="string">&quot;拾&quot;</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">        <span class="keyword">if</span> (perchar != <span class="number">0</span>) tmpnewchar = tmpnewchar + <span class="string">&quot;佰&quot;</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">3</span>:</span><br><span class="line">        <span class="keyword">if</span> (perchar != <span class="number">0</span>) tmpnewchar = tmpnewchar + <span class="string">&quot;仟&quot;</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">4</span>:</span><br><span class="line">        tmpnewchar = tmpnewchar + <span class="string">&quot;万&quot;</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">5</span>:</span><br><span class="line">        <span class="keyword">if</span> (perchar != <span class="number">0</span>) tmpnewchar = tmpnewchar + <span class="string">&quot;拾&quot;</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">6</span>:</span><br><span class="line">        <span class="keyword">if</span> (perchar != <span class="number">0</span>) tmpnewchar = tmpnewchar + <span class="string">&quot;佰&quot;</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">7</span>:</span><br><span class="line">        <span class="keyword">if</span> (perchar != <span class="number">0</span>) tmpnewchar = tmpnewchar + <span class="string">&quot;仟&quot;</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">8</span>:</span><br><span class="line">        tmpnewchar = tmpnewchar + <span class="string">&quot;亿&quot;</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">9</span>:</span><br><span class="line">        tmpnewchar = tmpnewchar + <span class="string">&quot;拾&quot;</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">var</span> newchar = tmpnewchar + newchar;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//小数点之后进行转化</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="title class_">Num</span>.<span class="title function_">indexOf</span>(<span class="string">&quot;.&quot;</span>) != -<span class="number">1</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (part[<span class="number">1</span>].<span class="property">length</span> &gt; <span class="number">2</span>) &#123;</span><br><span class="line">      <span class="comment">// alert(&quot;小数点之后只能保留两位,系统将自动截断&quot;);</span></span><br><span class="line">      part[<span class="number">1</span>] = part[<span class="number">1</span>].<span class="title function_">substr</span>(<span class="number">0</span>, <span class="number">2</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; part[<span class="number">1</span>].<span class="property">length</span>; i++) &#123;</span><br><span class="line">      tmpnewchar = <span class="string">&quot;&quot;</span>;</span><br><span class="line">      perchar = part[<span class="number">1</span>].<span class="title function_">charAt</span>(i);</span><br><span class="line">      <span class="keyword">switch</span> (perchar) &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&quot;0&quot;</span>:</span><br><span class="line">          tmpnewchar = <span class="string">&quot;零&quot;</span> + tmpnewchar;</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&quot;1&quot;</span>:</span><br><span class="line">          tmpnewchar = <span class="string">&quot;壹&quot;</span> + tmpnewchar;</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&quot;2&quot;</span>:</span><br><span class="line">          tmpnewchar = <span class="string">&quot;贰&quot;</span> + tmpnewchar;</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&quot;3&quot;</span>:</span><br><span class="line">          tmpnewchar = <span class="string">&quot;叁&quot;</span> + tmpnewchar;</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&quot;4&quot;</span>:</span><br><span class="line">          tmpnewchar = <span class="string">&quot;肆&quot;</span> + tmpnewchar;</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&quot;5&quot;</span>:</span><br><span class="line">          tmpnewchar = <span class="string">&quot;伍&quot;</span> + tmpnewchar;</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&quot;6&quot;</span>:</span><br><span class="line">          tmpnewchar = <span class="string">&quot;陆&quot;</span> + tmpnewchar;</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&quot;7&quot;</span>:</span><br><span class="line">          tmpnewchar = <span class="string">&quot;柒&quot;</span> + tmpnewchar;</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&quot;8&quot;</span>:</span><br><span class="line">          tmpnewchar = <span class="string">&quot;捌&quot;</span> + tmpnewchar;</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&quot;9&quot;</span>:</span><br><span class="line">          tmpnewchar = <span class="string">&quot;玖&quot;</span> + tmpnewchar;</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> (i == <span class="number">0</span>) tmpnewchar = tmpnewchar + <span class="string">&quot;角&quot;</span>;</span><br><span class="line">      <span class="keyword">if</span> (i == <span class="number">1</span>) tmpnewchar = tmpnewchar + <span class="string">&quot;分&quot;</span>;</span><br><span class="line">      newchar = newchar + tmpnewchar;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//替换所有无用汉字</span></span><br><span class="line">  <span class="keyword">while</span> (newchar.<span class="title function_">search</span>(<span class="string">&quot;零零&quot;</span>) != -<span class="number">1</span>) newchar = newchar.<span class="title function_">replace</span>(<span class="string">&quot;零零&quot;</span>, <span class="string">&quot;零&quot;</span>);</span><br><span class="line">  newchar = newchar.<span class="title function_">replace</span>(<span class="string">&quot;零亿&quot;</span>, <span class="string">&quot;亿&quot;</span>);</span><br><span class="line">  newchar = newchar.<span class="title function_">replace</span>(<span class="string">&quot;亿万&quot;</span>, <span class="string">&quot;亿&quot;</span>);</span><br><span class="line">  newchar = newchar.<span class="title function_">replace</span>(<span class="string">&quot;零万&quot;</span>, <span class="string">&quot;万&quot;</span>);</span><br><span class="line">  newchar = newchar.<span class="title function_">replace</span>(<span class="string">&quot;零元&quot;</span>, <span class="string">&quot;元&quot;</span>);</span><br><span class="line">  newchar = newchar.<span class="title function_">replace</span>(<span class="string">&quot;零角&quot;</span>, <span class="string">&quot;&quot;</span>);</span><br><span class="line">  newchar = newchar.<span class="title function_">replace</span>(<span class="string">&quot;零分&quot;</span>, <span class="string">&quot;&quot;</span>);</span><br><span class="line">  <span class="keyword">if</span> (newchar.<span class="title function_">charAt</span>(newchar.<span class="property">length</span> - <span class="number">1</span>) == <span class="string">&quot;元&quot;</span>) &#123;</span><br><span class="line">    newchar = newchar + <span class="string">&quot;整&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> newchar;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>数组去重</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">unique</span> = (<span class="params">arr</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> arr.<span class="title function_">filter</span>(<span class="function">(<span class="params">item, index, arr</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> arr.<span class="title function_">indexOf</span>(item) === index;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>求两个集合的并集</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">union</span> = (<span class="params">a, b</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">var</span> newArr = a.<span class="title function_">concat</span>(b);</span><br><span class="line">  <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">unique</span>(newArr);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>求两个集合的交集</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">intersect</span> = (<span class="params">a, b</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">var</span> _this = <span class="variable language_">this</span>;</span><br><span class="line">  a = <span class="variable language_">this</span>.<span class="title function_">unique</span>(a);</span><br><span class="line">  <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">map</span>(a, <span class="keyword">function</span> (<span class="params">o</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> _this.<span class="title function_">contains</span>(b, o) ? o : <span class="literal">null</span>;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>将类数组转换为数组</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">formArray</span> = (<span class="params">ary</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">var</span> arr = [];</span><br><span class="line">  <span class="keyword">if</span> (<span class="title class_">Array</span>.<span class="title function_">isArray</span>(ary)) &#123;</span><br><span class="line">    arr = ary;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    arr = <span class="title class_">Array</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">slice</span>.<span class="title function_">call</span>(ary);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> arr;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>检测密码强度</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">checkPwd</span> = (<span class="params">str</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">var</span> <span class="title class_">Lv</span> = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">if</span> (str.<span class="property">length</span> &lt; <span class="number">6</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">Lv</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (<span class="regexp">/[0-9]/</span>.<span class="title function_">test</span>(str)) &#123;</span><br><span class="line">    <span class="title class_">Lv</span>++;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (<span class="regexp">/[a-z]/</span>.<span class="title function_">test</span>(str)) &#123;</span><br><span class="line">    <span class="title class_">Lv</span>++;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (<span class="regexp">/[A-Z]/</span>.<span class="title function_">test</span>(str)) &#123;</span><br><span class="line">    <span class="title class_">Lv</span>++;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (<span class="regexp">/[\.|-|_]/</span>.<span class="title function_">test</span>(str)) &#123;</span><br><span class="line">    <span class="title class_">Lv</span>++;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="title class_">Lv</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>节流防抖</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">//延时执行</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">debounce</span>(<span class="params">func, delay</span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> timer = <span class="literal">null</span>;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (timer) <span class="built_in">clearTimeout</span>(timer);</span><br><span class="line">    timer = <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="title function_">func</span>();</span><br><span class="line">    &#125;, delay);</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//========</span></span><br><span class="line"><span class="comment">//可以作为节流使用</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">debounce</span>(<span class="params">func, delay</span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> timer = <span class="literal">null</span>;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (timer) <span class="built_in">clearTimeout</span>(timer);</span><br><span class="line">    <span class="keyword">var</span> callNow = !timer;</span><br><span class="line">    timer = <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      timer = <span class="literal">null</span>;</span><br><span class="line">    &#125;, delay);</span><br><span class="line">    <span class="keyword">if</span> (callNow) <span class="title function_">func</span>();</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//节流——————</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">throttle</span>(<span class="params">func, wait</span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> timeout;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> context = <span class="variable language_">this</span>;</span><br><span class="line">    <span class="keyword">var</span> args = <span class="variable language_">arguments</span>;</span><br><span class="line">    <span class="keyword">if</span> (!timeout) &#123;</span><br><span class="line">      timeout = <span class="built_in">setTimeout</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        timeout = <span class="literal">null</span>;</span><br><span class="line">        func.<span class="title function_">apply</span>(context, args);</span><br><span class="line">      &#125;, wait);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>判断两个对象是否键值相同</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">isObjectEqual</span> = (<span class="params">a, b</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">var</span> aProps = <span class="title class_">Object</span>.<span class="title function_">getOwnPropertyNames</span>(a);</span><br><span class="line">  <span class="keyword">var</span> bProps = <span class="title class_">Object</span>.<span class="title function_">getOwnPropertyNames</span>(b);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (aProps.<span class="property">length</span> !== bProps.<span class="property">length</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; aProps.<span class="property">length</span>; i++) &#123;</span><br><span class="line">    <span class="keyword">var</span> propName = aProps[i];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (a[propName] !== b[propName]) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>16 进制颜色转 RGBRGBA 字符串</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">colorToRGB</span> = (<span class="params">val, opa</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">var</span> pattern = <span class="regexp">/^(#?)[a-fA-F0-9]&#123;6&#125;$/</span>; <span class="comment">//16进制颜色值校验规则</span></span><br><span class="line">  <span class="keyword">var</span> isOpa = <span class="keyword">typeof</span> opa == <span class="string">&quot;number&quot;</span>; <span class="comment">//判断是否有设置不透明度</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (!pattern.<span class="title function_">test</span>(val)) &#123;</span><br><span class="line">    <span class="comment">//如果值不符合规则返回空字符</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> v = val.<span class="title function_">replace</span>(<span class="regexp">/#/</span>, <span class="string">&quot;&quot;</span>); <span class="comment">//如果有#号先去除#号</span></span><br><span class="line">  <span class="keyword">var</span> rgbArr = [];</span><br><span class="line">  <span class="keyword">var</span> rgbStr = <span class="string">&quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="number">3</span>; i++) &#123;</span><br><span class="line">    <span class="keyword">var</span> item = v.<span class="title function_">substring</span>(i * <span class="number">2</span>, i * <span class="number">2</span> + <span class="number">2</span>);</span><br><span class="line">    <span class="keyword">var</span> num = <span class="built_in">parseInt</span>(item, <span class="number">16</span>);</span><br><span class="line">    rgbArr.<span class="title function_">push</span>(num);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  rgbStr = rgbArr.<span class="title function_">join</span>();</span><br><span class="line">  rgbStr =</span><br><span class="line">    <span class="string">&quot;rgb&quot;</span> + (isOpa ? <span class="string">&quot;a&quot;</span> : <span class="string">&quot;&quot;</span>) + <span class="string">&quot;(&quot;</span> + rgbStr + (isOpa ? <span class="string">&quot;,&quot;</span> + opa : <span class="string">&quot;&quot;</span>) + <span class="string">&quot;)&quot;</span>;</span><br><span class="line">  <span class="keyword">return</span> rgbStr;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>生成随机颜色</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*随机获取颜色*/</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">getRandomColor</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> r = <span class="title class_">Math</span>.<span class="title function_">floor</span>(<span class="title class_">Math</span>.<span class="title function_">random</span>() * <span class="number">256</span>);</span><br><span class="line">  <span class="keyword">var</span> g = <span class="title class_">Math</span>.<span class="title function_">floor</span>(<span class="title class_">Math</span>.<span class="title function_">random</span>() * <span class="number">256</span>);</span><br><span class="line">  <span class="keyword">var</span> b = <span class="title class_">Math</span>.<span class="title function_">floor</span>(<span class="title class_">Math</span>.<span class="title function_">random</span>() * <span class="number">256</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="string">&quot;rgb(&quot;</span> + r + <span class="string">&quot;,&quot;</span> + g + <span class="string">&quot;,&quot;</span> + b + <span class="string">&quot;)&quot;</span>;</span><br><span class="line">  <span class="comment">//return &#x27;#&#x27; + Math.floor(Math.random() * 0xffffff).toString(16);</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>颜色 RGB 转 16 进制</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">rgbToHex</span> = (<span class="params">r, g, b</span>) =&gt;</span><br><span class="line">  <span class="string">&quot;#&quot;</span> + ((<span class="number">1</span> &lt;&lt; <span class="number">24</span>) + (r &lt;&lt; <span class="number">16</span>) + (g &lt;&lt; <span class="number">8</span>) + b).<span class="title function_">toString</span>(<span class="number">16</span>).<span class="title function_">slice</span>(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line"><span class="title function_">rgbToHex</span>(<span class="number">0</span>, <span class="number">51</span>, <span class="number">255</span>);</span><br><span class="line"><span class="comment">// Result: #0033ff</span></span><br></pre></td></tr></table></figure>

<p>计算 2 个日期之间相差多少天</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">dayDif</span> = (<span class="params">date1, date2</span>) =&gt;</span><br><span class="line">  <span class="title class_">Math</span>.<span class="title function_">ceil</span>(<span class="title class_">Math</span>.<span class="title function_">abs</span>(date1.<span class="title function_">getTime</span>() - date2.<span class="title function_">getTime</span>()) / <span class="number">86400000</span>);</span><br><span class="line"></span><br><span class="line"><span class="title function_">dayDif</span>(<span class="keyword">new</span> <span class="title class_">Date</span>(<span class="string">&quot;2020-10-21&quot;</span>), <span class="keyword">new</span> <span class="title class_">Date</span>(<span class="string">&quot;2021-10-22&quot;</span>));</span><br><span class="line"><span class="comment">// Result: 366</span></span><br></pre></td></tr></table></figure>

<p>校验数组是否为空</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">isNotEmpty</span> = (<span class="params">arr</span>) =&gt; <span class="title class_">Array</span>.<span class="title function_">isArray</span>(arr) &amp;&amp; arr.<span class="property">length</span> &gt; <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="title function_">isNotEmpty</span>([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]);</span><br><span class="line"><span class="comment">// Result: true</span></span><br></pre></td></tr></table></figure>

<p>检验车牌号</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="title function_">isCarNum</span>(<span class="params">val</span>) &#123;</span><br><span class="line">              <span class="keyword">var</span> patrn = <span class="regexp">/^([京津沪渝冀豫云辽黑湘皖鲁新苏浙赣鄂桂甘晋蒙陕吉闽贵粤青藏川宁琼使领A-Z]&#123;1&#125;[A-Z]&#123;1&#125;[A-HJ-NP-Z0-9]&#123;4&#125;[A-HJ-NP-Z0-9挂学警港澳]&#123;1&#125;)$/</span>;</span><br><span class="line">              <span class="keyword">var</span> patrn2 = <span class="regexp">/^([京津沪渝冀豫云辽黑湘皖鲁新苏浙赣鄂桂甘晋蒙陕吉闽贵粤青藏川宁琼使领A-Z]&#123;1&#125;[A-Z]&#123;1&#125;(([0-9]&#123;5&#125;[DF])|([DF]([A-HJ-NP-Z0-9])[0-9]&#123;4&#125;)))$/</span>;</span><br><span class="line">              <span class="keyword">if</span> (!patrn.<span class="title function_">test</span>(val) &amp;&amp; !patrn2.<span class="title function_">test</span>(val)) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">              &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">              &#125;</span><br><span class="line">            &#125;,</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>前端</category>
      </categories>
      <tags>
        <tag>utils</tag>
      </tags>
  </entry>
  <entry>
    <title>vue里面的文本空格占位符</title>
    <url>/test/post/vue%E6%96%87%E6%9C%AC%E7%A9%BA%E6%A0%BC%E5%8D%A0%E4%BD%8D%E7%AC%A6/</url>
    <content><![CDATA[<h2 id="vue里面的文本空格占位符"><a href="#vue里面的文本空格占位符" class="headerlink" title="vue里面的文本空格占位符"></a>vue里面的文本空格占位符</h2><p>下面是几个普通html常用字符：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="symbol">&amp;nbsp;</span>  空格</span><br><span class="line"><span class="symbol">&amp;amp;</span>   &amp;</span><br><span class="line"><span class="symbol">&amp;lt;</span>    &lt;</span><br><span class="line"><span class="symbol">&amp;gt;</span>    &gt;</span><br><span class="line"><span class="symbol">&amp;quot;</span>   &quot;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><img src="/test/images/image.png" alt="Alt text"></p>
<p>vue中空格表示：</p>
<p><img src="/test/images/image-1.png" alt="Alt text"></p>
<p>三种空格unicode(\u00A0,\u0020,\u3000)表示的区别</p>
<p>1.不间断空格\u00A0,主要用在office中,让一个单词在结尾处不会换行显示,快捷键ctrl+shift+space ;</p>
<p>2.半角空格(英文符号)\u0020,代码中常用的;</p>
<p>3.全角空格(中文符号)\u3000,中文文章中使用;</p>
<p>————————————————</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;button&gt;测评报&#123;&#123; <span class="string">&quot;\xa0&quot;</span> &#125;&#125;名费&#123;&#123;<span class="string">&quot;\xa0\xa0\xa0\xa0\xa0\xa0\xa0&quot;</span>&#125;&#125; &lt;/button&gt;</span><br></pre></td></tr></table></figure>

<p>转自：<a href="https://blog.csdn.net/weixin_50367873/article/details/114269165">https://blog.csdn.net/weixin_50367873/article/details/114269165</a></p>
]]></content>
      <categories>
        <category>前端</category>
      </categories>
      <tags>
        <tag>JavaScript</tag>
      </tags>
  </entry>
  <entry>
    <title>什么是全局数据共享</title>
    <url>/test/post/%E4%BB%80%E4%B9%88%E6%98%AF%E5%85%A8%E5%B1%80%E6%95%B0%E6%8D%AE%E5%85%B1%E4%BA%AB/</url>
    <content><![CDATA[<h2 id="wx-小程序中的全局数据共享方案-MonX"><a href="#wx-小程序中的全局数据共享方案-MonX" class="headerlink" title="wx 小程序中的全局数据共享方案 MonX"></a>wx 小程序中的全局数据共享方案 MonX</h2><p>什么是全局数据共享<br>全局数据共享（又叫做：状态管理）是为了解决组件之间数据共享的问题。<br>开发中常用的全局数据共享方案有： Vuex 、 Redux 、 MobX 等。 2. 小程序中的全局数据共享方案<br>在小程序中，可使用 mobx-miniprogram 配合 mobx-miniprogram-bindings 实现全局数据共享。其<br>中：<br>mobx-miniprogram 用来创建 Store 实例对象<br>mobx-miniprogram-bindings 用来把 Store 中的共享数据或方法，绑定到组件或页面中使用</p>
<p>在项目中运行如下的命令，安装 MobX 相关的包：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">npm install --save mobx-miniprogram@<span class="number">4.13</span><span class="number">.2</span> mobx-miniprogram-bindings@<span class="number">1.2</span><span class="number">.1</span></span><br></pre></td></tr></table></figure>

<p>注意： MobX 相关的包安装完毕之后，记得删除 miniprogram_npm 目录后，重新构建 npm 。</p>
<p><strong>创建 MobX 的 Store 实例</strong><br>在项目根目录下新建 store 文件夹，并且新建 store.js 文件</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 按需导入第三方包的方法observable, action</span></span><br><span class="line"><span class="keyword">import</span> &#123; observable, action &#125; <span class="keyword">from</span> <span class="string">&quot;mobx-miniprogram&quot;</span>;</span><br><span class="line"><span class="comment">// 创建 Store实例对象,并将其导出</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> store = <span class="title function_">observable</span>(&#123;</span><br><span class="line">  <span class="comment">// 数据字段</span></span><br><span class="line">  <span class="attr">numA</span>: <span class="number">1</span>,</span><br><span class="line">  <span class="attr">numB</span>: <span class="number">2</span>,</span><br><span class="line">  <span class="comment">// 计算属性</span></span><br><span class="line">  <span class="comment">// 在计算属性的方法前，必须加 get修饰符，代表sum的值是只读的，无法进行修改</span></span><br><span class="line">  <span class="comment">// 计算属性sum 依赖于numA和numB的值，因此sum函数的返回值就是最终的值</span></span><br><span class="line">  <span class="keyword">get</span> <span class="title function_">sum</span>() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">numA</span> + <span class="variable language_">this</span>.<span class="property">numB</span>;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 定义actions方法, 用来修改 store中的数据</span></span><br><span class="line">  <span class="attr">updateNum1</span>: <span class="title function_">action</span>(<span class="keyword">function</span> (<span class="params">step</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">numA</span> += step;</span><br><span class="line">  &#125;),</span><br><span class="line">  <span class="attr">updateNum2</span>: <span class="title function_">action</span>(<span class="keyword">function</span> (<span class="params">step</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">numB</span> += step;</span><br><span class="line">  &#125;),</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>在页面中使用:<br>页面的 js 文件中:</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 1.首先 导入第三方包，将数据绑定到页面</span></span><br><span class="line"><span class="keyword">import</span> &#123; createStoreBindings &#125; <span class="keyword">from</span> <span class="string">&quot;mobx-miniprogram-bindings&quot;</span>;</span><br><span class="line"><span class="comment">// 2.其次 在页面的js文件的头部区域导入容器的数据</span></span><br><span class="line"><span class="keyword">import</span> &#123; store &#125; <span class="keyword">from</span> <span class="string">&quot;../../store/store&quot;</span>;</span><br><span class="line"><span class="comment">// 3. 绑定操作：将仓库的东西绑定到当前的页面中，在页面的js文件的Page方法中</span></span><br><span class="line"><span class="title class_">Page</span>(&#123;</span><br><span class="line">  <span class="comment">// 上面周期函数--监听页面的加载</span></span><br><span class="line">  <span class="attr">onLoad</span>: <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// 调用createStoreBindings方法</span></span><br><span class="line">    <span class="comment">// 参数1： 绑定给谁：当前页面this</span></span><br><span class="line">    <span class="comment">// 参数2： 对象&#123; store(容器)， fields(数据)， actions(修改方法)</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">storeBindings</span> = <span class="title function_">createStoreBindings</span>(<span class="variable language_">this</span>, &#123;</span><br><span class="line">      <span class="comment">// 映射容器的实例</span></span><br><span class="line">      store,</span><br><span class="line">      <span class="comment">// 映射容器的数据字段</span></span><br><span class="line">      <span class="attr">fields</span>: [<span class="string">&quot;numA&quot;</span>, <span class="string">&quot;numB&quot;</span>, <span class="string">&quot;sum&quot;</span>],</span><br><span class="line">      <span class="comment">// 映射容器修改的方法</span></span><br><span class="line">      <span class="attr">actions</span>: [<span class="string">&quot;updateNum1&quot;</span>],</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 生命周期函数--监听页面的卸载</span></span><br><span class="line">  <span class="attr">onUnload</span>: <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// 使用this.storeBindings，得到调用createStoreBindings方法的返回值</span></span><br><span class="line">    <span class="comment">//调用destroyStoreBindings 方法，进行清理销毁的工作</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">storeBindings</span>.<span class="title function_">destroyStoreBindings</span>();</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>页面的 wxml 文件中</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;!-- 使用仓库中的数据 --&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">view</span>&gt;</span>&#123;&#123;numA&#125;&#125; + &#123;&#123;numB&#125;&#125; = &#123;&#123;sum&#125;&#125;<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">van-button</span> <span class="attr">type</span>=<span class="string">&quot;primary&quot;</span> <span class="attr">bindtap</span>=<span class="string">&quot;btnHnadler1&quot;</span>&gt;</span>numA+1<span class="tag">&lt;/<span class="name">van-button</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

<p>监听函数 btnHandler1 的代码</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 页面的js文件中的 tap事件处理函数</span></span><br><span class="line">btnHnadler1 (e) &#123;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(e)</span><br><span class="line">  <span class="comment">// 使用仓库中的方法，并传递数据</span></span><br><span class="line"><span class="variable language_">this</span>.<span class="title function_">updateNum1</span>(<span class="number">100</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在组件中使用<br>准备工作<br>新建组件文件夹以及组件文件 numbers<br>全局注册这个组件<br>在 message 页面中使用子组件<br>组件的 js 文件</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">按需导入容器成员</span><br><span class="line"><span class="number">2.</span> 在组件的behaviors节点 实现自动绑定</span><br><span class="line"><span class="number">3.</span> 在storeBindings节点指定要绑定的store和要绑定的数据以及方法</span><br><span class="line"><span class="keyword">import</span> &#123; storeBindingsBehavior &#125; <span class="keyword">from</span> <span class="string">&#x27;mobx-miniprogram-bindings&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; store &#125; <span class="keyword">from</span> <span class="string">&#x27;../../store/store&#x27;</span></span><br><span class="line"><span class="title class_">Component</span>(&#123;</span><br><span class="line">  <span class="comment">// 通过storeBindingsBehavior 来实现自动绑定</span></span><br><span class="line">  <span class="attr">behaviors</span>: [storeBindingsBehavior],</span><br><span class="line">  <span class="attr">storeBindings</span>: &#123;</span><br><span class="line">    store, <span class="comment">// 指定要绑定的store</span></span><br><span class="line"> <span class="attr">fields</span>: &#123; <span class="comment">// 指定要绑定的数据字段或计算属性</span></span><br><span class="line"><span class="attr">numA</span>: <span class="function">() =&gt;</span> store.<span class="property">numA</span>, <span class="comment">// 绑定字段的方式1：</span></span><br><span class="line">      <span class="attr">numB</span>: <span class="function"><span class="params">store</span> =&gt;</span> store.<span class="property">numB</span>, <span class="comment">// 绑定字段的方式2</span></span><br><span class="line">      <span class="attr">sum</span>: <span class="string">&#x27;sum&#x27;</span> <span class="comment">// 绑定字段的方式3</span></span><br><span class="line">   &#125;,</span><br><span class="line">    <span class="attr">actions</span>: &#123; <span class="comment">// 指定要绑定的方法</span></span><br><span class="line">      <span class="attr">updateNum2</span>: <span class="string">&#x27;updateNum2&#x27;</span></span><br><span class="line">   &#125;</span><br><span class="line"> &#125;</span><br><span class="line">&#125;)</span><br><span class="line">注意： fields中前面是在组件中的名称，可自定义，后面是容器中的名称，必须和仓库一致</span><br></pre></td></tr></table></figure>

<p>组件的 wxml 文件</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;!-- 组件的 .<span class="property">wxml</span>结构 --&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">view</span>&gt;</span>&#123;&#123;numA&#125;&#125; + &#123;&#123;numB&#125;&#125; = &#123;&#123;sum&#125;&#125;<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">van-button</span> <span class="attr">type</span>=<span class="string">&quot;primary&quot;</span> <span class="attr">bindtap</span>=<span class="string">&quot;btnHnadler2&quot;</span>&gt;</span>numB+1<span class="tag">&lt;/<span class="name">van-button</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

<p>事件处理函数 btnHandler2</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="title class_">Compoonent</span>(&#123;</span><br><span class="line">  <span class="attr">methods</span>: &#123;</span><br><span class="line">    <span class="title function_">btnHnadler2</span>(<span class="params">e</span>) &#123;</span><br><span class="line">      <span class="comment">// 直接使用this调用仓库中的方法</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">updateNum2</span>(<span class="number">20</span>);</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>结论: 无论是在页面中使用仓库中的东西, 还是在组件中使用仓库中的东西, 在绑定成功之后, 就可以像使<br>用自身数据和调用自身方法一样的对仓库的数据和方法进行操作。</p>
<h2 id="实现-wx-小程序-API-的-Promise-化"><a href="#实现-wx-小程序-API-的-Promise-化" class="headerlink" title="实现 wx 小程序 API 的 Promise 化"></a>实现 wx 小程序 API 的 Promise 化</h2><ol>
<li><p>基于回调函数的异步 API 的缺点<br>默认情况下，小程序官方提供的异步 API 都是基于回调函数实现的，例如，网络请求的 API 需要按照<br>如下的方式调用：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">wx.<span class="title function_">request</span>(&#123;</span><br><span class="line">  <span class="attr">method</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">  <span class="attr">url</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">  <span class="attr">data</span>: &#123;&#125;,</span><br><span class="line">  <span class="attr">success</span>: <span class="function">() =&gt;</span> &#123;&#125;, <span class="comment">// 成功的回调</span></span><br><span class="line">  <span class="attr">complate</span>: <span class="function">() =&gt;</span> &#123;&#125;, <span class="comment">// 无论成功与否都会执行的回调</span></span><br><span class="line">  <span class="attr">fail</span>: <span class="function">() =&gt;</span> &#123;&#125;, <span class="comment">// 失败的回调</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>​</p>
<p>这种代码的缺点是显而易见的, 容易造成回调地狱的问题，代码的可读性、维护性差！而我们就想将这</p>
<p>种类型的代码使用 API Promise 化进行改造。</p>
</li>
<li><p>什么是 API Promise 化<br>API Promise 化，指的是通过额外的配置，将官方提供的、基于回调函数的异步 API ，升级改造为基<br>于 Promise 的异步 API ，从而提高代码的可读性、维护性，避免回调地狱的问题。</p>
</li>
<li><p>实现 API Promise 化<br>在小程序中，实现 API Promise 化主要依赖于 miniprogram-api-promise 这个第三方的 npm 包。<br>它的安装和使用步骤如下:</p>
</li>
</ol>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">npm i --save miniprogram-api-promise@<span class="number">1.0</span><span class="number">.4</span></span><br><span class="line">- 下载完成，我们不能直接使用，而是需要再次重新构建npm包</span><br><span class="line">- 建议在构建前先删除原有的miniprogram_npm</span><br><span class="line">- 然后再点击工具，构建npm</span><br></pre></td></tr></table></figure>

<p>导入并执行：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 在小程序入口文件中（app.js),只需要调用一次 promisifyAll()方法</span></span><br><span class="line"><span class="comment">// 即可实现异步API 的Promise化</span></span><br><span class="line"><span class="comment">// 按需导入一个方法</span></span><br><span class="line"><span class="keyword">import</span> &#123; promisifyAll &#125; <span class="keyword">from</span> <span class="string">&quot;miniprogram-api-promise&quot;</span>;</span><br><span class="line"><span class="comment">// 声明一个常量，为一个空对象，</span></span><br><span class="line"><span class="comment">// 并在wx顶级对象下添加一个属性p也指向该空对象，使所有成员都可以使用该对象</span></span><br><span class="line"><span class="keyword">const</span> wxp = (wx.<span class="property">p</span> = &#123;&#125;);</span><br><span class="line"><span class="comment">// promisify all wx&#x27;s api</span></span><br><span class="line"><span class="comment">// 参数1： wx顶级对象</span></span><br><span class="line"><span class="comment">// 参数2： wxp指向一个空对象</span></span><br><span class="line"><span class="title function_">promisifyAll</span>(wx, wxp);</span><br></pre></td></tr></table></figure>

<p>解释上述代码:<br>promisifyAll : 做的事就是将 wx 拥有的属性方法都 copy 并改造了一份给了 wxp 这个对象。<br>然而, wxp 只是当前 js 文件的一个常量，只能在当前文件使用。<br>因此：我们在 wx 上挂载一个属性 p 让他和 wxp 指向同一个空对象。<br>在其他页面或者组件就可以通过全局对象 wx 点出 p 来访问到 wxp。<br>此时 wx.p 发起异步的请求时，得到的是一个 promise 对象。<br>那么我们就可以使用 async&#x2F;await 简化 Promise 语法。</p>
<p>在原生开发小程序的过程中，发现有多个页面都使用了几乎完全一样的逻辑。由于小程序官方并没有提供 Mixins 这种代码复用机制，所以只能采用非常不优雅的复制粘贴的方式去“复用”代码。随着功能越来越复杂，靠复制粘贴来维护代码显然不科学，于是便寻思着如何在小程序里面实现 Mixins。</p>
<h2 id="在小程序中实现-Mixins-方案"><a href="#在小程序中实现-Mixins-方案" class="headerlink" title="在小程序中实现 Mixins 方案"></a>在小程序中实现 Mixins 方案</h2><h3 id="什么是-Mixins"><a href="#什么是-Mixins" class="headerlink" title="什么是 Mixins"></a>什么是 Mixins</h3><p>Mixins 直译过来是“混入”的意思，顾名思义就是把可复用的代码混入当前的代码里面。熟悉 VueJS 的同学应该清楚，它提供了更强大了代码复用能力，解耦了重复的模块，让系统维护更加方便优雅。</p>
<p>先看看在 VueJS 中是怎么使用 Mixins 的。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// define a mixin object</span></span><br><span class="line"><span class="keyword">var</span> myMixin = &#123;</span><br><span class="line">  <span class="attr">created</span>: <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">hello</span>();</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">methods</span>: &#123;</span><br><span class="line">    <span class="attr">hello</span>: <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;hello from mixin!&quot;</span>);</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// define a component that uses this mixin</span></span><br><span class="line"><span class="keyword">var</span> <span class="title class_">Component</span> = <span class="title class_">Vue</span>.<span class="title function_">extend</span>(&#123;</span><br><span class="line">  <span class="attr">mixins</span>: [myMixin],</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> component = <span class="keyword">new</span> <span class="title class_">Component</span>(); <span class="comment">// =&gt; &quot;hello from mixin!&quot;</span></span><br><span class="line"><span class="number">123456789101112131415161718</span>;</span><br></pre></td></tr></table></figure>

<p>在上述的代码中，首先定义了一个名为 myMixin 的对象，里面定义了一些生命周期函数和方法。接着在一个新建的组件里面直接通过 mixins: [myMixin] 的方式注入，此时新建的组件便获得了来自 myMixin 的方法了。</p>
<p>明白了什么是 Mixins 以后，便可开始着手在小程序里面实现了。</p>
<h3 id="Mixins-的机制"><a href="#Mixins-的机制" class="headerlink" title="Mixins 的机制"></a>Mixins 的机制</h3><p>Mixins 也有一些小小的细节需要注意的，就是关于生命周期事件的执行顺序。在上一节的例子中，我们在 myMixin 里定义了一个 created() 方法，这是 VueJS 里面的一个生命周期事件。如果我们在新建组件 Component 里面也定义一个 created() 方法，那么执行结果会是如何呢？</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> <span class="title class_">Component</span> = <span class="title class_">Vue</span>.<span class="title function_">extend</span>(&#123;</span><br><span class="line">  <span class="attr">mixins</span>: [myMixin],</span><br><span class="line">  <span class="attr">created</span>: <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;hello from Component!&quot;</span>);</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> component = <span class="keyword">new</span> <span class="title class_">Component</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// =&gt;</span></span><br><span class="line"><span class="comment">// Hello from mixin!</span></span><br><span class="line"><span class="comment">// Hello from Component!</span></span><br><span class="line"><span class="number">123456789101112</span>;</span><br></pre></td></tr></table></figure>

<p>可以看运行结果是先输出了来自 Mixin 的 log，再输出来自组件的 log。</p>
<p>除了生命周期函数以外，再看看对象属性的混入结果：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// define a mixin object</span></span><br><span class="line"><span class="keyword">const</span> myMixin = &#123;</span><br><span class="line">  <span class="title function_">data</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="attr">mixinData</span>: <span class="string">&quot;data from mixin&quot;</span>,</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// define a component that uses this mixin</span></span><br><span class="line"><span class="keyword">var</span> <span class="title class_">Component</span> = <span class="title class_">Vue</span>.<span class="title function_">extend</span>(&#123;</span><br><span class="line">  <span class="attr">mixins</span>: [myMixin],</span><br><span class="line">  <span class="title function_">data</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="attr">componentData</span>: <span class="string">&quot;data from component&quot;</span>,</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="title function_">mounted</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">$data</span>);</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> component = <span class="keyword">new</span> <span class="title class_">Component</span>();</span><br><span class="line"><span class="number">1234567891011121314151617181920212223</span>;</span><br></pre></td></tr></table></figure>

<p><img src="https://img-blog.csdnimg.cn/95cba679a72a4f98a6d5e451d6d0bbad.png" alt="在这里插入图片描述"><br>在 VueJS 中，会把来自 Mixins 和组件的对象属性当中的内容（如 data, methods 等）混合，以确保两边的数据都同时存在。</p>
<p>经过上述的验证，我们可以得到 VueJS 中关于 Mixins 运行机制的结论：</p>
<p>生命周期属性，会优先执行来自 Mixins 当中的，后执行来自组件当中的。<br>对象类型属性，来自 Mixins 和来自组件中的会共存。<br>但是在小程序中，这套机制会和 VueJS 的有一点区别。在小程序中，自定义的方法是直接定义在 Page 的属性当中的，既不属于生命周期类型属性，也不属于对象类型属性。为了不引入奇怪的问题，我们为小程序的 Mixins 运行机制多加一条：</p>
<p>小程序中的自定义方法，优先级为 Page &gt; Mixins，即 Page 中的自定义方法会覆盖 Mixins 当中的。</p>
<h3 id="代码实现"><a href="#代码实现" class="headerlink" title="代码实现"></a>代码实现</h3><p>在小程序中，每个页面都由 Page(options) 函数定义，而 Mixins 则作用于这个函数当中的 options 对象。因此我们实现 Mixins 的思路就有了——劫持并改写 Page 函数，最后再重新把它释放出来。</p>
<p>新建一个 mixins.js 文件：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 保存原生的 Page 函数</span></span><br><span class="line"><span class="keyword">const</span> originPage = <span class="title class_">Page</span>;</span><br><span class="line"></span><br><span class="line"><span class="title class_">Page</span> = <span class="function">(<span class="params">options</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> mixins = options.<span class="property">mixins</span>;</span><br><span class="line">  <span class="comment">// mixins 必须为数组</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="title class_">Array</span>.<span class="title function_">isArray</span>(mixins)) &#123;</span><br><span class="line">    <span class="keyword">delete</span> options.<span class="property">mixins</span>;</span><br><span class="line">    <span class="comment">// mixins 注入并执行相应逻辑</span></span><br><span class="line">    options = <span class="title function_">merge</span>(mixins, options);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 释放原生 Page 函数</span></span><br><span class="line">  <span class="title function_">originPage</span>(options);</span><br><span class="line">&#125;;</span><br><span class="line"><span class="number">1234567891011121314</span>;</span><br></pre></td></tr></table></figure>

<p>原理很简单，关键的地方在于 merge() 函数。merge 函数即为小程序 Mixins 运行机制的具体实现，完全按照上一节总结的三条结论来进行。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 定义小程序内置的属性/方法</span></span><br><span class="line"><span class="keyword">const</span> originProperties = [<span class="string">&quot;data&quot;</span>, <span class="string">&quot;properties&quot;</span>, <span class="string">&quot;options&quot;</span>];</span><br><span class="line"><span class="keyword">const</span> originMethods = [</span><br><span class="line">  <span class="string">&quot;onLoad&quot;</span>,</span><br><span class="line">  <span class="string">&quot;onReady&quot;</span>,</span><br><span class="line">  <span class="string">&quot;onShow&quot;</span>,</span><br><span class="line">  <span class="string">&quot;onHide&quot;</span>,</span><br><span class="line">  <span class="string">&quot;onUnload&quot;</span>,</span><br><span class="line">  <span class="string">&quot;onPullDownRefresh&quot;</span>,</span><br><span class="line">  <span class="string">&quot;onReachBottom&quot;</span>,</span><br><span class="line">  <span class="string">&quot;onShareAppMessage&quot;</span>,</span><br><span class="line">  <span class="string">&quot;onPageScroll&quot;</span>,</span><br><span class="line">  <span class="string">&quot;onTabItemTap&quot;</span>,</span><br><span class="line">];</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">merge</span>(<span class="params">mixins, options</span>) &#123;</span><br><span class="line">  mixins.<span class="title function_">forEach</span>(<span class="function">(<span class="params">mixin</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">toString</span>.<span class="title function_">call</span>(mixin) !== <span class="string">&quot;[object Object]&quot;</span>) &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&quot;mixin 类型必须为对象！&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 遍历 mixin 里面的所有属性</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> [key, value] <span class="keyword">of</span> <span class="title class_">Object</span>.<span class="title function_">entries</span>(mixin)) &#123;</span><br><span class="line">      <span class="keyword">if</span> (originProperties.<span class="title function_">includes</span>(key)) &#123;</span><br><span class="line">        <span class="comment">// 内置对象属性混入</span></span><br><span class="line">        options[key] = &#123; ...value, ...options[key] &#125;;</span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span> (originMethods.<span class="title function_">includes</span>(key)) &#123;</span><br><span class="line">        <span class="comment">// 内置方法属性混入，优先执行混入的部分</span></span><br><span class="line">        <span class="keyword">const</span> originFunc = options[key];</span><br><span class="line">        options[key] = <span class="keyword">function</span> (<span class="params">...args</span>) &#123;</span><br><span class="line">          value.<span class="title function_">call</span>(<span class="variable language_">this</span>, ...args);</span><br><span class="line">          <span class="keyword">return</span> originFunc &amp;&amp; originFunc.<span class="title function_">call</span>(<span class="variable language_">this</span>, ...args);</span><br><span class="line">        &#125;;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// 自定义方法混入</span></span><br><span class="line">        options = &#123; ...mixin, ...options &#125;;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="keyword">return</span> options;</span><br><span class="line">&#125;</span><br><span class="line"><span class="number">1234567891011121314151617181920212223242526272829</span>;</span><br></pre></td></tr></table></figure>

<h3 id="Mixins-使用"><a href="#Mixins-使用" class="headerlink" title="Mixins 使用"></a>Mixins 使用</h3><p>1、在小程序的 app.js 里引入 mixins.js</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">require</span>(<span class="string">&quot;./mixins.js&quot;</span>);</span><br><span class="line"><span class="number">1</span>;</span><br></pre></td></tr></table></figure>

<p>2、撰写一个 myMixin.js</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">data</span>: &#123; <span class="attr">someData</span>: <span class="string">&quot;myMixin&quot;</span> &#125;,</span><br><span class="line">  <span class="title function_">onShow</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Log from mixin!&quot;</span>);</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>3、在 page&#x2F;index&#x2F;index.js 中使用</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="title class_">Page</span>(&#123;</span><br><span class="line">  <span class="attr">mixins</span>: [<span class="built_in">require</span>(<span class="string">&quot;../../myMixin.js&quot;</span>)],</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>小程序</category>
      </categories>
      <tags>
        <tag>小程序</tag>
      </tags>
  </entry>
  <entry>
    <title>js window 页面事件</title>
    <url>/test/post/window-event/</url>
    <content><![CDATA[<h2 id="js-window-页面事件"><a href="#js-window-页面事件" class="headerlink" title="js window 页面事件"></a>js window 页面事件</h2><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="variable language_">window</span>.<span class="title function_">addEventListener</span>(<span class="string">&quot;load&quot;</span>, <span class="keyword">function</span> (<span class="params">e</span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;load&quot;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="variable language_">window</span>.<span class="title function_">addEventListener</span>(<span class="string">&quot;resize&quot;</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;resize&quot;</span>, <span class="variable language_">document</span>.<span class="property">body</span>.<span class="property">offsetWidth</span>);</span><br><span class="line">  <span class="comment">// console.log(&quot;clientWidth&quot;, document.body.clientWidth);</span></span><br><span class="line">&#125;);</span><br><span class="line"><span class="variable language_">window</span>.<span class="title function_">addEventListener</span>(<span class="string">&quot;scroll&quot;</span>, <span class="keyword">function</span> (<span class="params">e</span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;scroll&quot;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="variable language_">window</span>.<span class="title function_">addEventListener</span>(<span class="string">&quot;pageshow&quot;</span>, <span class="keyword">function</span> (<span class="params">e</span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;pageshow&quot;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="variable language_">window</span>.<span class="title function_">addEventListener</span>(<span class="string">&quot;pagehide&quot;</span>, <span class="keyword">function</span> (<span class="params">e</span>) &#123;</span><br><span class="line">  <span class="comment">// 页面隐藏的时候执行事件</span></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;pagehide&quot;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="variable language_">window</span>.<span class="title function_">addEventListener</span>(<span class="string">&quot;visibilitychange&quot;</span>, <span class="keyword">function</span> (<span class="params">e</span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;visibilitychange&quot;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="variable language_">window</span>.<span class="title function_">addEventListener</span>(<span class="string">&quot;unload&quot;</span>, <span class="keyword">function</span> (<span class="params">e</span>) &#123;</span><br><span class="line">  <span class="comment">// 当用户离开页面时触发了事件</span></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;onunload&quot;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">window</span>.<span class="property">onbeforeunload</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="comment">// 页面跳转之前执行了事件</span></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;onbeforeunload&quot;</span>);</span><br><span class="line">  <span class="variable language_">localStorage</span>.<span class="title function_">setItem</span>(<span class="string">&quot;onbeforeunload&quot;</span>, <span class="string">&quot;1&quot;</span>);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>前端</category>
      </categories>
      <tags>
        <tag>window</tag>
      </tags>
  </entry>
  <entry>
    <title>什么是进程?什么的线程?</title>
    <url>/test/post/%E4%BB%80%E4%B9%88%E6%98%AF%E8%BF%9B%E7%A8%8B-%E4%BB%80%E4%B9%88%E7%9A%84%E7%BA%BF%E7%A8%8B/</url>
    <content><![CDATA[<h2 id="进程"><a href="#进程" class="headerlink" title="进程"></a>进程</h2><p>操作系统中最核心的概念就是进程，进程是对正在运行中的程序的一个抽象，是系统进行资源分配和调度的基本单位</p>
<p>操作系统的其他所有内容都是围绕着进程展开的，负责执行这些任务的是 CPU</p>
<p>进程是一种抽象的概念，从来没有统一的标准定义看，一般由程序、数据集合和进程控制块三部分组成：</p>
<ul>
<li><p>程序用于描述进程要完成的功能，是控制进程执行的指令集</p>
</li>
<li><p>数据集合是程序在执行时所需要的数据和工作区</p>
</li>
<li><p>程序控制块，包含进程的描述信息和控制信息，是进程存在的唯一标志</p>
</li>
</ul>
<h2 id="线程"><a href="#线程" class="headerlink" title="线程"></a>线程</h2><p>线程（thread）是操作系统能够进行运算调度的最小单位，其是进程中的一个执行任务（控制单元），负责当前进程中程序的执行</p>
<p>一个进程至少有一个线程，一个进程可以运行多个线程，这些线程共享同一块内存，线程之间可以共享对象、资源，如果有冲突或需要协同，还可以随时沟通以解决冲突或保持同步</p>
<p>举个例子，假设你经营着一家物业管理公司。最初，业务量很小，事事都需要你亲力亲为。给老张家修完暖气管道，立马再去老李家换电灯泡—这叫单线程，所有的工作都得顺序执行</p>
<p>后来业务拓展了，你雇佣了几个工人，这样，你的物业公司就可以同时为多户人家提供服务了—这叫多线程，你是主线程。但实际上，并不是线程越多，进程的工作效率越高，这是因为在一个进程内，不管你创建了多少线程，它们总是被限定在一颗 CPU内，或者多核 CPU的一个核内</p>
<p>这意味着，多线程在宏观上是并行的，在微观上则是分时切换串行的，多线程编程无法充分发挥多核计算资源的优势</p>
<p>这导致使用多线程做任务并行处理时，线程数量超过一定数值后，线程越多速度反倒越慢的原因</p>
<h2 id="区别"><a href="#区别" class="headerlink" title="区别"></a>区别</h2><ul>
<li><p>本质区别：进程是操作系统资源分配的基本单位，而线程是任务调度和执行的基本单位</p>
</li>
<li><p>在开销方面：每个进程都有独立的代码和数据空间（程序上下文），程序之间的切换会有较大的开销；线程可以看做轻量级的进程，同一类线程共享代码和数据空间，每个线程都有自己独立的运行栈和程序计数器（PC），线程之间切换的开销小</p>
</li>
<li><p>所处环境：在操作系统中能同时运行多个进程（程序）；而在同一个进程（程序）中有多个线程同时执行（通过CPU调度，在每个时间片中只有一个线程执行）</p>
</li>
<li><p>内存分配方面：系统在运行的时候会为每个进程分配不同的内存空间；而对线程而言，除了CPU外，系统不会为线程分配内存（线程所使用的资源来自其所属进程的资源），线程组之间只能共享资源</p>
</li>
<li><p>包含关系：没有线程的进程可以看做是单线程的，如果一个进程内有多个线程，则执行过程不是一条线的，而是多条线（线程）共同完成的；线程是进程的一部分，所以线程也被称为轻权进程或者轻量级进程</p>
</li>
</ul>
<p>举个例子：进程＝火车，线程＝车厢</p>
<ul>
<li><p>线程在进程下行进（单纯的车厢无法运行）</p>
</li>
<li><p>一个进程可以包含多个线程（一辆火车可以有多个车厢）</p>
</li>
<li><p>不同进程间数据很难共享（一辆火车上的乘客很难换到另外一辆火车，比如站点换乘）</p>
</li>
<li><p>同一进程下不同线程间数据很易共享（A车厢换到B车厢很容易）</p>
</li>
<li><p>进程要比线程消耗更多的计算机资源（采用多列火车相比多个车厢更耗资源）</p>
</li>
<li><p>进程间不会相互影响，一个线程挂掉将导致整个进程挂掉（一列火车不会影响到另外一列火车，但是如果一列火车上中间的一节车厢着火了，将影响到所有车厢）</p>
</li>
</ul>
]]></content>
  </entry>
  <entry>
    <title>从零开始配置webpack</title>
    <url>/test/post/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E9%85%8D%E7%BD%AEwebpack/</url>
    <content><![CDATA[<h2 id="从零开始配置webpack-基于webpack-4-和-babel-7版本"><a href="#从零开始配置webpack-基于webpack-4-和-babel-7版本" class="headerlink" title="从零开始配置webpack(基于webpack 4 和 babel 7版本)"></a>从零开始配置webpack(基于webpack 4 和 babel 7版本)</h2><h3 id="webpack-核心概念"><a href="#webpack-核心概念" class="headerlink" title="webpack 核心概念:"></a>webpack 核心概念:</h3><ul>
<li>Entry: 入口</li>
<li>Module:模块，webpack中一切皆是模块</li>
<li>Chunk:代码库，一个chunk由十多个模块组合而成，用于代码合并与分割</li>
<li>Loader:模块转换器，用于把模块原内容按照需求转换成新内容</li>
<li>Plugin:扩展插件，在webpack构建流程中的特定时机注入扩展逻辑来改变构建结果或做你想要做的事情</li>
<li>Output: 输出结果</li>
</ul>
<h3 id="webpack流程"><a href="#webpack流程" class="headerlink" title="webpack流程:"></a>webpack流程:</h3><p>webpack启动后会从 Entry 里配置的 Module 开始递归解析 Entry 依赖的所有Module.每找到一个Module,就会根据配置的Loader去找出对应的转换规则，对Module进行转换后，再解析出当前的Module依赖的Module.这些模块会以Entry为单位进行分组，一个Entry和其所有依赖的Module被分到一个组也就是一个Chunk。最好Webpack会把所有Chunk转换成文件输出。在整个流程中Webpack会在恰当的时机执行Plugin里定义的逻辑。</p>
<p>下面我们开始从零开始配置一个支持打包图片,CSS,LESS,SASS,支持ES6&#x2F;ES7和JSX语法，并对代码进行压缩的webpack配置.</p>
<h3 id="1-最简webpack配置"><a href="#1-最简webpack配置" class="headerlink" title="1. 最简webpack配置"></a>1. 最简webpack配置</h3><p>首先初始化npm和安装webpack的依赖:</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">npm init -y</span><br><span class="line">npm install --save-dev webpack webpack-cli</span><br></pre></td></tr></table></figure>
<p>配置 webpack.config.js 文件如下:</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">    <span class="attr">entry</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&#x27;src/index.js&#x27;</span>),</span><br><span class="line">    <span class="attr">output</span>: &#123;</span><br><span class="line">        <span class="attr">path</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&#x27;dist&#x27;</span>),</span><br><span class="line">        <span class="attr">filename</span>: <span class="string">&#x27;bundle.js&#x27;</span>,</span><br><span class="line">        <span class="attr">publicPath</span>: <span class="string">&#x27;/&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>说明: publicPath 上线时配置的是cdn的地址。</p>
<p>使用命令进行打包:</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">webpack --mode production</span><br></pre></td></tr></table></figure>
<p>也可以将其配置到 package.json 中的 scripts 字段.</p>
<p>入口文件为 src&#x2F;index.js, 打包输出到 dist&#x2F;bundle.js.</p>
<h3 id="2-使用模板-html"><a href="#2-使用模板-html" class="headerlink" title="2. 使用模板 html"></a>2. 使用模板 html</h3><p>html-webpack-plugin 可以指定template模板文件，将会在output目录下，生成html文件，并引入打包后的js.</p>
<p>安装依赖:</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">npm install --save-dev html-webpack-plugin</span><br></pre></td></tr></table></figure>
<p>在 webpack.config.js 增加 plugins 配置:</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">HtmlWebpackPlugin</span> = <span class="built_in">require</span>(<span class="string">&#x27;html-webpack-plugin&#x27;</span>);</span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">    <span class="comment">//...other code</span></span><br><span class="line">    <span class="attr">plugins</span>: [</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">HtmlWebpackPlugin</span>(&#123;</span><br><span class="line">            <span class="attr">template</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&#x27;src/index.html&#x27;</span>)</span><br><span class="line">        &#125;)</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>HtmlWebpackPlugin 还有一些其它的参数,如title(html的title),minify(是否要压缩),filename(dist中生成的html的文件名)等</p>
<h3 id="3-配置-webpack-dev-server"><a href="#3-配置-webpack-dev-server" class="headerlink" title="3. 配置 webpack-dev-server"></a>3. 配置 webpack-dev-server</h3><p>webpack-dev-server提供了一个简单的Web服务器和实时热更新的能力</p>
<p>安装依赖:</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">npm install --save-dev webpack-dev-server</span><br></pre></td></tr></table></figure>
<p>在 webpack.config.js 增加 devServer 配置:</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">HtmlWebpackPlugin</span> = <span class="built_in">require</span>(<span class="string">&#x27;html-webpack-plugin&#x27;</span>);</span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">    <span class="comment">//...other code</span></span><br><span class="line">    <span class="attr">devServer</span>: &#123;</span><br><span class="line">        <span class="attr">contentBase</span>: <span class="string">&#x27;./dist&#x27;</span>,</span><br><span class="line">        <span class="attr">port</span>: <span class="string">&#x27;8080&#x27;</span>,</span><br><span class="line">        <span class="attr">host</span>: <span class="string">&#x27;localhost&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在 package.json 的 scripts 字段中增加:</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">webpack-dev-server --mode development</span><br></pre></td></tr></table></figure>
<p>之后，我们就可以通过 npm run dev , 来启动服务。</p>
<p>更多 webpack-dev-server 的知识，请访问: <a href="https://webpack.js.org/configuration/dev-server/">https://webpack.js.org/configuration/dev-server/</a></p>
<h3 id="4-支持加载css文件"><a href="#4-支持加载css文件" class="headerlink" title="4. 支持加载css文件"></a>4. 支持加载css文件</h3><p>通过使用不同的 style-loader 和 css-loader, 可以将 css 文件转换成JS文件类型。</p>
<p>安装依赖:</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">npm install --save-dev style-loader css-loader</span><br></pre></td></tr></table></figure>
<p>在 webpack.config.js 中增加 loader 的配置</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">    <span class="comment">//other code</span></span><br><span class="line">    <span class="attr">module</span>: &#123;</span><br><span class="line">        <span class="attr">rules</span>: [</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">test</span>: <span class="regexp">/\.css/</span>,</span><br><span class="line">                <span class="attr">use</span>: [<span class="string">&#x27;style-loader&#x27;</span>, <span class="string">&#x27;css-loader&#x27;</span>],</span><br><span class="line">                <span class="attr">exclude</span>: <span class="regexp">/node_modules/</span>,</span><br><span class="line">                <span class="attr">include</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&#x27;src&#x27;</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>loader 可以配置以下参数:</p>
<ul>
<li>test: 匹配处理文件的扩展名的正则表达式</li>
<li>use: loader名称</li>
<li>include&#x2F;exclude: 手动指定必须处理的文件夹或屏蔽不需要处理的文件夹</li>
<li>query: 为loader提供额外的设置选项</li>
</ul>
<p>如果需要给loader传参，那么可以使用use+loader的方式,如:</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">    <span class="comment">//other code</span></span><br><span class="line">    <span class="attr">module</span>: &#123;</span><br><span class="line">        <span class="attr">rules</span>: [</span><br><span class="line">            &#123;</span><br><span class="line">            <span class="attr">use</span>: [&#123;</span><br><span class="line">                        <span class="attr">loader</span>: <span class="string">&#x27;style-loader&#x27;</span>,</span><br><span class="line">                        <span class="attr">options</span>: &#123;</span><br><span class="line">                            <span class="attr">insertAt</span>: <span class="string">&#x27;top&#x27;</span></span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;,</span><br><span class="line">                    <span class="string">&#x27;css-loader&#x27;</span></span><br><span class="line">                ],</span><br><span class="line">                <span class="comment">//....</span></span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>
<h3 id="5-支持加载图片"><a href="#5-支持加载图片" class="headerlink" title="5. 支持加载图片"></a>5. 支持加载图片</h3><ul>
<li>file-loader: 解决CSS等文件中的引入图片路径问题</li>
<li>url-loader: 当图片小于limit的时候会把图片Base64编码，大于limit参数的时候还是使用file-loader进行拷贝</li>
</ul>
<p>如果希望图片存放在单独的目录下，那么需要指定outputPath</p>
<p>安装依赖:</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">npm install --save-dev url-loader file-loader</span><br></pre></td></tr></table></figure>
<p>在 webpack.config.js 中增加 loader 的配置(增加在 module.rules 的数组中)。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">    <span class="comment">//other code</span></span><br><span class="line">    <span class="attr">module</span>: &#123;</span><br><span class="line">        <span class="attr">rules</span>: [</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">test</span>: <span class="regexp">/\.(gif|jpg|png|bmp|eot|woff|woff2|ttf|svg)/</span>,</span><br><span class="line">                <span class="attr">use</span>: [</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="attr">loader</span>: <span class="string">&#x27;url-loader&#x27;</span>,</span><br><span class="line">                        <span class="attr">options</span>: &#123;</span><br><span class="line">                            <span class="attr">limit</span>: <span class="number">8192</span>,</span><br><span class="line">                            <span class="attr">outputPath</span>: <span class="string">&#x27;images&#x27;</span></span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                ]</span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>
<h3 id="6-支持编译less和sass"><a href="#6-支持编译less和sass" class="headerlink" title="6.支持编译less和sass"></a>6.支持编译less和sass</h3><p>有些前端同事可能习惯于使用less或者是sass编写css，那么也需要在 webpack 中进行配置。</p>
<p>安装对应的依赖:</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">npm install --save-dev less less-loader</span><br><span class="line">npm install --save-dev node-sass sass-loader</span><br></pre></td></tr></table></figure>
<p>在 webpack.config.js 中增加 loader 的配置(module.rules 数组中)。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">    <span class="comment">//other code</span></span><br><span class="line">    <span class="attr">module</span>: &#123;</span><br><span class="line">        <span class="attr">rules</span>: [</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">test</span>: <span class="regexp">/\.less/</span>,</span><br><span class="line">                <span class="attr">use</span>: [<span class="string">&#x27;style-loader&#x27;</span>, <span class="string">&#x27;css-loader&#x27;</span>, <span class="string">&#x27;less-loader&#x27;</span>],</span><br><span class="line">                <span class="attr">exclude</span>: <span class="regexp">/node_modules/</span>,</span><br><span class="line">                <span class="attr">include</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&#x27;src&#x27;</span>)</span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">test</span>: <span class="regexp">/\.scss/</span>,</span><br><span class="line">                <span class="attr">use</span>: [<span class="string">&#x27;style-loader&#x27;</span>, <span class="string">&#x27;css-loader&#x27;</span>, <span class="string">&#x27;sass-loader&#x27;</span>],</span><br><span class="line">                <span class="attr">exclude</span>: <span class="regexp">/node_modules/</span>,</span><br><span class="line">                <span class="attr">include</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&#x27;src&#x27;</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;        </span><br></pre></td></tr></table></figure>
<h3 id="7-支持转义-ES6-ES7-JSX"><a href="#7-支持转义-ES6-ES7-JSX" class="headerlink" title="7.支持转义 ES6&#x2F;ES7&#x2F;JSX"></a>7.支持转义 ES6&#x2F;ES7&#x2F;JSX</h3><p>ES6&#x2F;ES7&#x2F;JSX 转义需要 Babel 的依赖，支持装饰器。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">npm install --save-dev @babel/core babel-loader @babel/preset-env @babel/preset-react @babel/plugin-proposal-decorators @babel/plugin-proposal-object-rest-spread</span><br></pre></td></tr></table></figure>
<p>在 webpack.config.js 中增加 loader 的配置(module.rules 数组中)。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">    <span class="comment">//other code</span></span><br><span class="line">    <span class="attr">module</span>: &#123;</span><br><span class="line">        <span class="attr">rules</span>: [</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">test</span>: <span class="regexp">/\.jsx?$/</span>,</span><br><span class="line">                <span class="attr">use</span>: [</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="attr">loader</span>: <span class="string">&#x27;babel-loader&#x27;</span>,</span><br><span class="line">                        <span class="attr">options</span>: &#123;</span><br><span class="line">                            <span class="attr">presets</span>: [<span class="string">&#x27;@babel/preset-env&#x27;</span>, <span class="string">&#x27;@babel/react&#x27;</span>],</span><br><span class="line">                            <span class="attr">plugins</span>: [</span><br><span class="line">                                [<span class="built_in">require</span>(<span class="string">&quot;@babel/plugin-proposal-decorators&quot;</span>), &#123; <span class="string">&quot;legacy&quot;</span>: <span class="literal">true</span> &#125;]</span><br><span class="line">                            ]</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                ],</span><br><span class="line">                <span class="attr">include</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&#x27;src&#x27;</span>),</span><br><span class="line">                <span class="attr">exclude</span>: <span class="regexp">/node_modules/</span></span><br><span class="line">            &#125;,</span><br><span class="line">        ]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="8-压缩JS文件"><a href="#8-压缩JS文件" class="headerlink" title="8.压缩JS文件"></a>8.压缩JS文件</h3><p>安装依赖:</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">npm install --save-dev uglifyjs-webpack-plugin</span><br><span class="line">npm install --save-dev optimize-css-assets-webpack-plugin</span><br></pre></td></tr></table></figure>
<p>在 webpack.config.js 中增加 optimization 的配置</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">UglifyWebpackPlugin</span> = <span class="built_in">require</span>(<span class="string">&#x27;uglifyjs-webpack-plugin&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">    <span class="comment">//other code</span></span><br><span class="line">    <span class="attr">optimization</span>: &#123;</span><br><span class="line">        <span class="attr">minimizer</span>: [</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">UglifyWebpackPlugin</span>(&#123;</span><br><span class="line">                <span class="attr">parallel</span>: <span class="number">4</span></span><br><span class="line">            &#125;)</span><br><span class="line">        ]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="9-分离CSS-如果CSS文件较大的话"><a href="#9-分离CSS-如果CSS文件较大的话" class="headerlink" title="9.分离CSS(如果CSS文件较大的话)"></a>9.分离CSS(如果CSS文件较大的话)</h3><p>因为CSS的下载和JS可以并行，当一个HTML文件很大的时候，可以把CSS单独提取出来加载</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">npm install --save-dev mini-css-extract-plugin</span><br></pre></td></tr></table></figure>
<p>在 webpack.config.js 中增加 plugins 的配置,并且将 ‘style-loader’ 修改为 { loader: MiniCssExtractPlugin.loader}。</p>
<p>CSS打包在单独目录，那么配置filename。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">MiniCssExtractPlugin</span> = <span class="built_in">require</span>(<span class="string">&#x27;mini-css-extract-plugin&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">    <span class="comment">//other code</span></span><br><span class="line">    <span class="attr">module</span>: &#123;</span><br><span class="line">        <span class="attr">rules</span>: [</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">test</span>: <span class="regexp">/\.css/</span>,</span><br><span class="line">                <span class="attr">use</span>: [&#123; <span class="attr">loader</span>: <span class="title class_">MiniCssExtractPlugin</span>.<span class="property">loader</span>&#125;, <span class="string">&#x27;css-loader&#x27;</span>],</span><br><span class="line">                <span class="attr">exclude</span>: <span class="regexp">/node_modules/</span>,</span><br><span class="line">                <span class="attr">include</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&#x27;src&#x27;</span>)</span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">test</span>: <span class="regexp">/\.less/</span>,</span><br><span class="line">                <span class="attr">use</span>: [&#123; <span class="attr">loader</span>: <span class="title class_">MiniCssExtractPlugin</span>.<span class="property">loader</span> &#125;, <span class="string">&#x27;css-loader&#x27;</span>, <span class="string">&#x27;less-loader&#x27;</span>],</span><br><span class="line">                <span class="attr">exclude</span>: <span class="regexp">/node_modules/</span>,</span><br><span class="line">                <span class="attr">include</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&#x27;src&#x27;</span>)</span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">test</span>: <span class="regexp">/\.scss/</span>,</span><br><span class="line">                <span class="attr">use</span>: [&#123; <span class="attr">loader</span>: <span class="title class_">MiniCssExtractPlugin</span>.<span class="property">loader</span> &#125;, <span class="string">&#x27;css-loader&#x27;</span>, <span class="string">&#x27;sass-loader&#x27;</span>],</span><br><span class="line">                <span class="attr">exclude</span>: <span class="regexp">/node_modules/</span>,</span><br><span class="line">                <span class="attr">include</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&#x27;src&#x27;</span>)</span><br><span class="line">            &#125;,</span><br><span class="line">        ]</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">plugins</span>: [</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">MiniCssExtractPlugin</span>(&#123;</span><br><span class="line">            <span class="attr">filename</span>: <span class="string">&#x27;css/[name].css&#x27;</span></span><br><span class="line">        &#125;)</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="10-压缩CSS文件"><a href="#10-压缩CSS文件" class="headerlink" title="10.压缩CSS文件"></a>10.压缩CSS文件</h3><p>安装依赖:</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">npm install --save-dev optimize-css-assets-webpack-plugin</span><br></pre></td></tr></table></figure>
<p>在 webpack.config.js 中的 optimization 中增加配置</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">OptimizeCssAssetsWebpackPlugin</span> = <span class="built_in">require</span>(<span class="string">&#x27;optimize-css-assets-webpack-plugin&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">    <span class="comment">//other code</span></span><br><span class="line">    <span class="attr">optimization</span>: &#123;</span><br><span class="line">        <span class="attr">minimizer</span>: [</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">OptimizeCssAssetsWebpackPlugin</span>()</span><br><span class="line">        ]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="11-打包前先清空输出目录"><a href="#11-打包前先清空输出目录" class="headerlink" title="11.打包前先清空输出目录"></a>11.打包前先清空输出目录</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">npm install --save-dev clean-webpack-plugin</span><br></pre></td></tr></table></figure>
<p>在 webpack.config.js 中增加 plugins 的配置</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">CleanWebpackPlugin</span> = <span class="built_in">require</span>(<span class="string">&#x27;clean-webpack-plugin&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">    <span class="comment">//other code</span></span><br><span class="line">    <span class="attr">plugins</span>: [</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">CleanWebpackPlugin</span>()</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>至此，webpack配置已经基本能满足需求。</p>
<h3 id="完整webpack-config-js和package-json文件"><a href="#完整webpack-config-js和package-json文件" class="headerlink" title="完整webpack.config.js和package.json文件"></a>完整webpack.config.js和package.json文件</h3><p>webpack.config.js文件:</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> htmlWebpackPlugin = <span class="built_in">require</span>(<span class="string">&#x27;html-webpack-plugin&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">UglifyWebpackPlugin</span> = <span class="built_in">require</span>(<span class="string">&#x27;uglifyjs-webpack-plugin&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">MiniCssExtractPlugin</span> = <span class="built_in">require</span>(<span class="string">&#x27;mini-css-extract-plugin&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">CleanWebpackPlugin</span> = <span class="built_in">require</span>(<span class="string">&#x27;clean-webpack-plugin&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">OptimizeCssAssetsWebpackPlugin</span> = <span class="built_in">require</span>(<span class="string">&#x27;optimize-css-assets-webpack-plugin&#x27;</span>);</span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">    <span class="attr">entry</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&#x27;src/index.js&#x27;</span>),</span><br><span class="line">    <span class="attr">output</span>: &#123;</span><br><span class="line">        <span class="attr">path</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&#x27;dist&#x27;</span>),</span><br><span class="line">        <span class="attr">filename</span>: <span class="string">&#x27;bundle.js&#x27;</span>,</span><br><span class="line">        <span class="attr">publicPath</span>: <span class="string">&#x27;/&#x27;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">devServer</span>: &#123;</span><br><span class="line">        <span class="attr">contentBase</span>: <span class="string">&#x27;./dist&#x27;</span>,</span><br><span class="line">        <span class="attr">port</span>: <span class="string">&#x27;8080&#x27;</span>,</span><br><span class="line">        <span class="attr">host</span>: <span class="string">&#x27;localhost&#x27;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">module</span>: &#123;</span><br><span class="line">        <span class="attr">rules</span>: [</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">test</span>: <span class="regexp">/\.jsx?$/</span>,</span><br><span class="line">                <span class="attr">use</span>: [</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="attr">loader</span>: <span class="string">&#x27;babel-loader&#x27;</span>,</span><br><span class="line">                        <span class="attr">options</span>: &#123;</span><br><span class="line">                            <span class="attr">presets</span>: [<span class="string">&#x27;@babel/preset-env&#x27;</span>, <span class="string">&#x27;@babel/react&#x27;</span>],</span><br><span class="line">                            <span class="attr">plugins</span>: [</span><br><span class="line">                                [<span class="built_in">require</span>(<span class="string">&quot;@babel/plugin-proposal-decorators&quot;</span>), &#123; <span class="string">&quot;legacy&quot;</span>: <span class="literal">true</span> &#125;]</span><br><span class="line">                            ]</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                ],</span><br><span class="line">                <span class="attr">include</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&#x27;src&#x27;</span>),</span><br><span class="line">                <span class="attr">exclude</span>: <span class="regexp">/node_modules/</span></span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">test</span>: <span class="regexp">/\.css/</span>,</span><br><span class="line">                <span class="attr">use</span>: [&#123; <span class="attr">loader</span>: <span class="title class_">MiniCssExtractPlugin</span>.<span class="property">loader</span>&#125;, <span class="string">&#x27;css-loader&#x27;</span>],</span><br><span class="line">                <span class="attr">exclude</span>: <span class="regexp">/node_modules/</span>,</span><br><span class="line">                <span class="attr">include</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&#x27;src&#x27;</span>)</span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">test</span>: <span class="regexp">/\.less/</span>,</span><br><span class="line">                <span class="attr">use</span>: [&#123; <span class="attr">loader</span>: <span class="title class_">MiniCssExtractPlugin</span>.<span class="property">loader</span> &#125;, <span class="string">&#x27;css-loader&#x27;</span>, <span class="string">&#x27;less-loader&#x27;</span>],</span><br><span class="line">                <span class="attr">exclude</span>: <span class="regexp">/node_modules/</span>,</span><br><span class="line">                <span class="attr">include</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&#x27;src&#x27;</span>)</span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">test</span>: <span class="regexp">/\.scss/</span>,</span><br><span class="line">                <span class="attr">use</span>: [&#123; <span class="attr">loader</span>: <span class="title class_">MiniCssExtractPlugin</span>.<span class="property">loader</span> &#125;, <span class="string">&#x27;css-loader&#x27;</span>, <span class="string">&#x27;sass-loader&#x27;</span>],</span><br><span class="line">                <span class="attr">exclude</span>: <span class="regexp">/node_modules/</span>,</span><br><span class="line">                <span class="attr">include</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&#x27;src&#x27;</span>)</span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">test</span>: <span class="regexp">/\.(gif|jpg|png|bmp|eot|woff|woff2|ttf|svg)/</span>,</span><br><span class="line">                <span class="attr">use</span>: [</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="attr">loader</span>: <span class="string">&#x27;url-loader&#x27;</span>,</span><br><span class="line">                        <span class="attr">options</span>: &#123;</span><br><span class="line">                            <span class="attr">limit</span>: <span class="number">1024</span>,</span><br><span class="line">                            <span class="attr">outputPath</span>: <span class="string">&#x27;images&#x27;</span></span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                ]</span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">optimization</span>: &#123;</span><br><span class="line">        <span class="attr">minimizer</span>: [</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">UglifyWebpackPlugin</span>(&#123;</span><br><span class="line">                <span class="attr">parallel</span>: <span class="number">4</span></span><br><span class="line">            &#125;),</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">OptimizeCssAssetsWebpackPlugin</span>()</span><br><span class="line">        ]</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">plugins</span>: [</span><br><span class="line">        <span class="keyword">new</span> <span class="title function_">htmlWebpackPlugin</span>(&#123;</span><br><span class="line">            <span class="attr">template</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&#x27;src/index.html&#x27;</span>),</span><br><span class="line">        &#125;),</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">MiniCssExtractPlugin</span>(&#123;</span><br><span class="line">            <span class="attr">filename</span>: <span class="string">&#x27;css/[name].css&#x27;</span></span><br><span class="line">        &#125;),</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">CleanWebpackPlugin</span>()</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>package.json文件:</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;name&quot;</span>: <span class="string">&quot;webpk&quot;</span>,</span><br><span class="line">  <span class="string">&quot;version&quot;</span>: <span class="string">&quot;1.0.0&quot;</span>,</span><br><span class="line">  <span class="string">&quot;description&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">  <span class="string">&quot;main&quot;</span>: <span class="string">&quot;webpack.config.js&quot;</span>,</span><br><span class="line">  <span class="string">&quot;scripts&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;test&quot;</span>: <span class="string">&quot;echo \&quot;Error: no test specified\&quot; &amp;&amp; exit 1&quot;</span>,</span><br><span class="line">    <span class="string">&quot;build&quot;</span>: <span class="string">&quot;webpack --mode production&quot;</span>,</span><br><span class="line">    <span class="string">&quot;dev&quot;</span>: <span class="string">&quot;webpack-dev-server --mode development&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;keywords&quot;</span>: [],</span><br><span class="line">  <span class="string">&quot;author&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">  <span class="string">&quot;license&quot;</span>: <span class="string">&quot;ISC&quot;</span>,</span><br><span class="line">  <span class="string">&quot;devDependencies&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;@babel/core&quot;</span>: <span class="string">&quot;^7.4.0&quot;</span>,</span><br><span class="line">    <span class="string">&quot;@babel/plugin-proposal-decorators&quot;</span>: <span class="string">&quot;^7.4.0&quot;</span>,</span><br><span class="line">    <span class="string">&quot;@babel/plugin-proposal-object-rest-spread&quot;</span>: <span class="string">&quot;^7.4.0&quot;</span>,</span><br><span class="line">    <span class="string">&quot;@babel/preset-env&quot;</span>: <span class="string">&quot;^7.4.1&quot;</span>,</span><br><span class="line">    <span class="string">&quot;@babel/preset-react&quot;</span>: <span class="string">&quot;^7.0.0&quot;</span>,</span><br><span class="line">    <span class="string">&quot;babel-loader&quot;</span>: <span class="string">&quot;^8.0.5&quot;</span>,</span><br><span class="line">    <span class="string">&quot;clean-webpack-plugin&quot;</span>: <span class="string">&quot;^2.0.1&quot;</span>,</span><br><span class="line">    <span class="string">&quot;css-loader&quot;</span>: <span class="string">&quot;^2.1.1&quot;</span>,</span><br><span class="line">    <span class="string">&quot;file-loader&quot;</span>: <span class="string">&quot;^3.0.1&quot;</span>,</span><br><span class="line">    <span class="string">&quot;html-webpack-plugin&quot;</span>: <span class="string">&quot;^3.2.0&quot;</span>,</span><br><span class="line">    <span class="string">&quot;less&quot;</span>: <span class="string">&quot;^3.9.0&quot;</span>,</span><br><span class="line">    <span class="string">&quot;less-loader&quot;</span>: <span class="string">&quot;^4.1.0&quot;</span>,</span><br><span class="line">    <span class="string">&quot;mini-css-extract-plugin&quot;</span>: <span class="string">&quot;^0.5.0&quot;</span>,</span><br><span class="line">    <span class="string">&quot;node-sass&quot;</span>: <span class="string">&quot;^4.11.0&quot;</span>,</span><br><span class="line">    <span class="string">&quot;optimize-css-assets-webpack-plugin&quot;</span>: <span class="string">&quot;^5.0.1&quot;</span>,</span><br><span class="line">    <span class="string">&quot;sass-loader&quot;</span>: <span class="string">&quot;^7.1.0&quot;</span>,</span><br><span class="line">    <span class="string">&quot;style-loader&quot;</span>: <span class="string">&quot;^0.23.1&quot;</span>,</span><br><span class="line">    <span class="string">&quot;uglifyjs-webpack-plugin&quot;</span>: <span class="string">&quot;^2.1.2&quot;</span>,</span><br><span class="line">    <span class="string">&quot;url-loader&quot;</span>: <span class="string">&quot;^1.1.2&quot;</span>,</span><br><span class="line">    <span class="string">&quot;webpack&quot;</span>: <span class="string">&quot;^4.29.6&quot;</span>,</span><br><span class="line">    <span class="string">&quot;webpack-cli&quot;</span>: <span class="string">&quot;^3.3.0&quot;</span>,</span><br><span class="line">    <span class="string">&quot;webpack-dev-server&quot;</span>: <span class="string">&quot;^3.2.1&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;dependencies&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;react&quot;</span>: <span class="string">&quot;^16.8.4&quot;</span>,</span><br><span class="line">    <span class="string">&quot;react-dom&quot;</span>: <span class="string">&quot;^16.8.4&quot;</span>,</span><br><span class="line">    <span class="string">&quot;react-redux&quot;</span>: <span class="string">&quot;^6.0.1&quot;</span>,</span><br><span class="line">    <span class="string">&quot;redux&quot;</span>: <span class="string">&quot;^4.0.1&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>更多loader和plugin的参数可以参考:</p>
<p><a href="https://www.webpackjs.com/loaders/">https://www.webpackjs.com/loaders/</a></p>
<p><a href="https://www.webpackjs.com/plugins/">https://www.webpackjs.com/plugins/</a></p>
]]></content>
      <categories>
        <category>前端</category>
      </categories>
      <tags>
        <tag>JavaScript</tag>
        <tag>webpack</tag>
      </tags>
  </entry>
  <entry>
    <title>使用CSS实现进度条和饼图</title>
    <url>/test/post/%E4%BD%BF%E7%94%A8CSS%E5%AE%9E%E7%8E%B0%E8%BF%9B%E5%BA%A6%E6%9D%A1%E5%92%8C%E9%A5%BC%E5%9B%BE/</url>
    <content><![CDATA[<p>进度条，是我们日常界面中使用的非常多的一种，下面我们来看看。到今天，我们可以如何实现进度条。</p>
<h2 id="HTML-标签-–-meter-progress"><a href="#HTML-标签-–-meter-progress" class="headerlink" title="HTML 标签 – meter &amp; progress"></a>HTML 标签 – meter &amp; progress</h2><p>这个可能是一些同学还不太清楚的，HTML5 原生提供了两个标签 <code>&lt;meter&gt;</code> 和 <code>&lt;progress&gt;</code> 来实现进度条。</p>
<ul>
<li><code>&lt;meter&gt;</code>：用来显示已知范围的标量值或者分数值</li>
<li><code>&lt;progress&gt;</code>：用来显示一项任务的完成进度，通常情况下，该元素都显示为一个进度条</li>
</ul>
<p>我们分别来看看，首先是 <code>&lt;meter&gt;</code> 标签：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;p&gt;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">span</span>&gt;</span>完成度：<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">meter</span> <span class="attr">min</span>=<span class="string">&quot;0&quot;</span> <span class="attr">max</span>=<span class="string">&quot;500&quot;</span> <span class="attr">value</span>=<span class="string">&quot;350&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    350 degrees</span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">meter</span>&gt;</span></span></span><br><span class="line">&lt;/p&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">meter &#123;</span><br><span class="line">    <span class="attr">width</span>: 200px;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>样式如下：</p>
<p><img src="https://alianck.oss-cn-beijing.aliyuncs.com/process1.webp" alt="图片"></p>
<p>其中，<code>min</code>、<code>max</code>、<code>value</code> 分别表示最大值，最小值与当前值。</p>
<p>无独有偶，我们再来看看 <code>&lt;progress&gt;</code> 标签的用法：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;p&gt;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;file&quot;</span>&gt;</span>完成度：<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span></span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">progress</span> <span class="attr">max</span>=<span class="string">&quot;100&quot;</span> <span class="attr">value</span>=<span class="string">&quot;70&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    &#123;&quot; &quot;&#125;</span></span><br><span class="line"><span class="language-xml">    70%&#123;&quot; &quot;&#125;</span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">progress</span>&gt;</span></span></span><br><span class="line">&lt;/p&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">progress &#123;</span><br><span class="line">    <span class="attr">width</span>: 200px;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>样式如下：</p>
<p><img src="https://alianck.oss-cn-beijing.aliyuncs.com/process2.webp" alt="图片"></p>
<p>其中，<code>max</code> 属性描述这个 progress 元素所表示的任务一共需要完成多少工作量，<code>value</code> 属性用来指定该进度条已完成的工作量。</p>
<h3 id="meter-progress-之间的差异"><a href="#meter-progress-之间的差异" class="headerlink" title="meter &amp; progress 之间的差异"></a>meter &amp; progress 之间的差异</h3><p>那么问题来了，从上述 Demo 看，两个标签的效果一模一样，那么它们的区别是什么？为什么会有两个看似一样的标签呢？</p>
<p>这两个元素最大的差异在于<strong>语义上的差别</strong>。</p>
<ul>
<li><code>&lt;meter&gt;</code>：表示<strong>已知范围内的标量测量值或分数值</strong></li>
<li><code>&lt;progress&gt;</code>：表示<strong>任务的完成进度</strong></li>
</ul>
<p>譬如，一个需求当前的完成度，应该使用 <code>&lt;progress&gt;</code>，而如果要展示汽车仪表盘当前的速度值，应该使用 <code>meter</code>。</p>
<h3 id="meter-progress-的局限性"><a href="#meter-progress-的局限性" class="headerlink" title="meter &amp; progress 的局限性"></a>meter &amp; progress 的局限性</h3><p>当然，在实际的业务需求中，或者生产环境，你几乎是不会看到 <code>&lt;meter&gt;</code> 和 <code>&lt;progress&gt;</code> 标签。</p>
<p>和我们在这篇文章中 – 《利用 datalist 实现可过滤下拉选框》[1] 讲到的原因类似，在于：</p>
<ol>
<li>我们无法有效的修改 <code>&lt;meter&gt;</code> 和 <code>&lt;progress&gt;</code> 标签的样式，譬如背景色，进度前景色等。并且，最为致命的是，浏览器默认样式的表现在不同浏览器之间并不一致。这给追求稳定，UI 表现一致的业务来说，是灾难性的缺点！</li>
<li>我们无法给他添加一些动画效果、交互效果，因为一些实际的应用场景中，肯定不是简单的展示一个进度条仅此而已</li>
</ol>
<h2 id="利用-CSS-实现进度条"><a href="#利用-CSS-实现进度条" class="headerlink" title="利用 CSS 实现进度条"></a>利用 CSS 实现进度条</h2><p>因此，在现阶段，更多的还是使用一些 CSS 的方式去实现进度条。</p>
<h3 id="使用百分比实现进度条"><a href="#使用百分比实现进度条" class="headerlink" title="使用百分比实现进度条"></a>使用百分比实现进度条</h3><p>最为常见的一种方式是使用背景色配合百分比的方式制作进度条。</p>
<p>最简单的一个 DEMO：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;div <span class="keyword">class</span>=<span class="string">&quot;g-container&quot;</span>&gt;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;g-progress&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">.<span class="property">g</span>-container &#123;</span><br><span class="line">    <span class="attr">width</span>: 240px;</span><br><span class="line">    <span class="attr">height</span>: 25px;</span><br><span class="line">    border-<span class="attr">radius</span>: 25px;</span><br><span class="line">    <span class="attr">background</span>: #eee;</span><br><span class="line">&#125;</span><br><span class="line">.<span class="property">g</span>-progress &#123;</span><br><span class="line">    <span class="attr">width</span>: <span class="number">50</span>%;</span><br><span class="line">    <span class="attr">height</span>: inherit;</span><br><span class="line">    border-<span class="attr">radius</span>: 25px <span class="number">0</span> <span class="number">0</span> 25px;</span><br><span class="line">    <span class="attr">background</span>: #0f0;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>效果如下：</p>
<p><img src="https://alianck.oss-cn-beijing.aliyuncs.com/process3.webp" alt="图片"></p>
<p>这种方式优势在于使用简单，实际进度可以非常方便的传递进 CSS 中</p>
<ol>
<li>利用 HTML <code>style</code> 属性填写完整的 <code>width</code> 值，譬如 <code>&lt;div class=&quot;g-progress&quot; style=&quot;width: 50%&quot;&gt;&lt;/div&gt;</code></li>
<li>或者利用 CSS 自定义属性 <code>&lt;div class=&quot;g-progress&quot; style=&quot;--progress: 50%&quot;&gt;&lt;/div&gt;</code> 配合实际 CSS 中的 <code>width: var(--progress)</code></li>
<li>完全的自定义样式，以及可以轻松的添加辅助丰富的动画和交互效果</li>
</ol>
<p>譬如给 <code>g-progress</code> 添加一个过渡效果：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">.<span class="property">g</span>-progress &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="attr">transition</span>: width .2s linear;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>这样，每次进度变化，都是一个动态的过渡过程：</p>
<p><img src="https://alianck.oss-cn-beijing.aliyuncs.com/process4.gif" alt="图片"></p>
<p>或者，渐变前景色，修改 <code>background: #0f0</code> 为 <code>background: linear-gradient(90deg, #0f0, #0ff)</code>：</p>
<h3 id="单标签使用渐变实现"><a href="#单标签使用渐变实现" class="headerlink" title="单标签使用渐变实现"></a>单标签使用渐变实现</h3><p>当然，可以看到，我们上面使用的是两个标签的结构：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;div class=&quot;g-container&quot;&gt;</span><br><span class="line">    &lt;div class=&quot;g-progress&quot;&gt;&lt;/div&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>抠门点，我们还可以仅仅利用一个标签去完成这个事情，主要借助了渐变去完成这个事情：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;div <span class="keyword">class</span>=<span class="string">&quot;g-progress&quot;</span>&gt;&lt;/div&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">.<span class="property">g</span>-progress &#123;</span><br><span class="line">    <span class="attr">width</span>: 240px;</span><br><span class="line">    <span class="attr">height</span>: 25px;</span><br><span class="line">    border-<span class="attr">radius</span>: 25px;</span><br><span class="line">    <span class="attr">background</span>: linear-<span class="title function_">gradient</span>(90deg, #0f0, #0ff <span class="number">70</span>%, transparent <span class="number">0</span>);</span><br><span class="line">    <span class="attr">border</span>: 1px solid #eee;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>结果如下：</p>
<p><img src="https://alianck.oss-cn-beijing.aliyuncs.com/process5.webp" alt="图片"></p>
<p>同样的，我们可以利用 HTML <code>style</code> 属性填写完整的 <code>background</code> 值传递实际百分比，当然，这里更推荐使用 CSS 自定义属性传值：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;div <span class="keyword">class</span>=<span class="string">&quot;g-progress&quot;</span> style=<span class="string">&quot;--progress: 50%&quot;</span>&gt;&lt;/div&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">.<span class="property">g</span>-progress &#123;</span><br><span class="line">    <span class="attr">background</span>: linear-<span class="title function_">gradient</span>(90deg, #0f0, #0ff <span class="title function_">var</span>(--progress), transparent <span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>熟悉 CSS 的同学会发现一个目前这种方式的弊端，在于当修改 <code>--progress</code> 的值的时候，即便给 <code>.g-progress</code> 添加了 <code>transition</code>，也不会有过渡动画效果。</p>
<p>原因在于，CSS 中，渐变（诸如 <code>linear-gradinet</code>、<code>radial-gradient</code>、<code>conic-gradient</code>）都是不支持过渡变换的。</p>
<p>所以，在这里，为了实现动画效果，我们可以借助 CSS @property，改造下我们的代码：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;div class=&quot;g-progress&quot; style=&quot;--progress: 70%&quot;&gt;&lt;/div&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">@property --progress &#123;</span><br><span class="line">  <span class="attr">syntax</span>: <span class="string">&#x27;&lt;percentage&gt;&#x27;</span>;</span><br><span class="line">  <span class="attr">inherits</span>: <span class="literal">false</span>;</span><br><span class="line">  initial-<span class="attr">value</span>: <span class="number">0</span>%;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.<span class="property">g</span>-progress &#123;</span><br><span class="line">    <span class="attr">margin</span>: auto;</span><br><span class="line">    <span class="attr">width</span>: 240px;</span><br><span class="line">    <span class="attr">height</span>: 25px;</span><br><span class="line">    border-<span class="attr">radius</span>: 25px;</span><br><span class="line">    <span class="attr">background</span>: linear-<span class="title function_">gradient</span>(90deg, #0f0, #0ff <span class="title function_">var</span>(--progress), transparent <span class="number">0</span>);</span><br><span class="line">    <span class="attr">border</span>: 1px solid #eee;</span><br><span class="line">    <span class="attr">transition</span>: .3s --progress;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>借助 CSS @property 的特性，我们在单标签下也是可以实现动画效果的：</p>
<p><img src="https://alianck.oss-cn-beijing.aliyuncs.com/process6.gif" alt="图片"></p>
<p>CodePen Demo – 单标签的进度条效果[2]</p>
<blockquote>
<p>对 CSS @property 还不了解的，可以看看我的这篇文章 – CSS @property，让不可能变可能[3]</p>
</blockquote>
<h2 id="圆弧形进度条"><a href="#圆弧形进度条" class="headerlink" title="圆弧形进度条"></a>圆弧形进度条</h2><p>当然，进度条不可能只有直线型的。还有非常多其他类型的，下面我们首先来看看圆弧型的进度条。</p>
<p>在今天，我们可以使用 CSS 快速的创建圆弧形式的进度条，类似于这样：</p>
<p><img src="https://alianck.oss-cn-beijing.aliyuncs.com/process7.webp" alt="图片"></p>
<p>核心就是使用角向渐变 <code>background: conic-gradient()</code>：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;div class=&quot;g-progress&quot;&gt;&lt;/div&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">.<span class="property">g</span>-progress &#123;</span><br><span class="line">    <span class="attr">width</span>: 160px;</span><br><span class="line">    <span class="attr">height</span>: 160px;</span><br><span class="line">    border-<span class="attr">radius</span>: <span class="number">50</span>%;</span><br><span class="line">    <span class="attr">background</span>: conic-<span class="title function_">gradient</span>(#<span class="title class_">FFCDB2</span> <span class="number">0</span>, #<span class="title class_">FFCDB2</span> <span class="number">25</span>%, #<span class="variable constant_">B5838D</span> <span class="number">25</span>%, #<span class="variable constant_">B5838D</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>利用角向渐变 <code>background: conic-gradient()</code>，我们可以轻松实现这样一个饼图：</p>
<p><img src="https://alianck.oss-cn-beijing.aliyuncs.com/process8.webp" alt="图片"></p>
<p>接下来就是镂空中间部分。</p>
<p>传统的想法是，在中间叠加一个圆，然而，这样做的一个极大的弊端在于，如果我们的背景不是纯色而是渐变色，就不适用了，譬如这样：</p>
<p><img src="https://alianck.oss-cn-beijing.aliyuncs.com/process9.webp" alt="图片"></p>
<p>那么如何镂空中间，使得中间部分透明呢？这里我们可以巧妙的通过 <code>mask</code> 属性达到目的，镂空中间：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">.<span class="property">g</span>-progress &#123;</span><br><span class="line">    <span class="attr">background</span>: conic-<span class="title function_">gradient</span>(#<span class="title class_">FFCDB2</span> <span class="number">0</span>, #<span class="title class_">FFCDB2</span> <span class="number">25</span>%, #<span class="variable constant_">B5838D</span> <span class="number">25</span>%, #<span class="variable constant_">B5838D</span>);</span><br><span class="line">  + <span class="attr">mask</span>: radial-<span class="title function_">gradient</span>(transparent, transparent <span class="number">50</span>%, #<span class="number">000</span> <span class="number">50</span>%, #<span class="number">000</span> <span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>这样，我们就轻松的镂空了中间，即便背景不是纯色也无妨。</p>
<p><img src="https://alianck.oss-cn-beijing.aliyuncs.com/process10.webp" alt="图片"></p>
<p>CodePen Demo - 角向渐变实现圆弧形进度条[4]</p>
<p>基于此拓展，还可以实现多色的圆弧型进度条：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">.<span class="property">g</span>-progress &#123;</span><br><span class="line">    <span class="attr">width</span>: 160px;</span><br><span class="line">    <span class="attr">height</span>: 160px;</span><br><span class="line">    border-<span class="attr">radius</span>: <span class="number">50</span>%;</span><br><span class="line">    <span class="attr">mask</span>: radial-<span class="title function_">gradient</span>(transparent, transparent <span class="number">50</span>%, #<span class="number">000</span> <span class="number">51</span>%, #<span class="number">000</span> <span class="number">0</span>);</span><br><span class="line">    <span class="attr">background</span>:</span><br><span class="line">        conic-<span class="title function_">gradient</span>(</span><br><span class="line">            #<span class="title class_">FFCDB2</span> <span class="number">0</span>, #<span class="title class_">FFCDB2</span> <span class="number">25</span>%,</span><br><span class="line">            #<span class="variable constant_">B5838D</span> <span class="number">25</span>%, #<span class="variable constant_">B5838D</span> <span class="number">50</span>%,</span><br><span class="line">            #673ab7 <span class="number">50</span>%, #673ab7 <span class="number">90</span>%,</span><br><span class="line">            #ff5722 <span class="number">90.2</span>%, #ff5722 <span class="number">100</span>%</span><br><span class="line">        );</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>当然，这个可能不像进度条，更类似于饼图？</p>
<p><img src="https://alianck.oss-cn-beijing.aliyuncs.com/process11.webp" alt="图片"></p>
<h3 id="角向渐变实现圆弧进度条的局限性"><a href="#角向渐变实现圆弧进度条的局限性" class="headerlink" title="角向渐变实现圆弧进度条的局限性"></a>角向渐变实现圆弧进度条的局限性</h3><p>当然，这个方法有两个弊端。</p>
<ol>
<li>当然进度百分比不是类似于 0°、90°、180°、270°、360° 这类数字时，使用角向渐变时，不同颜色间的衔接处会有明显的锯齿。</li>
</ol>
<p>看个例子 <code>conic-gradient(#FFCDB2 0, #FFCDB2 27%, #B5838D 27%, #B5838D)</code>：</p>
<p><img src="https://alianck.oss-cn-beijing.aliyuncs.com/process12.webp" alt="图片"></p>
<p>遇到此类问题的解决方案是，在衔接处，适当留出一些渐变空间，我们简单的改造一下上述角向渐变代码：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  - <span class="attr">background</span>: conic-<span class="title function_">gradient</span>(#<span class="title class_">FFCDB2</span> <span class="number">0</span>, #<span class="title class_">FFCDB2</span> <span class="number">27</span>%, #<span class="variable constant_">B5838D</span> <span class="number">27</span>%, #<span class="variable constant_">B5838D</span>)<span class="string">`</span></span><br><span class="line"><span class="string">  + background: conic-gradient(#FFCDB2 0, #FFCDB2 27%, #B5838D 27.2%, #B5838D)`</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>仔细看上面的代码，将从 <code>27%</code> 到 <code>27%</code> 的一个变化，改为了 从 <code>27%</code> 到 <code>27.2%</code>，这多出来的 <code>0.2%</code> 就是为了消除锯齿的，实际改变后的效果：</p>
<p><img src="https://alianck.oss-cn-beijing.aliyuncs.com/process13.webp" alt="图片"></p>
<p>具体使用的使用，可以多调试选取既不会看出模糊，又能尽可能消除锯齿的一个范围幅度。</p>
<ol>
<li>对于开头和结尾需要圆形的圆弧进度条实现起来较为麻烦</li>
</ol>
<p>还有一种情况，实际使用中，要求的是首尾带圆形的圆弧进度条，例如下图所示：</p>
<p><img src="https://alianck.oss-cn-beijing.aliyuncs.com/process14.webp" alt="图片"></p>
<p>当然，这种情况当然进度条颜色是<strong>纯色</strong>也是可以解决的，我们通过在在首尾处叠加两个小圆圈即可实现这种效果。</p>
<p>如果进度条是渐变色的话，这种进度条则需要借助 SVG&#x2F;Canvas 实现了。</p>
<p>上述完整的带圆角的圆弧进度条，你可以戳这里看完整源码 – CodePen Demo – 首尾为圆形的圆弧进度条[5]</p>
<h2 id="球形进度条-wave"><a href="#球形进度条-wave" class="headerlink" title="球形进度条 wave"></a>球形进度条 wave</h2><p>球形进度条也是比较常见的，类似于下面这种：</p>
<p><img src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" alt="图片"></p>
<p>对于球形进度条，其实核心在于使用 CSS 实现中间部分的波浪效果。</p>
<p>这个技巧到今天应该已经被大伙熟知了，就不过多赘述，一图胜千言，可以使用滚动大圆的方式，类似于这样：</p>
<p><img src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" alt="图片"></p>
<p>容器应用 <code>overflow: hidden</code>，就能得到这样的效果：</p>
<p><img src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" alt="图片"></p>
<p>对这个技巧还不理解，可以猛击这篇文章：纯 CSS 实现波浪效果！[6]</p>
<p>应用这个技巧，只需要简单的封装，控制一下球形容器表示进度 0% - 100% 时的波浪的高度即可。我们就能得到从 0% - 100% 的动画效果。</p>
<p>完整的代码大概如下：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;div <span class="keyword">class</span>=<span class="string">&quot;container&quot;</span>&gt;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;wave-change&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;wave&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">.<span class="property">container</span> &#123;</span><br><span class="line">    <span class="attr">width</span>: 200px;</span><br><span class="line">    <span class="attr">height</span>: 200px;</span><br><span class="line">    <span class="attr">border</span>: 5px solid <span class="title function_">rgb</span>(<span class="number">118</span>, <span class="number">218</span>, <span class="number">255</span>);</span><br><span class="line">    border-<span class="attr">radius</span>: <span class="number">50</span>%;</span><br><span class="line">    <span class="attr">overflow</span>: hidden;</span><br><span class="line">&#125;</span><br><span class="line">.<span class="property">wave</span>-change &#123;</span><br><span class="line">        <span class="attr">position</span>: absolute;</span><br><span class="line">        <span class="attr">width</span>: 200px;</span><br><span class="line">        <span class="attr">height</span>: 200px;</span><br><span class="line">        <span class="attr">left</span>: <span class="number">0</span>;</span><br><span class="line">        <span class="attr">top</span>: <span class="number">0</span>;</span><br><span class="line">        <span class="attr">animation</span>: change 12s infinite linear;</span><br><span class="line">      &#125;</span><br><span class="line">      .<span class="property">wave</span>-<span class="attr">change</span>::before,</span><br><span class="line">      .<span class="property">wave</span>-<span class="attr">change</span>::after &#123;</span><br><span class="line">        <span class="attr">content</span>: <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">        <span class="attr">position</span>: absolute;</span><br><span class="line">        <span class="attr">width</span>: 400px;</span><br><span class="line">        <span class="attr">height</span>: 400px;</span><br><span class="line">        <span class="attr">top</span>: <span class="number">0</span>;</span><br><span class="line">        <span class="attr">left</span>: <span class="number">50</span>%;</span><br><span class="line">        background-<span class="attr">color</span>: <span class="title function_">rgba</span>(<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">0.6</span>);</span><br><span class="line">        border-<span class="attr">radius</span>: <span class="number">45</span>% <span class="number">47</span>% <span class="number">43</span>% <span class="number">46</span>%;</span><br><span class="line">        <span class="attr">transform</span>: <span class="title function_">translate</span>(-<span class="number">50</span>%, -<span class="number">70</span>%) <span class="title function_">rotate</span>(<span class="number">0</span>);</span><br><span class="line">        <span class="attr">animation</span>: rotate 7s linear infinite;</span><br><span class="line">        z-<span class="attr">index</span>: <span class="number">1</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      .<span class="property">wave</span>-<span class="attr">change</span>::after &#123;</span><br><span class="line">        border-<span class="attr">radius</span>: <span class="number">47</span>% <span class="number">42</span>% <span class="number">46</span>% <span class="number">44</span>%;</span><br><span class="line">        background-<span class="attr">color</span>: <span class="title function_">rgba</span>(<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">0.8</span>);</span><br><span class="line">        <span class="attr">transform</span>: <span class="title function_">translate</span>(-<span class="number">50</span>%, -<span class="number">70</span>%) <span class="title function_">rotate</span>(<span class="number">0</span>);</span><br><span class="line">        <span class="attr">animation</span>: rotate 9s linear -4s infinite;</span><br><span class="line">        z-<span class="attr">index</span>: <span class="number">2</span>;</span><br><span class="line">      &#125;</span><br><span class="line">.<span class="property">wave</span> &#123;</span><br><span class="line">    <span class="attr">position</span>: relative;</span><br><span class="line">    <span class="attr">width</span>: 200px;</span><br><span class="line">    <span class="attr">height</span>: 200px;</span><br><span class="line">    background-<span class="attr">color</span>: <span class="title function_">rgb</span>(<span class="number">118</span>, <span class="number">218</span>, <span class="number">255</span>);</span><br><span class="line">    border-<span class="attr">radius</span>: <span class="number">50</span>%;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">p &#123;</span><br><span class="line">    <span class="attr">position</span>: absolute;</span><br><span class="line">    <span class="attr">top</span>: <span class="number">50</span>%;</span><br><span class="line">    <span class="attr">left</span>: <span class="number">50</span>%;</span><br><span class="line">    <span class="attr">transform</span>: <span class="title function_">translate</span>(-<span class="number">50</span>%, -<span class="number">50</span>%);</span><br><span class="line">    font-<span class="attr">size</span>: 36px;</span><br><span class="line">    <span class="attr">color</span>: #<span class="number">000</span>;</span><br><span class="line">    z-<span class="attr">index</span>: <span class="number">10</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@keyframes rotate &#123;</span><br><span class="line">   to &#123;</span><br><span class="line">        <span class="attr">transform</span>: <span class="title function_">translate</span>(-<span class="number">50</span>%, -<span class="number">70</span>%) <span class="title function_">rotate</span>(360deg);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">@keyframes change &#123;</span><br><span class="line">    <span class="keyword">from</span> &#123;</span><br><span class="line">        <span class="attr">top</span>: 80px;</span><br><span class="line">    &#125;</span><br><span class="line">    to &#123;</span><br><span class="line">        <span class="attr">top</span>: -120px;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" alt="图片"></p>
<p>完整的代码示例，你可以戳这里：</p>
<ul>
<li>CodePen Demo – Pure Css Wave Progress bar[7]</li>
<li>CodePen Demo – Pure Css Wave Progress bar Animation[8]</li>
</ul>
<h2 id="3D-进度条"><a href="#3D-进度条" class="headerlink" title="3D 进度条"></a>3D 进度条</h2><p>嗯，下面这个 3D 进度条需要对 CSS 3D 有基本的掌握。</p>
<p>你可以先看看这篇文章 – 奇思妙想 CSS 3D 动画 | 仅使用 CSS 能制作出多惊艳的动画？[9]</p>
<p>它主要是借助了一个 3D 立方体。接下来我们来实现一个立方体进度条~</p>
<p>首先，实现一个立方体，结构如下：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;div <span class="keyword">class</span>=<span class="string">&quot;demo-cube perspective&quot;</span>&gt;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">&quot;cube&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">&quot;top&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">&quot;bottom&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">&quot;front&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">&quot;back&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">&quot;right&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">&quot;left&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span></span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" alt="图片"></p>
<p>我们可以把这个立方体想象成一个立体的进度条容器，通过控制 6 面的颜色，我们可以巧妙的得到一种 3D 进度条效果。</p>
<p>当然，其实我们不需要那么多面，4 个面即可，去掉左右，然后利用渐变修改一下立方体各个面的颜色，去掉 border，核心的 CSS 代码如下：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">.<span class="property">demo</span>-cube &#123;</span><br><span class="line">  <span class="attr">position</span>: relative;</span><br><span class="line"></span><br><span class="line">  .<span class="property">cube</span> &#123;</span><br><span class="line">    <span class="attr">position</span>: absolute;</span><br><span class="line">    <span class="attr">top</span>: <span class="number">50</span>%;</span><br><span class="line">    <span class="attr">left</span>: <span class="number">50</span>%;</span><br><span class="line">    <span class="attr">width</span>: 300px;</span><br><span class="line">    <span class="attr">height</span>: 100px;</span><br><span class="line">    transform-<span class="attr">style</span>: preserve-3d;</span><br><span class="line">    <span class="attr">transform</span>: <span class="title function_">translate</span>(-<span class="number">50</span>%, -<span class="number">50</span>%) <span class="title function_">rotateX</span>(-<span class="number">33.</span>5deg);</span><br><span class="line"></span><br><span class="line">    li &#123;</span><br><span class="line">      <span class="attr">position</span>: absolute;</span><br><span class="line">      <span class="attr">width</span>: 300px;</span><br><span class="line">      <span class="attr">height</span>: 100px;</span><br><span class="line">      <span class="attr">background</span>: linear-<span class="title function_">gradient</span>(90deg, <span class="title function_">rgba</span>(<span class="number">156</span>, <span class="number">39</span>, <span class="number">176</span>, <span class="number">.3</span>), <span class="title function_">rgba</span>(<span class="number">255</span>, <span class="number">34</span>, <span class="number">109</span>, <span class="number">.8</span>) <span class="number">70</span>%, <span class="title function_">rgba</span>(<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">.6</span>) <span class="number">70</span>%, <span class="title function_">rgba</span>(<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">.6</span>));</span><br><span class="line">    &#125;</span><br><span class="line">    .<span class="property">top</span> &#123;</span><br><span class="line">      <span class="attr">transform</span>: <span class="title function_">rotateX</span>(90deg) <span class="title function_">translateZ</span>(50px);</span><br><span class="line">    &#125;</span><br><span class="line">    .<span class="property">bottom</span> &#123;</span><br><span class="line">      <span class="attr">transform</span>: <span class="title function_">rotateX</span>(-90deg) <span class="title function_">translateZ</span>(50px);</span><br><span class="line">    &#125;</span><br><span class="line">    .<span class="property">front</span> &#123;</span><br><span class="line">      <span class="attr">transform</span>: <span class="title function_">translateZ</span>(50px);</span><br><span class="line">    &#125;</span><br><span class="line">    .<span class="property">back</span> &#123;</span><br><span class="line">      <span class="attr">transform</span>: <span class="title function_">rotateX</span>(-180deg) <span class="title function_">translateZ</span>(50px);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>我们就可以得到一个非常酷炫的 3D 进度条效果：</p>
<p><img src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" alt="图片"></p>
<h4 id="利用-CSS-Property-给-3D-进度条加上动画"><a href="#利用-CSS-Property-给-3D-进度条加上动画" class="headerlink" title="利用 CSS Property 给 3D 进度条加上动画"></a>利用 CSS Property 给 3D 进度条加上动画</h4><p>当然，进度条嘛，它需要一个填充动画。由于我们使用的是渐变实现的进度条的进度，需要去控制其中的颜色百分比变化。</p>
<p>而正常而言，CSS 是不支持渐变的动画的，不过这也难不倒我们，因为我们可以使用 CSS @Property 。</p>
<p>简单改造一下代码：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">@property --per &#123;</span><br><span class="line">  <span class="attr">syntax</span>: <span class="string">&#x27;&lt;percentage&gt;&#x27;</span>;</span><br><span class="line">  <span class="attr">inherits</span>: <span class="literal">false</span>;</span><br><span class="line">  initial-<span class="attr">value</span>: <span class="number">0</span>%;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.<span class="property">demo</span>-cube .<span class="property">cube</span> &#123;</span><br><span class="line">  .<span class="property">top</span>,</span><br><span class="line">  .<span class="property">front</span>,</span><br><span class="line">  .<span class="property">bottom</span>,</span><br><span class="line">  .<span class="property">back</span> &#123;</span><br><span class="line">    <span class="attr">background</span>: linear-<span class="title function_">gradient</span>(90deg, <span class="title function_">rgba</span>(<span class="number">255</span>, <span class="number">217</span>, <span class="number">34</span>, <span class="number">.6</span>), <span class="title function_">rgba</span>(<span class="number">255</span>, <span class="number">34</span>, <span class="number">109</span>, <span class="number">.8</span>) <span class="title function_">var</span>(--per), <span class="title function_">rgba</span>(<span class="number">255</span>, <span class="number">34</span>, <span class="number">109</span>, <span class="number">.1</span>) <span class="title function_">var</span>(--per), <span class="title function_">rgba</span>(<span class="number">255</span>, <span class="number">34</span>, <span class="number">109</span>, <span class="number">.1</span>));</span><br><span class="line">    <span class="attr">animation</span>: perChange 6s infinite;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@keyframes perChange &#123;</span><br><span class="line">  <span class="number">0</span>% &#123;</span><br><span class="line">    --<span class="attr">per</span>: <span class="number">0</span>%;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="number">90</span>%,</span><br><span class="line">  to &#123;</span><br><span class="line">    --<span class="attr">per</span>: <span class="number">80</span>%;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>这样，我们就实现了一个会动的 3D 进度条，只需要控制 <code>--per</code> CSS 自定义属性即可，效果如下：</p>
<p><img src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" alt="图片"></p>
<blockquote>
<p>对于 CSS @Property 不算很了解的，可以看看作者的这篇文章 – CSS @property，让不可能变可能[10]，它的出现，让 CSS 极大的提升了制作各种动画的能力。</p>
</blockquote>
<p>上述的完整代码，你可以猛击这里：CSS 灵感 – 3D 立方体进度条[11]</p>
<h2 id="扩展延伸"><a href="#扩展延伸" class="headerlink" title="扩展延伸"></a>扩展延伸</h2><p>本文从简到繁介绍了使用 HTML&#x2F;CSS 逐步构建进度条的方式，并且逐渐加深了难度。</p>
<p>当然，随着难度的提升，得到的是更为酷炫的进度条。</p>
<p>基于上述的方法介绍，基本可以演化出各种我们需要的进度条。譬如基于上述的方法，可以实现一个简单的电池充电动画：</p>
<p><img src="https://alianck.oss-cn-beijing.aliyuncs.com/process15.gif" alt="图片"></p>
<p>当然，CSS 千变万化，进度条的种类肯定也不仅仅局限于上述的几类。譬如我们可以利用滤镜实现的仿华为手机的充电动画，也是一种进度条的呈现方式，也是能够使用纯 CSS 实现的：</p>
<p><img src="https://alianck.oss-cn-beijing.aliyuncs.com/process16.gif" alt="图片"></p>
<blockquote>
<p>上述效果的完整实现可以戳 – 巧用 CSS 实现酷炫的充电动画[12]</p>
</blockquote>
<p>又或者，我们可以在进度条的纹理上做文章：</p>
<p><img src="https://alianck.oss-cn-beijing.aliyuncs.com/process17.webp" alt="图片"></p>
<p>效果来源于 CodePen – Bars By Lucagaz[13]。</p>
<p>总而言之，CSS 美好世界值得我们去探索。</p>
<h2 id="最后"><a href="#最后" class="headerlink" title="最后"></a>最后</h2><p>好了，本文到此结束，希望本文对你有所帮助 :)</p>
]]></content>
      <categories>
        <category>前端</category>
      </categories>
      <tags>
        <tag>CSS</tag>
      </tags>
  </entry>
  <entry>
    <title>大厂JS必考手写题</title>
    <url>/test/post/%E5%A4%A7%E5%8E%82JS%E5%BF%85%E8%80%83%E6%89%8B%E5%86%99%E9%A2%98/</url>
    <content><![CDATA[<h2 id="篇一"><a href="#篇一" class="headerlink" title="篇一"></a>篇一</h2><p>🎄 前言</p>
<p>本文主要总结了 2021 年前端提前批和秋招所考察的手写题，题目来源于牛客网前端面经区，统计时间自 3 月初至 10 月底，面经来源于阿里、腾讯、百度、字节、美团、京东、快手、拼多多等 15 家公司，并做了简单的频次划分。</p>
<ul>
<li>⭐⭐⭐⭐⭐: 在 15 家公司面试中出现 10+</li>
<li>⭐⭐⭐⭐：在 15 家公式面试中出现 5-10</li>
<li>⭐⭐⭐：在 15 家公司面试中出现 3-5</li>
<li>无星：出现 1-2</li>
</ul>
<p>题目解析一部分来源于小包的编写，另一部分如果我感觉题目扩展开来更好的话，我就选取部分大佬的博客链接。</p>
<h2 id="🌟-promise"><a href="#🌟-promise" class="headerlink" title="🌟 promise"></a>🌟 promise</h2><h3 id="实现-promise"><a href="#实现-promise" class="headerlink" title="实现 promise"></a>实现 promise</h3><p>考察频率: (⭐⭐⭐⭐⭐)</p>
<p>参考代码[1]</p>
<h3 id="实现-promise-all"><a href="#实现-promise-all" class="headerlink" title="实现 promise.all"></a>实现 promise.all</h3><p>考察频率: (⭐⭐⭐⭐⭐)</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">PromiseAll</span>(<span class="params">promises</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="title class_">Array</span>.<span class="title function_">isArray</span>(promises)) &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">TypeError</span>(<span class="string">&quot;promises must be an array&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">let</span> result = [];</span><br><span class="line">    <span class="keyword">let</span> count = <span class="number">0</span>;</span><br><span class="line">    promises.<span class="title function_">forEach</span>(<span class="function">(<span class="params">promise, index</span>) =&gt;</span> &#123;</span><br><span class="line">      promise.<span class="title function_">then</span>(</span><br><span class="line">        <span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">          result[index] = res;</span><br><span class="line">          count++;</span><br><span class="line">          count === promises.<span class="property">length</span> &amp;&amp; <span class="title function_">resolve</span>(result);</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">          <span class="title function_">reject</span>(err);</span><br><span class="line">        &#125;</span><br><span class="line">      );</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">复制代码;</span><br></pre></td></tr></table></figure>

<h3 id="实现-promise-finally"><a href="#实现-promise-finally" class="headerlink" title="实现 promise.finally"></a>实现 promise.finally</h3><p>考察频率: (⭐⭐⭐⭐⭐)</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="title class_">Promise</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">finally</span> = <span class="keyword">function</span> (<span class="params">cb</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">then</span>(</span><br><span class="line">    <span class="keyword">function</span> (<span class="params">value</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">resolve</span>(<span class="title function_">cb</span>()).<span class="title function_">then</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> value;</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="keyword">function</span> (<span class="params">err</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">resolve</span>(<span class="title function_">cb</span>()).<span class="title function_">then</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> err;</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">复制代码;</span><br></pre></td></tr></table></figure>

<h3 id="实现-promise-allSettled"><a href="#实现-promise-allSettled" class="headerlink" title="实现 promise.allSettled"></a>实现 promise.allSettled</h3><p>考察频率: (⭐⭐⭐⭐)</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">allSettled</span>(<span class="params">promises</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (promises.<span class="property">length</span> === <span class="number">0</span>) <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">resolve</span>([]);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> _promises = promises.<span class="title function_">map</span>(<span class="function">(<span class="params">item</span>) =&gt;</span></span><br><span class="line">    item <span class="keyword">instanceof</span> <span class="title class_">Promise</span> ? item : <span class="title class_">Promise</span>.<span class="title function_">resolve</span>(item)</span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> result = [];</span><br><span class="line">    <span class="keyword">let</span> unSettledPromiseCount = _promises.<span class="property">length</span>;</span><br><span class="line"></span><br><span class="line">    _promises.<span class="title function_">forEach</span>(<span class="function">(<span class="params">promise, index</span>) =&gt;</span> &#123;</span><br><span class="line">      promise.<span class="title function_">then</span>(</span><br><span class="line">        <span class="function">(<span class="params">value</span>) =&gt;</span> &#123;</span><br><span class="line">          result[index] = &#123;</span><br><span class="line">            <span class="attr">status</span>: <span class="string">&quot;fulfilled&quot;</span>,</span><br><span class="line">            value,</span><br><span class="line">          &#125;;</span><br><span class="line"></span><br><span class="line">          unSettledPromiseCount -= <span class="number">1</span>;</span><br><span class="line">          <span class="comment">// resolve after all are settled</span></span><br><span class="line">          <span class="keyword">if</span> (unSettledPromiseCount === <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="title function_">resolve</span>(result);</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="function">(<span class="params">reason</span>) =&gt;</span> &#123;</span><br><span class="line">          result[index] = &#123;</span><br><span class="line">            <span class="attr">status</span>: <span class="string">&quot;rejected&quot;</span>,</span><br><span class="line">            reason,</span><br><span class="line">          &#125;;</span><br><span class="line"></span><br><span class="line">          unSettledPromiseCount -= <span class="number">1</span>;</span><br><span class="line">          <span class="comment">// resolve after all are settled</span></span><br><span class="line">          <span class="keyword">if</span> (unSettledPromiseCount === <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="title function_">resolve</span>(result);</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      );</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line">复制代码;</span><br></pre></td></tr></table></figure>

<h3 id="实现-promise-race"><a href="#实现-promise-race" class="headerlink" title="实现 promise.race"></a>实现 promise.race</h3><p>考察频率: (⭐⭐⭐)</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="title class_">Promise</span>.<span class="property">race</span> = <span class="keyword">function</span> (<span class="params">promiseArr</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    promiseArr.<span class="title function_">forEach</span>(<span class="function">(<span class="params">p</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="title class_">Promise</span>.<span class="title function_">resolve</span>(p).<span class="title function_">then</span>(</span><br><span class="line">        <span class="function">(<span class="params">val</span>) =&gt;</span> &#123;</span><br><span class="line">          <span class="title function_">resolve</span>(val);</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">          <span class="title function_">rejecte</span>(err);</span><br><span class="line">        &#125;</span><br><span class="line">      );</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br><span class="line">复制代码;</span><br></pre></td></tr></table></figure>

<h3 id="来说一下如何串行执行多个-Promise"><a href="#来说一下如何串行执行多个-Promise" class="headerlink" title="来说一下如何串行执行多个 Promise"></a>来说一下如何串行执行多个 Promise</h3><p>参考代码[2]</p>
<h3 id="promise-any"><a href="#promise-any" class="headerlink" title="promise.any"></a>promise.any</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="title class_">Promise</span>.<span class="property">any</span> = <span class="keyword">function</span> (<span class="params">promiseArr</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> index = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (promiseArr.<span class="property">length</span> === <span class="number">0</span>) <span class="keyword">return</span>;</span><br><span class="line">    promiseArr.<span class="title function_">forEach</span>(<span class="function">(<span class="params">p, i</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="title class_">Promise</span>.<span class="title function_">resolve</span>(p).<span class="title function_">then</span>(</span><br><span class="line">        <span class="function">(<span class="params">val</span>) =&gt;</span> &#123;</span><br><span class="line">          <span class="title function_">resolve</span>(val);</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">          index++;</span><br><span class="line">          <span class="keyword">if</span> (index === promiseArr.<span class="property">length</span>) &#123;</span><br><span class="line">            <span class="title function_">reject</span>(<span class="keyword">new</span> <span class="title class_">AggregateError</span>(<span class="string">&quot;All promises were rejected&quot;</span>));</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      );</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">复制代码;</span><br></pre></td></tr></table></figure>

<h3 id="resolve"><a href="#resolve" class="headerlink" title="resolve"></a>resolve</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="title class_">Promise</span>.<span class="property">resolve</span> = <span class="keyword">function</span> (<span class="params">value</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (value <span class="keyword">instanceof</span> <span class="title class_">Promise</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> value;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve</span>) =&gt;</span> <span class="title function_">resolve</span>(value));</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">复制代码;</span><br></pre></td></tr></table></figure>

<h3 id="reject"><a href="#reject" class="headerlink" title="reject"></a>reject</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="title class_">Promise</span>.<span class="property">reject</span> = <span class="keyword">function</span> (<span class="params">reason</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> <span class="title function_">reject</span>(reason));</span><br><span class="line">&#125;;</span><br><span class="line">复制代码;</span><br></pre></td></tr></table></figure>

<h2 id="🐳-Array-篇"><a href="#🐳-Array-篇" class="headerlink" title="🐳 Array 篇"></a>🐳 Array 篇</h2><h3 id="数组去重"><a href="#数组去重" class="headerlink" title="数组去重"></a>数组去重</h3><p>考察频率: (⭐⭐⭐⭐⭐)</p>
<h4 id="使用双重-for-和-splice"><a href="#使用双重-for-和-splice" class="headerlink" title="使用双重 for 和 splice"></a>使用双重 <code>for</code> 和 <code>splice</code></h4><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">unique</span>(<span class="params">arr</span>) &#123;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; arr.<span class="property">length</span>; i++) &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> j = i + <span class="number">1</span>; j &lt; arr.<span class="property">length</span>; j++) &#123;</span><br><span class="line">      <span class="keyword">if</span> (arr[i] == arr[j]) &#123;</span><br><span class="line">        <span class="comment">//第一个等同于第二个，splice方法删除第二个</span></span><br><span class="line">        arr.<span class="title function_">splice</span>(j, <span class="number">1</span>);</span><br><span class="line">        <span class="comment">// 删除后注意回调j</span></span><br><span class="line">        j--;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> arr;</span><br><span class="line">&#125;</span><br><span class="line">复制代码;</span><br></pre></td></tr></table></figure>

<h4 id="使用-indexOf-或-includes-加新数组"><a href="#使用-indexOf-或-includes-加新数组" class="headerlink" title="使用 indexOf 或 includes 加新数组"></a>使用 <code>indexOf</code> 或 <code>includes</code> 加新数组</h4><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">//使用indexof</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">unique</span>(<span class="params">arr</span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> uniqueArr = []; <span class="comment">// 新数组</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; arr.<span class="property">length</span>; i++) &#123;</span><br><span class="line">    <span class="keyword">if</span> (uniqueArr.<span class="title function_">indexOf</span>(arr[i]) === -<span class="number">1</span>) &#123;</span><br><span class="line">      <span class="comment">//indexof返回-1表示在新数组中不存在该元素</span></span><br><span class="line">      uniqueArr.<span class="title function_">push</span>(arr[i]); <span class="comment">//是新数组里没有的元素就push入</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> uniqueArr;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 使用includes</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">unique</span>(<span class="params">arr</span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> uniqueArr = [];</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; arr.<span class="property">length</span>; i++) &#123;</span><br><span class="line">    <span class="comment">//includes 检测数组是否有某个值</span></span><br><span class="line">    <span class="keyword">if</span> (!uniqueArr.<span class="title function_">includes</span>(arr[i])) &#123;</span><br><span class="line">      uniqueArr.<span class="title function_">push</span>(arr[i]); <span class="comment">//</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> uniqueArr;</span><br><span class="line">&#125;</span><br><span class="line">复制代码;</span><br></pre></td></tr></table></figure>

<h4 id="sort-排序后，使用快慢指针的思想"><a href="#sort-排序后，使用快慢指针的思想" class="headerlink" title="sort 排序后，使用快慢指针的思想"></a><code>sort</code> 排序后，使用快慢指针的思想</h4><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">unique</span>(<span class="params">arr</span>) &#123;</span><br><span class="line">  arr.<span class="title function_">sort</span>(<span class="function">(<span class="params">a, b</span>) =&gt;</span> a - b);</span><br><span class="line">  <span class="keyword">var</span> slow = <span class="number">1</span>,</span><br><span class="line">    fast = <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">while</span> (fast &lt; arr.<span class="property">length</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (arr[fast] != arr[fast - <span class="number">1</span>]) &#123;</span><br><span class="line">      arr[slow++] = arr[fast];</span><br><span class="line">    &#125;</span><br><span class="line">    ++fast;</span><br><span class="line">  &#125;</span><br><span class="line">  arr.<span class="property">length</span> = slow;</span><br><span class="line">  <span class="keyword">return</span> arr;</span><br><span class="line">&#125;</span><br><span class="line">复制代码;</span><br></pre></td></tr></table></figure>

<p><code>sort</code> 方法用于从小到大排序(返回一个新数组)，其参数中不带以上回调函数就会在两位数及以上时出现排序错误(如果省略，元素按照转换为的字符串的各个字符的 <code>Unicode</code> 位点进行排序。两位数会变为长度为二的字符串来计算)。</p>
<h4 id="ES6-提供的-Set-去重"><a href="#ES6-提供的-Set-去重" class="headerlink" title="ES6 提供的 Set 去重"></a><code>ES6</code> 提供的 <code>Set</code> 去重</h4><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">unique</span>(<span class="params">arr</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> result = <span class="keyword">new</span> <span class="title class_">Set</span>(arr);</span><br><span class="line">  <span class="keyword">return</span> [...result];</span><br><span class="line">  <span class="comment">//使用扩展运算符将Set数据结构转为数组</span></span><br><span class="line">&#125;</span><br><span class="line">复制代码;</span><br></pre></td></tr></table></figure>

<p><code>Set</code> 中的元素只会出现一次，即 <code>Set</code> 中的元素是唯一的。</p>
<h4 id="使用哈希表存储元素是否出现-ES6-提供的-map"><a href="#使用哈希表存储元素是否出现-ES6-提供的-map" class="headerlink" title="使用哈希表存储元素是否出现(ES6 提供的 map)"></a>使用哈希表存储元素是否出现(<code>ES6</code> 提供的 <code>map</code>)</h4><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">unique</span>(<span class="params">arr</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> map = <span class="keyword">new</span> <span class="title class_">Map</span>();</span><br><span class="line">  <span class="keyword">let</span> uniqueArr = <span class="keyword">new</span> <span class="title class_">Array</span>(); <span class="comment">// 数组用于返回结果</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; arr.<span class="property">length</span>; i++) &#123;</span><br><span class="line">    <span class="keyword">if</span> (map.<span class="title function_">has</span>(arr[i])) &#123;</span><br><span class="line">      <span class="comment">// 如果有该key值</span></span><br><span class="line">      map.<span class="title function_">set</span>(arr[i], <span class="literal">true</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      map.<span class="title function_">set</span>(arr[i], <span class="literal">false</span>); <span class="comment">// 如果没有该key值</span></span><br><span class="line">      uniqueArr.<span class="title function_">push</span>(arr[i]);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> uniqueArr;</span><br><span class="line">&#125;</span><br><span class="line">复制代码;</span><br></pre></td></tr></table></figure>

<p><code>map</code> 对象保存键值对，与对象类似。但 <code>map</code> 的键可以是任意类型，对象的键只能是字符串类型。</p>
<p>如果数组中只有数字也可以使用普通对象作为哈希表。</p>
<h4 id="filter-配合-indexOf"><a href="#filter-配合-indexOf" class="headerlink" title="filter 配合 indexOf"></a><code>filter</code> 配合 <code>indexOf</code></h4><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">unique</span>(<span class="params">arr</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> arr.<span class="title function_">filter</span>(<span class="keyword">function</span> (<span class="params">item, index, arr</span>) &#123;</span><br><span class="line">    <span class="comment">//当前元素，在原始数组中的第一个索引==当前索引值，否则返回当前元素</span></span><br><span class="line">    <span class="comment">//不是那么就证明是重复项，就舍弃</span></span><br><span class="line">    <span class="keyword">return</span> arr.<span class="title function_">indexOf</span>(item) === index;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line">复制代码;</span><br></pre></td></tr></table></figure>

<p>这里有可能存在疑问，我来举个例子：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> arr = [<span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">3</span>];</span><br><span class="line">arr.<span class="title function_">indexOf</span>(arr[<span class="number">0</span>]) === <span class="number">0</span>; <span class="comment">// 1 的第一次出现</span></span><br><span class="line">arr.<span class="title function_">indexOf</span>(arr[<span class="number">1</span>]) !== <span class="number">1</span>; <span class="comment">// 说明前面曾经出现过1</span></span><br><span class="line">复制代码;</span><br></pre></td></tr></table></figure>

<h4 id="reduce-配合-includes"><a href="#reduce-配合-includes" class="headerlink" title="reduce 配合 includes"></a><code>reduce</code> 配合 <code>includes</code></h4><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">unique</span>(<span class="params">arr</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> uniqueArr = arr.<span class="title function_">reduce</span>(<span class="function">(<span class="params">acc, cur</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (!acc.<span class="title function_">includes</span>(cur)) &#123;</span><br><span class="line">      acc.<span class="title function_">push</span>(cur);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> acc;</span><br><span class="line">  &#125;, []); <span class="comment">// []作为回调函数的第一个参数的初始值</span></span><br><span class="line">  <span class="keyword">return</span> uniqueArr;</span><br><span class="line">&#125;</span><br><span class="line">复制代码;</span><br></pre></td></tr></table></figure>

<h3 id="数组扁平化"><a href="#数组扁平化" class="headerlink" title="数组扁平化"></a>数组扁平化</h3><p>考察频率: (⭐⭐⭐)</p>
<p>参考代码[3]</p>
<h3 id="forEach"><a href="#forEach" class="headerlink" title="forEach"></a>forEach</h3><p>考察频率: (⭐⭐⭐)</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="title class_">Array</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">myForEach</span> = <span class="keyword">function</span> (<span class="params">callbackFn</span>) &#123;</span><br><span class="line">  <span class="comment">// 判断this是否合法</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="variable language_">this</span> === <span class="literal">null</span> || <span class="variable language_">this</span> === <span class="literal">undefined</span>) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">TypeError</span>(<span class="string">&quot;Cannot read property &#x27;myForEach&#x27; of null&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 判断callbackFn是否合法</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">toString</span>.<span class="title function_">call</span>(callbackFn) !== <span class="string">&quot;[object Function]&quot;</span>) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">TypeError</span>(callbackFn + <span class="string">&quot; is not a function&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 取到执行方法的数组对象和传入的this对象</span></span><br><span class="line">  <span class="keyword">var</span> _arr = <span class="variable language_">this</span>,</span><br><span class="line">    thisArg = <span class="variable language_">arguments</span>[<span class="number">1</span>] || <span class="variable language_">window</span>;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; _arr.<span class="property">length</span>; i++) &#123;</span><br><span class="line">    <span class="comment">// 执行回调函数</span></span><br><span class="line">    callbackFn.<span class="title function_">call</span>(thisArg, _arr[i], i, _arr);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">复制代码;</span><br></pre></td></tr></table></figure>

<h3 id="reduce"><a href="#reduce" class="headerlink" title="reduce"></a>reduce</h3><p>考察频率: (⭐⭐⭐)</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="title class_">Array</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">myReduce</span> = <span class="keyword">function</span> (<span class="params">callbackFn</span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> _arr = <span class="variable language_">this</span>,</span><br><span class="line">    accumulator = <span class="variable language_">arguments</span>[<span class="number">1</span>];</span><br><span class="line">  <span class="keyword">var</span> i = <span class="number">0</span>;</span><br><span class="line">  <span class="comment">// 判断是否传入初始值</span></span><br><span class="line">  <span class="keyword">if</span> (accumulator === <span class="literal">undefined</span>) &#123;</span><br><span class="line">    <span class="comment">// 没有初始值的空数组调用reduce会报错</span></span><br><span class="line">    <span class="keyword">if</span> (_arr.<span class="property">length</span> === <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&quot;initVal and Array.length&gt;0 need one&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 初始值赋值为数组第一个元素</span></span><br><span class="line">    accumulator = _arr[i];</span><br><span class="line">    i++;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">for</span> (; i &lt; _arr.<span class="property">length</span>; i++) &#123;</span><br><span class="line">    <span class="comment">// 计算结果赋值给初始值</span></span><br><span class="line">    accumulator = <span class="title function_">callbackFn</span>(accumulator, _arr[i], i, _arr);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> accumulator;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">复制代码;</span><br></pre></td></tr></table></figure>

<h3 id="map"><a href="#map" class="headerlink" title="map"></a>map</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="title class_">Array</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">myMap</span> = <span class="keyword">function</span> (<span class="params">callbackFn</span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> _arr = <span class="variable language_">this</span>,</span><br><span class="line">    thisArg = <span class="variable language_">arguments</span>[<span class="number">1</span>] || <span class="variable language_">window</span>,</span><br><span class="line">    res = [];</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; _arr.<span class="property">length</span>; i++) &#123;</span><br><span class="line">    <span class="comment">// 存储运算结果</span></span><br><span class="line">    res.<span class="title function_">push</span>(callbackFn.<span class="title function_">call</span>(thisArg, _arr[i], i, _arr));</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> res;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">复制代码;</span><br></pre></td></tr></table></figure>

<h3 id="filter"><a href="#filter" class="headerlink" title="filter"></a>filter</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="title class_">Array</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">myFilter</span> = <span class="keyword">function</span> (<span class="params">callbackFn</span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> _arr = <span class="variable language_">this</span>,</span><br><span class="line">    thisArg = <span class="variable language_">arguments</span>[<span class="number">1</span>] || <span class="variable language_">window</span>,</span><br><span class="line">    res = [];</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; _arr.<span class="property">length</span>; i++) &#123;</span><br><span class="line">    <span class="comment">// 回调函数执行为true</span></span><br><span class="line">    <span class="keyword">if</span> (callbackFn.<span class="title function_">call</span>(thisArg, _arr[i], i, _arr)) &#123;</span><br><span class="line">      res.<span class="title function_">push</span>(_arr[i]);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> res;</span><br><span class="line">&#125;;</span><br><span class="line">复制代码;</span><br></pre></td></tr></table></figure>

<h3 id="every"><a href="#every" class="headerlink" title="every"></a>every</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="title class_">Array</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">myEvery</span> = <span class="keyword">function</span> (<span class="params">callbackFn</span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> _arr = <span class="variable language_">this</span>,</span><br><span class="line">    thisArg = <span class="variable language_">arguments</span>[<span class="number">1</span>] || <span class="variable language_">window</span>;</span><br><span class="line">  <span class="comment">// 开始标识值为true</span></span><br><span class="line">  <span class="comment">// 遇到回调返回false，直接返回false</span></span><br><span class="line">  <span class="comment">// 如果循环执行完毕，意味着所有回调返回值为true，最终结果为true</span></span><br><span class="line">  <span class="keyword">var</span> flag = <span class="literal">true</span>;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; _arr.<span class="property">length</span>; i++) &#123;</span><br><span class="line">    <span class="comment">// 回调函数执行为false，函数中断</span></span><br><span class="line">    <span class="keyword">if</span> (!callbackFn.<span class="title function_">call</span>(thisArg, _arr[i], i, _arr)) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> flag;</span><br><span class="line">&#125;;</span><br><span class="line">复制代码;</span><br></pre></td></tr></table></figure>

<h3 id="some"><a href="#some" class="headerlink" title="some"></a>some</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="title class_">Array</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">mySome</span> = <span class="keyword">function</span> (<span class="params">callbackFn</span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> _arr = <span class="variable language_">this</span>,</span><br><span class="line">    thisArg = <span class="variable language_">arguments</span>[<span class="number">1</span>] || <span class="variable language_">window</span>;</span><br><span class="line">  <span class="comment">// 开始标识值为false</span></span><br><span class="line">  <span class="comment">// 遇到回调返回true，直接返回true</span></span><br><span class="line">  <span class="comment">// 如果循环执行完毕，意味着所有回调返回值为false，最终结果为false</span></span><br><span class="line">  <span class="keyword">var</span> flag = <span class="literal">false</span>;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; _arr.<span class="property">length</span>; i++) &#123;</span><br><span class="line">    <span class="comment">// 回调函数执行为false，函数中断</span></span><br><span class="line">    <span class="keyword">if</span> (callbackFn.<span class="title function_">call</span>(thisArg, _arr[i], i, _arr)) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> flag;</span><br><span class="line">&#125;;</span><br><span class="line">复制代码;</span><br></pre></td></tr></table></figure>

<h3 id="find-findIndex"><a href="#find-findIndex" class="headerlink" title="find&#x2F;findIndex"></a>find&#x2F;findIndex</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="title class_">Array</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">myFind</span> = <span class="keyword">function</span> (<span class="params">callbackFn</span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> _arr = <span class="variable language_">this</span>,</span><br><span class="line">    thisArg = <span class="variable language_">arguments</span>[<span class="number">1</span>] || <span class="variable language_">window</span>;</span><br><span class="line">  <span class="comment">// 遇到回调返回true，直接返回该数组元素</span></span><br><span class="line">  <span class="comment">// 如果循环执行完毕，意味着所有回调返回值为false，最终结果为undefined</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; _arr.<span class="property">length</span>; i++) &#123;</span><br><span class="line">    <span class="comment">// 回调函数执行为false，函数中断</span></span><br><span class="line">    <span class="keyword">if</span> (callbackFn.<span class="title function_">call</span>(thisArg, _arr[i], i, _arr)) &#123;</span><br><span class="line">      <span class="keyword">return</span> _arr[i];</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">undefined</span>;</span><br><span class="line">&#125;;</span><br><span class="line">复制代码;</span><br></pre></td></tr></table></figure>

<h3 id="indexOf"><a href="#indexOf" class="headerlink" title="indexOf"></a>indexOf</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">indexOf</span>(<span class="params">findVal, beginIndex = <span class="number">0</span></span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">length</span> &lt; <span class="number">1</span> || beginIndex &gt; findVal.<span class="property">length</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (!findVal) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  beginIndex = beginIndex &lt;= <span class="number">0</span> ? <span class="number">0</span> : beginIndex;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = beginIndex; i &lt; <span class="variable language_">this</span>.<span class="property">length</span>; i++) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>[i] == findVal) <span class="keyword">return</span> i;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">复制代码;</span><br></pre></td></tr></table></figure>

<h3 id="实现-sort"><a href="#实现-sort" class="headerlink" title="实现 sort"></a>实现 sort</h3><p>参考代码[4]</p>
<h2 id="🌊-防抖节流"><a href="#🌊-防抖节流" class="headerlink" title="🌊 防抖节流"></a>🌊 防抖节流</h2><h3 id="实现防抖函数-debounce"><a href="#实现防抖函数-debounce" class="headerlink" title="实现防抖函数 debounce"></a>实现防抖函数 debounce</h3><p>考察频率: (⭐⭐⭐⭐⭐)</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">debounce</span>(<span class="params">func, wait, immediate</span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> timeout, result;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> debounced = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> context = <span class="variable language_">this</span>;</span><br><span class="line">    <span class="keyword">var</span> args = <span class="variable language_">arguments</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (timeout) <span class="built_in">clearTimeout</span>(timeout);</span><br><span class="line">    <span class="keyword">if</span> (immediate) &#123;</span><br><span class="line">      <span class="comment">// 如果已经执行过，不再执行</span></span><br><span class="line">      <span class="keyword">var</span> callNow = !timeout;</span><br><span class="line">      timeout = <span class="built_in">setTimeout</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        timeout = <span class="literal">null</span>;</span><br><span class="line">      &#125;, wait);</span><br><span class="line">      <span class="keyword">if</span> (callNow) result = func.<span class="title function_">apply</span>(context, args);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      timeout = <span class="built_in">setTimeout</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        result = func.<span class="title function_">apply</span>(context, args);</span><br><span class="line">      &#125;, wait);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  debounced.<span class="property">cancel</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="built_in">clearTimeout</span>(timeout);</span><br><span class="line">    timeout = <span class="literal">null</span>;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> debounced;</span><br><span class="line">&#125;</span><br><span class="line">复制代码;</span><br></pre></td></tr></table></figure>

<h3 id="实现节流函数-throttle"><a href="#实现节流函数-throttle" class="headerlink" title="实现节流函数 throttle"></a>实现节流函数 throttle</h3><p>考察频率: (⭐⭐⭐⭐⭐)</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 第四版</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">throttle</span>(<span class="params">func, wait, options</span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> timeout, context, args, result;</span><br><span class="line">  <span class="keyword">var</span> previous = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">if</span> (!options) options = &#123;&#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> later = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    previous = options.<span class="property">leading</span> === <span class="literal">false</span> ? <span class="number">0</span> : <span class="keyword">new</span> <span class="title class_">Date</span>().<span class="title function_">getTime</span>();</span><br><span class="line">    timeout = <span class="literal">null</span>;</span><br><span class="line">    func.<span class="title function_">apply</span>(context, args);</span><br><span class="line">    <span class="keyword">if</span> (!timeout) context = args = <span class="literal">null</span>;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> throttled = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> now = <span class="keyword">new</span> <span class="title class_">Date</span>().<span class="title function_">getTime</span>();</span><br><span class="line">    <span class="keyword">if</span> (!previous &amp;&amp; options.<span class="property">leading</span> === <span class="literal">false</span>) previous = now;</span><br><span class="line">    <span class="keyword">var</span> remaining = wait - (now - previous);</span><br><span class="line">    context = <span class="variable language_">this</span>;</span><br><span class="line">    args = <span class="variable language_">arguments</span>;</span><br><span class="line">    <span class="keyword">if</span> (remaining &lt;= <span class="number">0</span> || remaining &gt; wait) &#123;</span><br><span class="line">      <span class="keyword">if</span> (timeout) &#123;</span><br><span class="line">        <span class="built_in">clearTimeout</span>(timeout);</span><br><span class="line">        timeout = <span class="literal">null</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      previous = now;</span><br><span class="line">      func.<span class="title function_">apply</span>(context, args);</span><br><span class="line">      <span class="keyword">if</span> (!timeout) context = args = <span class="literal">null</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (!timeout &amp;&amp; options.<span class="property">trailing</span> !== <span class="literal">false</span>) &#123;</span><br><span class="line">      timeout = <span class="built_in">setTimeout</span>(later, remaining);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">return</span> throttled;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">复制代码;</span><br></pre></td></tr></table></figure>

<h2 id="⛲-Object-篇"><a href="#⛲-Object-篇" class="headerlink" title="⛲ Object 篇"></a>⛲ Object 篇</h2><h3 id="能不能写一个完整的深拷贝"><a href="#能不能写一个完整的深拷贝" class="headerlink" title="能不能写一个完整的深拷贝"></a>能不能写一个完整的深拷贝</h3><p>考察频率: (⭐⭐⭐⭐⭐)</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">getType</span> = (<span class="params">obj</span>) =&gt; <span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">toString</span>.<span class="title function_">call</span>(obj);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">isObject</span> = (<span class="params">target</span>) =&gt;</span><br><span class="line">  (<span class="keyword">typeof</span> target === <span class="string">&quot;object&quot;</span> || <span class="keyword">typeof</span> target === <span class="string">&quot;function&quot;</span>) &amp;&amp;</span><br><span class="line">  target !== <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> canTraverse = &#123;</span><br><span class="line">  <span class="string">&quot;[object Map]&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="string">&quot;[object Set]&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="string">&quot;[object Array]&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="string">&quot;[object Object]&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="string">&quot;[object Arguments]&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">const</span> mapTag = <span class="string">&quot;[object Map]&quot;</span>;</span><br><span class="line"><span class="keyword">const</span> setTag = <span class="string">&quot;[object Set]&quot;</span>;</span><br><span class="line"><span class="keyword">const</span> boolTag = <span class="string">&quot;[object Boolean]&quot;</span>;</span><br><span class="line"><span class="keyword">const</span> numberTag = <span class="string">&quot;[object Number]&quot;</span>;</span><br><span class="line"><span class="keyword">const</span> stringTag = <span class="string">&quot;[object String]&quot;</span>;</span><br><span class="line"><span class="keyword">const</span> symbolTag = <span class="string">&quot;[object Symbol]&quot;</span>;</span><br><span class="line"><span class="keyword">const</span> dateTag = <span class="string">&quot;[object Date]&quot;</span>;</span><br><span class="line"><span class="keyword">const</span> errorTag = <span class="string">&quot;[object Error]&quot;</span>;</span><br><span class="line"><span class="keyword">const</span> regexpTag = <span class="string">&quot;[object RegExp]&quot;</span>;</span><br><span class="line"><span class="keyword">const</span> funcTag = <span class="string">&quot;[object Function]&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">handleRegExp</span> = (<span class="params">target</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; source, flags &#125; = target;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> target.<span class="title function_">constructor</span>(<span class="params">source, flags</span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">handleFunc</span> = (<span class="params">func</span>) =&gt; &#123;</span><br><span class="line">  <span class="comment">// 箭头函数直接返回自身</span></span><br><span class="line">  <span class="keyword">if</span> (!func.<span class="property"><span class="keyword">prototype</span></span>) <span class="keyword">return</span> func;</span><br><span class="line">  <span class="keyword">const</span> bodyReg = <span class="regexp">/(?&lt;=&#123;)(.|\n)+(?=&#125;)/m</span>;</span><br><span class="line">  <span class="keyword">const</span> paramReg = <span class="regexp">/(?&lt;=\().+(?=\)\s+&#123;)/</span>;</span><br><span class="line">  <span class="keyword">const</span> funcString = func.<span class="title function_">toString</span>();</span><br><span class="line">  <span class="comment">// 分别匹配 函数参数 和 函数体</span></span><br><span class="line">  <span class="keyword">const</span> param = paramReg.<span class="title function_">exec</span>(funcString);</span><br><span class="line">  <span class="keyword">const</span> body = bodyReg.<span class="title function_">exec</span>(funcString);</span><br><span class="line">  <span class="keyword">if</span> (!body) <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">  <span class="keyword">if</span> (param) &#123;</span><br><span class="line">    <span class="keyword">const</span> paramArr = param[<span class="number">0</span>].<span class="title function_">split</span>(<span class="string">&quot;,&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Function</span>(...paramArr, body[<span class="number">0</span>]);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Function</span>(body[<span class="number">0</span>]);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">handleNotTraverse</span> = (<span class="params">target, tag</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> <span class="title class_">Ctor</span> = target.<span class="property">constructor</span>;</span><br><span class="line">  <span class="keyword">switch</span> (tag) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="attr">boolTag</span>:</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Object</span>(<span class="title class_">Boolean</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">valueOf</span>.<span class="title function_">call</span>(target));</span><br><span class="line">    <span class="keyword">case</span> <span class="attr">numberTag</span>:</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Object</span>(<span class="title class_">Number</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">valueOf</span>.<span class="title function_">call</span>(target));</span><br><span class="line">    <span class="keyword">case</span> <span class="attr">stringTag</span>:</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Object</span>(<span class="title class_">String</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">valueOf</span>.<span class="title function_">call</span>(target));</span><br><span class="line">    <span class="keyword">case</span> <span class="attr">symbolTag</span>:</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Object</span>(<span class="title class_">Symbol</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">valueOf</span>.<span class="title function_">call</span>(target));</span><br><span class="line">    <span class="keyword">case</span> <span class="attr">errorTag</span>:</span><br><span class="line">    <span class="keyword">case</span> <span class="attr">dateTag</span>:</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Ctor</span>(target);</span><br><span class="line">    <span class="keyword">case</span> <span class="attr">regexpTag</span>:</span><br><span class="line">      <span class="keyword">return</span> <span class="title function_">handleRegExp</span>(target);</span><br><span class="line">    <span class="keyword">case</span> <span class="attr">funcTag</span>:</span><br><span class="line">      <span class="keyword">return</span> <span class="title function_">handleFunc</span>(target);</span><br><span class="line">    <span class="attr">default</span>:</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Ctor</span>(target);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">deepClone</span> = (<span class="params">target, map = <span class="keyword">new</span> <span class="built_in">WeakMap</span>()</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">if</span> (!<span class="title function_">isObject</span>(target)) <span class="keyword">return</span> target;</span><br><span class="line">  <span class="keyword">let</span> type = <span class="title function_">getType</span>(target);</span><br><span class="line">  <span class="keyword">let</span> cloneTarget;</span><br><span class="line">  <span class="keyword">if</span> (!canTraverse[type]) &#123;</span><br><span class="line">    <span class="comment">// 处理不能遍历的对象</span></span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">handleNotTraverse</span>(target, type);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// 这波操作相当关键，可以保证对象的原型不丢失！</span></span><br><span class="line">    <span class="keyword">let</span> ctor = target.<span class="property">constructor</span>;</span><br><span class="line">    cloneTarget = <span class="keyword">new</span> <span class="title function_">ctor</span>();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (map.<span class="title function_">get</span>(target)) <span class="keyword">return</span> target;</span><br><span class="line">  map.<span class="title function_">set</span>(target, <span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (type === mapTag) &#123;</span><br><span class="line">    <span class="comment">//处理Map</span></span><br><span class="line">    target.<span class="title function_">forEach</span>(<span class="function">(<span class="params">item, key</span>) =&gt;</span> &#123;</span><br><span class="line">      cloneTarget.<span class="title function_">set</span>(<span class="title function_">deepClone</span>(key, map), <span class="title function_">deepClone</span>(item, map));</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (type === setTag) &#123;</span><br><span class="line">    <span class="comment">//处理Set</span></span><br><span class="line">    target.<span class="title function_">forEach</span>(<span class="function">(<span class="params">item</span>) =&gt;</span> &#123;</span><br><span class="line">      cloneTarget.<span class="title function_">add</span>(<span class="title function_">deepClone</span>(item, map));</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 处理数组和对象</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> prop <span class="keyword">in</span> target) &#123;</span><br><span class="line">    <span class="keyword">if</span> (target.<span class="title function_">hasOwnProperty</span>(prop)) &#123;</span><br><span class="line">      cloneTarget[prop] = <span class="title function_">deepClone</span>(target[prop], map);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> cloneTarget;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">复制代码;</span><br></pre></td></tr></table></figure>

<p>参考博客[5]</p>
<h3 id="实现-new"><a href="#实现-new" class="headerlink" title="实现 new"></a>实现 new</h3><p>考察频率: (⭐⭐⭐⭐)</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">createObject</span>(<span class="params">Con</span>) &#123;</span><br><span class="line">  <span class="comment">// 创建新对象obj</span></span><br><span class="line">  <span class="comment">// var obj = &#123;&#125;;也可以</span></span><br><span class="line">  <span class="keyword">var</span> obj = <span class="title class_">Object</span>.<span class="title function_">create</span>(<span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 将obj.__proto__ -&gt; 构造函数原型</span></span><br><span class="line">  <span class="comment">// (不推荐)obj.__proto__ = Con.prototype</span></span><br><span class="line">  <span class="title class_">Object</span>.<span class="title function_">setPrototypeOf</span>(obj, <span class="title class_">Con</span>.<span class="property"><span class="keyword">prototype</span></span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 执行构造函数，并接受构造函数返回值</span></span><br><span class="line">  <span class="keyword">const</span> ret = <span class="title class_">Con</span>.<span class="title function_">apply</span>(obj, [].<span class="property">slice</span>.<span class="title function_">call</span>(<span class="variable language_">arguments</span>, <span class="number">1</span>));</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 若构造函数返回值为对象，直接返回该对象</span></span><br><span class="line">  <span class="comment">// 否则返回obj</span></span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">typeof</span> ret === <span class="string">&quot;object&quot;</span> ? ret : obj;</span><br><span class="line">&#125;</span><br><span class="line">复制代码;</span><br></pre></td></tr></table></figure>

<h3 id="继承"><a href="#继承" class="headerlink" title="继承"></a>继承</h3><p>考察频率: (⭐⭐⭐⭐)</p>
<h4 id="原型链继承"><a href="#原型链继承" class="headerlink" title="原型链继承"></a>原型链继承</h4><h4 id="借用构造函数-经典继承"><a href="#借用构造函数-经典继承" class="headerlink" title="借用构造函数(经典继承)"></a>借用构造函数(经典继承)</h4><h4 id="组合继承"><a href="#组合继承" class="headerlink" title="组合继承"></a>组合继承</h4><h4 id="原型式继承"><a href="#原型式继承" class="headerlink" title="原型式继承"></a>原型式继承</h4><h4 id="寄生式继承"><a href="#寄生式继承" class="headerlink" title="寄生式继承"></a>寄生式继承</h4><h4 id="寄生组合式继承"><a href="#寄生组合式继承" class="headerlink" title="寄生组合式继承"></a>寄生组合式继承</h4><h4 id="Class-实现继承-补充一下"><a href="#Class-实现继承-补充一下" class="headerlink" title="Class 实现继承(补充一下)"></a>Class 实现继承(补充一下)</h4><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Animal</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">name</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">name</span> = name;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">getName</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">name</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Dog</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Animal</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">name, age</span>) &#123;</span><br><span class="line">    <span class="variable language_">super</span>(name);</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">age</span> = age;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">复制代码;</span><br></pre></td></tr></table></figure>

<p>参考代码[6]</p>
<h3 id="实现-object-create"><a href="#实现-object-create" class="headerlink" title="实现 object.create"></a>实现 object.create</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">newCreate</span>(<span class="params">proto, propertiesObject</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> proto !== <span class="string">&quot;object&quot;</span> &amp;&amp; <span class="keyword">typeof</span> proto !== <span class="string">&quot;function&quot;</span>) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="title class_">TypeError</span>(<span class="string">&quot;Object prototype may only be an Object: &quot;</span> + proto);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">F</span>(<span class="params"></span>) &#123;&#125;</span><br><span class="line">  F.<span class="property"><span class="keyword">prototype</span></span> = proto;</span><br><span class="line">  <span class="keyword">const</span> o = <span class="keyword">new</span> <span class="title function_">F</span>();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (propertiesObject !== <span class="literal">undefined</span>) &#123;</span><br><span class="line">    <span class="title class_">Object</span>.<span class="title function_">keys</span>(propertiesObject).<span class="title function_">forEach</span>(<span class="function">(<span class="params">prop</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">let</span> desc = propertiesObject[prop];</span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">typeof</span> desc !== <span class="string">&quot;object&quot;</span> || desc === <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="title class_">TypeError</span>(<span class="string">&quot;Object prorotype may only be an Object: &quot;</span> + desc);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="title class_">Object</span>.<span class="title function_">defineProperty</span>(o, prop, desc);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> o;</span><br><span class="line">&#125;</span><br><span class="line">复制代码;</span><br></pre></td></tr></table></figure>

<h2 id="🚂-Function-篇"><a href="#🚂-Function-篇" class="headerlink" title="🚂 Function 篇"></a>🚂 Function 篇</h2><h3 id="call"><a href="#call" class="headerlink" title="call"></a>call</h3><p>考察频率: (⭐⭐⭐⭐)</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="title class_">Function</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">myCall</span> = <span class="keyword">function</span> (<span class="params">thisArg</span>) &#123;</span><br><span class="line">  thisArg = thisArg || <span class="variable language_">window</span>;</span><br><span class="line">  thisArg.<span class="property">func</span> = <span class="variable language_">this</span>;</span><br><span class="line">  <span class="keyword">const</span> args = [];</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">1</span>; i &lt; <span class="variable language_">arguments</span>.<span class="property">length</span>; i++) &#123;</span><br><span class="line">    args.<span class="title function_">push</span>(<span class="string">&quot;arguments[&quot;</span> + i + <span class="string">&quot;]&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">const</span> result = <span class="built_in">eval</span>(<span class="string">&quot;thisArg.func(&quot;</span> + args + <span class="string">&quot;)&quot;</span>);</span><br><span class="line">  <span class="keyword">delete</span> thisArg.<span class="property">func</span>;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;;</span><br><span class="line">复制代码;</span><br></pre></td></tr></table></figure>

<h3 id="bind"><a href="#bind" class="headerlink" title="bind"></a>bind</h3><p>考察频率: (⭐⭐⭐⭐)</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="title class_">Function</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">sx_bind</span> = <span class="keyword">function</span> (<span class="params">obj, ...args</span>) &#123;</span><br><span class="line">  obj = obj || <span class="variable language_">window</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> fn = <span class="title class_">Symbol</span>();</span><br><span class="line">  obj[fn] = <span class="variable language_">this</span>;</span><br><span class="line">  <span class="keyword">const</span> _this = <span class="variable language_">this</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> res = <span class="keyword">function</span> (<span class="params">...innerArgs</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>, _this);</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span> <span class="keyword">instanceof</span> _this) &#123;</span><br><span class="line">      <span class="variable language_">this</span>[fn] = _this;</span><br><span class="line">      <span class="variable language_">this</span>[fn](...[...args, ...innerArgs]);</span><br><span class="line">      <span class="keyword">delete</span> <span class="variable language_">this</span>[fn];</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      obj[fn](...[...args, ...innerArgs]);</span><br><span class="line">      <span class="keyword">delete</span> obj[fn];</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">  res.<span class="property"><span class="keyword">prototype</span></span> = <span class="title class_">Object</span>.<span class="title function_">create</span>(<span class="variable language_">this</span>.<span class="property"><span class="keyword">prototype</span></span>);</span><br><span class="line">  <span class="keyword">return</span> res;</span><br><span class="line">&#125;;</span><br><span class="line">复制代码;</span><br></pre></td></tr></table></figure>

<h3 id="apply"><a href="#apply" class="headerlink" title="apply"></a>apply</h3><p>考察频率: (⭐⭐⭐⭐)</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="title class_">Function</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">myApply</span> = <span class="keyword">function</span> (<span class="params">thisArg, arr</span>) &#123;</span><br><span class="line">  thisArg = thisArg || <span class="variable language_">window</span>;</span><br><span class="line">  thisArg.<span class="property">func</span> = <span class="variable language_">this</span>;</span><br><span class="line">  <span class="keyword">const</span> args = [];</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; arr.<span class="property">length</span>; i++) &#123;</span><br><span class="line">    args.<span class="title function_">push</span>(<span class="string">&quot;arr[&quot;</span> + i + <span class="string">&quot;]&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">const</span> result = <span class="built_in">eval</span>(<span class="string">&quot;thisArg.func(&quot;</span> + args + <span class="string">&quot;)&quot;</span>);</span><br><span class="line">  <span class="keyword">delete</span> thisArg.<span class="property">func</span>;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;;</span><br><span class="line">复制代码;</span><br></pre></td></tr></table></figure>

<h3 id="实现柯里化"><a href="#实现柯里化" class="headerlink" title="实现柯里化"></a>实现柯里化</h3><p>考察频率: (⭐⭐⭐)</p>
<p>参考代码[7]</p>
<h3 id="实现链式调用"><a href="#实现链式调用" class="headerlink" title="实现链式调用"></a>实现链式调用</h3><p>参考代码[8]</p>
<h3 id="偏函数"><a href="#偏函数" class="headerlink" title="偏函数"></a>偏函数</h3><p>参考代码[9]</p>
<h2 id="🌍-ajax-与-jsonp"><a href="#🌍-ajax-与-jsonp" class="headerlink" title="🌍 ajax 与 jsonp"></a>🌍 ajax 与 jsonp</h2><p>考察频率: (⭐⭐⭐)</p>
<h3 id="实现-ajax"><a href="#实现-ajax" class="headerlink" title="实现 ajax"></a>实现 ajax</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">ajax</span>(<span class="params">&#123; url = <span class="literal">null</span>, method = <span class="string">&quot;GET&quot;</span>, dataType = <span class="string">&quot;JSON&quot;</span>, <span class="keyword">async</span> = <span class="literal">true</span> &#125;</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> xhr = <span class="keyword">new</span> <span class="title class_">XMLHttpRequest</span>();</span><br><span class="line">    xhr.<span class="title function_">open</span>(method, url, <span class="keyword">async</span>);</span><br><span class="line">    xhr.<span class="property">responseType</span> = dataType;</span><br><span class="line">    xhr.<span class="property">onreadystatechange</span> = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (!<span class="regexp">/^[23]\d&#123;2&#125;$/</span>.<span class="title function_">test</span>(xhr.<span class="property">status</span>)) <span class="keyword">return</span>;</span><br><span class="line">      <span class="keyword">if</span> (xhr.<span class="property">readyState</span> === <span class="number">4</span>) &#123;</span><br><span class="line">        <span class="keyword">let</span> result = xhr.<span class="property">responseText</span>;</span><br><span class="line">        <span class="title function_">resolve</span>(result);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    xhr.<span class="property">onerror</span> = <span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="title function_">reject</span>(err);</span><br><span class="line">    &#125;;</span><br><span class="line">    xhr.<span class="title function_">send</span>();</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line">复制代码;</span><br></pre></td></tr></table></figure>

<h3 id="实现-jsonp"><a href="#实现-jsonp" class="headerlink" title="实现 jsonp"></a>实现 jsonp</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">jsonp</span> = (<span class="params">&#123; url, params, callbackName &#125;</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">generateUrl</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">let</span> dataSrc = <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> key <span class="keyword">in</span> params) &#123;</span><br><span class="line">      <span class="keyword">if</span> (params.<span class="title function_">hasOwnProperty</span>(key)) &#123;</span><br><span class="line">        dataSrc += <span class="string">`<span class="subst">$&#123;key&#125;</span>=<span class="subst">$&#123;params[key]&#125;</span>&amp;`</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    dataSrc += <span class="string">`callback=<span class="subst">$&#123;callbackName&#125;</span>`</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">`<span class="subst">$&#123;url&#125;</span>?<span class="subst">$&#123;dataSrc&#125;</span>`</span>;</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> scriptEle = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&quot;script&quot;</span>);</span><br><span class="line">    scriptEle.<span class="property">src</span> = <span class="title function_">generateUrl</span>();</span><br><span class="line">    <span class="variable language_">document</span>.<span class="property">body</span>.<span class="title function_">appendChild</span>(scriptEle);</span><br><span class="line">    <span class="variable language_">window</span>[callbackName] = <span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="title function_">resolve</span>(data);</span><br><span class="line">      <span class="variable language_">document</span>.<span class="title function_">removeChild</span>(scriptEle);</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br><span class="line">复制代码;</span><br></pre></td></tr></table></figure>

<h2 id="🛫-ES6-篇"><a href="#🛫-ES6-篇" class="headerlink" title="🛫 ES6 篇"></a>🛫 ES6 篇</h2><h3 id="实现-set"><a href="#实现-set" class="headerlink" title="实现 set"></a>实现 set</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Set</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">items</span> = &#123;&#125;;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">size</span> = <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">has</span>(<span class="params">element</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> element <span class="keyword">in</span> <span class="variable language_">this</span>.<span class="property">items</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">add</span>(<span class="params">element</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="variable language_">this</span>.<span class="title function_">has</span>(element)) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">items</span>[element] = element;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">size</span>++;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">delete</span>(<span class="params">element</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="title function_">has</span>(element)) &#123;</span><br><span class="line">      <span class="keyword">delete</span> <span class="variable language_">this</span>.<span class="property">items</span>[element];</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">size</span>--;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">clear</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">items</span> = &#123;&#125;;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">size</span> = <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">values</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> values = [];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> key <span class="keyword">in</span> <span class="variable language_">this</span>.<span class="property">items</span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">items</span>.<span class="title function_">hasOwnProperty</span>(key)) &#123;</span><br><span class="line">        values.<span class="title function_">push</span>(key);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> values;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">复制代码;</span><br></pre></td></tr></table></figure>

<h3 id="实现-map"><a href="#实现-map" class="headerlink" title="实现 map"></a>实现 map</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">defaultToString</span>(<span class="params">key</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (key === <span class="literal">null</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;NULL&quot;</span>;</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (key === <span class="literal">undefined</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;UNDEFINED&quot;</span>;</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (</span><br><span class="line">    <span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">toString</span>.<span class="title function_">call</span>(key) === <span class="string">&quot;[object Object]&quot;</span> ||</span><br><span class="line">    <span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">toString</span>.<span class="title function_">call</span>(key) === <span class="string">&quot;[object Array]&quot;</span></span><br><span class="line">  ) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(key);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> key.<span class="title function_">toString</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Map</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">items</span> = &#123;&#125;;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">size</span> = <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">set</span>(<span class="params">key, value</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="variable language_">this</span>.<span class="title function_">has</span>(key)) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">items</span>[<span class="title function_">defaultToString</span>(key)] = value;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">size</span>++;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">get</span>(<span class="params">key</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">items</span>[<span class="title function_">defaultToString</span>(key)];</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">has</span>(<span class="params">key</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">items</span>[<span class="title function_">defaultToString</span>(key)] !== <span class="literal">undefined</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">delete</span>(<span class="params">key</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="title function_">has</span>(key)) &#123;</span><br><span class="line">      <span class="keyword">delete</span> <span class="variable language_">this</span>.<span class="property">items</span>[key];</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">size</span>--;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">clear</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">items</span> = &#123;&#125;;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">size</span> = <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">keys</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> keys = [];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> key <span class="keyword">in</span> <span class="variable language_">this</span>.<span class="property">items</span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="title function_">has</span>(key)) &#123;</span><br><span class="line">        keys.<span class="title function_">push</span>(key);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> keys;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">values</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> values = [];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> key <span class="keyword">in</span> <span class="variable language_">this</span>.<span class="property">items</span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="title function_">has</span>(key)) &#123;</span><br><span class="line">        values.<span class="title function_">push</span>(<span class="variable language_">this</span>.<span class="property">items</span>[key]);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> values;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">复制代码;</span><br></pre></td></tr></table></figure>

<h3 id="实现-es6-的-class"><a href="#实现-es6-的-class" class="headerlink" title="实现 es6 的 class"></a>实现 es6 的 class</h3><p>参考代码[10]</p>
<h2 id="🦉-其他"><a href="#🦉-其他" class="headerlink" title="🦉 其他"></a>🦉 其他</h2><h3 id="instanceof"><a href="#instanceof" class="headerlink" title="instanceof"></a>instanceof</h3><p>考察频率: (⭐⭐⭐⭐)</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">instance_of</span>(<span class="params">Case, Constructor</span>) &#123;</span><br><span class="line">  <span class="comment">// 基本数据类型返回false</span></span><br><span class="line">  <span class="comment">// 兼容一下函数对象</span></span><br><span class="line">  <span class="keyword">if</span> ((<span class="keyword">typeof</span> <span class="title class_">Case</span> != <span class="string">&quot;object&quot;</span> &amp;&amp; <span class="keyword">typeof</span> <span class="title class_">Case</span> != <span class="string">&quot;function&quot;</span>) || <span class="title class_">Case</span> == <span class="string">&quot;null&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  <span class="keyword">let</span> <span class="title class_">CaseProto</span> = <span class="title class_">Object</span>.<span class="title function_">getPrototypeOf</span>(<span class="title class_">Case</span>);</span><br><span class="line">  <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">    <span class="comment">// 查到原型链顶端，仍未查到，返回false</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="title class_">CaseProto</span> == <span class="literal">null</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    <span class="comment">// 找到相同的原型</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="title class_">CaseProto</span> === <span class="title class_">Constructor</span>.<span class="property"><span class="keyword">prototype</span></span>) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    <span class="title class_">CaseProto</span> = <span class="title class_">Object</span>.<span class="title function_">getPrototypeOf</span>(<span class="title class_">CaseProto</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">复制代码;</span><br></pre></td></tr></table></figure>

<h3 id="实现千分位分隔符"><a href="#实现千分位分隔符" class="headerlink" title="实现千分位分隔符"></a>实现千分位分隔符</h3><p>考察频率: (⭐⭐⭐)</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> str = <span class="string">&quot;100000000000&quot;</span>,</span><br><span class="line">  reg = <span class="regexp">/(?=(\B\d&#123;3&#125;)+$)/g</span>;</span><br><span class="line">str.<span class="title function_">replace</span>(reg, <span class="string">&quot;,&quot;</span>);</span><br><span class="line">复制代码;</span><br></pre></td></tr></table></figure>

<h3 id="把一个-JSON-对象的-key-从下划线形式（Pascal）转换到小驼峰形式（Camel）"><a href="#把一个-JSON-对象的-key-从下划线形式（Pascal）转换到小驼峰形式（Camel）" class="headerlink" title="把一个 JSON 对象的 key 从下划线形式（Pascal）转换到小驼峰形式（Camel）"></a>把一个 JSON 对象的 key 从下划线形式（Pascal）转换到小驼峰形式（Camel）</h3><p>考察频率: (⭐⭐⭐)</p>
<p>参考代码[11]</p>
<h3 id="实现数据类型判断函数"><a href="#实现数据类型判断函数" class="headerlink" title="实现数据类型判断函数"></a>实现数据类型判断函数</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">myTypeof</span>(<span class="params">obj</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">toString</span>.<span class="title function_">call</span>(obj).<span class="title function_">slice</span>(<span class="number">8</span>, -<span class="number">1</span>).<span class="title function_">toLowerCase</span>();</span><br><span class="line">&#125;</span><br><span class="line">复制代码;</span><br></pre></td></tr></table></figure>

<h3 id="实现数组转树"><a href="#实现数组转树" class="headerlink" title="实现数组转树"></a>实现数组转树</h3><p>参考代码[12]</p>
<h3 id="实现-sleep-函数"><a href="#实现-sleep-函数" class="headerlink" title="实现 sleep 函数"></a>实现 sleep 函数</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// promise</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">sleep</span> = (<span class="params">time</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve</span>) =&gt;</span> <span class="built_in">setTimeout</span>(resolve, time));</span><br><span class="line">&#125;;</span><br><span class="line"><span class="title function_">sleep</span>(<span class="number">1000</span>).<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">1</span>);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// ES5</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">sleep</span>(<span class="params">callback, time</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> callback === <span class="string">&quot;function&quot;</span>) <span class="built_in">setTimeout</span>(callback, time);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">output</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">sleep</span>(output, <span class="number">1000</span>);</span><br><span class="line"></span><br><span class="line">复制代码;</span><br></pre></td></tr></table></figure>

<h3 id="实现发布订阅模式"><a href="#实现发布订阅模式" class="headerlink" title="实现发布订阅模式"></a>实现发布订阅模式</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">EventEmitter</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">cache</span> = &#123;&#125;;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">on</span>(<span class="params">name, fn</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">cache</span>[name]) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">cache</span>[name].<span class="title function_">push</span>(fn);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">cache</span>[name] = [fn];</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">off</span>(<span class="params">name, fn</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> tasks = <span class="variable language_">this</span>.<span class="property">cache</span>[name];</span><br><span class="line">    <span class="keyword">if</span> (tasks) &#123;</span><br><span class="line">      <span class="keyword">const</span> index = tasks.<span class="title function_">findIndex</span>(<span class="function">(<span class="params">f</span>) =&gt;</span> f === fn || f.<span class="property">callback</span> === fn);</span><br><span class="line">      <span class="keyword">if</span> (index &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">        tasks.<span class="title function_">splice</span>(index, <span class="number">1</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">emit</span>(<span class="params">name, once = <span class="literal">false</span>, ...args</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">cache</span>[name]) &#123;</span><br><span class="line">      <span class="comment">// 创建副本，如果回调函数内继续注册相同事件，会造成死循环</span></span><br><span class="line">      <span class="keyword">let</span> tasks = <span class="variable language_">this</span>.<span class="property">cache</span>[name].<span class="title function_">slice</span>();</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">let</span> fn <span class="keyword">of</span> tasks) &#123;</span><br><span class="line">        <span class="title function_">fn</span>(...args);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> (once) &#123;</span><br><span class="line">        <span class="keyword">delete</span> <span class="variable language_">this</span>.<span class="property">cache</span>[name];</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="篇二"><a href="#篇二" class="headerlink" title="篇二"></a>篇二</h2><h3 id="1-call-的实现"><a href="#1-call-的实现" class="headerlink" title="1.call 的实现"></a>1.call 的实现</h3><ul>
<li>第一个参数为 null 或者 undefined 时，this 指向全局对象 window，值为原始值的指向该原始值的自动包装对象，如 String、Number、Boolean</li>
<li>为了避免函数名与上下文(context)的属性发生冲突，使用 Symbol 类型作为唯一值</li>
<li>将函数作为传入的上下文(context)属性执行</li>
<li>函数执行完成后删除该属性</li>
<li>返回执行结果</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="title class_">Function</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">myCall</span> = <span class="keyword">function</span> (<span class="params">context, ...args</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> cxt = context || <span class="variable language_">window</span>;</span><br><span class="line">  <span class="comment">//将当前被调用的方法定义在cxt.func上.(为了能以对象调用形式绑定this)</span></span><br><span class="line">  <span class="comment">//新建一个唯一的Symbol变量避免重复</span></span><br><span class="line">  <span class="keyword">let</span> func = <span class="title class_">Symbol</span>();</span><br><span class="line">  cxt[func] = <span class="variable language_">this</span>;</span><br><span class="line">  args = args ? args : [];</span><br><span class="line">  <span class="comment">//以对象调用形式调用func,此时this指向cxt 也就是传入的需要绑定的this指向</span></span><br><span class="line">  <span class="keyword">const</span> res = args.<span class="property">length</span> &gt; <span class="number">0</span> ? cxt[func](...args) : cxt[func]();</span><br><span class="line">  <span class="comment">//删除该方法，不然会对传入对象造成污染（添加该方法）</span></span><br><span class="line">  <span class="keyword">delete</span> cxt[func];</span><br><span class="line">  <span class="keyword">return</span> res;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="2-apply-的实现"><a href="#2-apply-的实现" class="headerlink" title="2.apply 的实现"></a>2.apply 的实现</h3><ul>
<li>前部分与 call 一样</li>
<li>第二个参数可以不传，但类型必须为数组或者类数组</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="title class_">Function</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">myApply</span> = <span class="keyword">function</span> (<span class="params">context, args = []</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> cxt = context || <span class="variable language_">window</span>;</span><br><span class="line">  <span class="comment">//将当前被调用的方法定义在cxt.func上.(为了能以对象调用形式绑定this)</span></span><br><span class="line">  <span class="comment">//新建一个唯一的Symbol变量避免重复</span></span><br><span class="line">  <span class="keyword">let</span> func = <span class="title class_">Symbol</span>();</span><br><span class="line">  cxt[func] = <span class="variable language_">this</span>;</span><br><span class="line">  <span class="comment">//以对象调用形式调用func,此时this指向cxt 也就是传入的需要绑定的this指向</span></span><br><span class="line">  <span class="keyword">const</span> res = args.<span class="property">length</span> &gt; <span class="number">0</span> ? cxt[func](...args) : cxt[func]();</span><br><span class="line">  <span class="keyword">delete</span> cxt[func];</span><br><span class="line">  <span class="keyword">return</span> res;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="3-bind-的实现"><a href="#3-bind-的实现" class="headerlink" title="3.bind 的实现"></a>3.bind 的实现</h3><p>需要考虑：</p>
<ul>
<li>bind() 除了 this 外，还可传入多个参数；</li>
<li>bind 创建的新函数可能传入多个参数；</li>
<li>新函数可能被当做构造函数调用；</li>
<li>函数可能有返回值；</li>
</ul>
<p>实现方法：</p>
<ul>
<li>bind 方法不会立即执行，需要返回一个待执行的函数；（闭包）</li>
<li>实现作用域绑定（apply）</li>
<li>参数传递（apply 的数组传参）</li>
<li>当作为构造函数的时候，进行原型继承</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="title class_">Function</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">myBind</span> = <span class="keyword">function</span> (<span class="params">context, ...args</span>) &#123;</span><br><span class="line">  <span class="comment">//新建一个变量赋值为this，表示当前函数</span></span><br><span class="line">  <span class="keyword">const</span> fn = <span class="variable language_">this</span>;</span><br><span class="line">  <span class="comment">//判断有没有传参进来，若为空则赋值[]</span></span><br><span class="line">  args = args ? args : [];</span><br><span class="line">  <span class="comment">//返回一个newFn函数，在里面调用fn</span></span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">function</span> <span class="title function_">newFn</span>(<span class="params">...newFnArgs</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span> <span class="keyword">instanceof</span> newFn) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> <span class="title function_">fn</span>(...args, ...newFnArgs);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> fn.<span class="title function_">apply</span>(context, [...args, ...newFnArgs]);</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<ul>
<li>测试</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> name = <span class="string">&quot;小王&quot;</span>,</span><br><span class="line">  age = <span class="number">17</span>;</span><br><span class="line"><span class="keyword">let</span> obj = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&quot;小张&quot;</span>,</span><br><span class="line">  <span class="attr">age</span>: <span class="variable language_">this</span>.<span class="property">age</span>,</span><br><span class="line">  <span class="attr">myFun</span>: <span class="keyword">function</span> (<span class="params"><span class="keyword">from</span>, to</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">name</span> + <span class="string">&quot; 年龄 &quot;</span> + <span class="variable language_">this</span>.<span class="property">age</span> + <span class="string">&quot;来自 &quot;</span> + <span class="keyword">from</span> + <span class="string">&quot;去往&quot;</span> + to);</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">let</span> db = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&quot;德玛&quot;</span>,</span><br><span class="line">  <span class="attr">age</span>: <span class="number">99</span>,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//结果</span></span><br><span class="line">obj.<span class="property">myFun</span>.<span class="title function_">myCall</span>(db, <span class="string">&quot;成都&quot;</span>, <span class="string">&quot;上海&quot;</span>); <span class="comment">// 德玛 年龄 99  来自 成都去往上海</span></span><br><span class="line">obj.<span class="property">myFun</span>.<span class="title function_">myApply</span>(db, [<span class="string">&quot;成都&quot;</span>, <span class="string">&quot;上海&quot;</span>]); <span class="comment">// 德玛 年龄 99  来自 成都去往上海</span></span><br><span class="line">obj.<span class="property">myFun</span>.<span class="title function_">myBind</span>(db, <span class="string">&quot;成都&quot;</span>, <span class="string">&quot;上海&quot;</span>)(); <span class="comment">// 德玛 年龄 99  来自 成都去往上海</span></span><br><span class="line">obj.<span class="property">myFun</span>.<span class="title function_">myBind</span>(db, [<span class="string">&quot;成都&quot;</span>, <span class="string">&quot;上海&quot;</span>])(); <span class="comment">// 德玛 年龄 99  来自 成都, 上海去往 undefined</span></span><br></pre></td></tr></table></figure>

<h3 id="4-寄生式组合继承"><a href="#4-寄生式组合继承" class="headerlink" title="4.寄生式组合继承"></a>4.寄生式组合继承</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Person</span>(<span class="params">obj</span>) &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">name</span> = obj.<span class="property">name</span>;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">age</span> = obj.<span class="property">age</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title class_">Person</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">add</span> = <span class="keyword">function</span> (<span class="params">value</span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(value);</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">var</span> p1 = <span class="keyword">new</span> <span class="title class_">Person</span>(&#123; <span class="attr">name</span>: <span class="string">&quot;番茄&quot;</span>, <span class="attr">age</span>: <span class="number">18</span> &#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Person1</span>(<span class="params">obj</span>) &#123;</span><br><span class="line">  <span class="title class_">Person</span>.<span class="title function_">call</span>(<span class="variable language_">this</span>, obj);</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">sex</span> = obj.<span class="property">sex</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 这一步是继承的关键</span></span><br><span class="line"><span class="title class_">Person1</span>.<span class="property"><span class="keyword">prototype</span></span> = <span class="title class_">Object</span>.<span class="title function_">create</span>(<span class="title class_">Person</span>.<span class="property"><span class="keyword">prototype</span></span>);</span><br><span class="line"><span class="title class_">Person1</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">constructor</span> = <span class="title class_">Person1</span>;</span><br><span class="line"></span><br><span class="line"><span class="title class_">Person1</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">play</span> = <span class="keyword">function</span> (<span class="params">value</span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(value);</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">var</span> p2 = <span class="keyword">new</span> <span class="title class_">Person1</span>(&#123; <span class="attr">name</span>: <span class="string">&quot;鸡蛋&quot;</span>, <span class="attr">age</span>: <span class="number">118</span>, <span class="attr">sex</span>: <span class="string">&quot;男&quot;</span> &#125;);</span><br></pre></td></tr></table></figure>

<h3 id="5-ES6-继承"><a href="#5-ES6-继承" class="headerlink" title="5.ES6 继承"></a>5.ES6 继承</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">//class 相当于es5中构造函数</span></span><br><span class="line"><span class="comment">//class中定义方法时，前后不能加function，全部定义在class的protopyte属性中</span></span><br><span class="line"><span class="comment">//class中定义的所有方法是不可枚举的</span></span><br><span class="line"><span class="comment">//class中只能定义方法，不能定义对象，变量等</span></span><br><span class="line"><span class="comment">//class和方法内默认都是严格模式</span></span><br><span class="line"><span class="comment">//es5中constructor为隐式属性</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">People</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">name = <span class="string">&quot;wang&quot;</span>, age = <span class="string">&quot;27&quot;</span></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">name</span> = name;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">age</span> = age;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">eat</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.name&#125;</span> <span class="subst">$&#123;<span class="variable language_">this</span>.age&#125;</span> eat food`</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//继承父类</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Woman</span> <span class="keyword">extends</span> <span class="title class_ inherited__">People</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">name = <span class="string">&quot;ren&quot;</span>, age = <span class="string">&quot;27&quot;</span></span>) &#123;</span><br><span class="line">    <span class="comment">//继承父类属性</span></span><br><span class="line">    <span class="variable language_">super</span>(name, age);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">eat</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">//继承父类方法</span></span><br><span class="line">    <span class="variable language_">super</span>.<span class="title function_">eat</span>();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> wonmanObj = <span class="keyword">new</span> <span class="title class_">Woman</span>(<span class="string">&quot;xiaoxiami&quot;</span>);</span><br><span class="line">wonmanObj.<span class="title function_">eat</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">//es5继承先创建子类的实例对象，然后再将父类的方法添加到this上（Parent.apply(this)）。</span></span><br><span class="line"><span class="comment">//es6继承是使用关键字super先创建父类的实例对象this，最后在子类class中修改this。</span></span><br></pre></td></tr></table></figure>

<h3 id="6-new-的实现"><a href="#6-new-的实现" class="headerlink" title="6.new 的实现"></a>6.new 的实现</h3><ul>
<li>一个继承自 Foo.prototype 的新对象被创建。</li>
<li>使用指定的参数调用构造函数 Foo，并将 this 绑定到新创建的对象。new Foo 等同于 new Foo()，也就是没有指定参数列表，Foo 不带任何参数调用的情况。</li>
<li>由构造函数返回的对象就是 new 表达式的结果。如果构造函数没有显式返回一个对象，则使用步骤 1 创建的对象。</li>
<li>一般情况下，构造函数不返回值，但是用户可以选择主动返回对象，来覆盖正常的对象创建步骤</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Ctor</span>(<span class="params"></span>)&#123;</span><br><span class="line">    ....</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">myNew</span>(<span class="params">ctor,...args</span>)&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">typeof</span> ctor !== <span class="string">&#x27;function&#x27;</span>)&#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="string">&#x27;myNew function the first param must be a function&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">var</span> newObj = <span class="title class_">Object</span>.<span class="title function_">create</span>(ctor.<span class="property"><span class="keyword">prototype</span></span>); <span class="comment">//创建一个继承自ctor.prototype的新对象</span></span><br><span class="line">    <span class="keyword">var</span> ctorReturnResult = ctor.<span class="title function_">apply</span>(newObj, args); <span class="comment">//将构造函数ctor的this绑定到newObj中</span></span><br><span class="line">    <span class="keyword">var</span> isObject = <span class="keyword">typeof</span> ctorReturnResult === <span class="string">&#x27;object&#x27;</span> &amp;&amp; ctorReturnResult !== <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">var</span> isFunction = <span class="keyword">typeof</span> ctorReturnResult === <span class="string">&#x27;function&#x27;</span>;</span><br><span class="line">    <span class="keyword">if</span>(isObject || isFunction)&#123;</span><br><span class="line">        <span class="keyword">return</span> ctorReturnResult;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> newObj;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> c = <span class="title function_">myNew</span>(<span class="title class_">Ctor</span>);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="7-instanceof-的实现"><a href="#7-instanceof-的实现" class="headerlink" title="7.instanceof 的实现"></a>7.instanceof 的实现</h3><ul>
<li>instanceof 是用来判断 A 是否为 B 的实例，表达式为：A instanceof B，如果 A 是 B 的实例，则返回 true,否则返回 false。</li>
<li>instanceof 运算符用来测试一个对象在其原型链中是否存在一个构造函数的 prototype 属性。</li>
<li>不能检测基本数据类型，在原型链上的结果未必准确，不能检测 null,undefined</li>
<li>实现：遍历左边变量的原型链，直到找到右边变量的 prototype，如果没有找到，返回 false</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">myInstanceOf</span>(<span class="params">a, b</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> left = a.<span class="property">__proto__</span>;</span><br><span class="line">  <span class="keyword">let</span> right = b.<span class="property"><span class="keyword">prototype</span></span>;</span><br><span class="line">  <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (left == <span class="literal">null</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (left == right) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    left = left.<span class="property">__proto__</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//instanceof 运算符用于判断构造函数的 prototype 属性是否出现在对象的原型链中的任何位置。</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">myInstanceof</span>(<span class="params">left, right</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> proto = <span class="title class_">Object</span>.<span class="title function_">getPrototypeOf</span>(left), <span class="comment">// 获取对象的原型</span></span><br><span class="line">    prototype = right.<span class="property"><span class="keyword">prototype</span></span>; <span class="comment">// 获取构造函数的 prototype 对象</span></span><br><span class="line">  <span class="comment">// 判断构造函数的 prototype 对象是否在对象的原型链上</span></span><br><span class="line">  <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!proto) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">if</span> (proto === prototype) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    proto = <span class="title class_">Object</span>.<span class="title function_">getPrototypeOf</span>(proto);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="8-Object-create-的实现"><a href="#8-Object-create-的实现" class="headerlink" title="8.Object.create()的实现"></a>8.Object.create()的实现</h3><ul>
<li>MDN 文档</li>
<li>Object.create()会将参数对象作为一个新创建的空对象的原型, 并返回这个空对象</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">//简略版</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">myCreate</span>(<span class="params">obj</span>) &#123;</span><br><span class="line">  <span class="comment">// 新声明一个函数</span></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">C</span>(<span class="params"></span>) &#123;&#125;</span><br><span class="line">  <span class="comment">// 将函数的原型指向obj</span></span><br><span class="line">  C.<span class="property"><span class="keyword">prototype</span></span> = obj;</span><br><span class="line">  <span class="comment">// 返回这个函数的实力化对象</span></span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title function_">C</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//官方版Polyfill</span></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">typeof</span> <span class="title class_">Object</span>.<span class="property">create</span> !== <span class="string">&quot;function&quot;</span>) &#123;</span><br><span class="line">  <span class="title class_">Object</span>.<span class="property">create</span> = <span class="keyword">function</span> (<span class="params">proto, propertiesObject</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> proto !== <span class="string">&quot;object&quot;</span> &amp;&amp; <span class="keyword">typeof</span> proto !== <span class="string">&quot;function&quot;</span>) &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">TypeError</span>(<span class="string">&quot;Object prototype may only be an Object: &quot;</span> + proto);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (proto === <span class="literal">null</span>) &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(</span><br><span class="line">        <span class="string">&quot;This browser&#x27;s implementation of Object.create is a shim and doesn&#x27;t support &#x27;null&#x27; as the first argument.&quot;</span></span><br><span class="line">      );</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> propertiesObject !== <span class="string">&quot;undefined&quot;</span>)</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(</span><br><span class="line">        <span class="string">&quot;This browser&#x27;s implementation of Object.create is a shim and doesn&#x27;t support a second argument.&quot;</span></span><br><span class="line">      );</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">F</span>(<span class="params"></span>) &#123;&#125;</span><br><span class="line">    F.<span class="property"><span class="keyword">prototype</span></span> = proto;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title function_">F</span>();</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="9-实现-Object-assign"><a href="#9-实现-Object-assign" class="headerlink" title="9.实现 Object.assign"></a>9.实现 Object.assign</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="title class_">Object</span>.<span class="property">assign2</span> = <span class="keyword">function</span> (<span class="params">target, ...source</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (target == <span class="literal">null</span>) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">TypeError</span>(<span class="string">&quot;Cannot convert undefined or null to object&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">let</span> ret = <span class="title class_">Object</span>(target);</span><br><span class="line">  source.<span class="title function_">forEach</span>(<span class="keyword">function</span> (<span class="params">obj</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (obj != <span class="literal">null</span>) &#123;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">let</span> key <span class="keyword">in</span> obj) &#123;</span><br><span class="line">        <span class="keyword">if</span> (obj.<span class="title function_">hasOwnProperty</span>(key)) &#123;</span><br><span class="line">          ret[key] = obj[key];</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="keyword">return</span> ret;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="10-Promise-的实现"><a href="#10-Promise-的实现" class="headerlink" title="10.Promise 的实现"></a>10.Promise 的实现</h3><p>实现 Promise 需要完全读懂 Promise A+ 规范，不过从总体的实现上看，有如下几个点需要考虑到：</p>
<ul>
<li>Promise 本质是一个状态机，且状态只能为以下三种：Pending（等待态）、Fulfilled（执行态）、Rejected（拒绝态），状态的变更是单向的，只能从 Pending -&gt; Fulfilled 或 Pending -&gt; Rejected，状态变更不可逆</li>
<li>then 需要支持链式调用</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Promise</span> &#123;</span><br><span class="line">  callbacks = [];</span><br><span class="line">  state = <span class="string">&quot;pending&quot;</span>; <span class="comment">//增加状态</span></span><br><span class="line">  value = <span class="literal">null</span>; <span class="comment">//保存结果</span></span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">fn</span>) &#123;</span><br><span class="line">    <span class="title function_">fn</span>(<span class="variable language_">this</span>.<span class="property">_resolve</span>.<span class="title function_">bind</span>(<span class="variable language_">this</span>), <span class="variable language_">this</span>.<span class="property">_reject</span>.<span class="title function_">bind</span>(<span class="variable language_">this</span>));</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">then</span>(<span class="params">onFulfilled, onRejected</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">_handle</span>(&#123;</span><br><span class="line">        <span class="attr">onFulfilled</span>: onFulfilled || <span class="literal">null</span>,</span><br><span class="line">        <span class="attr">onRejected</span>: onRejected || <span class="literal">null</span>,</span><br><span class="line">        <span class="attr">resolve</span>: resolve,</span><br><span class="line">        <span class="attr">reject</span>: reject,</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">_handle</span>(<span class="params">callback</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">state</span> === <span class="string">&quot;pending&quot;</span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">callbacks</span>.<span class="title function_">push</span>(callback);</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> cb =</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">state</span> === <span class="string">&quot;fulfilled&quot;</span> ? callback.<span class="property">onFulfilled</span> : callback.<span class="property">onRejected</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!cb) &#123;</span><br><span class="line">      <span class="comment">//如果then中没有传递任何东西</span></span><br><span class="line">      cb = <span class="variable language_">this</span>.<span class="property">state</span> === <span class="string">&quot;fulfilled&quot;</span> ? callback.<span class="property">resolve</span> : callback.<span class="property">reject</span>;</span><br><span class="line">      <span class="title function_">cb</span>(<span class="variable language_">this</span>.<span class="property">value</span>);</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> ret = <span class="title function_">cb</span>(<span class="variable language_">this</span>.<span class="property">value</span>);</span><br><span class="line">    cb = <span class="variable language_">this</span>.<span class="property">state</span> === <span class="string">&quot;fulfilled&quot;</span> ? callback.<span class="property">resolve</span> : callback.<span class="property">reject</span>;</span><br><span class="line">    <span class="title function_">cb</span>(ret);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">_resolve</span>(<span class="params">value</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (value &amp;&amp; (<span class="keyword">typeof</span> value === <span class="string">&quot;object&quot;</span> || <span class="keyword">typeof</span> value === <span class="string">&quot;function&quot;</span>)) &#123;</span><br><span class="line">      <span class="keyword">var</span> then = value.<span class="property">then</span>;</span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">typeof</span> then === <span class="string">&quot;function&quot;</span>) &#123;</span><br><span class="line">        then.<span class="title function_">call</span>(value, <span class="variable language_">this</span>.<span class="property">_resolve</span>.<span class="title function_">bind</span>(<span class="variable language_">this</span>), <span class="variable language_">this</span>.<span class="property">_reject</span>.<span class="title function_">bind</span>(<span class="variable language_">this</span>));</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">state</span> = <span class="string">&quot;fulfilled&quot;</span>; <span class="comment">//改变状态</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">value</span> = value; <span class="comment">//保存结果</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">callbacks</span>.<span class="title function_">forEach</span>(<span class="function">(<span class="params">callback</span>) =&gt;</span> <span class="variable language_">this</span>.<span class="title function_">_handle</span>(callback));</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">_reject</span>(<span class="params">error</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">state</span> = <span class="string">&quot;rejected&quot;</span>;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">value</span> = error;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">callbacks</span>.<span class="title function_">forEach</span>(<span class="function">(<span class="params">callback</span>) =&gt;</span> <span class="variable language_">this</span>.<span class="title function_">_handle</span>(callback));</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="Promise-resolve"><a href="#Promise-resolve" class="headerlink" title="Promise.resolve"></a>Promise.resolve</h4><ul>
<li>Promsie.resolve(value) 可以将任何值转成值为 value 状态是 fulfilled 的 Promise，但如果传入的值本身是 Promise 则会原样返回它。</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="title class_">Promise</span>.<span class="title function_">resolve</span>(<span class="params">value</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (value &amp;&amp; value <span class="keyword">instanceof</span> <span class="title class_">Promise</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> value;</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (value &amp;&amp; <span class="keyword">typeof</span> value === <span class="string">&#x27;object&#x27;</span> &amp;&amp; <span class="keyword">typeof</span> value.<span class="property">then</span> === <span class="string">&#x27;function&#x27;</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> then = value.<span class="property">then</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function"><span class="params">resolve</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="title function_">then</span>(resolve);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (value) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function"><span class="params">resolve</span> =&gt;</span> <span class="title function_">resolve</span>(value));</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function"><span class="params">resolve</span> =&gt;</span> <span class="title function_">resolve</span>());</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="Promise-reject"><a href="#Promise-reject" class="headerlink" title="Promise.reject"></a>Promise.reject</h4><ul>
<li>和 Promise.resolve() 类似，Promise.reject() 会实例化一个 rejected 状态的 Promise。但与 Promise.resolve() 不同的是，如果给 Promise.reject() 传递一个 Promise 对象，则这个对象会成为新 Promise 的值。</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="title class_">Promise</span>.<span class="property">reject</span> = <span class="keyword">function</span> (<span class="params">reason</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> <span class="title function_">reject</span>(reason));</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h4 id="Promise-all"><a href="#Promise-all" class="headerlink" title="Promise.all"></a>Promise.all</h4><ul>
<li>传入的所有 Promsie 都是 fulfilled，则返回由他们的值组成的，状态为 fulfilled 的新 Promise；</li>
<li>只要有一个 Promise 是 rejected，则返回 rejected 状态的新 Promsie，且它的值是第一个 rejected 的 Promise 的值；</li>
<li>只要有一个 Promise 是 pending，则返回一个 pending 状态的新 Promise；</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="title class_">Promise</span>.<span class="property">all</span> = <span class="keyword">function</span> (<span class="params">promiseArr</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> index = <span class="number">0</span>,</span><br><span class="line">    result = [];</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    promiseArr.<span class="title function_">forEach</span>(<span class="function">(<span class="params">p, i</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="title class_">Promise</span>.<span class="title function_">resolve</span>(p).<span class="title function_">then</span>(</span><br><span class="line">        <span class="function">(<span class="params">val</span>) =&gt;</span> &#123;</span><br><span class="line">          index++;</span><br><span class="line">          result[i] = val;</span><br><span class="line">          <span class="keyword">if</span> (index === promiseArr.<span class="property">length</span>) &#123;</span><br><span class="line">            <span class="title function_">resolve</span>(result);</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">          <span class="title function_">reject</span>(err);</span><br><span class="line">        &#125;</span><br><span class="line">      );</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h4 id="Promise-race"><a href="#Promise-race" class="headerlink" title="Promise.race"></a>Promise.race</h4><ul>
<li>Promise.race 会返回一个由所有可迭代实例中第一个 fulfilled 或 rejected 的实例包装后的新实例。</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="title class_">Promise</span>.<span class="property">race</span> = <span class="keyword">function</span> (<span class="params">promiseArr</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    promiseArr.<span class="title function_">forEach</span>(<span class="function">(<span class="params">p</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="title class_">Promise</span>.<span class="title function_">resolve</span>(p).<span class="title function_">then</span>(</span><br><span class="line">        <span class="function">(<span class="params">val</span>) =&gt;</span> &#123;</span><br><span class="line">          <span class="title function_">resolve</span>(val);</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">          <span class="title function_">rejecte</span>(err);</span><br><span class="line">        &#125;</span><br><span class="line">      );</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="11-Ajax-的实现"><a href="#11-Ajax-的实现" class="headerlink" title="11.Ajax 的实现"></a>11.Ajax 的实现</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">ajax</span>(<span class="params">url, method, body, headers</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> req = <span class="keyword">new</span> <span class="title class_">XMLHttpRequest</span>();</span><br><span class="line">    req.<span class="title function_">open</span>(methods, url);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> key <span class="keyword">in</span> headers) &#123;</span><br><span class="line">      req.<span class="title function_">setRequestHeader</span>(key, headers[key]);</span><br><span class="line">    &#125;</span><br><span class="line">    req.<span class="title function_">onreadystatechange</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (req.<span class="property">readystate</span> == <span class="number">4</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (req.<span class="property">status</span> &gt;= <span class="string">&quot;200&quot;</span> &amp;&amp; req.<span class="property">status</span> &lt;= <span class="number">300</span>) &#123;</span><br><span class="line">          <span class="title function_">resolve</span>(req.<span class="property">responeText</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="title function_">reject</span>(req);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    req.<span class="title function_">send</span>(body);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="12-实现防抖函数（debounce）"><a href="#12-实现防抖函数（debounce）" class="headerlink" title="12.实现防抖函数（debounce）"></a>12.实现防抖函数（debounce）</h3><ul>
<li>连续触发在最后一次执行方法，场景：输入框匹配</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="title function_">debounce</span> = (<span class="params">fn, time = <span class="number">1000</span></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">let</span> timeLock = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">function</span> (<span class="params">...args</span>) &#123;</span><br><span class="line">    <span class="built_in">clearTimeout</span>(timeLock);</span><br><span class="line">    timeLock = <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="title function_">fn</span>(...args);</span><br><span class="line">    &#125;, time);</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="13-实现节流函数（throttle）"><a href="#13-实现节流函数（throttle）" class="headerlink" title="13.实现节流函数（throttle）"></a>13.实现节流函数（throttle）</h3><ul>
<li>在一定时间内只触发一次，场景：长列表滚动节流</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="title function_">throttle</span> = (<span class="params">fn, time = <span class="number">1000</span></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">let</span> flag = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">function</span> (<span class="params">...args</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (flag) &#123;</span><br><span class="line">      flag = <span class="literal">false</span>;</span><br><span class="line">      <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        flag = <span class="literal">true</span>;</span><br><span class="line">        <span class="title function_">fn</span>(...args);</span><br><span class="line">      &#125;, time);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="14-深拷贝（deepclone）"><a href="#14-深拷贝（deepclone）" class="headerlink" title="14.深拷贝（deepclone）"></a>14.深拷贝（deepclone）</h3><ul>
<li>判断类型，正则和日期直接返回新对象</li>
<li>空或者非对象类型，直接返回原值</li>
<li>考虑循环引用，判断如果 hash 中含有直接返回 hash 中的值</li>
<li>新建一个相应的 new obj.constructor 加入 hash</li>
<li>遍历对象递归（普通 key 和 key 是 symbol 情况）</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">deepClone</span>(<span class="params">obj, hash = <span class="keyword">new</span> <span class="built_in">WeakMap</span>()</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (obj <span class="keyword">instanceof</span> <span class="title class_">RegExp</span>) <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">RegExp</span>(obj);</span><br><span class="line">  <span class="keyword">if</span> (obj <span class="keyword">instanceof</span> <span class="title class_">Date</span>) <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Date</span>(obj);</span><br><span class="line">  <span class="keyword">if</span> (obj === <span class="literal">null</span> || <span class="keyword">typeof</span> obj !== <span class="string">&quot;object&quot;</span>) <span class="keyword">return</span> obj;</span><br><span class="line">  <span class="comment">//循环引用的情况</span></span><br><span class="line">  <span class="keyword">if</span> (hash.<span class="title function_">has</span>(obj)) &#123;</span><br><span class="line">    <span class="keyword">return</span> hash.<span class="title function_">get</span>(obj);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//new 一个相应的对象</span></span><br><span class="line">  <span class="comment">//obj为Array，相当于new Array()</span></span><br><span class="line">  <span class="comment">//obj为Object，相当于new Object()</span></span><br><span class="line">  <span class="keyword">let</span> constr = <span class="keyword">new</span> obj.<span class="title function_">constructor</span>(<span class="params"></span>);</span><br><span class="line">  hash.<span class="title function_">set</span>(obj, constr);</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> key <span class="keyword">in</span> obj) &#123;</span><br><span class="line">    <span class="keyword">if</span> (obj.<span class="title function_">hasOwnProperty</span>(key)) &#123;</span><br><span class="line">      constr[key] = <span class="title function_">deepClone</span>(obj[key], hash);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//考虑symbol的情况</span></span><br><span class="line">  <span class="keyword">let</span> symbolObj = <span class="title class_">Object</span>.<span class="title function_">getOwnPropertySymbols</span>(obj);</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; symbolObj.<span class="property">length</span>; i++) &#123;</span><br><span class="line">    <span class="keyword">if</span> (obj.<span class="title function_">hasOwnProperty</span>(symbolObj[i])) &#123;</span><br><span class="line">      constr[symbolObj[i]] = <span class="title function_">deepClone</span>(obj[symbolObj[i]], hash);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> constr;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="15-数组扁平化的实现-flat"><a href="#15-数组扁平化的实现-flat" class="headerlink" title="15.数组扁平化的实现(flat)"></a>15.数组扁平化的实现(flat)</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> arr = [<span class="number">1</span>, <span class="number">2</span>, [<span class="number">3</span>, <span class="number">4</span>, [<span class="number">5</span>, [<span class="number">6</span>]]]];</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(arr.<span class="title function_">flat</span>(<span class="title class_">Infinity</span>)); <span class="comment">//flat参数为指定要提取嵌套数组的结构深度，默认值为 1</span></span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">//用reduce实现</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">fn</span>(<span class="params">arr</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> arr.<span class="title function_">reduce</span>(<span class="function">(<span class="params">prev, cur</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> prev.<span class="title function_">concat</span>(<span class="title class_">Array</span>.<span class="title function_">isArray</span>(cur) ? <span class="title function_">fn</span>(cur) : cur);</span><br><span class="line">  &#125;, []);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="16-函数柯里化"><a href="#16-函数柯里化" class="headerlink" title="16.函数柯里化"></a>16.函数柯里化</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">sumFn</span>(<span class="params">a, b, c</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> a + b + c;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> sum = <span class="title function_">curry</span>(sumFn);</span><br><span class="line"><span class="title function_">sum</span>(<span class="number">2</span>)(<span class="number">3</span>)(<span class="number">5</span>); <span class="comment">//10</span></span><br><span class="line"><span class="title function_">sum</span>(<span class="number">2</span>, <span class="number">3</span>)(<span class="number">5</span>); <span class="comment">//10</span></span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">curry</span>(<span class="params">fn, ...args</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> fnLen = fn.<span class="property">length</span>,</span><br><span class="line">    argsLen = args.<span class="property">length</span>;</span><br><span class="line">  <span class="comment">//对比函数的参数和当前传入参数</span></span><br><span class="line">  <span class="comment">//若参数不够就继续递归返回curry</span></span><br><span class="line">  <span class="comment">//若参数够就调用函数返回相应的值</span></span><br><span class="line">  <span class="keyword">if</span> (fnLen &gt; argsLen) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">function</span> (<span class="params">...arg2s</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="title function_">curry</span>(fn, ...args, ...arg2s);</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">fn</span>(...args);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="17-使用闭包实现每隔一秒打印-1-2-3-4"><a href="#17-使用闭包实现每隔一秒打印-1-2-3-4" class="headerlink" title="17.使用闭包实现每隔一秒打印 1,2,3,4"></a>17.使用闭包实现每隔一秒打印 1,2,3,4</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">1</span>; i &lt;= <span class="number">5</span>; i++) &#123;</span><br><span class="line">  (<span class="keyword">function</span> (<span class="params">i</span>) &#123;</span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(i), <span class="number">1000</span> * i);</span><br><span class="line">  &#125;)(i);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="18-手写一个-jsonp"><a href="#18-手写一个-jsonp" class="headerlink" title="18.手写一个 jsonp"></a>18.手写一个 jsonp</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> jsonp = <span class="keyword">function</span> (<span class="params">url, data</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 初始化url</span></span><br><span class="line">    <span class="keyword">let</span> dataString = url.<span class="title function_">indexOf</span>(<span class="string">&quot;?&quot;</span>) === -<span class="number">1</span> ? <span class="string">&quot;?&quot;</span> : <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="keyword">let</span> callbackName = <span class="string">`jsonpCB_<span class="subst">$&#123;<span class="built_in">Date</span>.now()&#125;</span>`</span>;</span><br><span class="line">    url += <span class="string">`<span class="subst">$&#123;dataString&#125;</span>callback=<span class="subst">$&#123;callbackName&#125;</span>`</span>;</span><br><span class="line">    <span class="keyword">if</span> (data) &#123;</span><br><span class="line">      <span class="comment">// 有请求参数，依次添加到url</span></span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">let</span> k <span class="keyword">in</span> data) &#123;</span><br><span class="line">        url += <span class="string">`<span class="subst">$&#123;k&#125;</span>=<span class="subst">$&#123;data[k]&#125;</span>`</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">let</span> jsNode = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&quot;script&quot;</span>);</span><br><span class="line">    jsNode.<span class="property">src</span> = url;</span><br><span class="line">    <span class="comment">// 触发callback，触发后删除js标签和绑定在window上的callback</span></span><br><span class="line">    <span class="variable language_">window</span>[callbackName] = <span class="function">(<span class="params">result</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">delete</span> <span class="variable language_">window</span>[callbackName];</span><br><span class="line">      <span class="variable language_">document</span>.<span class="property">body</span>.<span class="title function_">removeChild</span>(jsNode);</span><br><span class="line">      <span class="keyword">if</span> (result) &#123;</span><br><span class="line">        <span class="title function_">resolve</span>(result);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="title function_">reject</span>(<span class="string">&quot;没有返回数据&quot;</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="comment">// js加载异常的情况</span></span><br><span class="line">    jsNode.<span class="title function_">addEventListener</span>(</span><br><span class="line">      <span class="string">&quot;error&quot;</span>,</span><br><span class="line">      <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">delete</span> <span class="variable language_">window</span>[callbackName];</span><br><span class="line">        <span class="variable language_">document</span>.<span class="property">body</span>.<span class="title function_">removeChild</span>(jsNode);</span><br><span class="line">        <span class="title function_">reject</span>(<span class="string">&quot;JavaScript资源加载失败&quot;</span>);</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="literal">false</span></span><br><span class="line">    );</span><br><span class="line">    <span class="comment">// 添加js节点到document上时，开始请求</span></span><br><span class="line">    <span class="variable language_">document</span>.<span class="property">body</span>.<span class="title function_">appendChild</span>(jsNode);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"><span class="title function_">jsonp</span>(<span class="string">&quot;http://192.168.0.103:8081/jsonp&quot;</span>, &#123;</span><br><span class="line">  <span class="attr">a</span>: <span class="number">1</span>,</span><br><span class="line">  <span class="attr">b</span>: <span class="string">&quot;heiheihei&quot;</span>,</span><br><span class="line">&#125;)</span><br><span class="line">  .<span class="title function_">then</span>(<span class="function">(<span class="params">result</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(result);</span><br><span class="line">  &#125;)</span><br><span class="line">  .<span class="title function_">catch</span>(<span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">error</span>(err);</span><br><span class="line">  &#125;);</span><br></pre></td></tr></table></figure>

<h3 id="19-手写一个观察者模式"><a href="#19-手写一个观察者模式" class="headerlink" title="19.手写一个观察者模式"></a>19.手写一个观察者模式</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Subject</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">name</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">name</span> = name;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">observers</span> = [];</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">state</span> = <span class="string">&quot;XXXX&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 被观察者要提供一个接受观察者的方法</span></span><br><span class="line">  <span class="title function_">attach</span>(<span class="params">observer</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">observers</span>.<span class="title function_">push</span>(observer);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 改变被观察着的状态</span></span><br><span class="line">  <span class="title function_">setState</span>(<span class="params">newState</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">state</span> = newState;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">observers</span>.<span class="title function_">forEach</span>(<span class="function">(<span class="params">o</span>) =&gt;</span> &#123;</span><br><span class="line">      o.<span class="title function_">update</span>(newState);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Observer</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">name</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">name</span> = name;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">update</span>(<span class="params">newState</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.name&#125;</span>say:<span class="subst">$&#123;newState&#125;</span>`</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 被观察者 灯</span></span><br><span class="line"><span class="keyword">let</span> sub = <span class="keyword">new</span> <span class="title class_">Subject</span>(<span class="string">&quot;灯&quot;</span>);</span><br><span class="line"><span class="keyword">let</span> mm = <span class="keyword">new</span> <span class="title class_">Observer</span>(<span class="string">&quot;小明&quot;</span>);</span><br><span class="line"><span class="keyword">let</span> jj = <span class="keyword">new</span> <span class="title class_">Observer</span>(<span class="string">&quot;小健&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 订阅 观察者</span></span><br><span class="line">sub.<span class="title function_">attach</span>(mm);</span><br><span class="line">sub.<span class="title function_">attach</span>(jj);</span><br><span class="line"></span><br><span class="line">sub.<span class="title function_">setState</span>(<span class="string">&quot;灯亮了来电了&quot;</span>);</span><br></pre></td></tr></table></figure>

<h3 id="20-EventEmitter-实现"><a href="#20-EventEmitter-实现" class="headerlink" title="20.EventEmitter 实现"></a>20.EventEmitter 实现</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">EventEmitter</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">events</span> = &#123;&#125;;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">on</span>(<span class="params">event, callback</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> callbacks = <span class="variable language_">this</span>.<span class="property">events</span>[event] || [];</span><br><span class="line">    callbacks.<span class="title function_">push</span>(callback);</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">events</span>[event] = callbacks;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">off</span>(<span class="params">event, callback</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> callbacks = <span class="variable language_">this</span>.<span class="property">events</span>[event];</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">events</span>[event] = callbacks &amp;&amp; callbacks.<span class="title function_">filter</span>(<span class="function">(<span class="params">fn</span>) =&gt;</span> fn !== callback);</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">emit</span>(<span class="params">event, ...args</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> callbacks = <span class="variable language_">this</span>.<span class="property">events</span>[event];</span><br><span class="line">    callbacks.<span class="title function_">forEach</span>(<span class="function">(<span class="params">fn</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="title function_">fn</span>(...args);</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">once</span>(<span class="params">event, callback</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> wrapFun = <span class="keyword">function</span> (<span class="params">...args</span>) &#123;</span><br><span class="line">      <span class="title function_">callback</span>(...args);</span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">off</span>(event, wrapFun);</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">on</span>(event, wrapFun);</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="21-生成随机数的各种方法？"><a href="#21-生成随机数的各种方法？" class="headerlink" title="21.生成随机数的各种方法？"></a>21.生成随机数的各种方法？</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">getRandom</span>(<span class="params">min, max</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title class_">Math</span>.<span class="title function_">floor</span>(<span class="title class_">Math</span>.<span class="title function_">random</span>() * (max - min)) + min;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="22-如何实现数组的随机排序？"><a href="#22-如何实现数组的随机排序？" class="headerlink" title="22.如何实现数组的随机排序？"></a>22.如何实现数组的随机排序？</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> arr = [<span class="number">2</span>, <span class="number">3</span>, <span class="number">454</span>, <span class="number">34</span>, <span class="number">324</span>, <span class="number">32</span>];</span><br><span class="line">arr.<span class="title function_">sort</span>(randomSort);</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">randomSort</span>(<span class="params">a, b</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title class_">Math</span>.<span class="title function_">random</span>() &gt; <span class="number">0.5</span> ? -<span class="number">1</span> : <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="23-写一个通用的事件侦听器函数。"><a href="#23-写一个通用的事件侦听器函数。" class="headerlink" title="23.写一个通用的事件侦听器函数。"></a>23.写一个通用的事件侦听器函数。</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">EventUtils</span> = &#123;</span><br><span class="line">  <span class="comment">// 视能力分别使用dom0||dom2||IE方式 来绑定事件</span></span><br><span class="line">  <span class="comment">// 添加事件</span></span><br><span class="line">  <span class="attr">addEvent</span>: <span class="keyword">function</span> (<span class="params">element, type, handler</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (element.<span class="property">addEventListener</span>) &#123;</span><br><span class="line">      element.<span class="title function_">addEventListener</span>(type, handler, <span class="literal">false</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (element.<span class="property">attachEvent</span>) &#123;</span><br><span class="line">      element.<span class="title function_">attachEvent</span>(<span class="string">&quot;on&quot;</span> + type, handler);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      element[<span class="string">&quot;on&quot;</span> + type] = handler;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 移除事件</span></span><br><span class="line">  <span class="attr">removeEvent</span>: <span class="keyword">function</span> (<span class="params">element, type, handler</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (element.<span class="property">removeEventListener</span>) &#123;</span><br><span class="line">      element.<span class="title function_">removeEventListener</span>(type, handler, <span class="literal">false</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (element.<span class="property">detachEvent</span>) &#123;</span><br><span class="line">      element.<span class="title function_">detachEvent</span>(<span class="string">&quot;on&quot;</span> + type, handler);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      element[<span class="string">&quot;on&quot;</span> + type] = <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 获取事件目标</span></span><br><span class="line">  <span class="attr">getTarget</span>: <span class="keyword">function</span> (<span class="params">event</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> event.<span class="property">target</span> || event.<span class="property">srcElement</span>;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 获取 event 对象的引用，取到事件的所有信息，确保随时能使用 event</span></span><br><span class="line">  <span class="attr">getEvent</span>: <span class="keyword">function</span> (<span class="params">event</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> event || <span class="variable language_">window</span>.<span class="property">event</span>;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 阻止事件（主要是事件冒泡，因为 IE 不支持事件捕获）</span></span><br><span class="line">  <span class="attr">stopPropagation</span>: <span class="keyword">function</span> (<span class="params">event</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (event.<span class="property">stopPropagation</span>) &#123;</span><br><span class="line">      event.<span class="title function_">stopPropagation</span>();</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      event.<span class="property">cancelBubble</span> = <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 取消事件的默认行为</span></span><br><span class="line">  <span class="attr">preventDefault</span>: <span class="keyword">function</span> (<span class="params">event</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (event.<span class="property">preventDefault</span>) &#123;</span><br><span class="line">      event.<span class="title function_">preventDefault</span>();</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      event.<span class="property">returnValue</span> = <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="24-使用迭代的方式实现-flatten-函数。"><a href="#24-使用迭代的方式实现-flatten-函数。" class="headerlink" title="24.使用迭代的方式实现 flatten 函数。"></a>24.使用迭代的方式实现 flatten 函数。</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> arr = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, [<span class="number">4</span>, <span class="number">5</span>], [<span class="number">6</span>, [<span class="number">7</span>, [<span class="number">8</span>]]]];</span><br><span class="line"><span class="comment">/** * 使用递归的方式处理 * wrap 内保</span></span><br><span class="line"><span class="comment">存结果 ret * 返回一个递归函数 **/</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">wrap</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> ret = [];</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">function</span> <span class="title function_">flat</span>(<span class="params">a</span>) &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> item <span class="keyword">of</span> a) &#123;</span><br><span class="line">      <span class="keyword">if</span> (item.<span class="property">constructor</span> === <span class="title class_">Array</span>) &#123;</span><br><span class="line">        ret.<span class="title function_">concat</span>(<span class="title function_">flat</span>(item));</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        ret.<span class="title function_">push</span>(item);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">wrap</span>()(arr));</span><br></pre></td></tr></table></figure>

<h3 id="25-怎么实现一个-sleep"><a href="#25-怎么实现一个-sleep" class="headerlink" title="25.怎么实现一个 sleep"></a>25.怎么实现一个 sleep</h3><ul>
<li>sleep 函数作用是让线程休眠，等到指定时间在重新唤起。</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">sleep</span>(<span class="params">delay</span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> start = <span class="keyword">new</span> <span class="title class_">Date</span>().<span class="title function_">getTime</span>();</span><br><span class="line">  <span class="keyword">while</span> (<span class="keyword">new</span> <span class="title class_">Date</span>().<span class="title function_">getTime</span>() - start &lt; delay) &#123;</span><br><span class="line">    <span class="keyword">continue</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">test</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;111&quot;</span>);</span><br><span class="line">  <span class="title function_">sleep</span>(<span class="number">2000</span>);</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;222&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">test</span>();</span><br></pre></td></tr></table></figure>

<h3 id="26-实现正则切分千分位（10000-10-000）"><a href="#26-实现正则切分千分位（10000-10-000）" class="headerlink" title="26.实现正则切分千分位（10000 &#x3D;&gt; 10,000）"></a>26.实现正则切分千分位（10000 &#x3D;&gt; 10,000）</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">//无小数点</span></span><br><span class="line"><span class="keyword">let</span> num1 = <span class="string">&quot;1321434322222&quot;</span>;</span><br><span class="line">num1.<span class="title function_">replace</span>(<span class="regexp">/(\d)(?=(\d&#123;3&#125;)+$)/g</span>, <span class="string">&quot;$1,&quot;</span>);</span><br><span class="line"><span class="comment">//有小数点</span></span><br><span class="line"><span class="keyword">let</span> num2 = <span class="string">&quot;342243242322.3432423&quot;</span>;</span><br><span class="line">num2.<span class="title function_">replace</span>(<span class="regexp">/(\d)(?=(\d&#123;3&#125;)+\.)/g</span>, <span class="string">&quot;$1,&quot;</span>);</span><br></pre></td></tr></table></figure>

<h3 id="27-对象数组去重"><a href="#27-对象数组去重" class="headerlink" title="27.对象数组去重"></a>27.对象数组去重</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">输入: [</span><br><span class="line">  &#123; <span class="attr">a</span>: <span class="number">1</span>, <span class="attr">b</span>: <span class="number">2</span>, <span class="attr">c</span>: <span class="number">3</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">b</span>: <span class="number">2</span>, <span class="attr">c</span>: <span class="number">3</span>, <span class="attr">a</span>: <span class="number">1</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">d</span>: <span class="number">2</span>, <span class="attr">c</span>: <span class="number">2</span> &#125;,</span><br><span class="line">];</span><br><span class="line">输出: [</span><br><span class="line">  &#123; <span class="attr">a</span>: <span class="number">1</span>, <span class="attr">b</span>: <span class="number">2</span>, <span class="attr">c</span>: <span class="number">3</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">d</span>: <span class="number">2</span>, <span class="attr">c</span>: <span class="number">2</span> &#125;,</span><br><span class="line">];</span><br></pre></td></tr></table></figure>

<ul>
<li>首先写一个函数把对象中的 key 排序，然后再转成字符串</li>
<li>遍历数组利用 Set 将转为字符串后的对象去重</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">objSort</span>(<span class="params">obj</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> newObj = &#123;&#125;;</span><br><span class="line">  <span class="comment">//遍历对象，并将key进行排序</span></span><br><span class="line">  <span class="title class_">Object</span>.<span class="title function_">keys</span>(obj)</span><br><span class="line">    .<span class="title function_">sort</span>()</span><br><span class="line">    .<span class="title function_">map</span>(<span class="function">(<span class="params">key</span>) =&gt;</span> &#123;</span><br><span class="line">      newObj[key] = obj[key];</span><br><span class="line">    &#125;);</span><br><span class="line">  <span class="comment">//将排序好的数组转成字符串</span></span><br><span class="line">  <span class="keyword">return</span> <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(newObj);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">unique</span>(<span class="params">arr</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> set = <span class="keyword">new</span> <span class="title class_">Set</span>();</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; arr.<span class="property">length</span>; i++) &#123;</span><br><span class="line">    <span class="keyword">let</span> str = <span class="title function_">objSort</span>(arr[i]);</span><br><span class="line">    set.<span class="title function_">add</span>(str);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//将数组中的字符串转回对象</span></span><br><span class="line">  arr = [...set].<span class="title function_">map</span>(<span class="function">(<span class="params">item</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">JSON</span>.<span class="title function_">parse</span>(item);</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="keyword">return</span> arr;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="28-解析-URL-Params-为对象"><a href="#28-解析-URL-Params-为对象" class="headerlink" title="28.解析 URL Params 为对象"></a>28.解析 URL Params 为对象</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> url =</span><br><span class="line">  <span class="string">&quot;http://www.domain.com/?user=anonymous&amp;id=123&amp;id=456&amp;city=%E5%8C%97%E4%BA%AC&amp;enabled&quot;</span>;</span><br><span class="line"><span class="title function_">parseParam</span>(url);</span><br><span class="line"><span class="comment">/* 结果</span></span><br><span class="line"><span class="comment">&#123; user: &#x27;anonymous&#x27;,</span></span><br><span class="line"><span class="comment">  id: [ 123, 456 ], // 重复出现的 key 要组装成数组，能被转成数字的就转成数字类型</span></span><br><span class="line"><span class="comment">  city: &#x27;北京&#x27;, // 中文需解码</span></span><br><span class="line"><span class="comment">  enabled: true, // 未指定值得 key 约定为 true</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">parseParam</span>(<span class="params">url</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> paramsStr = <span class="regexp">/.+\?(.+)$/</span>.<span class="title function_">exec</span>(url)[<span class="number">1</span>]; <span class="comment">// 将 ? 后面的字符串取出来</span></span><br><span class="line">  <span class="keyword">const</span> paramsArr = paramsStr.<span class="title function_">split</span>(<span class="string">&quot;&amp;&quot;</span>); <span class="comment">// 将字符串以 &amp; 分割后存到数组中</span></span><br><span class="line">  <span class="keyword">let</span> paramsObj = &#123;&#125;;</span><br><span class="line">  <span class="comment">// 将 params 存到对象中</span></span><br><span class="line">  paramsArr.<span class="title function_">forEach</span>(<span class="function">(<span class="params">param</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="regexp">/=/</span>.<span class="title function_">test</span>(param)) &#123;</span><br><span class="line">      <span class="comment">// 处理有 value 的参数</span></span><br><span class="line">      <span class="keyword">let</span> [key, val] = param.<span class="title function_">split</span>(<span class="string">&quot;=&quot;</span>); <span class="comment">// 分割 key 和 value</span></span><br><span class="line">      val = <span class="built_in">decodeURIComponent</span>(val); <span class="comment">// 解码</span></span><br><span class="line">      val = <span class="regexp">/^\d+$/</span>.<span class="title function_">test</span>(val) ? <span class="built_in">parseFloat</span>(val) : val; <span class="comment">// 判断是否转为数字</span></span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (paramsObj.<span class="title function_">hasOwnProperty</span>(key)) &#123;</span><br><span class="line">        <span class="comment">// 如果对象有 key，则添加一个值</span></span><br><span class="line">        paramsObj[key] = [].<span class="title function_">concat</span>(paramsObj[key], val);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// 如果对象没有这个 key，创建 key 并设置值</span></span><br><span class="line">        paramsObj[key] = val;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">// 处理没有 value 的参数</span></span><br><span class="line">      paramsObj[param] = <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> paramsObj;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="29-模板引擎实现"><a href="#29-模板引擎实现" class="headerlink" title="29.模板引擎实现"></a>29.模板引擎实现</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> template = <span class="string">&quot;我是&#123;&#123;name&#125;&#125;，年龄&#123;&#123;age&#125;&#125;，性别&#123;&#123;sex&#125;&#125;&quot;</span>;</span><br><span class="line"><span class="keyword">let</span> data = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&quot;姓名&quot;</span>,</span><br><span class="line">  <span class="attr">age</span>: <span class="number">18</span>,</span><br><span class="line">&#125;;</span><br><span class="line"><span class="title function_">render</span>(template, data); <span class="comment">// 我是姓名，年龄18，性别undefined</span></span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">render</span>(<span class="params">template, data</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> reg = <span class="regexp">/\&#123;\&#123;(\w+)\&#125;\&#125;/</span>; <span class="comment">// 模板字符串正则</span></span><br><span class="line">  <span class="keyword">if</span> (reg.<span class="title function_">test</span>(template)) &#123;</span><br><span class="line">    <span class="comment">// 判断模板里是否有模板字符串</span></span><br><span class="line">    <span class="keyword">const</span> name = reg.<span class="title function_">exec</span>(template)[<span class="number">1</span>]; <span class="comment">// 查找当前模板里第一个模板字符串的字段</span></span><br><span class="line">    template = template.<span class="title function_">replace</span>(reg, data[name]); <span class="comment">// 将第一个模板字符串渲染</span></span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">render</span>(template, data); <span class="comment">// 递归的渲染并返回渲染后的结构</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> template; <span class="comment">// 如果模板没有模板字符串直接返回</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="30-转化为驼峰命名"><a href="#30-转化为驼峰命名" class="headerlink" title="30.转化为驼峰命名"></a>30.转化为驼峰命名</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> s1 = <span class="string">&quot;get-element-by-id&quot;</span>;</span><br><span class="line"><span class="comment">// 转化为 getElementById</span></span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> f = <span class="keyword">function</span> (<span class="params">s</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> s.<span class="title function_">replace</span>(<span class="regexp">/-\w/g</span>, <span class="keyword">function</span> (<span class="params">x</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> x.<span class="title function_">slice</span>(<span class="number">1</span>).<span class="title function_">toUpperCase</span>();</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="31-查找字符串中出现最多的字符和个数"><a href="#31-查找字符串中出现最多的字符和个数" class="headerlink" title="31.查找字符串中出现最多的字符和个数"></a>31.查找字符串中出现最多的字符和个数</h3><ul>
<li>例: abbcccddddd -&gt; 字符最多的是 d，出现了 5 次</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> str = <span class="string">&quot;abcabcabcbbccccc&quot;</span>;</span><br><span class="line"><span class="keyword">let</span> num = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">let</span> char = <span class="string">&quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使其按照一定的次序排列</span></span><br><span class="line">str = str.<span class="title function_">split</span>(<span class="string">&quot;&quot;</span>).<span class="title function_">sort</span>().<span class="title function_">join</span>(<span class="string">&quot;&quot;</span>);</span><br><span class="line"><span class="comment">// &quot;aaabbbbbcccccccc&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义正则表达式</span></span><br><span class="line"><span class="keyword">let</span> re = <span class="regexp">/(\w)\1+/g</span>;</span><br><span class="line">str.<span class="title function_">replace</span>(re, <span class="function">(<span class="params">$0, $1</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (num &lt; $0.<span class="property">length</span>) &#123;</span><br><span class="line">    num = $0.<span class="property">length</span>;</span><br><span class="line">    char = $1;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`字符最多的是<span class="subst">$&#123;char&#125;</span>，出现了<span class="subst">$&#123;num&#125;</span>次`</span>);</span><br></pre></td></tr></table></figure>

<h3 id="32-图片懒加载"><a href="#32-图片懒加载" class="headerlink" title="32.图片懒加载"></a>32.图片懒加载</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> imgList = [...<span class="variable language_">document</span>.<span class="title function_">querySelectorAll</span>(<span class="string">&quot;img&quot;</span>)];</span><br><span class="line"><span class="keyword">let</span> length = imgList.<span class="property">length</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> imgLazyLoad = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> count = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">return</span> (<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> deleteIndexList = [];</span><br><span class="line">    imgList.<span class="title function_">forEach</span>(<span class="function">(<span class="params">img, index</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">let</span> rect = img.<span class="title function_">getBoundingClientRect</span>();</span><br><span class="line">      <span class="keyword">if</span> (rect.<span class="property">top</span> &lt; <span class="variable language_">window</span>.<span class="property">innerHeight</span>) &#123;</span><br><span class="line">        img.<span class="property">src</span> = img.<span class="property">dataset</span>.<span class="property">src</span>;</span><br><span class="line">        deleteIndexList.<span class="title function_">push</span>(index);</span><br><span class="line">        count++;</span><br><span class="line">        <span class="keyword">if</span> (count === length) &#123;</span><br><span class="line">          <span class="variable language_">document</span>.<span class="title function_">removeEventListener</span>(<span class="string">&quot;scroll&quot;</span>, imgLazyLoad);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    imgList = imgList.<span class="title function_">filter</span>(<span class="function">(<span class="params">img, index</span>) =&gt;</span> !deleteIndexList.<span class="title function_">includes</span>(index));</span><br><span class="line">  &#125;)();</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 这里最好加上防抖处理</span></span><br><span class="line"><span class="variable language_">document</span>.<span class="title function_">addEventListener</span>(<span class="string">&quot;scroll&quot;</span>, imgLazyLoad);</span><br></pre></td></tr></table></figure>

<p>有些重复的，可做参考 ⭐ 。</p>
]]></content>
      <categories>
        <category>前端</category>
      </categories>
      <tags>
        <tag>JavaScript</tag>
        <tag>面试</tag>
      </tags>
  </entry>
  <entry>
    <title>Java类加载机制</title>
    <url>/test/post/%E8%B0%88%E8%B0%88Java%E7%B1%BB%E5%8A%A0%E8%BD%BD%E6%9C%BA%E5%88%B6/</url>
    <content><![CDATA[<h1 id="谈谈-Java-类加载机制"><a href="#谈谈-Java-类加载机制" class="headerlink" title="谈谈 Java 类加载机制"></a>谈谈 Java 类加载机制</h1><p>最近在学习 Tomcat 架构，其中很重要的一个模块是类加载器，因为以前学习的不够深入，所以趁这个机会好好把类加载机制搞明白。</p>
<!-- TOC -->

<ul>
<li><a href="#%E8%B0%88%E8%B0%88-java-%E7%B1%BB%E5%8A%A0%E8%BD%BD%E6%9C%BA%E5%88%B6">谈谈 Java 类加载机制</a><ul>
<li><a href="#overview">Overview</a></li>
<li><a href="#api-for-class-loading">API for class loading</a><ul>
<li><a href="#javalangclassloader"><code>java.lang.ClassLoader</code></a></li>
<li><a href="#javasecuritysecureclassloader"><code>java.security.SecureClassLoader</code></a></li>
<li><a href="#javaneturlclassloader"><code>java.net.URLClassLoader</code></a></li>
</ul>
</li>
<li><a href="#tomcat-8515-class-loading-mechanism">Tomcat 8.5.15 class loading Mechanism</a></li>
<li><a href="#reference">Reference</a></li>
</ul>
</li>
</ul>
<!-- /TOC -->

<hr>
<h2 id="Overview"><a href="#Overview" class="headerlink" title="Overview"></a>Overview</h2><p><img src="/test/../res/Class-loader.png"></p>
<p>类加载器主要分为两类，一类是 JDK 默认提供的，一类是用户自定义的。<br>JDK 默认提供三种类加载器</p>
<ol>
<li><code>Bootstrap ClassLoader</code>，启动类加载器，每次执行 <code>java</code> 命令时都会使用该加载器为虚拟机加载核心类。该加载器是由 <code>native code</code> 实现，而不是 Java 代码，加载类的路径为 <code>&lt;JAVA_HOME&gt;/jre/lib</code>。特别的 <code>&lt;JAVA_HOME&gt;/jre/lib/rt.jar</code> 中包含了 <code>sun.misc.Launcher</code> 类， 而 <code>sun.misc.Launcher$ExtClassLoader</code> 和 <code>sun.misc.Launcher$AppClassLoader</code> 都是 <code>sun.misc.Launcher</code> 的内部类，所以拓展类加载器和系统类加载器都是由启动类加载器加载的。</li>
<li><code>Extension ClassLoader</code>, 拓展类加载器，用于加载拓展库中的类。拓展库路径为 <code>&lt;JAVA_HOME&gt;/jre/lib/ext/</code>。实现类为 <code>sun.misc.Launcher$ExtClassLoader</code></li>
<li><code>System ClassLoader</code>, 系统类加载器。用于加载 CLASSPATH 中的类。实现类为 <code>sun.misc.Launcher$AppClassLoader</code></li>
</ol>
<p>用户自定义的类加载器</p>
<ol>
<li><code>Custom ClassLoader</code>, 一般都是 <code>java.lang.ClassLoder</code> 的子类</li>
</ol>
<p>正统的类加载机制是基于双亲委派的，也就是当调用类加载器加载类时，首先将加载任务委派给双亲，若双亲无法加载成功时，自己才进行类加载。</p>
<p>在实例化一个新的类加载器时，我们可以为其指定一个 <code>parent</code>，即双亲，若未显式指定，则 <code>System ClassLoader</code> 就作为默认双亲。</p>
<p>具体的说，类加载任务是由 <code>ClassLoader</code> 的 <code>loadClass()</code> 方法来执行的，他会按照以下顺序加载类：</p>
<ol>
<li>通过 <code>findLoadedClass()</code> 看该类是否已经被加载。该方法为 native code 实现，若已加载则返回。</li>
<li>若未加载则委派给双亲，<code>parent.loadClass()</code>，若成功则返回</li>
<li>若未成功，则调用 <code>findClass()</code> 方法加载类。<code>java.lang.ClassLoader</code> 中该方法只是简单的抛出一个 <code>ClassNotFoundException</code> 所以，自定义的 ClassLoader 都需要 Override <code>findClass()</code> 方法</li>
</ol>
<h2 id="API-for-class-loading"><a href="#API-for-class-loading" class="headerlink" title="API for class loading"></a>API for class loading</h2><h3 id="java-lang-ClassLoader"><a href="#java-lang-ClassLoader" class="headerlink" title="java.lang.ClassLoader"></a><code>java.lang.ClassLoader</code></h3><ul>
<li><code>ClassLoader</code> 是一个抽象类。</li>
<li>待加载的类必须用 <code>The Java™ Language Specification</code> 定义的全类名，全类名的定义请查阅 <a href="https://docs.oracle.com/javase/specs/jls/se8/html/jls-13.html#jls-13.1">The Form of a Binary</a>。</li>
<li>给定一个全类名，类加载器应该去定位该类所在的位置。通用的策略是将全类名转换为类文件路径，然后通过类文件路径在文件系统中定位。</li>
<li>每一个加载到内存的类都由一个 Class 对象来表示，每一个 Class 对象都有一个指向加载该类的类加载器的引用。但是数组的 Class 对象是由 Java 运行时环境创建的，通过 <code>Class.getClassLoader()</code> 方法返回的是数组元素的类加载器，若数组元素是基本类型，则返回 <code>null</code>，若类是由 <code>Bootstrap ClassLoader</code> 加载的话也是返回 <code>null</code>  <figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// Object 类在 &lt;java_home&gt;/jre/lib/rt.jar 中，</span></span><br><span class="line">        <span class="comment">// 由 Bootstrap ClassLoader 加载，由于该类加载器是由 native code 编写</span></span><br><span class="line">        <span class="comment">// 所以输出为 null</span></span><br><span class="line">        Object[] objects = <span class="keyword">new</span> <span class="title class_">Object</span>[<span class="number">5</span>];</span><br><span class="line">        System.out.println();</span><br><span class="line">        System.out.println(objects.getClass().getClassLoader());</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ZipFileAttributes 类在 &lt;java_home&gt;/jre/lib/ext/zipfs.jar 中，</span></span><br><span class="line">        <span class="comment">// 由 Extension ClassLoader 加载，</span></span><br><span class="line">        <span class="comment">// 输出为  sun.misc.Launcher$ExtClassLoader@4b67cf4d</span></span><br><span class="line">        ZipFileAttributes[] attributes = <span class="keyword">new</span> <span class="title class_">ZipFileAttributes</span>[<span class="number">5</span>];</span><br><span class="line">        System.out.println();</span><br><span class="line">        System.out.println(attributes.getClass().getClassLoader());</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Main 类是自定义的类，</span></span><br><span class="line">        <span class="comment">// 默认由 System ClassLoader 加载，</span></span><br><span class="line">        <span class="comment">// 输出为 sun.misc.Launcher$AppClassLoader@18b4aac2</span></span><br><span class="line">        Main[] array = <span class="keyword">new</span> <span class="title class_">Main</span>[<span class="number">5</span>];</span><br><span class="line">        array[<span class="number">0</span>] = <span class="keyword">new</span> <span class="title class_">Main</span>();</span><br><span class="line">        System.out.println();</span><br><span class="line">        System.out.println(array.getClass().getClassLoader());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><code>ClassLoader</code> 默认支持并行加载，但是其子类必须调用 <code>ClassLoader.registerAsParallelCapable()</code> 来启用并行加载</li>
<li>一般来说,JVM 从本地文件系统加载类的行为是与平台有关的。</li>
<li><code>defineClass()</code> 方法可以将字节流转换成一个 <code>Class</code> 对象。然后调用 <code>Class.newInstance()</code> 来创建类的实例</li>
</ul>
<h3 id="java-security-SecureClassLoader"><a href="#java-security-SecureClassLoader" class="headerlink" title="java.security.SecureClassLoader"></a><code>java.security.SecureClassLoader</code></h3><p>增加了一层权限验证，因为关注点不在安全，所以暂不讨论。</p>
<h3 id="java-net-URLClassLoader"><a href="#java-net-URLClassLoader" class="headerlink" title="java.net.URLClassLoader"></a><code>java.net.URLClassLoader</code></h3><p>该类加载器用来加载 URL 指定的 JAR 文件或目录中的类和资源，以 <code>/</code> 结尾的 URL 认为是目录，否则认为是 JAR 文件。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 尝试通过 URLClassLoader 来加载桌面下的 Test 类。</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            URL[] urls = <span class="keyword">new</span> <span class="title class_">URL</span>[<span class="number">1</span>];</span><br><span class="line">            <span class="type">URLStreamHandler</span> <span class="variable">streamHandler</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">            <span class="type">File</span> <span class="variable">classPath</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;/home/chen/Desktop/&quot;</span>);</span><br><span class="line">            <span class="type">String</span> <span class="variable">repository</span> <span class="operator">=</span> (<span class="keyword">new</span> <span class="title class_">URL</span>(<span class="string">&quot;file&quot;</span>, <span class="literal">null</span>,</span><br><span class="line">                    classPath.getCanonicalPath() + File.separator))</span><br><span class="line">                    .toString();</span><br><span class="line">            urls[<span class="number">0</span>] = <span class="keyword">new</span> <span class="title class_">URL</span>(<span class="literal">null</span>, repository, streamHandler);</span><br><span class="line"></span><br><span class="line">            <span class="type">ClassLoader</span> <span class="variable">loader</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">URLClassLoader</span>(urls);</span><br><span class="line"></span><br><span class="line">            <span class="type">Class</span> <span class="variable">testClass</span> <span class="operator">=</span> loader.loadClass(<span class="string">&quot;Test&quot;</span>);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// output:  java.net.URLClassLoader@7f31245a</span></span><br><span class="line">            System.out.println(testClass.getClassLoader());</span><br><span class="line">        &#125; <span class="keyword">catch</span> (MalformedURLException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Tomcat-8-5-15-class-loading-Mechanism"><a href="#Tomcat-8-5-15-class-loading-Mechanism" class="headerlink" title="Tomcat 8.5.15 class loading Mechanism"></a>Tomcat 8.5.15 class loading Mechanism</h2><p><img src="/test/../res/tomcat-classloader.png"></p>
<p>Tomcat 使用正统的类加载机制(双亲委派),但部分地方做了改动。</p>
<ul>
<li><p><code>Bootstrap classLoader</code> 和 <code>Extension classLoader</code> 的作用不变</p>
</li>
<li><p><code>System classLoader</code> 正常情况下加载的是 <code>CLASSPATH</code> 下的类，但是 Tomcat 的启动脚本并未使用该变量，而是从以下仓库下加载类：</p>
<ol>
<li><code>$CATALINA_HOME/bin/bootstrap.jar</code> 包含了 Tomcat 的启动类。在该启动类中创建了 <code>Common classLoader</code>、<code>Catalina classLoader</code>、<code>shared classLoader</code>。因为 <code>$CATALINA_BASE/conf/catalina.properties</code> 中只对 <code>common.loader</code> 属性做了定义，<code>server.loader</code> 和 <code>shared.loader</code> 属性为空，所以默认情况下，这三个 classLoader 都是 <code>CommonLoader</code>。具体的代码逻辑可以查阅 <code>org.apache.catalina.startup.Bootstrap</code> 类的 <code>initClassLoaders()</code> 方法和 <code>createClassLoader()</code> 方法。</li>
<li><code>$CATALINA_BASE/bin/tomcat-juli.jar</code> 包含了 Tomcat 日志模块所需要的实现类</li>
<li><code>$CATALINA_HOME/bin/commons-daemon.jar</code></li>
</ol>
</li>
<li><p><code>Common classLoader</code> 是位于 Tomcat 应用服务器顶层的公用类加载器。由其加载的类可以由 Tomcat 自身类和所有应用程序使用。扫描路径由 <code>$CATALINA_BASE/conf/catalina.properties</code> 文件中的 <code>common.loader</code> 属性定义。默认是 <code>$CATALINA_HOME/lib</code>.</p>
</li>
<li><p><code>catalina classLoader</code> 用于加载服务器内部可见类，这些类应用程序不能访问。</p>
</li>
<li><p><code>shared classLoader</code> 用于加载应用程序共享类，这些类服务器不会依赖。</p>
</li>
<li><p><code>Webapp classLoader</code> 。每个应用程序都会有一个独一无二的 <code>webapp classloader</code>，他用来加载本应用程序 <code>/WEB-INF/classes</code> 和 <code>/WEB-INF/lib</code> 下的类。</p>
</li>
</ul>
<p>特别的：</p>
<p><code>Webapp classLoader</code> 的默认行为会与正常的双亲委派模式不同：</p>
<ol>
<li>从 <code>Bootstrap classloader</code> 加载</li>
<li>若没有，从 <code>/WEB-INF/classes</code> 加载</li>
<li>若没有，从 <code>/WEB-INF/lib/*.jar</code> 加载</li>
<li>若没有，则依次从 <code>System</code>、<code>Common</code>、<code>shared</code> 加载（该步骤使用双亲委派）</li>
</ol>
<p>当然了，我们也可以通过配置来使 <code>Webapp classLoader</code> 严格按照双亲委派模式加载类：</p>
<ol>
<li>通过在工程的 <code>META-INF/context.xml</code>（和 <code>WEB-INF/classes</code> 在同一目录下） 配置文件中添加 <code>&lt;Loader delegate=&quot;true&quot;/&gt;</code></li>
<li>因为 <code>Webapp classLoader</code> 的实现类是 <code>org.apache.catalina.loader.WebappLoader</code>，他有一个属性叫 <code>delegate</code>， 用来控制类加载器的加载行为，默认为 <code>false</code>，我们可以使用 <code>set</code> 方法，将其设为 <code>true</code> 来启用严格双亲委派加载模式。</li>
</ol>
<p>严格双亲委派模式加载步骤：</p>
<ol>
<li>从 <code>Bootstrap classloader</code> 加载</li>
<li>若没有，则依次从 <code>System</code>、<code>Common</code>、<code>shared</code> 加载</li>
<li>若没有，从 <code>/WEB-INF/classes</code> 加载</li>
<li>若没有，从 <code>/WEB-INF/lib/*.jar</code> 加载</li>
</ol>
<h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><ol>
<li><a href="https://docs.oracle.com/javase/tutorial/ext/basics/load.html">The Java Class Loading Mechanism</a></li>
<li><a href="https://en.wikipedia.org/wiki/Java_Classloader">Java Classloader</a></li>
<li><a href="https://tomcat.apache.org/tomcat-8.5-doc/class-loader-howto.html">Class Loader HOW-TO - Apache Tomcat 8</a></li>
<li><a href="">《Tomcat 架构解析》</a></li>
<li><a href="">《深入理解 Java 虚拟机》</a></li>
</ol>
]]></content>
      <categories>
        <category>Java</category>
      </categories>
      <tags>
        <tag>Java</tag>
      </tags>
  </entry>
  <entry>
    <title>手摸手教你撸一个脚手架</title>
    <url>/test/post/%E6%89%8B%E6%91%B8%E6%89%8B%E6%95%99%E4%BD%A0%E6%92%B8%E4%B8%80%E4%B8%AA%E8%84%9A%E6%89%8B%E6%9E%B6/</url>
    <content><![CDATA[<h2 id="脚手架"><a href="#脚手架" class="headerlink" title="脚手架"></a>脚手架</h2><p>vue-cli, create-react-app、react-native-cli 等都是非常优秀的脚手架，通过脚手架，我们可以快速初始化一个项目，无需自己从零开始一步步配置，有效提升开发体验。尽管这些脚手架非常优秀，但是未必是符合我们的实际应用的，我们可以定制一个属于自己的脚手架(或公司通用脚手架)，来提升自己的开发效率。</p>
<blockquote>
<p>脚手架的作用</p>
</blockquote>
<ul>
<li>减少重复性的工作，不需要复制其他项目再删除无关代码，或者从零创建一个项目和文件。</li>
<li>可以根据交互动态生成项目结构和配置文件。</li>
<li>多人协作更为方便，不需要把文件传来传去。</li>
</ul>
<h2 id="实现的功能"><a href="#实现的功能" class="headerlink" title="实现的功能"></a>实现的功能</h2><p>在开始之前，我们需要明确自己的脚手架需要哪些功能。vue init template-name project-name 、create-react-app project-name。我们这次编写的脚手架(eos-cli)具备以下能力(脚手架的名字爱叫啥叫啥，随便写):</p>
<ul>
<li>eos init template-name project-name 根据远程模板，初始化一个项目(远程模板可配置)</li>
<li>eos config set <key> <value> 修改配置信息</li>
<li>eos config get [<key>] 查看配置信息</li>
<li>eos –version 查看当前版本号</li>
<li>eos -h</li>
</ul>
<p>大家可以自行扩展其它的 commander，本篇文章旨在教大家如何实现一个脚手架。</p>
<p>本项目完整代码请戳: <a href="https://github.com/ytking/eos-cli">https://github.com/ytking/eos-cli</a></p>
<p>或</p>
<p>本项目完整代码请戳: <a href="https://github.com/ytking/yang-cli">https://github.com/ytking/yang-cli</a></p>
<h2 id="需要使用的第三方库"><a href="#需要使用的第三方库" class="headerlink" title="需要使用的第三方库"></a>需要使用的第三方库</h2><ul>
<li>babel-cli&#x2F;babel-env: 语法转换</li>
<li>commander: 命令行工具</li>
<li>download-git-repo: 用来下载远程模板</li>
<li>ini: 格式转换</li>
<li>inquirer: 交互式命令行工具</li>
<li>ora: 显示loading动画</li>
<li>chalk: 修改控制台输出内容样式</li>
<li>log-symbols: 显示出 √ 或 × 等的图标</li>
</ul>
<p>关于这些第三方库的说明，可以直接npm上查看相应的说明，此处不一一展开。</p>
<h2 id="初始化项目"><a href="#初始化项目" class="headerlink" title="初始化项目"></a>初始化项目</h2><p>创建一个空项目(eos-cli)，使用 npm init 进行初始化。</p>
<p><strong>安装依赖</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">npm install babel-cli babel-env chalk commander download-git-repo ini inquirer log-symbols ora</span><br></pre></td></tr></table></figure>
<p><strong>目录结构</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">├── bin</span><br><span class="line">│   └── www             //可执行文件</span><br><span class="line">├── dist</span><br><span class="line">    ├── ...             //生成文件</span><br><span class="line">└── src</span><br><span class="line">    ├── config.js       //管理eos配置文件</span><br><span class="line">    ├── index.js        //主流程入口文件</span><br><span class="line">    ├── init.js         //init command</span><br><span class="line">    ├── main.js         //入口文件</span><br><span class="line">    └── utils</span><br><span class="line">        ├── constants.js //定义常量</span><br><span class="line">        ├── get.js       //获取模板</span><br><span class="line">        └── rc.js        //配置文件</span><br><span class="line">├── .babelrc             //babel配置文件</span><br><span class="line">├── package.json</span><br><span class="line">├── README.md</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><strong>babel 配置</strong></p>
<p>开发使用了ES6语法，使用 babel 进行转义，</p>
<blockquote>
<p>.bablerc</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;presets&quot;: [</span><br><span class="line">        [</span><br><span class="line">            &quot;env&quot;,</span><br><span class="line">            &#123;</span><br><span class="line">                &quot;targets&quot;: &#123;</span><br><span class="line">                    &quot;node&quot;: &quot;current&quot;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>eos 命令</strong></p>
<p>node.js 内置了对命令行操作的支持，package.json 中的 bin 字段可以定义命令名和关联的执行文件。在 package.json 中添加 bin 字段</p>
<blockquote>
<p>package.json</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;name&quot;</span>: <span class="string">&quot;eos-cli&quot;</span>,</span><br><span class="line">    <span class="string">&quot;version&quot;</span>: <span class="string">&quot;1.0.0&quot;</span>,</span><br><span class="line">    <span class="string">&quot;description&quot;</span>: <span class="string">&quot;脚手架&quot;</span>,</span><br><span class="line">    <span class="string">&quot;main&quot;</span>: <span class="string">&quot;index.js&quot;</span>,</span><br><span class="line">    <span class="string">&quot;bin&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;eos&quot;</span>: <span class="string">&quot;./bin/www&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">&quot;scripts&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;compile&quot;</span>: <span class="string">&quot;babel src -d dist&quot;</span>,</span><br><span class="line">        <span class="string">&quot;watch&quot;</span>: <span class="string">&quot;npm run compile -- --watch&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>www 文件</p>
</blockquote>
<p>行首加入一行 #!&#x2F;usr&#x2F;bin&#x2F;env node 指定当前脚本由node.js进行解析</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="meta">#! /usr/bin/env node</span></span><br><span class="line"><span class="built_in">require</span>(<span class="string">&#x27;../dist/main.js&#x27;</span>);</span><br></pre></td></tr></table></figure>
<p><strong>链接到全局环境</strong></p>
<p>开发过程中为了方便调试，在当前的 eos-cli 目录下执行 npm link，将 eos 命令链接到全局环境。</p>
<p><strong>启动项目</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">npm run watch</span><br></pre></td></tr></table></figure>
<h2 id="处理命令行"><a href="#处理命令行" class="headerlink" title="处理命令行"></a>处理命令行</h2><p>利用 commander 来处理命令行。</p>
<p>main</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> program <span class="keyword">from</span> <span class="string">&#x27;commander&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="variable constant_">VERSION</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;./utils/constants&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> apply <span class="keyword">from</span> <span class="string">&#x27;./index&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> chalk <span class="keyword">from</span> <span class="string">&#x27;chalk&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * eos commands</span></span><br><span class="line"><span class="comment"> *    - config</span></span><br><span class="line"><span class="comment"> *    - init </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> actionMap = &#123;</span><br><span class="line">    <span class="attr">init</span>: &#123;</span><br><span class="line">        <span class="attr">description</span>: <span class="string">&#x27;generate a new project from a template&#x27;</span>,</span><br><span class="line">        <span class="attr">usages</span>: [</span><br><span class="line">            <span class="string">&#x27;eos init templateName projectName&#x27;</span></span><br><span class="line">        ]</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">config</span>: &#123;</span><br><span class="line">        <span class="attr">alias</span>: <span class="string">&#x27;cfg&#x27;</span>,</span><br><span class="line">        <span class="attr">description</span>: <span class="string">&#x27;config .eosrc&#x27;</span>,</span><br><span class="line">        <span class="attr">usages</span>: [</span><br><span class="line">            <span class="string">&#x27;eos config set &lt;k&gt; &lt;v&gt;&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;eos config get &lt;k&gt;&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;eos config remove &lt;k&gt;&#x27;</span></span><br><span class="line">        ]</span><br><span class="line">        </span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">//other commands</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 添加 init / config 命令</span></span><br><span class="line"><span class="title class_">Object</span>.<span class="title function_">keys</span>(actionMap).<span class="title function_">forEach</span>(<span class="function">(<span class="params">action</span>) =&gt;</span> &#123;</span><br><span class="line">    program.<span class="title function_">command</span>(action)</span><br><span class="line">    .<span class="title function_">description</span>(actionMap[action].<span class="property">description</span>)</span><br><span class="line">    .<span class="title function_">alias</span>(actionMap[action].<span class="property">alias</span>) <span class="comment">//别名</span></span><br><span class="line">    .<span class="title function_">action</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">switch</span> (action) &#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;config&#x27;</span>: </span><br><span class="line">                <span class="comment">//配置</span></span><br><span class="line">                <span class="title function_">apply</span>(action, ...process.<span class="property">argv</span>.<span class="title function_">slice</span>(<span class="number">3</span>));</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;init&#x27;</span>:</span><br><span class="line">                <span class="title function_">apply</span>(action, ...process.<span class="property">argv</span>.<span class="title function_">slice</span>(<span class="number">3</span>));</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="attr">default</span>:</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">help</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;\r\nUsage:&#x27;</span>);</span><br><span class="line">    <span class="title class_">Object</span>.<span class="title function_">keys</span>(actionMap).<span class="title function_">forEach</span>(<span class="function">(<span class="params">action</span>) =&gt;</span> &#123;</span><br><span class="line">        actionMap[action].<span class="property">usages</span>.<span class="title function_">forEach</span>(<span class="function"><span class="params">usage</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;  - &#x27;</span> + usage);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;\r&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line">program.<span class="title function_">usage</span>(<span class="string">&#x27;&lt;command&gt; [options]&#x27;</span>);</span><br><span class="line"><span class="comment">// eos -h </span></span><br><span class="line">program.<span class="title function_">on</span>(<span class="string">&#x27;-h&#x27;</span>, help);</span><br><span class="line">program.<span class="title function_">on</span>(<span class="string">&#x27;--help&#x27;</span>, help);</span><br><span class="line"><span class="comment">// eos -V   VERSION 为 package.json 中的版本号</span></span><br><span class="line">program.<span class="title function_">version</span>(<span class="variable constant_">VERSION</span>, <span class="string">&#x27;-V --version&#x27;</span>).<span class="title function_">parse</span>(process.<span class="property">argv</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// eos 不带参数时</span></span><br><span class="line"><span class="keyword">if</span> (!process.<span class="property">argv</span>.<span class="title function_">slice</span>(<span class="number">2</span>).<span class="property">length</span>) &#123;</span><br><span class="line">    program.<span class="title function_">outputHelp</span>(make_green);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">make_green</span>(<span class="params">txt</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> chalk.<span class="title function_">green</span>(txt); </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="下载模板"><a href="#下载模板" class="headerlink" title="下载模板"></a>下载模板</h2><p>download-git-repo 支持从 Github、Gitlab 下载远程仓库到本地。</p>
<blockquote>
<p>get.js</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; getAll &#125; <span class="keyword">from</span> <span class="string">&#x27;./rc&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> downloadGit <span class="keyword">from</span> <span class="string">&#x27;download-git-repo&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">downloadLocal</span> = <span class="keyword">async</span> (<span class="params">templateName, projectName</span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">let</span> config = <span class="keyword">await</span> <span class="title function_">getAll</span>();</span><br><span class="line">    <span class="keyword">let</span> api = <span class="string">`<span class="subst">$&#123;config.registry&#125;</span>/<span class="subst">$&#123;templateName&#125;</span>`</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">//projectName 为下载到的本地目录</span></span><br><span class="line">        <span class="title function_">downloadGit</span>(api, projectName, <span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (err) &#123;</span><br><span class="line">                <span class="title function_">reject</span>(err);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="title function_">resolve</span>();</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="init-命令"><a href="#init-命令" class="headerlink" title="init 命令"></a>init 命令</h2><p><strong>命令行交互</strong></p>
<p>在用户执行 init 命令后，向用户提出问题，接收用户的输入并作出相应的处理。命令行交互利用 inquirer 来实现:</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">inquirer.<span class="title function_">prompt</span>([</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">name</span>: <span class="string">&#x27;description&#x27;</span>,</span><br><span class="line">        <span class="attr">message</span>: <span class="string">&#x27;Please enter the project description: &#x27;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">name</span>: <span class="string">&#x27;author&#x27;</span>,</span><br><span class="line">        <span class="attr">message</span>: <span class="string">&#x27;Please enter the author name: &#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">]).<span class="title function_">then</span>(<span class="function">(<span class="params">answer</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p><strong>视觉美化</strong></p>
<p>在用户输入之后，开始下载模板，这时候使用 ora 来提示用户正在下载模板，下载结束之后，也给出提示。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> ora <span class="keyword">from</span> <span class="string">&#x27;ora&#x27;</span>;</span><br><span class="line"><span class="keyword">let</span> loading = <span class="title function_">ora</span>(<span class="string">&#x27;downloading template ...&#x27;</span>);</span><br><span class="line">loading.<span class="title function_">start</span>();</span><br><span class="line"><span class="comment">//download</span></span><br><span class="line">loading.<span class="title function_">succeed</span>(); <span class="comment">//或 loading.fail();</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>init.js</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; downloadLocal &#125; <span class="keyword">from</span> <span class="string">&#x27;./utils/get&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> ora <span class="keyword">from</span> <span class="string">&#x27;ora&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> inquirer <span class="keyword">from</span> <span class="string">&#x27;inquirer&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> fs <span class="keyword">from</span> <span class="string">&#x27;fs&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> chalk <span class="keyword">from</span> <span class="string">&#x27;chalk&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> symbol <span class="keyword">from</span> <span class="string">&#x27;log-symbols&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="title function_">init</span> = <span class="keyword">async</span> (<span class="params">templateName, projectName</span>) =&gt; &#123;</span><br><span class="line">    <span class="comment">//项目不存在</span></span><br><span class="line">    <span class="keyword">if</span> (!fs.<span class="title function_">existsSync</span>(projectName)) &#123;</span><br><span class="line">        <span class="comment">//命令行交互</span></span><br><span class="line">        inquirer.<span class="title function_">prompt</span>([</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">name</span>: <span class="string">&#x27;description&#x27;</span>,</span><br><span class="line">                <span class="attr">message</span>: <span class="string">&#x27;Please enter the project description: &#x27;</span></span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">name</span>: <span class="string">&#x27;author&#x27;</span>,</span><br><span class="line">                <span class="attr">message</span>: <span class="string">&#x27;Please enter the author name: &#x27;</span></span><br><span class="line">            &#125;</span><br><span class="line">        ]).<span class="title function_">then</span>(<span class="keyword">async</span> (answer) =&gt; &#123;</span><br><span class="line">            <span class="comment">//下载模板 选择模板</span></span><br><span class="line">            <span class="comment">//通过配置文件，获取模板信息</span></span><br><span class="line">            <span class="keyword">let</span> loading = <span class="title function_">ora</span>(<span class="string">&#x27;downloading template ...&#x27;</span>);</span><br><span class="line">            loading.<span class="title function_">start</span>();</span><br><span class="line">            <span class="title function_">downloadLocal</span>(templateName, projectName).<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                loading.<span class="title function_">succeed</span>();</span><br><span class="line">                <span class="keyword">const</span> fileName = <span class="string">`<span class="subst">$&#123;projectName&#125;</span>/package.json`</span>;</span><br><span class="line">                <span class="keyword">if</span>(fs.<span class="title function_">existsSync</span>(fileName))&#123;</span><br><span class="line">                    <span class="keyword">const</span> data = fs.<span class="title function_">readFileSync</span>(fileName).<span class="title function_">toString</span>();</span><br><span class="line">                    <span class="keyword">let</span> json = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(data);</span><br><span class="line">                    json.<span class="property">name</span> = projectName;</span><br><span class="line">                    json.<span class="property">author</span> = answer.<span class="property">author</span>;</span><br><span class="line">                    json.<span class="property">description</span> = answer.<span class="property">description</span>;</span><br><span class="line">                    <span class="comment">//修改项目文件夹中 package.json 文件</span></span><br><span class="line">                    fs.<span class="title function_">writeFileSync</span>(fileName, <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(json, <span class="literal">null</span>, <span class="string">&#x27;\t&#x27;</span>), <span class="string">&#x27;utf-8&#x27;</span>);</span><br><span class="line">                    <span class="variable language_">console</span>.<span class="title function_">log</span>(symbol.<span class="property">success</span>, chalk.<span class="title function_">green</span>(<span class="string">&#x27;Project initialization finished!&#x27;</span>));</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">                loading.<span class="title function_">fail</span>();</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">//项目已经存在</span></span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(symbol.<span class="property">error</span>, chalk.<span class="title function_">red</span>(<span class="string">&#x27;The project already exists&#x27;</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = init;</span><br></pre></td></tr></table></figure>
<h2 id="config-配置"><a href="#config-配置" class="headerlink" title="config 配置"></a>config 配置</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">eos config set registry vuejs-templates</span><br></pre></td></tr></table></figure>
<p>config 配置，支持我们使用其它仓库的模板，例如，我们可以使用 vuejs-templates 中的仓库作为模板。这样有一个好处：更新模板无需重新发布脚手架，使用者无需重新安装，并且可以自由选择下载目标。</p>
<blockquote>
<p>config.js</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 管理 .eosrc 文件 (当前用户目录下)</span></span><br><span class="line"><span class="keyword">import</span> &#123; get, set, getAll, remove &#125; <span class="keyword">from</span> <span class="string">&#x27;./utils/rc&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="title function_">config</span> = <span class="keyword">async</span> (<span class="params">action, key, value</span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">switch</span> (action) &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;get&#x27;</span>:</span><br><span class="line">            <span class="keyword">if</span> (key) &#123;</span><br><span class="line">                <span class="keyword">let</span> result = <span class="keyword">await</span> <span class="title function_">get</span>(key);</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(result);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">let</span> obj = <span class="keyword">await</span> <span class="title function_">getAll</span>();</span><br><span class="line">                <span class="title class_">Object</span>.<span class="title function_">keys</span>(obj).<span class="title function_">forEach</span>(<span class="function"><span class="params">key</span> =&gt;</span> &#123;</span><br><span class="line">                    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`<span class="subst">$&#123;key&#125;</span>=<span class="subst">$&#123;obj[key]&#125;</span>`</span>);</span><br><span class="line">                &#125;)</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;set&#x27;</span>:</span><br><span class="line">            <span class="title function_">set</span>(key, value);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;remove&#x27;</span>:</span><br><span class="line">            <span class="title function_">remove</span>(key);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="attr">default</span>:</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = config;</span><br></pre></td></tr></table></figure>
<p>?rc.js</p>
<p>.eosrc 文件的增删改查</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="variable constant_">RC</span>, <span class="variable constant_">DEFAULTS</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;./constants&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; decode, encode &#125; <span class="keyword">from</span> <span class="string">&#x27;ini&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; promisify &#125; <span class="keyword">from</span> <span class="string">&#x27;util&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> chalk <span class="keyword">from</span> <span class="string">&#x27;chalk&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> fs <span class="keyword">from</span> <span class="string">&#x27;fs&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> exits = <span class="title function_">promisify</span>(fs.<span class="property">exists</span>);</span><br><span class="line"><span class="keyword">const</span> readFile = <span class="title function_">promisify</span>(fs.<span class="property">readFile</span>);</span><br><span class="line"><span class="keyword">const</span> writeFile = <span class="title function_">promisify</span>(fs.<span class="property">writeFile</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//RC 是配置文件</span></span><br><span class="line"><span class="comment">//DEFAULTS 是默认的配置</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">get</span> = <span class="keyword">async</span> (<span class="params">key</span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> exit = <span class="keyword">await</span> <span class="title function_">exits</span>(<span class="variable constant_">RC</span>);</span><br><span class="line">    <span class="keyword">let</span> opts;</span><br><span class="line">    <span class="keyword">if</span> (exit) &#123;</span><br><span class="line">        opts = <span class="keyword">await</span> <span class="title function_">readFile</span>(<span class="variable constant_">RC</span>, <span class="string">&#x27;utf8&#x27;</span>);</span><br><span class="line">        opts = <span class="title function_">decode</span>(opts);</span><br><span class="line">        <span class="keyword">return</span> opts[key];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">getAll</span> = <span class="keyword">async</span> (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> exit = <span class="keyword">await</span> <span class="title function_">exits</span>(<span class="variable constant_">RC</span>);</span><br><span class="line">    <span class="keyword">let</span> opts;</span><br><span class="line">    <span class="keyword">if</span> (exit) &#123;</span><br><span class="line">        opts = <span class="keyword">await</span> <span class="title function_">readFile</span>(<span class="variable constant_">RC</span>, <span class="string">&#x27;utf8&#x27;</span>);</span><br><span class="line">        opts = <span class="title function_">decode</span>(opts);</span><br><span class="line">        <span class="keyword">return</span> opts;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> &#123;&#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">set</span> = <span class="keyword">async</span> (<span class="params">key, value</span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> exit = <span class="keyword">await</span> <span class="title function_">exits</span>(<span class="variable constant_">RC</span>);</span><br><span class="line">    <span class="keyword">let</span> opts;</span><br><span class="line">    <span class="keyword">if</span> (exit) &#123;</span><br><span class="line">        opts = <span class="keyword">await</span> <span class="title function_">readFile</span>(<span class="variable constant_">RC</span>, <span class="string">&#x27;utf8&#x27;</span>);</span><br><span class="line">        opts = <span class="title function_">decode</span>(opts);</span><br><span class="line">        <span class="keyword">if</span>(!key) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(chalk.<span class="title function_">red</span>(chalk.<span class="title function_">bold</span>(<span class="string">&#x27;Error:&#x27;</span>)), chalk.<span class="title function_">red</span>(<span class="string">&#x27;key is required&#x27;</span>));</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(!value) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(chalk.<span class="title function_">red</span>(chalk.<span class="title function_">bold</span>(<span class="string">&#x27;Error:&#x27;</span>)), chalk.<span class="title function_">red</span>(<span class="string">&#x27;value is required&#x27;</span>));</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="title class_">Object</span>.<span class="title function_">assign</span>(opts, &#123; [key]: value &#125;);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        opts = <span class="title class_">Object</span>.<span class="title function_">assign</span>(<span class="variable constant_">DEFAULTS</span>, &#123; [key]: value &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">await</span> <span class="title function_">writeFile</span>(<span class="variable constant_">RC</span>, <span class="title function_">encode</span>(opts), <span class="string">&#x27;utf8&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">remove</span> = <span class="keyword">async</span> (<span class="params">key</span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> exit = <span class="keyword">await</span> <span class="title function_">exits</span>(<span class="variable constant_">RC</span>);</span><br><span class="line">    <span class="keyword">let</span> opts;</span><br><span class="line">    <span class="keyword">if</span> (exit) &#123;</span><br><span class="line">        opts = <span class="keyword">await</span> <span class="title function_">readFile</span>(<span class="variable constant_">RC</span>, <span class="string">&#x27;utf8&#x27;</span>);</span><br><span class="line">        opts = <span class="title function_">decode</span>(opts);</span><br><span class="line">        <span class="keyword">delete</span> opts[key];</span><br><span class="line">        <span class="keyword">await</span> <span class="title function_">writeFile</span>(<span class="variable constant_">RC</span>, <span class="title function_">encode</span>(opts), <span class="string">&#x27;utf8&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="发布"><a href="#发布" class="headerlink" title="发布"></a>发布</h2><p>npm publish 将本脚手架发布至npm上。其它用户可以通过 npm install eos-cli -g 全局安装。<br>即可使用 eos 命令。</p>
<p><strong>项目地址</strong></p>
<p>本项目完整代码请戳: <a href="https://github.com/ytking/eos-cli">https://github.com/ytking/eos-cli</a></p>
]]></content>
      <categories>
        <category>前端</category>
      </categories>
      <tags>
        <tag>JavaScript</tag>
        <tag>cli</tag>
      </tags>
  </entry>
  <entry>
    <title>项目性能优化方案</title>
    <url>/test/post/%E9%A1%B9%E7%9B%AE%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E6%96%B9%E6%A1%88/</url>
    <content><![CDATA[<p>Vue 项目性能优化方案</p>
<p><strong>前言</strong></p>
<p>Vue 框架通过数据双向绑定和虚拟 DOM 技术，帮我们处理了前端开发中最脏最累的 DOM 操作部分， 我们不再需要去考虑如何操作 DOM 以及如何最高效地操作 DOM；但 Vue 项目中仍然存在项目首屏优化、Webpack 编译配置优化等问题，所以我们仍然需要去关注 Vue 项目性能方面的优化，使项目具有更高效的性能、更好的用户体验。本文是作者通过实际项目的优化实践进行总结而来，希望读者读完本文，有一定的启发思考，从而对自己的项目进行优化起到帮助。本文内容分为以下三部分组成：</p>
<ul>
<li><p>Vue 代码层面的优化；</p>
</li>
<li><p>webpack 配置层面的优化；</p>
</li>
<li><p>基础的 Web 技术层面的优化。</p>
</li>
</ul>
<h2 id="一、代码层面的优化"><a href="#一、代码层面的优化" class="headerlink" title="一、代码层面的优化"></a>一、代码层面的优化</h2><h3 id="1-1、v-if-和-v-show-区分使用场景"><a href="#1-1、v-if-和-v-show-区分使用场景" class="headerlink" title="1.1、v-if 和 v-show 区分使用场景"></a>1.1、v-if 和 v-show 区分使用场景</h3><p><strong>v-if</strong> 是 真正 的条件渲染，因为它会确保在切换过程中条件块内的事件监听器和子组件适当地被销毁和重建；也是惰性的：如果在初始渲染时条件为假，则什么也不做——直到条件第一次变为真时，才会开始渲染条件块。</p>
<p><strong>v-show</strong> 就简单得多， 不管初始条件是什么，元素总是会被渲染，并且只是简单地基于 CSS 的 display 属性进行切换。</p>
<p>所以，v-if 适用于在运行时很少改变条件，不需要频繁切换条件的场景；v-show 则适用于需要非常频繁切换条件的场景。</p>
<h3 id="1-2、computed-和-watch-区分使用场景"><a href="#1-2、computed-和-watch-区分使用场景" class="headerlink" title="1.2、computed 和 watch 区分使用场景"></a>1.2、computed 和 watch 区分使用场景</h3><p><strong>computed</strong>： 是计算属性，依赖其它属性值，并且 computed 的值有缓存，只有它依赖的属性值发生改变，下一次获取 computed 的值时才会重新计算 computed 的值；</p>
<p><strong>watch</strong>： 更多的是「观察」的作用，类似于某些数据的监听回调 ，每当监听的数据变化时都会执行回调进行后续操作；</p>
<p>运用场景：</p>
<p>当我们需要进行数值计算，并且依赖于其它数据时，应该使用 computed，因为可以利用 computed 的缓存特性，避免每次获取值时，都要重新计算；</p>
<p>当我们需要在数据变化时执行异步或开销较大的操作时，应该使用 watch，使用 watch 选项允许我们执行异步操作 ( 访问一个 API )，限制我们执行该操作的频率，并在我们得到最终结果前，设置中间状态。这些都是计算属性无法做到的。</p>
<h3 id="1-3、v-for-遍历必须为-item-添加-key，且避免同时使用-v-if"><a href="#1-3、v-for-遍历必须为-item-添加-key，且避免同时使用-v-if" class="headerlink" title="1.3、v-for 遍历必须为 item 添加 key，且避免同时使用 v-if"></a>1.3、v-for 遍历必须为 item 添加 key，且避免同时使用 v-if</h3><p>（1）v-for 遍历必须为 item 添加 key</p>
<p>在列表数据进行遍历渲染时，需要为每一项 item 设置唯一 key 值，方便 Vue.js 内部机制精准找到该条列表数据。当 state 更新时，新的状态值和旧的状态值对比，较快地定位到 diff 。</p>
<p>（2）v-for 遍历避免同时使用 v-if</p>
<p>v-for 比 v-if 优先级高，如果每一次都需要遍历整个数组，将会影响速度，尤其是当之需要渲染很小一部分的时候，必要情况下应该替换成 computed 属性。</p>
<p>推荐：</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&lt;ul&gt;  </span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">li</span> <span class="attr">v-for</span>=<span class="string">&quot;user in activeUsers&quot;</span> <span class="attr">:key</span>=<span class="string">&quot;user.id&quot;</span>&gt;</span>&#123;&#123; user.name &#125;&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line">&lt;/ul&gt;</span><br><span class="line">  <span class="attr">computed</span>: &#123;  </span><br><span class="line">    <span class="attr">activeUsers</span>: <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">users</span>.<span class="title function_">filter</span>(<span class="keyword">function</span> (<span class="params">user</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> user.<span class="property">isActive</span>    </span><br><span class="line">      &#125;)  </span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<p>不推荐：</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&lt;ul&gt;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">li</span> <span class="attr">v-for</span>=<span class="string">&quot;user in users&quot;</span> <span class="attr">v-if</span>=<span class="string">&quot;user.isActive&quot;</span> <span class="attr">:key</span>=<span class="string">&quot;user.id&quot;</span>&gt;</span>&#123;&#123; user.name &#125;&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line">&lt;/ul&gt;</span><br></pre></td></tr></table></figure>

<h3 id="1-4、长列表性能优化"><a href="#1-4、长列表性能优化" class="headerlink" title="1.4、长列表性能优化"></a>1.4、长列表性能优化</h3><p>Vue 会通过 Object.defineProperty 对数据进行劫持，来实现视图响应数据的变化，然而有些时候我们的组件就是纯粹的数据展示，不会有任何改变，我们就不需要 Vue 来劫持我们的数据，在大量数据展示的情况下，这能够很明显的减少组件初始化的时间，那如何禁止 Vue 劫持我们的数据呢？可以通过 Object.freeze 方法来冻结一个对象，一旦被冻结的对象就再也不能被修改了。</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="attr">data</span>: <span class="function">() =&gt;</span> (&#123; <span class="attr">users</span>: &#123;&#125; &#125;),</span><br><span class="line">  <span class="keyword">async</span> <span class="title function_">created</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> users = <span class="keyword">await</span> axios.<span class="title function_">get</span>(<span class="string">&quot;/api/users&quot;</span>);</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">users</span> = <span class="title class_">Object</span>.<span class="title function_">freeze</span>(users);</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="1-5、事件的销毁"><a href="#1-5、事件的销毁" class="headerlink" title="1.5、事件的销毁"></a>1.5、事件的销毁</h3><p>Vue 组件销毁时，会自动清理它与其它实例的连接，解绑它的全部指令及事件监听器，但是仅限于组件本身的事件。如果在 js 内</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="title function_">created</span>(<span class="params"></span>) &#123;  <span class="title function_">addEventListener</span>(<span class="string">&#x27;click&#x27;</span>, <span class="variable language_">this</span>.<span class="property">click</span>, <span class="literal">false</span>)&#125;,</span><br><span class="line"><span class="title function_">beforeDestroy</span>(<span class="params"></span>) &#123;  <span class="title function_">removeEventListener</span>(<span class="string">&#x27;click&#x27;</span>, <span class="variable language_">this</span>.<span class="property">click</span>, <span class="literal">false</span>)&#125;</span><br></pre></td></tr></table></figure>

<h3 id="1-6、图片资源懒加载"><a href="#1-6、图片资源懒加载" class="headerlink" title="1.6、图片资源懒加载"></a>1.6、图片资源懒加载</h3><p>对于图片过多的页面，为了加速页面加载速度，所以很多时候我们需要将页面内未出现在可视区域内的图片先不做加载， 等到滚动到可视区域后再去加载。这样对于页面加载性能上会有很大的提升，也提高了用户体验。我们在项目中使用 Vue 的 vue-lazyload 插件：</p>
<p>（1）安装插件</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">npm install vue-lazyload --save-dev</span><br></pre></td></tr></table></figure>

<p>（2）在入口文件 man.js 中引入并使用</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">VueLazyload</span> <span class="keyword">from</span> <span class="string">&quot;vue-lazyload&quot;</span>;</span><br></pre></td></tr></table></figure>

<p>然后再 vue 中直接使用</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="title class_">Vue</span>.<span class="title function_">use</span>(<span class="title class_">VueLazyload</span>);</span><br></pre></td></tr></table></figure>

<p>或者添加自定义选项</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="title class_">Vue</span>.<span class="title function_">use</span>(<span class="title class_">VueLazyload</span>, &#123;</span><br><span class="line">  <span class="attr">preLoad</span>: <span class="number">1.3</span>,</span><br><span class="line">  <span class="attr">error</span>: <span class="string">&quot;dist/error.png&quot;</span>,</span><br><span class="line">  <span class="attr">loading</span>: <span class="string">&quot;dist/loading.gif&quot;</span>,</span><br><span class="line">  <span class="attr">attempt</span>: <span class="number">1</span>,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>（3）在 vue 文件中将 img 标签的 src 属性直接改为 v-lazy ，从而将图片显示方式更改为懒加载显示：</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&lt;img v-lazy=<span class="string">&quot;/static/img/1.png&quot;</span>&gt;</span><br></pre></td></tr></table></figure>

<p>以上为 vue-lazyload 插件的简单使用，如果要看插件的更多参数选项，可以查看 vue-lazyload 的 github 地址。</p>
<h3 id="1-7、路由懒加载"><a href="#1-7、路由懒加载" class="headerlink" title="1.7、路由懒加载"></a>1.7、路由懒加载</h3><p>Vue 是单页面应用，可能会有很多的路由引入 ，这样使用 webpcak 打包后的文件很大，当进入首页时，加载的资源过多，页面会出现白屏的情况，不利于用户体验。如果我们能把不同路由对应的组件分割成不同的代码块，然后当路由被访问的时候才加载对应的组件，这样就更加高效了。这样会大大提高首屏显示的速度，但是可能其他的页面的速度就会降下来。</p>
<p>路由懒加载：</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">Foo</span> = (<span class="params"></span>) =&gt; <span class="keyword">import</span>(<span class="string">&#x27;./Foo.vue&#x27;</span>)<span class="keyword">const</span> router = <span class="keyword">new</span> <span class="title class_">VueRouter</span>(&#123;</span><br><span class="line">    <span class="attr">routes</span>: [&#123; <span class="attr">path</span>: <span class="string">&#x27;/foo&#x27;</span>, <span class="attr">component</span>: <span class="title class_">Foo</span> &#125;]</span><br><span class="line">  &#125;)</span><br></pre></td></tr></table></figure>

<h3 id="1-8、第三方插件的按需引入"><a href="#1-8、第三方插件的按需引入" class="headerlink" title="1.8、第三方插件的按需引入"></a>1.8、第三方插件的按需引入</h3><p>我们在项目中经常会需要引入第三方插件，如果我们直接引入整个插件，会导致项目的体积太大，我们可以借助 babel-plugin-component ，然后可以只引入需要的组件，以达到减小项目体积的目的。以下为项目中引入 element-ui 组件库为例：</p>
<p>（1）首先，安装 babel-plugin-component ：</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">npm install babel-plugin-component -D</span><br></pre></td></tr></table></figure>

<p>（2）然后，将 .babelrc 修改为：</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&#123;  </span><br><span class="line">  <span class="string">&quot;presets&quot;</span>: [[<span class="string">&quot;es2015&quot;</span>, &#123; <span class="string">&quot;modules&quot;</span>: <span class="literal">false</span> &#125;]],  </span><br><span class="line">  <span class="string">&quot;plugins&quot;</span>: [</span><br><span class="line">    [</span><br><span class="line">      <span class="string">&quot;component&quot;</span>,  </span><br><span class="line">      &#123;</span><br><span class="line">      <span class="string">&quot;libraryName&quot;</span>: <span class="string">&quot;element-ui&quot;</span>,</span><br><span class="line">      <span class="string">&quot;styleLibraryName&quot;</span>: <span class="string">&quot;theme-chalk&quot;</span> </span><br><span class="line">      &#125;    </span><br><span class="line">    ]  </span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>（3）在 main.js 中引入部分组件：</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">Vue</span> <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>;<span class="keyword">import</span> &#123; <span class="title class_">Button</span>, <span class="title class_">Select</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;element-ui&#x27;</span>;</span><br><span class="line"> <span class="title class_">Vue</span>.<span class="title function_">use</span>(<span class="title class_">Button</span>) <span class="title class_">Vue</span>.<span class="title function_">use</span>(<span class="title class_">Select</span>)</span><br></pre></td></tr></table></figure>

<h3 id="1-9、优化无限列表性能"><a href="#1-9、优化无限列表性能" class="headerlink" title="1.9、优化无限列表性能"></a>1.9、优化无限列表性能</h3><p>如果你的应用存在非常长或者无限滚动的列表，那么需要采用 窗口化 的技术来优化性能，只需要渲染少部分区域的内容，减少重新渲染组件和创建 dom 节点的时间。你可以参考以下开源项目 vue-virtual-scroll-list 和 vue-virtual-scroller 来优化这种无限列表的场景的。</p>
<h3 id="1-10、服务端渲染-SSR-or-预渲染"><a href="#1-10、服务端渲染-SSR-or-预渲染" class="headerlink" title="1.10、服务端渲染 SSR or 预渲染"></a>1.10、服务端渲染 SSR or 预渲染</h3><p>服务端渲染是指 Vue 在客户端将标签渲染成的整个 html 片段的工作在服务端完成，服务端形成的 html 片段直接返回给客户端这个过程就叫做服务端渲染。</p>
<p>（1）服务端渲染的优点：</p>
<p>更好的 SEO：因为 SPA 页面的内容是通过 Ajax 获取，而搜索引擎爬取工具并不会等待 Ajax 异步完成后再抓取页面内容，所以在 SPA 中是抓取不到页面通过 Ajax 获取到的内容；而 SSR 是直接由服务端返回已经渲染好的页面（数据已经包含在页面中），所以搜索引擎爬取工具可以抓取渲染好的页面；</p>
<p>更快的内容到达时间（首屏加载更快）：SPA 会等待所有 Vue 编译后的 js 文件都下载完成后，才开始进行页面的渲染，文件下载等需要一定的时间等，所以首屏渲染需要一定的时间；SSR 直接由服务端渲染好页面直接返回显示，无需等待下载 js 文件及再去渲染等，所以 SSR 有更快的内容到达时间；</p>
<p>（2）服务端渲染的缺点：</p>
<p>更多的开发条件限制：例如服务端渲染只支持 beforCreate 和 created 两个钩子函数，这会导致一些外部扩展库需要特殊处理，才能在服务端渲染应用程序中运行；并且与可以部署在任何静态文件服务器上的完全静态单页面应用程序 SPA 不同，服务端渲染应用程序，需要处于 Node.js server 运行环境；</p>
<p>更多的服务器负载：在 Node.js 中渲染完整的应用程序，显然会比仅仅提供静态文件的 server 更加大量占用 CPU 资源，因此如果你预料在高流量环境下使用，请准备相应的服务器负载，并明智地采用缓存策略。</p>
<p>如果你的项目的 SEO 和 首屏渲染是评价项目的关键指标，那么你的项目就需要服务端渲染来帮助你实现最佳的初始加载性能和 SEO，具体的 Vue SSR 如何实现，可以参考作者的另一篇文章《Vue SSR 踩坑之旅》。如果你的 Vue 项目只需改善少数营销页面（例如 &#x2F;， &#x2F;about， &#x2F;contact 等）的 SEO，那么你可能需要预渲染，在构建时 (build time) 简单地生成针对特定路由的静态 HTML 文件。优点是设置预渲染更简单，并可以将你的前端作为一个完全静态的站点，具体你可以使用 prerender-spa-plugin 就可以轻松地添加预渲染 。</p>
<h2 id="二、Webpack-层面的优化"><a href="#二、Webpack-层面的优化" class="headerlink" title="二、Webpack 层面的优化"></a>二、Webpack 层面的优化</h2><h3 id="2-1、Webpack-对图片进行压缩"><a href="#2-1、Webpack-对图片进行压缩" class="headerlink" title="2.1、Webpack 对图片进行压缩"></a>2.1、Webpack 对图片进行压缩</h3><p>在 vue 项目中除了可以在 webpack.base.conf.js 中 url-loader 中设置 limit 大小来对图片处理，对小于 limit 的图片转化为 base64 格式，其余的不做操作。所以对有些较大的图片资源，在请求资源的时候，加载会很慢，我们可以用 image-webpack-loader 来压缩图片：</p>
<p>（1）首先，安装 image-webpack-loader ：</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">npm install image-webpack-loader --save-dev</span><br></pre></td></tr></table></figure>

<p>（2）然后，在 webpack.base.conf.js 中进行配置：</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&#123;  <span class="attr">test</span>: <span class="regexp">/\.(png|jpe?g|gif|svg)(\?.*)?$/</span>,  <span class="attr">use</span>:[    &#123;    <span class="attr">loader</span>: <span class="string">&#x27;url-loader&#x27;</span>,    <span class="attr">options</span>: &#123;      <span class="attr">limit</span>: <span class="number">10000</span>,      <span class="attr">name</span>: utils.<span class="title function_">assetsPath</span>(<span class="string">&#x27;img/[name].[hash:7].[ext]&#x27;</span>)      &#125;    &#125;,    &#123;      <span class="attr">loader</span>: <span class="string">&#x27;image-webpack-loader&#x27;</span>,      <span class="attr">options</span>: &#123;        <span class="attr">bypassOnDebug</span>: <span class="literal">true</span>,      &#125;    &#125;  ]&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-2、减少-ES6-转为-ES5-的冗余代码"><a href="#2-2、减少-ES6-转为-ES5-的冗余代码" class="headerlink" title="2.2、减少 ES6 转为 ES5 的冗余代码"></a>2.2、减少 ES6 转为 ES5 的冗余代码</h3><p>Babel 插件会在将 ES6 代码转换成 ES5 代码时会注入一些辅助函数，例如下面的 ES6 代码：</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">HelloWebpack</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Component</span>&#123;...&#125;</span><br></pre></td></tr></table></figure>

<p>这段代码再被转换成能正常运行的 ES5 代码时需要以下两个辅助函数：</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">babel - runtime / helpers / createClass; <span class="comment">// 用于实现 class 语法babel-runtime/helpers/inherits  // 用于实现 extends 语法</span></span><br></pre></td></tr></table></figure>

<p>在默认情况下， Babel 会在每个输出文件中内嵌这些依赖的辅助函数代码，如果多个源代码文件都依赖这些辅助函数，那么这些辅助函数的代码将会出现很多次，造成代码冗余。为了不让这些辅助函数的代码重复出现，可以在依赖它们时通过 require(‘babel-runtime&#x2F;helpers&#x2F;createClass’) 的方式导入，这样就能做到只让它们出现一次。babel-plugin-transform-runtime 插件就是用来实现这个作用的，将相关辅助函数进行替换成导入语句，从而减小 babel 编译出来的代码的文件大小。</p>
<p>（1）首先，安装 babel-plugin-transform-runtime ：</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">npm install babel-plugin-transform-runtime --save-dev</span><br></pre></td></tr></table></figure>

<p>（2）然后，修改 .babelrc 配置文件为：</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="string">&quot;plugins&quot;</span>: [    <span class="string">&quot;transform-runtime&quot;</span>]</span><br></pre></td></tr></table></figure>

<p>如果要看插件的更多详细内容，可以查看 babel-plugin-transform-runtime 的 详细介绍。</p>
<h3 id="2-3、提取公共代码"><a href="#2-3、提取公共代码" class="headerlink" title="2.3、提取公共代码"></a>2.3、提取公共代码</h3><p>如果项目中没有去将每个页面的第三方库和公共模块提取出来，则项目会存在以下问题：</p>
<p>相同的资源被重复加载，浪费用户的流量和服务器的成本。</p>
<p>每个页面需要加载的资源太大，导致网页首屏加载缓慢，影响用户体验。</p>
<p>所以我们需要将多个页面的公共代码抽离成单独的文件，来优化以上问题 。Webpack 内置了专门用于提取多个 Chunk 中的公共部分的插件 CommonsChunkPlugin，我们在项目中 CommonsChunkPlugin 的配置如下：</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// 所有在 package.json 里面依赖的包，都会被打包进 vendor.js 这个文件中。</span></span><br><span class="line"><span class="keyword">new</span> webpack.<span class="property">optimize</span>.<span class="title class_">CommonsChunkPlugin</span>(&#123;  </span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;vendor&#x27;</span>,  <span class="attr">minChunks</span>: <span class="keyword">function</span>(<span class="params"><span class="variable language_">module</span>, count</span>) &#123;    </span><br><span class="line">    <span class="keyword">return</span> (      </span><br><span class="line">      <span class="variable language_">module</span>.<span class="property">resource</span> &amp;&amp;<span class="regexp">/\.js$/</span>.<span class="title function_">test</span>(<span class="variable language_">module</span>.<span class="property">resource</span>) &amp;&amp;<span class="variable language_">module</span>.<span class="property">resource</span>.<span class="title function_">indexOf</span>(path.<span class="title function_">join</span>(__dirname, <span class="string">&#x27;../node_modules&#x27;</span>)) === <span class="number">0</span>    </span><br><span class="line">    );  </span><br><span class="line">  &#125;</span><br><span class="line">&#125;),</span><br><span class="line"><span class="comment">// 抽取出代码模块的映射关系new webpack.optimize.CommonsChunkPlugin(&#123;  name: &#x27;manifest&#x27;,  chunks: [&#x27;vendor&#x27;]&#125;)</span></span><br></pre></td></tr></table></figure>

<p>如果要看插件的更多详细内容，可以查看 CommonsChunkPlugin 的 详细介绍。</p>
<h3 id="2-4、模板预编译"><a href="#2-4、模板预编译" class="headerlink" title="2.4、模板预编译"></a>2.4、模板预编译</h3><p>当使用 DOM 内模板或 JavaScript 内的字符串模板时，模板会在运行时被编译为渲染函数。通常情况下这个过程已经足够快了，但对性能敏感的应用还是最好避免这种用法。</p>
<p>预编译模板最简单的方式就是使用单文件组件——相关的构建设置会自动把预编译处理好，所以构建好的代码已经包含了编译出来的渲染函数而不是原始的模板字符串。</p>
<p>如果你使用 webpack，并且喜欢分离 JavaScript 和模板文件，你可以使用 vue-template-loader，它也可以在构建过程中把模板文件转换成为 JavaScript 渲染函数。</p>
<h3 id="2-5、提取组件的-CSS"><a href="#2-5、提取组件的-CSS" class="headerlink" title="2.5、提取组件的 CSS"></a>2.5、提取组件的 CSS</h3><p>当使用单文件组件时，组件内的 CSS 会以 style 标签的方式通过 JavaScript 动态注入。这有一些小小的运行时开销，如果你使用服务端渲染，这会导致一段 “无样式内容闪烁 (fouc) ” 。将所有组件的 CSS 提取到同一个文件可以避免这个问题，也会让 CSS 更好地进行压缩和缓存。</p>
<p>查阅这个构建工具各自的文档来了解更多：</p>
<p>webpack + vue-loader ( vue-cli 的 webpack 模板已经预先配置好)</p>
<p>Browserify + vueify</p>
<p>Rollup + rollup-plugin-vue</p>
<h3 id="2-6、优化-SourceMap"><a href="#2-6、优化-SourceMap" class="headerlink" title="2.6、优化 SourceMap"></a>2.6、优化 SourceMap</h3><p>我们在项目进行打包后，会将开发中的多个文件代码打包到一个文件中，并且经过压缩、去掉多余的空格、babel 编译化后，最终将编译得到的代码会用于线上环境，那么这样处理后的代码和源代码会有很大的差别，当有 bug 的时候，我们只能定位到压缩处理后的代码位置，无法定位到开发环境中的代码，对于开发来说不好调式定位问题，因此 sourceMap 出现了，它就是为了解决不好调式代码问题的。</p>
<p>SourceMap 的可选值如下（+ 号越多，代表速度越快，- 号越多，代表速度越慢, o 代表中等速度 ）</p>
<p>开发环境推荐：cheap-module-eval-source-map</p>
<p>生产环境推荐：cheap-module-source-map</p>
<p>原因如下：</p>
<p>cheap：源代码中的列信息是没有任何作用，因此我们打包后的文件不希望包含列相关信息，只有行信息能建立打包前后的依赖关系。因此不管是开发环境或生产环境，我们都希望添加 cheap 的基本类型来忽略打包前后的列信息；</p>
<p>module ：不管是开发环境还是正式环境，我们都希望能定位到 bug 的源代码具体的位置，比如说某个 Vue 文件报错了，我们希望能定位到具体的 Vue 文件，因此我们也需要 module 配置；</p>
<p>soure-map ：source-map 会为每一个打包后的模块生成独立的 soucemap 文件 ，因此我们需要增加 source-map 属性；</p>
<p>eval-source-map：eval 打包代码的速度非常快，因为它不生成 map 文件，但是可以对 eval 组合使用 eval-source-map 使用会将 map 文件以 DataURL 的形式存在打包后的 js 文件中。在正式环境中不要使用 eval-source-map, 因为它会增加文件的大小，但是在开发环境中，可以试用下，因为他们打包的速度很快。</p>
<p>2.7、构建结果输出分析<br>Webpack 输出的代码可读性非常差而且文件非常大，让我们非常头疼。为了更简单、直观地分析输出结果，社区中出现了许多可视化分析工具。这些工具以图形的方式将结果更直观地展示出来，让我们快速了解问题所在。接下来讲解我们在 Vue 项目中用到的分析工具：webpack-bundle-analyzer 。</p>
<p>我们在项目中 webpack.prod.conf.js 进行配置：</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (config.<span class="property">build</span>.<span class="property">bundleAnalyzerReport</span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> <span class="title class_">BundleAnalyzerPlugin</span> =</span><br><span class="line">    <span class="built_in">require</span>(<span class="string">&quot;webpack-bundle-analyzer&quot;</span>).<span class="property">BundleAnalyzerPlugin</span>;</span><br><span class="line">  webpackConfig.<span class="property">plugins</span>.<span class="title function_">push</span>(<span class="keyword">new</span> <span class="title class_">BundleAnalyzerPlugin</span>());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>执行 $ npm run build –report 后生成分析报告如下：</p>
<h3 id="2-8、Vue-项目的编译优化"><a href="#2-8、Vue-项目的编译优化" class="headerlink" title="2.8、Vue 项目的编译优化"></a>2.8、Vue 项目的编译优化</h3><p>如果你的 Vue 项目使用 Webpack 编译，需要你喝一杯咖啡的时间，那么也许你需要对项目的 Webpack 配置进行优化，提高 Webpack 的构建效率。具体如何进行 Vue 项目的 Webpack 构建优化，可以参考作者的另一篇文章《 Vue 项目 Webpack 优化实践》</p>
<h2 id="三、基础的-Web-技术优化"><a href="#三、基础的-Web-技术优化" class="headerlink" title="三、基础的 Web 技术优化"></a>三、基础的 Web 技术优化</h2><h3 id="3-1、开启-gzip-压缩"><a href="#3-1、开启-gzip-压缩" class="headerlink" title="3.1、开启 gzip 压缩"></a>3.1、开启 gzip 压缩</h3><p>gzip 是 GNUzip 的缩写，最早用于 UNIX 系统的文件压缩。HTTP 协议上的 gzip 编码是一种用来改进 web 应用程序性能的技术，web 服务器和客户端（浏览器）必须共同支持 gzip。目前主流的浏览器，Chrome，firefox，IE 等都支持该协议。常见的服务器如 Apache，Nginx，IIS 同样支持，gzip 压缩效率非常高，通常可以达到 70% 的压缩率，也就是说，如果你的网页有 30K，压缩之后就变成了 9K 左右</p>
<p>以下我们以服务端使用我们熟悉的 express 为例，开启 gzip 非常简单，相关步骤如下：</p>
<p>安装：</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">npm install compression --save</span><br></pre></td></tr></table></figure>

<p>添加代码逻辑：</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> compression = <span class="built_in">require</span>(<span class="string">&quot;compression&quot;</span>);</span><br><span class="line"><span class="keyword">var</span> app = <span class="title function_">express</span>();</span><br><span class="line">app.<span class="title function_">use</span>(<span class="title function_">compression</span>());</span><br></pre></td></tr></table></figure>

<p>重启服务，观察网络面板里面的 response header，如果看到红圈里的字段则表明 gzip 开启成功。</p>
<h3 id="3-2、浏览器缓存"><a href="#3-2、浏览器缓存" class="headerlink" title="3.2、浏览器缓存"></a>3.2、浏览器缓存</h3><p>为了提高用户加载页面的速度，对静态资源进行缓存是非常必要的，根据是否需要重新向服务器发起请求来分类，将 HTTP 缓存规则分为两大类（强制缓存，对比缓存），如果对缓存机制还不是了解很清楚的，可以参考作者写的关于 HTTP 缓存的文章《深入理解 HTTP 缓存机制及原理》，这里不再赘述。</p>
<h3 id="3-3、CDN-的使用"><a href="#3-3、CDN-的使用" class="headerlink" title="3.3、CDN 的使用"></a>3.3、CDN 的使用</h3><p>浏览器从服务器上下载 CSS、js 和图片等文件时都要和服务器连接，而大部分服务器的带宽有限，如果超过限制，网页就半天反应不过来。而 CDN 可以通过不同的域名来加载文件，从而使下载文件的并发连接数大大增加，且 CDN 具有更好的可用性，更低的网络延迟和丢包率 。</p>
<h3 id="3-4、使用-Chrome-Performance-查找性能瓶颈"><a href="#3-4、使用-Chrome-Performance-查找性能瓶颈" class="headerlink" title="3.4、使用 Chrome Performance 查找性能瓶颈"></a>3.4、使用 Chrome Performance 查找性能瓶颈</h3><p>Chrome 的 Performance 面板可以录制一段时间内的 js 执行细节及时间。使用 Chrome 开发者工具分析页面性能的步骤如下。</p>
<ul>
<li><p>1、打开 Chrome 开发者工具，切换到 Performance 面板</p>
</li>
<li><p>2、点击 Record 开始录制</p>
</li>
<li><p>3、刷新页面或展开某个节点</p>
</li>
<li><p>4、点击 Stop 停止录制</p>
</li>
</ul>
]]></content>
      <categories>
        <category>前端</category>
      </categories>
      <tags>
        <tag>JavaScript</tag>
        <tag>面试</tag>
      </tags>
  </entry>
  <entry>
    <title>谈谈Tomcat请求处理流程</title>
    <url>/test/post/%E8%B0%88%E8%B0%88Tomcat%E6%9E%B6%E6%9E%84%E5%8F%8A%E5%90%AF%E5%8A%A8%E8%BF%87%E7%A8%8B/</url>
    <content><![CDATA[<h1 id="谈谈-Tomcat-请求处理流程"><a href="#谈谈-Tomcat-请求处理流程" class="headerlink" title="谈谈 Tomcat 请求处理流程"></a>谈谈 Tomcat 请求处理流程</h1><p>《谈谈 Tomcat 架构及启动过程[含部署]》已重新修订!（与本文在 GitHub 同一目录下）包括架构和 Tomcat Start 过程中的 <code>MapperListener</code> 相关描述。<code>Connector</code> 启动相关的内容与请求处理关系比较紧密，所以就独立出来放在本文中了。</p>
<p><strong>建议结合《谈谈 Tomcat 架构及启动过程[含部署]》一起看!</strong></p>
<p>很多东西在时序图中体现的已经非常清楚了，没有必要再一步一步的作介绍，所以本文以图为主，然后对部分内容加以简单解释。</p>
<ul>
<li>绘制图形使用的工具是 <a href="http://plantuml.com/">PlantUML</a> + <a href="https://code.visualstudio.com/">Visual Studio Code</a> + <a href="https://marketplace.visualstudio.com/items?itemName=jebbs.plantuml">PlantUML Extension</a></li>
</ul>
<p>本文对 Tomcat 的介绍以 <code>Tomcat-9.0.0.M22</code> 为标准。</p>
<p><code>Tomcat-9.0.0.M22</code> 是 Tomcat 目前最新的版本，但尚未发布，它实现了 <code>Servlet4.0</code> 及 <code>JSP2.3</code> 并提供了很多新特性，需要 1.8 及以上的 JDK 支持等等，详情请查阅 <a href="https://tomcat.apache.org/tomcat-9.0-doc/index.html">Tomcat-9.0-doc</a></p>
<!-- TOC -->

<ul>
<li><a href="#%E8%B0%88%E8%B0%88-tomcat-%E8%AF%B7%E6%B1%82%E5%A4%84%E7%90%86%E6%B5%81%E7%A8%8B">谈谈 Tomcat 请求处理流程</a><ul>
<li><a href="#overview">Overview</a></li>
<li><a href="#connector-init-and-start">Connector Init and Start</a></li>
<li><a href="#requtst-process">Requtst Process</a><ul>
<li><a href="#acceptor">Acceptor</a></li>
<li><a href="#poller">Poller</a></li>
<li><a href="#worker">Worker</a></li>
<li><a href="#container">Container</a></li>
</ul>
</li>
<li><a href="#at-last">At last</a></li>
</ul>
</li>
<li><a href="#reference">Reference</a></li>
</ul>
<!-- /TOC -->

<hr>
<h2 id="Overview"><a href="#Overview" class="headerlink" title="Overview"></a>Overview</h2><p><img src="/test/../res/tomcat-request-process-model.jpg"></p>
<ol>
<li>Connector 启动以后会启动一组线程用于不同阶段的请求处理过程。<ol>
<li><code>Acceptor</code> 线程组。用于接受新连接，并将新连接封装一下，选择一个 <code>Poller</code> 将新连接添加到 <code>Poller</code> 的事件队列中。</li>
<li><code>Poller</code> 线程组。用于监听 Socket 事件，当 Socket 可读或可写等等时，将 Socket 封装一下添加到 <code>worker</code> 线程池的任务队列中。</li>
<li><code>worker</code> 线程组。用于对请求进行处理，包括分析请求报文并创建 Request 对象，调用容器的 pipeline 进行处理。</li>
</ol>
</li>
</ol>
<ul>
<li><code>Acceptor</code>、<code>Poller</code>、<code>worker</code> 所在的 <code>ThreadPoolExecutor</code> 都维护在 <code>NioEndpoint</code> 中。</li>
</ul>
<h2 id="Connector-Init-and-Start"><a href="#Connector-Init-and-Start" class="headerlink" title="Connector Init and Start"></a>Connector Init and Start</h2><p><img src="/test/../res/tomcat-connector-start.png"></p>
<ol>
<li><code>initServerSocket()</code>，通过 <code>ServerSocketChannel.open()</code> 打开一个 ServerSocket，默认绑定到 8080 端口，默认的连接等待队列长度是 100， 当超过 100 个时会拒绝服务。我们可以通过配置 <code>conf/server.xml</code> 中 <code>Connector</code> 的 <code>acceptCount</code> 属性对其进行定制。</li>
<li><code>createExecutor()</code> 用于创建 <code>Worker</code> 线程池。默认会启动 10 个 <code>Worker</code> 线程，Tomcat 处理请求过程中，Woker 最多不超过 200 个。我们可以通过配置 <code>conf/server.xml</code> 中 <code>Connector</code> 的 <code>minSpareThreads</code> 和 <code>maxThreads</code> 对这两个属性进行定制。</li>
<li><code>Pollor</code> 用于检测已就绪的 Socket。 默认最多不超过 2 个，<code>Math.min(2,Runtime.getRuntime().availableProcessors());</code>。我们可以通过配置 <code>pollerThreadCount</code> 来定制。</li>
<li><code>Acceptor</code> 用于接受新连接。默认是 1 个。我们可以通过配置 <code>acceptorThreadCount</code> 对其进行定制。</li>
</ol>
<h2 id="Requtst-Process"><a href="#Requtst-Process" class="headerlink" title="Requtst Process"></a>Requtst Process</h2><h3 id="Acceptor"><a href="#Acceptor" class="headerlink" title="Acceptor"></a>Acceptor</h3><p><img src="/test/../res/tomcat-request-process-acceptor.png"></p>
<ol>
<li><code>Acceptor</code> 在启动后会阻塞在 <code>ServerSocketChannel.accept();</code> 方法处，当有新连接到达时，该方法返回一个 <code>SocketChannel</code>。</li>
<li>配置完 Socket 以后将 Socket 封装到 <code>NioChannel</code> 中，并注册到 <code>Poller</code>,值的一提的是，我们一开始就启动了多个 <code>Poller</code> 线程，注册的时候，连接是公平的分配到每个 <code>Poller</code> 的。<code>NioEndpoint</code> 维护了一个 <code>Poller</code> 数组，当一个连接分配给 <code>pollers[index]</code> 时，下一个连接就会分配给 <code>pollers[(index+1)%pollers.length]</code>.</li>
<li><code>addEvent()</code> 方法会将 Socket 添加到该 <code>Poller</code> 的 <code>PollerEvent</code> 队列中。到此 <code>Acceptor</code> 的任务就完成了。</li>
</ol>
<h3 id="Poller"><a href="#Poller" class="headerlink" title="Poller"></a>Poller</h3><p><img src="/test/../res/tomcat-request-process-poller.png"></p>
<ol>
<li><code>selector.select(1000)</code>。当 <code>Poller</code> 启动后因为 selector 中并没有已注册的 <code>Channel</code>，所以当执行到该方法时只能阻塞。所有的 <code>Poller</code> 共用一个 Selector，其实现类是 <code>sun.nio.ch.EPollSelectorImpl</code></li>
<li><code>events()</code> 方法会将通过 <code>addEvent()</code> 方法添加到事件队列中的 Socket 注册到 <code>EPollSelectorImpl</code>，当 Socket 可读时，<code>Poller</code> 才对其进行处理</li>
<li><code>createSocketProcessor()</code> 方法将 Socket 封装到 <code>SocketProcessor</code> 中，<code>SocketProcessor</code> 实现了 <code>Runnable</code> 接口。<code>worker</code> 线程通过调用其 <code>run()</code> 方法来对 Socket 进行处理。</li>
<li><code>execute(SocketProcessor)</code> 方法将 <code>SocketProcessor</code> 提交到线程池，放入线程池的 <code>workQueue</code> 中。<code>workQueue</code> 是 <code>BlockingQueue</code> 的实例。到此 <code>Poller</code> 的任务就完成了。</li>
</ol>
<h3 id="Worker"><a href="#Worker" class="headerlink" title="Worker"></a>Worker</h3><p><img src="/test/../res/tomcat-request-process-worker.png"></p>
<ol>
<li><code>worker</code> 线程被创建以后就执行 <code>ThreadPoolExecutor</code> 的 <code>runWorker()</code> 方法，试图从 <code>workQueue</code> 中取待处理任务，但是一开始 <code>workQueue</code> 是空的，所以 <code>worker</code> 线程会阻塞在 <code>workQueue.take()</code> 方法。</li>
<li>当新任务添加到 <code>workQueue</code>后，<code>workQueue.take()</code> 方法会返回一个 <code>Runnable</code>，通常是 <code>SocketProcessor</code>,然后 <code>worker</code> 线程调用 <code>SocketProcessor</code> 的 <code>run()</code> 方法对 Socket 进行处理。</li>
<li><code>createProcessor()</code> 会创建一个 <code>Http11Processor</code>, 它用来解析 Socket，将 Socket 中的内容封装到 <code>Request</code> 中。注意这个 <code>Request</code> 是临时使用的一个类，它的全类名是 <code>org.apache.coyote.Request</code>，</li>
<li><code>postParseRequest()</code> 方法封装一下 Request，并处理一下映射关系(从 URL 映射到相应的 <code>Host</code>、<code>Context</code>、<code>Wrapper</code>)。<ol>
<li><code>CoyoteAdapter</code> 将 Rquest 提交给 <code>Container</code> 处理之前，并将 <code>org.apache.coyote.Request</code> 封装到 <code>org.apache.catalina.connector.Request</code>，传递给 <code>Container</code> 处理的 Request 是 <code>org.apache.catalina.connector.Request</code>。</li>
<li><code>connector.getService().getMapper().map()</code>，用来在 <code>Mapper</code> 中查询 URL 的映射关系。映射关系会保留到 <code>org.apache.catalina.connector.Request</code> 中，<code>Container</code> 处理阶段 <code>request.getHost()</code> 是使用的就是这个阶段查询到的映射主机，以此类推 <code>request.getContext()</code>、<code>request.getWrapper()</code> 都是。</li>
</ol>
</li>
<li><code>connector.getService().getContainer().getPipeline().getFirst().invoke()</code> 会将请求传递到 <code>Container</code> 处理，当然了 <code>Container</code> 处理也是在 <code>Worker</code> 线程中执行的，但是这是一个相对独立的模块，所以单独分出来一节。</li>
</ol>
<h3 id="Container"><a href="#Container" class="headerlink" title="Container"></a>Container</h3><p><img src="/test/../res/tomcat-request-process-container.png"></p>
<ol>
<li>需要注意的是，基本上每一个容器的 <code>StandardPipeline</code> 上都会有多个已注册的 <code>Valve</code>，我们只关注每个容器的 Basic Valve。其他 Valve 都是在 Basic Valve 前执行。</li>
<li><code>request.getHost().getPipeline().getFirst().invoke()</code> 先获取对应的 <code>StandardHost</code>，并执行其 pipeline。</li>
<li><code>request.getContext().getPipeline().getFirst().invoke()</code> 先获取对应的 <code>StandardContext</code>,并执行其 pipeline。</li>
<li><code>request.getWrapper().getPipeline().getFirst().invoke()</code> 先获取对应的 <code>StandardWrapper</code>，并执行其 pipeline。</li>
<li>最值得说的就是 <code>StandardWrapper</code> 的 Basic Valve，<code>StandardWrapperValve</code><ol>
<li><code>allocate()</code> 用来加载并初始化 <code>Servlet</code>，值的一提的是 Servlet 并不都是单例的，当 Servlet 实现了 <code>SingleThreadModel</code> 接口后，<code>StandardWrapper</code> 会维护一组 Servlet 实例，这是享元模式。当然了 <code>SingleThreadModel</code> 在 Servlet 2.4 以后就弃用了。</li>
<li><code>createFilterChain()</code> 方法会从 <code>StandardContext</code> 中获取到所有的过滤器，然后将匹配 Request URL 的所有过滤器挑选出来添加到 <code>filterChain</code> 中。</li>
<li><code>doFilter()</code> 执行过滤链,当所有的过滤器都执行完毕后调用 Servlet 的 <code>service()</code> 方法。</li>
</ol>
</li>
</ol>
<h2 id="At-last"><a href="#At-last" class="headerlink" title="At last"></a>At last</h2><p>博客在 CentOS 7 下编辑，这个平台的中文输入法没有搜狗用的爽，文中出现的错别字的概率可能会大一点，如果影响到了理解内容，请给我提 Issue，我会尽快修订～</p>
<p>博客持续更新，欢迎 <code>Star</code> &amp; <code>watch</code>。</p>
<p><strong>PS： 马上大四了，正在准备校招，如果各位大佬觉得博客写的还行的话，请砸面试机会给我。谢谢～</strong></p>
<ul>
<li>邮箱： <a href="mailto:&#x72;&#97;&#105;&#x6e;&#x73;&#116;&#111;&#x72;&#x6d;&#x2e;&#x6d;&#101;&#64;&#x6f;&#x75;&#116;&#x6c;&#111;&#x6f;&#x6b;&#46;&#99;&#x6f;&#109;">&#x72;&#97;&#105;&#x6e;&#x73;&#116;&#111;&#x72;&#x6d;&#x2e;&#x6d;&#101;&#64;&#x6f;&#x75;&#116;&#x6c;&#111;&#x6f;&#x6b;&#46;&#99;&#x6f;&#109;</a></li>
<li>简历： <a href="https://github.com/c-rainstorm/Resume">https://github.com/c-rainstorm/Resume</a></li>
</ul>
<p><strong>另：非常感谢 <a href="https://www.daocloud.io/">DaoCloud</a> 公司提供的面试机会！</strong></p>
<h1 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h1><ol>
<li><a href="https://www.amazon.com/How-Tomcat-Works-Budi-Kurniawan/dp/097521280X">《How Tomcat works》</a></li>
<li><a href="http://product.dangdang.com/25084132.html">《Tomcat 架构解析》– 刘光瑞</a></li>
<li><a href="https://tomcat.apache.org/tomcat-9.0-doc/index.html">Tomcat-9.0-doc</a></li>
<li><a href="http://www-eu.apache.org/dist/tomcat/tomcat-9/v9.0.0.M22/src/">apache-tomcat-9.0.0.M22-src</a></li>
<li><a href="http://gearever.iteye.com/blog/1844203">tomcat架构分析 (connector NIO 实现)</a></li>
</ol>
]]></content>
      <tags>
        <tag>Java</tag>
        <tag>Tomcat</tag>
      </tags>
  </entry>
</search>
